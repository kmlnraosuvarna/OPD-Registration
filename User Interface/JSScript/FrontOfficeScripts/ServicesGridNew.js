var ctrlcom = 'ctl00_ContentPlaceHolder1';
var width_change = 'Y';

/* Services Posting Search Button Click Pop Up Data Assigning*/
var gridControl; var isregfeeinc = ''; var is_reg_include = ''; var reqcons = ''; var _is_post = 'N'; var _is_free_followup = 'N';
var is_remarks_mandatory = 'N'; var _add_srv = [];
function OnServicesSearchLookup(ev, _val) {

    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        if (umr_no == '') {
            $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
            return false;
        }

        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
            $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
            $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
            return false;
        }
        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
            if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                return false;
            }
        }
    }
    if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_pre_regi').value != 5) {
            if (document.getElementById('ctl00_ContentPlaceHolder1_hdndtrmandatary').value == 'YES' || OrderingPhyCount == 1) {
                if (document.getElementById('' + ctrlcom + '_ucConsultant_txtSearchControl').value == '' || document.getElementById('' + ctrlcom + '_ucConsultant__hiddenID').value == '') {
                    $(".stoast").toastText("warning", "Please select Consultant Doctor.", 5, 3);
                    document.getElementById('' + ctrlcom + '_ucConsultant_txtSearchControl').focus();
                    OrderingPhyCount = 0;
                    return false;
                }
            }
        }
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
            if (umr_no == '') {
                $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
                $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
                $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }
            }
        }
        else {
            var pat_type = $('#' + ctrlcom + '_ddlPatientType').val();
            if (pat_type == 2 || pat_type == 5 || pat_type == 7 || pat_type == 10) {
                if ($('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }

            }

        }
    }

    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
    if (hdnallowtariffslcn == 'true') {

        var pat_type = '';
        if (form_name == 'OP' || form_name == 'Cons') {
            pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
            }
            else {
                pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
            }
        }
        if (pat_type == 1) {
            var PatientCategory = document.getElementById('' + ctrlcom + '_UCServices_ddlpatcat').value;
            if (PatientCategory == undefined || PatientCategory == null || PatientCategory == '' || PatientCategory == '--select--' || PatientCategory == '0') {
                $(".stoast").toastText("warning", "Please Select Patient Category", 5, 3);
                return false;

            }
            var taiff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;
            if (taiff_id == undefined || taiff_id == null || taiff_id == '' || taiff_id == '--select--' || taiff_id == '0') {
                $(".stoast").toastText("warning", "Please Select Tariff", 5, 3);
                $(".stoast").toastText("warning", "Sorry  No Tariff Mapped To This Patient Category", 5, 2);
                return false;
            }
        }
    }


    var CurrentRowIndex = 0;
    var Post_Cons_Style = '';
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.parentElement.rowIndex : ev.parentElement.parentElement.parentElement.parentElement.rowIndex;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var _selectedDoctorID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
    var _selectedSrvID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();

    var _selected_Dept_ID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
    if (_selected_Dept_ID == undefined || _selected_Dept_ID == null || _selected_Dept_ID == '') { _selected_Dept_ID = 0; }
    var order_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdn_ord_id]').val();
    var order_det_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnord_det_id]').val();
    document.getElementById('' + ctrlcom + '_UCServices_hdnOptions').value = '0';
    if (order_id == undefined || order_id == null || order_id == '')
    { order_id = 0; }
    if (order_det_id == undefined || order_det_id == null || order_det_id == '')
    { order_det_id = 0; }
    if (order_id == '1' && order_det_id == '1') {
        document.getElementById('' + ctrlcom + '_UCServices_hdnOptions').value = '3';
    }
    if (_selectedDoctorID == null || _selectedDoctorID == undefined || _selectedDoctorID == '') { _selectedDoctorID = "0"; }
    if (_selectedSrvID == null || _selectedSrvID == undefined || _selectedSrvID == '') { _selectedSrvID = "0"; }
    if (_selectedDoctorID > 0 || _selected_Dept_ID > 0) {
        document.getElementById('' + ctrlcom + '_UCServices_hdnOptions').value = '3';
    }
    var Post_Cons = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=chkPstCons]').attr('style');
    if (Post_Cons != undefined) {
        Post_Cons = Post_Cons.split(';');
        Post_Cons_Style = Post_Cons[0];
    }
    var is_MCI = $('#' + ctrlcom + '_UCServices_hdnIS_MCI').val();
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if ((document.getElementById('' + ctrlcom + '_UCServices_hdnOptions').value == '3' && _val != 'TblHeader') || (Post_Cons_Style == 'display: block' && _val != 'TblHeader')) {
        ctl00_ContentPlaceHolder1_UCServices_PanelSrvsLup.style.display = "block";
        divSrvsCons.style.display = "block";
        var _dept_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
        var _Doctor_Name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]');
        var _Doctor_Cd = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceCode]');
        var _Doctor_ID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]');
        var class_srv_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]');
        var hdnConsCharge = document.getElementById('' + ctrlcom + '_hdnConsCharge').vlaue;
        if (hdnConsCharge == '' || hdnConsCharge == undefined || hdnConsCharge == null) { hdnConsCharge = 0; }
        var cName = 'DISPLAY_NAME'; var pText = '';
        if (_dept_id == undefined || _dept_id == null || _dept_id == '') { _dept_id = '0'; }
        var defpagesize = $('[id*=hdninitialgridpagecount]').val();
        if (defpagesize == "" || defpagesize == null || defpagesize == undefined || defpagesize == "0") { defpagesize = "10"; }
        var param = param || {};
        param.dataKey = "ID";
        param.pageSize = defpagesize;
        param.pageNum = 1;
        param.defaultWSParams = { _cName: cName, _pText: pText, _advSrch: '', flag: _dept_id };
        param.wsPath = "GridService.asmx/GetConsultationDoctors";
        param.wsFilterPath = "GridService.asmx/GetConsultationDoctors";
        param.template = ["DISPLAY_NAME*DISPLAY_NAME"
                        , "DOCTOR_CD*DOCTOR_CD"
                        , "DEPARTMENT_DESC*DEPARTMENT_DESC"];
        param.header = [{ col: "Doctor Name", sort: true, filter: true }
                        , { col: "Code", sort: true, filter: false }
                        , { col: "Department", sort: true, filter: true}];

        param.enablePaging = true;
        param.enableTrace = false;
        param.enableFilter = true;
        param.enableCheckbox = false;
        param.enableSorting = true;
        param.likeLookup = true;
        param.RowNo = true; param.tableTemplate = true;
        param.enableDMS = false;
        param.rowClick = function (key) {
            if (key.ID != 'undefined' && key.ID != undefined) {
                if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons') {
                    if ($.inArray(parseInt(key.ID), arrServiceIds) != -1) {
                        $(".stoast").toastText("warning", "Consultation For Doctor Already Exists", 5, 3);
                        $('[id*=PanelSrvsLup]')[0].style.display = 'none';
                        return false;

                    }
                    if (key.ID != 'undefined' && key.ID != undefined) {
                        arrServiceIds[CurrentRowIndex] = parseInt(key.ID);
                    }
                }
                $("table[id*=UCServices_gvServices] tr:has(td)").each(function () {

                    var RowIndexForGrid = $(this)[0].rowIndex;
                    var _srv_id = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceID]').val();
                    var _srv_doctorId = $(this).closest('tr').find('input[type=hidden][id*=hdnDoctorID]').val();
                    var _service_name = $(this).closest('tr').find('input[type=text][id*=txtServiceName]').val();
                    var hdnDepartment_Id = $(this).closest('tr').find('[id*=hdnDepartment_Id]').val();

                    if (parseInt(key.ID) > 1) {
                        if (_srv_doctorId == key.ID || _srv_doctorId == key.ID) {
                            $(".stoast").toastText("warning", "Consultation For Doctor '" + _service_name + "'Already Exists in  Package", 5, 3);
                            $(this).closest('tr').remove();
                            CalculateGridAmt(RowIndexForGrid);
                        }
                    }
                });
                var per = 0;

                _Doctor_ID.val(key.ID);
                _Doctor_Name.val(key.DISPLAY_NAME);
                _Doctor_Cd.val(key.DOCTOR_CD);




                if (key.DEPARTMENT_ID > 0 && key.ID > 0) {
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').removeClass('red');
                    PkgConsBindSlotsCalling(CurrentRowIndex);
                }
            }
            $('[id*=PanelSrvsLup]')[0].style.display = 'none';
        };
        gridControl = $("#divSrvsCons").jtable(param);
        return false;
    }
    else {
        ctl00_ContentPlaceHolder1_UCServices_PanelSrvsLup.style.display = "block";
        divSrvsCons.style.display = "block";
        var service_type_id = 0;
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
            if (is_MCI.toLowerCase() == 'true') {
                if ($('#' + ctrlcom + '_UCServices_rbtnmcicreit_0')[0].checked) {
                    service_type_id = '2';
                }
                else {
                    service_type_id = '1';
                }
            }
            else {
                service_type_id = '1';
            }
        }

        var tariff_id = '1';
        if ($('[id*=hdnallowtariffslcn]').val().toLowerCase() == 'true') {
            if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' || document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP')) {
                if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') {
                    tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                }
                else if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '1') {
                    tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;

                }
                else if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value != '') {
                        tariff_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value;
                    }
                }
                else {
                    tariff_id = 1;
                }
            }
            else {
                tariff_id = 1;
            }
            if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnOPDState').value != '') {
                if ($('#' + ctrlcom + '_chk_old')[0].checked == false) {
                    if ((document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10') && service_type_id == '1') {
                        if ($('#' + ctrlcom + '_chk_old')[0].checked == true) {
                            tariff_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa_hiddenID').value;
                        } else {
                            tariff_id = $("#" + ctrlcom + "_EmployerInfo1_uctpa__hiddenID").val();
                        }

                    }
                    else if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '1') {
                        tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;

                    }
                }
                else {
                    if ((document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') && service_type_id == '1') {
                        tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                    }
                    else if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '1') {
                        tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;

                    }
                }
            }
        }
        else {

            tariff_id = 1;
        }

        var Patient_Class_id = '2';
        var column_name = 'SERVICE_NAME';
        var prefix_text = '';
        var advance_serch = '';
        var flag = 'Y';
        var Gender_id = document.getElementById('' + ctrlcom + '_UCServices_hdnGenderID').value;
        if (Gender_id == undefined || Gender_id == null || Gender_id == '') { Gender_id = "0"; }
        var company_id = '0';
        var referal_letter_id = '0';
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
            company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
            if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
                referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
            } else {
                referal_letter_id = 0;
            }
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
            var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
            if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
                referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
            else
                referal_letter_id = 0;
            company_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
            if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
                referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
            } else {
                referal_letter_id = 0;
            }
            company_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
        }
        var umr_no = '';
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && document.getElementById('' + ctrlcom + '_chkIsOsp').checked == false) {
            umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons') {
            umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
        else {
            umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnCon_In_Op').value == 'True')
        { flag = 'Y'; }
        else
        { flag = 'N'; }
        var _count = "0";
        if (company_id == undefined || company_id == null || company_id == '') { company_id = "0"; }
        if (service_type_id == undefined || service_type_id == null || service_type_id == '') { service_type_id = "0"; }
        if (tariff_id == undefined || tariff_id == null || tariff_id == '') { tariff_id = "1"; }
        if (Patient_Class_id == undefined || Patient_Class_id == null || Patient_Class_id == '') { Patient_Class_id = "0"; }
        if (Gender_id == undefined || Gender_id == null || Gender_id == '') { Gender_id = "4"; }

        var docdepartment = $('#ddldeprtment').val();
        if (docdepartment == undefined || docdepartment == null || docdepartment == '' || docdepartment == '--select--' || docdepartment == '0') { docdepartment = '0' }
        if (docdepartment != 0) { document.getElementById('' + ctrlcom + '_UCServices_ddlunits').value = 0; }
        var docunits = document.getElementById('' + ctrlcom + '_UCServices_ddlunits').value;
        if (docunits == undefined || docunits == null || docunits == '' || docunits == '--select--' || docunits == '0') { docunits = '0' }

        var _contextKey = service_type_id + "," + tariff_id + "," + Patient_Class_id + "," + column_name + "," + flag + "," + Gender_id + "," + company_id + "," + umr_no + ',' + referal_letter_id + ',' + docdepartment + ',' + docunits;
        var _bill_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_ucBills__hiddenID').value;
        if (_bill_id == undefined || _bill_id == null || _bill_id == '') { _bill_id = "0"; }
        var defpagesize = $('[id*=hdninitialgridpagecount]').val();
        if (defpagesize == "" || defpagesize == null || defpagesize == undefined || defpagesize == "0") { defpagesize = "10"; }
        var param = param || {};
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
            param.dataKey = "DOCTOR_ID";
        }
        else {
            param.dataKey = "SERVICE_ID";
        }
        param.pageSize = defpagesize;
        param.pageNum = 1;
        var AdvSrc = '';
        var srvpertariff = '';
        if (document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').checked == true) {
            srvpertariff = 'Y'
        }
        else {
            srvpertariff = 'N'
        }
        param.defaultWSParams = { prefixText: prefix_text, count: _count, contextKey: _contextKey, _advSrch: '', bill_id: _bill_id, tariff_id: tariff_id, srvpertariff: srvpertariff };
        param.wsPath = "ServiceMasterWebService.asmx/GetAllOPServiceAutoLookup";
        param.wsFilterPath = "ServiceMasterWebService.asmx/GetAllOPServiceAutoLookup";

        if (document.getElementById('' + ctrlcom + '_UCServices_hdnsrvpricereq').value.toLowerCase() == 'yes') {
            if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
                param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "PRICE*PRICE"
                    , "SERVICE_CD*SERVICE_CD"
                    , "DEPARTMENT_NAME*DEPARTMENT_NAME"
                                   ];
                param.header = [{ col: "Doctor Name", sort: false, filter: true }
                                    , { col: "Price", sort: true, filter: true }
                                    , { col: "Doctor Code", sort: false, filter: true }
                                    , { col: "Department Name", sort: false, filter: true }
                                    ];
            }
            else {
                if (document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').checked == true) {
                    param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "PRICE*PRICE"
                    , "SERVICE_CD*SERVICE_CD"
                    , "SERVICE_GROUP*SERVICE_GROUP"
                    , "SERVICE_TYPE_NAME*SERVICE_TYPE_NAME"
                     , "GEN_SERVICE_NAME*GEN_SERVICE_NAME"
                      , "GEN_SERVICE_CODE*GEN_SERVICE_CODE"

                    /* , "ESTIMATED_TIME*ESTIMATED_TIME"*/
                                   ];
                    param.header = [{ col: "Service Name", sort: false, filter: true }
                                    , { col: "Price", sort: false, filter: false }
                                    , { col: "Service Code", sort: false, filter: true }
                                    , { col: "Service Group Name", sort: false, filter: true }
                                    , { col: "Service Type Name", sort: false, filter: true }
                                      , { col: "General Service Name", sort: false, filter: true }
                                        , { col: "General Service Code", sort: false, filter: true }

                    /*, { col: "TAT", sort: false, filter: false }*/
                                    ];
                }
                else {
                    param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "PRICE*PRICE"
                    , "SERVICE_CD*SERVICE_CD"
                    , "SERVICE_GROUP*SERVICE_GROUP"
                    , "SERVICE_TYPE_NAME*SERVICE_TYPE_NAME"

                                   ];
                    param.header = [{ col: "Service Name", sort: false, filter: true }
                                    , { col: "Price", sort: false, filter: false }
                                    , { col: "Service Code", sort: false, filter: true }
                                    , { col: "Service Group Name", sort: false, filter: true }
                                    , { col: "Service Type Name", sort: false, filter: true }

                                    ];
                }
            }
        }
        else {
            if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
                param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "SERVICE_CD*SERVICE_CD"
                    , "DEPARTMENT_NAME*DEPARTMENT_NAME"
                                   ];
                param.header = [{ col: "Doctor Name", sort: false, filter: true }
                                    , { col: "Doctor Code", sort: false, filter: true }
                                    , { col: "Department Name", sort: false, filter: true }
                                    ];
            }
            else {
                if (document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').checked == true) {
                    param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "SERVICE_CD*SERVICE_CD"
                    , "SERVICE_GROUP*SERVICE_GROUP"
                    , "SERVICE_TYPE_NAME*SERVICE_TYPE_NAME"
                     , "GEN_SERVICE_NAME*GEN_SERVICE_NAME"
                      , "GEN_SERVICE_CODE*GEN_SERVICE_CODE"

                                   ];
                    param.header = [{ col: "Service Name", sort: false, filter: true }
                                    , { col: "Service Code", sort: false, filter: true }
                                    , { col: "Service Group Name", sort: false, filter: true }
                                    , { col: "Service Type Name", sort: false, filter: true }
                                      , { col: "General Service Name", sort: false, filter: true }
                                        , { col: "General Service Code", sort: false, filter: true }

                    
                                    ];
                }
                else {
                    param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "SERVICE_CD*SERVICE_CD"
                    , "SERVICE_GROUP*SERVICE_GROUP"
                    , "SERVICE_TYPE_NAME*SERVICE_TYPE_NAME"

                                   ];
                    param.header = [{ col: "Service Name", sort: false, filter: true }
                                    , { col: "Service Code", sort: false, filter: true }
                                    , { col: "Service Group Name", sort: false, filter: true }
                                    , { col: "Service Type Name", sort: false, filter: true }

                                    ];
                }
            }
        }

        param.enablePaging = true;
        param.enableTrace = false;
        param.enableFilter = true;
        param.enableCheckbox = false;
        param.enableSorting = true;
        param.likeLookup = true;
        param.enableDMS = false;
        param.RowNo = true; param.tableTemplate = true;
        param.rowClick = function (key) {

            var _txt_srvName = '';
            if (_val == "TblHeader") {
                _txt_srvName = $('[id$=gv_services_header] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]');
            }
            else {
                _txt_srvName = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]');
            }
            if (key.SERVICE_NAME != 'undefined' && key.SERVICE_NAME != undefined) {
                OnItemSelection(_txt_srvName, key);
            }
            ctl00_ContentPlaceHolder1_UCServices_PanelSrvsLup.style.display = "none";
            if (document.getElementById('' + ctrlcom + '_UCServices_hdnisdoctorrequired').value == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_hdnIsCnsltReqFrSrvPsting').value.toLowerCase() == 'true') {
                var gvServicesindex = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length - 1;
                serviceDoctor($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=imgsrvdtr]'), gvServicesindex);
            }
        };
        gridControl = $("#divSrvsCons").jtable(param);
        return false;
    }
}
function serviceDoctor(ev, RowIndex) {
    ctl00_ContentPlaceHolder1_UCServices_PanelSrvsLup.style.display = "block";
    divSrvsCons.style.display = "block";
    var Patient_Class_id = '2';
    var column_name = 'SERVICE_NAME';
    var prefix_text = '';
    var flag = 'Y';
    var Gender_id = document.getElementById('' + ctrlcom + '_UCServices_hdnGenderID').value;
    if (Gender_id == undefined || Gender_id == null || Gender_id == '') { Gender_id = "0"; }
    var _bill_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_ucBills__hiddenID').value;
    if (_bill_id == undefined || _bill_id == null || _bill_id == '') { _bill_id = "0"; }
    var company_id = '0';
    var referal_letter_id = '0';
    var _count = "0";
    var _contextKey = '';
    var param = param || {};
    param.pageNum = 1;
    param.dataKey = "DOCTOR_ID";
    var service_type_id = 1;
    var tariff_id = 1;
    var srvpertariff = "N";
    var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    var _contextKey = service_type_id + "," + tariff_id + "," + Patient_Class_id + "," + column_name + "," + flag + "," + Gender_id + "," + company_id + "," + umr_no + ',' + referal_letter_id + "," + 0 + "," + 0 + "," + srvpertariff;
    param.defaultWSParams = { prefixText: prefix_text, count: _count, contextKey: _contextKey, _advSrch: '', bill_id: _bill_id, tariff_id: tariff_id, srvpertariff: srvpertariff };
    param.wsPath = "ServiceMasterWebService.asmx/GetAllOPServiceAutoLookup";
    param.wsFilterPath = "ServiceMasterWebService.asmx/GetAllOPServiceAutoLookup";
    param.template = ["SERVICE_NAME*SERVICE_NAME"
                    , "PRICE*PRICE"
                    , "SERVICE_CD*SERVICE_CD"
                    , "DEPARTMENT_NAME*DEPARTMENT_NAME"

                                   ];
    param.header = [{ col: "Doctor Name", sort: false, filter: true }
                                    , { col: "Price", sort: true, filter: true }
                                    , { col: "Doctor Code", sort: false, filter: true }
                                    , { col: "Department Name", sort: false, filter: true }
                                    ];
    param.enablePaging = true;
    param.enableTrace = false;
    param.enableFilter = true;
    param.enableCheckbox = false;
    param.enableSorting = true;
    param.likeLookup = true;
    param.enableDMS = false;
    param.RowNo = true; param.tableTemplate = true;
    param.rowClick = function (key) {
        var CurrentRowIndex = 0;
        if (RowIndex != undefined) { CurrentRowIndex = RowIndex; }
        else {
            CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : ev.parentElement.parentElement.parentElement.rowIndex;
        }
        CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtsrvdoctor]').val(key.SERVICE_NAME);
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnsrvdoctorID]').val(key.DOCTOR_ID);
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnsrvdoctortext]').val(key.SERVICE_NAME);
        var srv_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=hdnServiceID]").val();
        var doctor_id = key.DOCTOR_ID;
        var srv_price_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnsrvpriceID]').val()
        var PatNetAmt = parseFloat($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPamt]").val()) - parseFloat($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').closest('tr').find("input[type=text][id*=txtDiscAmt]").val());
        GetNonAsync(
        "ServiceMasterWebService.asmx/GetDcotorOrgPct",
        { serviceID: srv_id, doctor_id: doctor_id, srv_price_id: srv_price_id },
        function (data) {
            if (data.d != "") {
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPct]').val(data.d[0].ORG_PCT);
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPct]').val(data.d[0].DOCTOR_PCT);
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPrice]').val((setProperDecimals(PatNetAmt) * setProperDecimals(data.d[0].DOCTOR_PCT)) / 100);
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPrice]').val((setProperDecimals(PatNetAmt) * setProperDecimals(data.d[0].ORG_PCT)) / 100);
            }
        },
       function (jqXHR, textStatus, errorThrown) {
       });
        ctl00_ContentPlaceHolder1_UCServices_PanelSrvsLup.style.display = "none";
    };
    gridControl = $("#divSrvsCons").jtable(param);
    return false;
}
var _ospCount = 0;
function ServicesAutoContextKey() {
    var service_type_id = 0;
    var is_MCI = $('#' + ctrlcom + '_UCServices_hdnIS_MCI').val();
    var Price = $('#' + ctrlcom + '_hdnregfee').val();
    if (Price == '' || Price == null || Price == undefined) { Price = "0"; }
    if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
        if (is_MCI.toLowerCase() == 'true') {
            if ($('#' + ctrlcom + '_UCServices_rbtnmcicreit_0')[0].checked) {
                service_type_id = '2';
            }
            else {
                service_type_id = '1';
            }
        }
        else {
            service_type_id = '1';
        }
        if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnOspRegReq').value == 'Y' && $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtServiceName]').val() != "REGISTRATION") {
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtRate]').val(Price);
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtAmount]').val(Price);
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(Price);
            CalculateGridAmt(0);
        }
        if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnOspRegReq').value == 'Y') {
            PatientRegFeeAmounts_New(Price);
            _ospCount = 1;
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
        Price = 0;
        if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnOspRegReq').value == 'Y' && _ospCount == 1) {
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtRate]').val(Price);
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtAmount]').val(Price);
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(Price);
            CalculateGridAmt(0);
        }
    }

    var tariff_id = '1';
    if ($('[id*=hdnallowtariffslcn]').val().toLowerCase() == 'true') {
        if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' || document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP')) {
            if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') {
                tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
            }
            else if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '1') {
                tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;

            }
            else if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value != '') {
                    tariff_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value;
                }
            }
            else {
                tariff_id = 1;
            }
        }
        else {
            tariff_id = 1;
        }
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnOPDState').value != '') {
            if ($('#' + ctrlcom + '_chk_old')[0].checked == false) {
                if ((document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10') && service_type_id == '1') {
                    if ($('#' + ctrlcom + '_chk_old')[0].checked == true) {
                        tariff_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa_hiddenID').value;
                    } else {
                        tariff_id = $("#" + ctrlcom + "_EmployerInfo1_uctpa__hiddenID").val();
                    }

                }
                else if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '1') {
                    tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;

                }
            }
            else {
                if ((document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') && service_type_id == '1') {
                    tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                }
                else if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '1') {
                    tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;

                }
            }
        }
    }
    else {

        tariff_id = 1;
    }

    var Patient_Class_id = '2';
    var column_name = 'SERVICE_NAME';
    var flag = 'Y';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnCon_In_Op').value == 'True')
    { flag = 'Y'; }
    else
    { flag = 'N'; }
    var Gender_id = '1';
    var company_id = '0';
    var referal_letter_id = 0;

    var umr_no = '';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && document.getElementById('' + ctrlcom + '_chkIsOsp').checked == false) {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'Cons') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') || (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'Cons' && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2')) {

        referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {

        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        company_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        company_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
    }

    var srvpertariff = '';
    if (document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').checked == true) {
        srvpertariff = 'Y'
    }
    else {
        srvpertariff = 'N'
    }
    if (tariff_id == '' || tariff_id == undefined || tariff_id == null) { tariff_id = 1; }
    if (company_id == undefined || company_id == null || company_id == '') { company_id = "0"; }

    var docdepartment = $('#ddldeprtment').val();
    var docunits = document.getElementById('' + ctrlcom + '_UCServices_ddlunits').value;
    if (docdepartment == undefined || docdepartment == null || docdepartment == '' || docdepartment == '--select--' || docdepartment == '0') { docdepartment = '0' }
    if (docunits == undefined || docunits == null || docunits == '' || docunits == '--select--' || docunits == '0') { docunits = '0' }

    var Contextkey = service_type_id + "," + tariff_id + "," + Patient_Class_id + "," + column_name + "," + flag + "," + Gender_id + "," + company_id + "," + umr_no + ',' + referal_letter_id + ',' + srvpertariff + ',' + docdepartment + ',' + docunits;
    var Index = document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndex').value;
    var Length = $('table[id*=gv_services] tr:has(td)').length;

    if (Length == '1')
        Index = 2;
    else {
        Index = Index;
    }
    var Id = '';

    if (Index == '2') {
        var OrgId = ($("#" + ctrlcom + "_UCServices_gv_services_header tbody tr:eq(" + Index + ") td:eq(3) input").attr("id"));
        if (OrgId == 'ctl00_ContentPlaceHolder1_UCServices_gv_services_header_ctl03_txtServiceName') {
            Id = ($("#" + ctrlcom + "_UCServices_gv_services_header tbody tr:eq(" + Index + ") td:eq(3) input").attr("id")).replace("txtServiceName", "autoComplete1");
        }
        else {
            var IDCount = OrgId.lastIndexOf("_") + 1;
            var autocomp = OrgId.substring(IDCount, OrgId.length);
            Id = autocomp.replace("txtServiceName", "autoComplete1");
        }
    }
    else {
        Id = ($("#" + ctrlcom + "_UCServices_gv_services_header tbody tr:eq(" + Index + ") td:eq(3) input").attr("id"));
        var txtID = Id.lastIndexOf("_") + 1;
        var autocomp = Id.substring(txtID, Id.length);
        Id = autocomp.replace("txtServiceName", "autoComplete1");
    }
    var autoId = Id;
    if ($find(autoId) != null) {
        $find(autoId).set_contextKey(Contextkey);
    }

}

var AllowSrv = 'N'; var Childcount = 0;
function OnItemSelection(sender, eventArgs) {

    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value <= 0) {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = 0;
    }
    var index_data = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length;
    var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OPQUICK') {
        if (index_data > 0) {
            document.getElementById('ctl00_ContentPlaceHolder1_chkhccrd').disabled = true;
        }
        else {
            document.getElementById('ctl00_ContentPlaceHolder1_chkhccrd').disabled = false;
        }
        if (document.getElementById('' + ctrlcom + '_hdnrefletterreq').value == 'Y') {
            var letterno = document.getElementById('' + ctrlcom + '_EmployerInfo1_txtrefletter').value;
            letterno = letterno || 0;
            if (letterno == 0) {
                $(".stoast").toastText("warning", "Please Enter Letter Deatails", 5, 3);
                return false;

            } else {

            }
        }
    }

    var client_name = $('[id*=hdnclientNameFor]').val();
    var admn_id = ''; _is_post = 'N';
    var Allow_Admit_in_op = 'N';
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP') {
        Allow_Admit_in_op = $('#' + ctrlcom + '_hdnAdmn_Pat_Op').val();
    }
    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnNewAdmnID').value != 0 && document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnNewAdmnID').value != "" && document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnNewAdmnID').value != undefined && Allow_Admit_in_op == 'False') {
        admn_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnNewAdmnID').value;
    }
    var results = ''; var _sender = '';
    if (sender._popupBehavior == undefined) {
        results = eventArgs;
        _sender = sender;
    }
    else {

        
        results = $.parseJSON(eval($($(eventArgs._item).closest("li")[0]).find("span")[$($(eventArgs._item).closest("li")[0]).find("span").length - 1].innerText))
        _sender = sender._popupBehavior._parentElement;
    }
    if (results.RECORD_STATUS == 'I') {
        $(".stoast").toastText("warning", "This Service " + results.TEXT + " Is In-Activated ,Please Contact Administrator.", 5, 3);
        $('#' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').val('');
        return false;
    }
    var gvServices = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var rowIndex = gvServices.rows.length;
    var checkRowIndex = '';
    var SERVICE_ID = results.SERVICE_ID;
    if (results.SERVICE_ID == undefined || results.SERVICE_ID == '' || results.SERVICE_ID == 'NaN') { SERVICE_ID = results.service_id; }
    if (SERVICE_ID == '2' && results.DOCTOR_ID != "0" && results.DOCTOR_ID != "") {
        SERVICE_ID = results.DOCTOR_ID;
    }
    if (SERVICE_ID == null || SERVICE_ID == '' || SERVICE_ID == undefined) { SERVICE_ID = 0; }
    var service_type_id = 0;
    var tariff_id = 1;
    if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
        service_type_id = '1';
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && results.SERVICE_ID == 2) {
        if (results.DOC_HOL_STATUS == "Y") {
            if (results.APMNT_DOC_LEAVE_FROM_DT == null || results.APMNT_DOC_LEAVE_FROM_DT == undefined) { results.APMNT_DOC_LEAVE_FROM_DT = ""; }
            if (results.APMNT_DOC_LEAVE_TO_DT == null || results.APMNT_DOC_LEAVE_TO_DT == undefined) { results.APMNT_DOC_LEAVE_TO_DT = ""; }
            if (results.APMNT_DOC_LEAVE_FROM_DT != "" && results.APMNT_DOC_LEAVE_TO_DT != "") {
                var from_dt = new Date(results.APMNT_DOC_LEAVE_FROM_DT).format("dd-MMM-yyyy");
                var to_dt = new Date(results.APMNT_DOC_LEAVE_TO_DT).format("dd-MMM-yyyy");
                $(".stoast").toastText("warning", "This Doctor is in Vacation/Holiday From " + from_dt + " to " + to_dt + "!", 5, 3);
            } else {
                $(".stoast").toastText("warning", "Today Doctor is in Vacation/Holiday!", 5, 3);
            }
            _sender.value = '';
            _sender.focus();
            return false;
        }
        if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10') {
            if ($('#' + ctrlcom + '_chk_old')[0].checked == true) {
                tariff_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa_hiddenID').value;
                tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                if (tariff_id > 0) {
                    var charge_setup_done = results.CHARGE_SETUP_DONE;
                    if (charge_setup_done == '' || charge_setup_done == null || charge_setup_done == undefined) {
                        charge_setup_done = 'N';
                    }
                    var _cmpName = '';
                    if ($('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl') != null) {
                        _cmpName = $('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val();
                    }

                    if (charge_setup_done == 'N') {
                        $(".stoast").toastText("warning", "Consultation Charge Setup Was Not Done For This Company  " + _cmpName + " under this tariff ", 5, 3);
                        return false;
                    }
                }
            } else {
                tariff_id = $("#" + ctrlcom + "_EmployerInfo1_uctpa__hiddenID").val();
                if (tariff_id > 0) {
                    var charge_setup_done = results.CHARGE_SETUP_DONE;
                    if (charge_setup_done == '' || charge_setup_done == null || charge_setup_done == undefined) {
                        charge_setup_done = 'N';
                    }
                    var _cmpName = '';
                    if ($('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl') != null) {
                        _cmpName = $('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val();
                    }

                    if (charge_setup_done == 'N') {
                        $(".stoast").toastText("warning", "Consultation Charge Setup Was Not Done For This Company  " + _cmpName + " under this tariff ", 5, 3);
                        return false;
                    }
                }
                var conslimit = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpcons').value;
                var consover = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpconsdone').value;
                if (consover == "" || consover == null || consover == undefined) { consover = "0"; }
                var count = 0;
                $('table[id*=UCServices_gvServices] tr').each(function (e) {
                    var srvconcount = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceID]').val();
                    if (srvconcount == 2) {
                        var classsrvid = $(this).closest('tr').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                        if (classsrvid > 0) {
                            if ($(this).closest('tr').find('[id*=chkPstCons]')[0].checked == true) { count++; }
                        } else {
                            count++;
                        }
                    }
                });

            }
            if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value = tariff_id;
            }
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && results.SERVICE_ID == 2) {
        if (results.DOC_HOL_STATUS == "Y") {
            if (results.APMNT_DOC_LEAVE_FROM_DT == null || results.APMNT_DOC_LEAVE_FROM_DT == undefined) { results.APMNT_DOC_LEAVE_FROM_DT = ""; }
            if (results.APMNT_DOC_LEAVE_TO_DT == null || results.APMNT_DOC_LEAVE_TO_DT == undefined) { results.APMNT_DOC_LEAVE_TO_DT = ""; }
            if (results.APMNT_DOC_LEAVE_FROM_DT != "" && results.APMNT_DOC_LEAVE_TO_DT != "") {
                var from_dt = new Date(results.APMNT_DOC_LEAVE_FROM_DT).format("dd-MMM-yyyy");
                var to_dt = new Date(results.APMNT_DOC_LEAVE_TO_DT).format("dd-MMM-yyyy");
                $(".stoast").toastText("warning", "This Doctor is in Vacation/Holiday From " + from_dt + " to " + to_dt + "!", 5, 3);
            } else {
                $(".stoast").toastText("warning", "Today Doctor is in Vacation/Holiday!", 5, 3);
            }
            _sender.value = '';
            _sender.focus();
            return false;
        }
        if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
            if (tariff_id > 0) {
                var charge_setup_done = results.CHARGE_SETUP_DONE;
                if (charge_setup_done == '' || charge_setup_done == null || charge_setup_done == undefined) {
                    charge_setup_done = 'N';
                }
                var _cmpName = '';
                if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl') != null) {
                    _cmpName = $('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val()
                }
                if (charge_setup_done == 'N') {
                    $(".stoast").toastText("warning", "Consultation Charge Setup Was Not Done For This Company  " + _cmpName + " under this tariff ", 5, 3);
                    return false;
                }
            }

            if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value = tariff_id;
            }
            var conslimit = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpcons').value;
            var consover = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpconsdone').value;
            if (consover == "" || consover == null || consover == undefined) { consover = "0"; }
            var count = 0;
            $('table[id*=UCServices_gvServices] tr').each(function (e) {
                var srvconcount = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceID]').val();
                if (srvconcount == 2) {
                    var classsrvid = $(this).closest('tr').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                    if (classsrvid > 0) {
                        if ($(this).closest('tr').find('[id*=chkPstCons]')[0].checked == true) { count++; }
                    } else {
                        count++;
                    }
                }
            });
        }
    }
    else if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && SERVICE_ID == 2)) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
            if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value = tariff_id;
            }
        }
    }
    else {
        tariff_id = 1;
    }
    var Patient_Class_id = '2';
    var column_name = 'SERVICE_NAME';
    var flag = 'Y';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnCon_In_Op').value == 'True')
    { flag = 'Y'; }
    else
    { flag = 'N'; }
    var referal_letter_id = '0';
    var Gender_id = '1';
    var company_id = '0';
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    var pat_type = '';
    if (form_name == 'OP' || form_name == 'Cons') {
        pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
    }
    else if (form_name == 'OPQUICK') {
        pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
    }
    if ((form_name == 'OP' && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) || (form_name == 'Cons' && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10'))) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    }
    else if (form_name == 'OPQUICK' && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        company_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
    }

    var umr_no = '';
    var bill_no = '';
    var pkg_ids = '';

    var GvRowscount = 0;
    var count = 0;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _index = 0;
    var _index = grid.rows.length;
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
        for (GvRowscount = 0; GvRowscount <= _index; GvRowscount++) {
            var pkg_class_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
            var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            if (pkg_class_id == '3') {
                pkg_ids = pkg_srv_id;
            }

        }
    });
    if (pkg_ids == '' || pkg_ids == undefined || pkg_ids == null)
    { pkg_ids = ''; }
    if (form_name == 'OP' && document.getElementById('' + ctrlcom + '_chkIsOsp').checked == false) {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        bill_no = $('#' + ctrlcom + '_UCServices_ucbillno_txtSearchControl').val();
    }
    else if (form_name == 'Cons') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else if (form_name == 'OPQUICK') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        bill_no = $('#' + ctrlcom + '_UCServices_ucbillno_txtSearchControl').val();
    }
    else {
        umr_no = '';
    }
    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
        if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value != '') {
            tariff_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value;
        }
    }
    if (bill_no == undefined || bill_no == null)
    { bill_no = ''; }
    var _count = "0";
    /*patient Category Mapping Concept*/
    if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK') {
        var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
        var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
        var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
        var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
        if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
        if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
        if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1)
            tariff_id = pat_tariff_id;
    }
    tariff_id = tariff_id == undefined ? 1 : tariff_id;
    if (company_id == undefined || company_id == null || company_id == '') { company_id = "0"; }
    if (service_type_id == undefined || service_type_id == null || service_type_id == '') { service_type_id = "0"; }
    if (tariff_id == undefined || tariff_id == null || tariff_id == '') { tariff_id = "0"; }
    if (Patient_Class_id == undefined || Patient_Class_id == null || Patient_Class_id == '') { Patient_Class_id = "0"; }
    if (Gender_id == undefined || Gender_id == null || Gender_id == '') { Gender_id = "4"; }
    var _Contextkey = '';
    if (admn_id == null || admn_id == undefined || admn_id == '') { /* Allow Admited Patient For Particular Service Added By Pushkar */
        _Contextkey = service_type_id + "," + tariff_id + "," + Patient_Class_id + "," + column_name + "," + flag + "," + Gender_id + "," + company_id + "," + umr_no + "," + SERVICE_ID + "," + 0 + "," + referal_letter_id + "," + bill_no + "," + pkg_ids + "," + pat_cat_id;
    }
    else {
        _Contextkey = service_type_id + "," + tariff_id + "," + Patient_Class_id + "," + column_name + "," + flag + "," + Gender_id + "," + company_id + "," + umr_no + "," + SERVICE_ID + ',' + admn_id + "," + referal_letter_id + "," + bill_no + "," + pkg_ids + "," + pat_cat_id;
    }
    GetNonAsync("ServiceMasterWebService.asmx/NewGetAutoCompleteSErviceInfo",
    { prefixText: '', count: parseInt(_count), contextKey: _Contextkey },
    function (jdata) {
        if (jdata.d != null) {
            if (jdata.d.length == 0) {
                if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value != '') {
                        var tariff_id_f = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value;
                        if (parseInt(tariff_id_f) > 1) {
                            if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
                                if (company_id > 0 && service_type_id == 1) {
                                    $(".stoast").toastText("warning", "The Selected Consultant is not mapped for the Company ", 5, 3);
                                    return false;
                                }
                                else {
                                    $(".stoast").toastText("warning", "This Patient is mapped as Foreign Patient, Selectd Consultation Not Applicable for this patient ", 5, 3);
                                    return false;
                                }
                            }
                        }
                        else if (company_id > 0 && service_type_id == 1) {
                            $(".stoast").toastText("warning", "Consultation Charge setup was not done ", 5, 3);
                            return false;

                        }
                        else {
                            $(".stoast").toastText("warning", "This Service is not applicable for OP Patients", 5, 3);
                            return false;
                        }
                    }
                    else {
                        $(".stoast").toastText("warning", "This Service is not applicable for OP Patients", 5, 3);
                        return false;
                    }
                }
                else {
                    $(".stoast").toastText("warning", "This Service is not applicable for OP Patients", 5, 3);
                    return false;
                }
            }
            else {
                OnAssignSerice(_sender, jdata.d[0][0]);
            }
            /** add for swipe functionality**/
            VisibleSwipe();
        }
    }, function () {
    });
}
function AllowAdminCharges() {

    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (form_name == 'OPQUICK' || form_name == 'Cons') {
        var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        var bill_no = $('#' + ctrlcom + '_UCServices_ucbillno_txtSearchControl').val();
    }
    else {
        var umr_no = '';
    }
    /*patient Category Mapping Concept*/
    var _tariff_id = 1;
    var _form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (_form_name == 'OP' || _form_name == 'Cons' || _form_name == 'OPQUICK' || _form_name == 'REG') {
        var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
        var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
        var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
        var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
        if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
        if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
        if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1)
            _tariff_id = pat_tariff_id;
    }
    var srv_id = document.getElementById('' + ctrlcom + '_UCServices_hdnconssrvID').value;
    var column_name = 'SERVICE_NAME';
    
    if (_form_name == 'OP' || _form_name == 'Cons') {
        var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    } else {
        if (_form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

            } else {
                var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
            }
        }
    }
    if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
    { Cmp_id = 0; }
    var _Contextkey = 0 + "," + _tariff_id + "," + 2 + "," + column_name + "," + 'N' + "," + 1 + "," + Cmp_id + "," + umr_no + "," + srv_id + "," + 0 + "," + 0 + "," + 0 + "," + 0;
    if (srv_id == undefined || srv_id == null || srv_id == '') { srv_id = 0; }
    if (srv_id != 0) {
        GetNonAsync("ServiceMasterWebService.asmx/NewGetAutoCompleteSErviceInfo",
    { prefixText: '', count: parseInt(0), contextKey: _Contextkey },
    function (jdata) {
        if (jdata.d != null && jdata.d[0][0] != null && jdata.d[0][0] != undefined && jdata.d[0][0] != 'undefined') {
            ctl00_ContentPlaceHolder1_UCServices_rbtnSrvsAndCons_1.checked = true;
            AssignValues("ctl00_ContentPlaceHolder1_UCServices_gv_services_header_ctl03_txtServiceName", jdata.d[0][0]);
            ctl00_ContentPlaceHolder1_UCServices_rbtnSrvsAndCons_0.checked = true;
            ServicesAutoContextKey();
        }
    });
    }
}
function OnsuccesssaveConfirmationwithParam_message_services(param) {
    var id = "ctl00_ContentPlaceHolder1_UCServices_gv_services_header_ctl03_txtServiceName";
    var docid = param.Doctor_id;

    if (parseInt(param.Doctor_id) > 0 && param.VALUE == '2') {
        if (docid == '' || docid == undefined || docid == null) { docid = "0"; }
        if (parseInt(docid) == parseInt(param.Doctor_id)) {
            var _consID = 0;
            var docName = param.TEXT;
            var sedt = new Date(param.PRIV_SRV_POSTED_DT).format('dd-MMM-yyyy');
            var currDt = new Date().format('dd-MMM-yyyy');
            if (sedt == currDt) {
                if (document.getElementById('' + ctrlcom + '_hdnalwsameconsameday').value == "Yes") {
                    var obj = 'suvarna';
                    return ConfirmationRequiredForSaveWithParam_message_Cons(obj, param, "Consultation For This Doctor (" + docName + ") Was Already Done On (" + sedt + "). Do You Want To Continue..");
                }
                else {

                    $(".stoast").toastText("warning", "Consultation For This Doctor (" + docName + ") Was Already Done On (" + sedt + "). System Doesnot allow More Than One Consultation For Same Doctor On Same Day", 5, 3);
                    document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').value = '';
                    return false;
                }
            }
        }
    }
    else {

        AssignValues(id, param);
        logcancel();
        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons') {
            var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        } else {
            if (form_name == 'OPQUICK') {
                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

                } else {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
                }
            }
        }
        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
        { Cmp_id = 0; }
        if (Cmp_id == 0) {
            var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
            if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
            { con_ruleId = 0; }
            if (con_ruleId > 0) {

                var con_rule_name = $('#' + ctrlcom + '_UCServices_hdnconrulename').val();

                BindDataPatientconsutionrule(con_ruleId, con_rule_name);
            }
        }
    }
    return false;
}
function OnCancelConfirmation_services() {

    $('#' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').val('');
    return false;
}




function OnAssignSerice(sender, results) {
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        if (umr_no == '') {
            $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
            return false;
        }
        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
            $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
            $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
            return false;
        }
        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
            if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                return false;
            }
        }
    }
    if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
            if (umr_no == '') {
                $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
                $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
                $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }
            }

        }
        else {
            var pat_type = $('#' + ctrlcom + '_ddlPatientType').val();
            if (pat_type == 2 || pat_type == 5 || pat_type == 7 || pat_type == 10) {
                if ($('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }

            }

        }
    }
    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
    if (hdnallowtariffslcn == 'true') {

        var pat_type = '';
        if (form_name == 'OP' || form_name == 'Cons') {
            pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
            }
            else {
                pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
            }
        }
        if (pat_type == 1) {
            var PatientCategory = document.getElementById('' + ctrlcom + '_UCServices_ddlpatcat').value;
            if (PatientCategory == undefined || PatientCategory == null || PatientCategory == '' || PatientCategory == '--select--' || PatientCategory == '0') {
                $(".stoast").toastText("warning", "Please Select Patient Category", 5, 3);
                return false;

            }
            var taiff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;
            if (taiff_id == undefined || taiff_id == null || taiff_id == '' || taiff_id == '--select--' || taiff_id == '0') {
                $(".stoast").toastText("warning", "Please Select Tariff", 5, 3);
                $(".stoast").toastText("warning", "Sorry  No Tariff Mapped To This Patient Category", 5, 2);
                return false;
            }
        }
    }
    if (document.getElementById('' + ctrlcom + '_uccorporate_chkRefLetReq').checked == true) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo_txtSearchControl').value == '') {
            $(".stoast").toastText("Info", "Please Enter LOA# Details", 5, 3);
            document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').value = '';
            document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo_txtSearchControl').value = '';

            return false;
        }

    }
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (form_name == 'OPQUICK' && document.getElementById('' + ctrlcom + '_pre_regi').value == '5' && results.SERVICECLASS_ID == 3) {
        $(".stoast").toastText("Info", "Health checkup packages are not eligible to osp patients", 5, 2);
        sender.value = '';
        return false;
    }
    
    if (results == 'undefined' || results == undefined) {
        $(".stoast").toastText("Info", "No Data Found", 5, 2);
        sender.value = '';
        return false;
    }
    if (results.COMPANY_ID > 0 && results.SERVICECLASS_ID == 3) {
        if (results.CMP_PKG_EXIST == "N") {
            $(".stoast").toastText("Info", "Package is not mapped under this Company/TPA", 5, 2);
            sender.value = '';
            return false;
        }
    }
    var obj = 'suvarna';
    var pkgCount = 0;
    var Date1 = new Date().format('dd-MMM-yyyy');
    if (document.getElementById('' + ctrlcom + '_hdnAppsync').value.toLowerCase() == "true") {
        if (results.SERVICECLASS_ID == 3) /*PACKAGE OR PROFILE */
        {
            $.ajax({
                type: "POST",
                url: _iniUrl + "GridService.asmx/PackageAvailabilitychk",

                data: "{'srv_id':'" + results.SERVICE_ID + "','Date':'" + Date1 + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                error: function (jqXHR, textStatus, errorThrown) {
                    /*error message */
                },
                success: function (JData) {
                    var data = JData.d;
                    var data1 = JSON.parse(data);
                    var result = $.parseJSON(data1);
                    if (result != null && data != null && data != '' && data != undefined) {
                        if (parseInt(result.length) > 0) {
                            var tot_cnt = result[0]["TOT_CNT"];
                            var book_cnt = result[0]["BOOKED_CNT"];
                            var avai_count = result[0]["AVAILABLE_CNT"];
                            if (parseInt(avai_count) > 0)
                            { }
                            else {
                                pkgCount = 1;
                                $(".stoast").toastText("warning", "Package Availability Per Day Is " + tot_cnt + "  Already Completed,Please Contact Administrator !", 5, 3);
                                return false;
                            }
                        }
                    }
                    /* sucess message */
                }
            });
        }
    }
    if (pkgCount == 1) {
        return false;
    }
    if (results.STOP_CONS == "Y") {
        $(".stoast").toastText("warning", "Sorry No More ConsultationFor This Doctor!", 5, 3);
        sender.value = '';
        sender.focus();
        return false;
    }
    if (results.STATUS == "Y") {
        $(".stoast").toastText("Info", "This Patient is Deativate Patient", 5, 2);
    }
    if (form_name == 'OP' || form_name == 'Cons') {
        pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
    }
    else if (form_name == 'OPQUICK') {
        pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
    }
    if (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10') {
        if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == false) {
                if (document.getElementById('' + ctrlcom + '_EmployerInfo1_chkcreditcheck').checked == true) {
                    document.getElementById('' + ctrlcom + '_uccorporate_hdnlimitpost').value = 'A';
                } else {
                    if (document.getElementById('' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').value != '') {
                        document.getElementById('' + ctrlcom + '_uccorporate_hdnlimitpost').value = 'A';
                    } else {
                        document.getElementById('' + ctrlcom + '_uccorporate_hdnlimitpost').value = 'R';
                    }
                }
            }
        }
        if (document.getElementById('' + ctrlcom + '_uccorporate_hdnrefletterreq').value == "Y") {
            if (document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_txtrefletter').value != "") {
                if (document.getElementById('' + ctrlcom + '_uccorporate_hdnlimitpost').value != 'A') {
                    $(".stoast").toastText("warning", "There Is No Credit Limit For This Letter!", 5, 3);
                    return false;
                }
            }
        }
    }

    if (results.DOC_HOL_STATUS == "Y") {
        if (results.APMNT_DOC_LEAVE_FROM_DT == null || results.APMNT_DOC_LEAVE_FROM_DT == undefined) { results.APMNT_DOC_LEAVE_FROM_DT = ""; }
        if (results.APMNT_DOC_LEAVE_TO_DT == null || results.APMNT_DOC_LEAVE_TO_DT == undefined) { results.APMNT_DOC_LEAVE_TO_DT = ""; }
        if (results.APMNT_DOC_LEAVE_FROM_DT != "" && results.APMNT_DOC_LEAVE_TO_DT != "") {
            var from_dt = new Date(results.APMNT_DOC_LEAVE_FROM_DT).format("dd-MMM-yyyy");
            var to_dt = new Date(results.APMNT_DOC_LEAVE_TO_DT).format("dd-MMM-yyyy");
            $(".stoast").toastText("warning", "This Doctor is in Vacation/Holiday From " + from_dt + " to " + to_dt + "!", 5, 3);
        } else {
            $(".stoast").toastText("warning", "Today Doctor is in Vacation/Holiday!", 5, 3);
        }
        sender.value = '';
        sender.focus();
        return false;
    }
    var referalqty = results.REFRL_QTY;
    referalqty = referalqty == ('' || undefined) ? 0 : referalqty;
    if (parseFloat(referalqty) > 0) {
        if (results.REFRL_QTY == results.UTILIZED_REFRL_QTY) {
            $(".stoast").toastText("Info", "This Service is Utilized" + results.REFRL_QTY + "Time Only", 5, 2);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    var cmp_rule_qty = results.CMO_RUL_QTY;
    cmp_rule_qty = cmp_rule_qty || 0;
    if (parseFloat(cmp_rule_qty) > 0) {
        if (results.CMO_RUL_QTY == results.UTILZ_CMP_RULE_QTY) {
            $(".stoast").toastText("Info", "This Service is Utilized " + results.CMO_RUL_QTY + " Time Only", 5, 2);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    var paymentBY = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
    var Cmpny = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').value;
    var Cmpny_ID = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    if (paymentBY == "2" && Cmpny == "" && Cmpny_ID == "0") {
        $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
        sender.value = '';
        sender.focus();
        return false;
    }

    if (results.NO_NEED_SRV == 'Y') {
        $(".stoast").toastText("Info", "This Service is Already Posted No Need To Post According To Service Configarations", 5, 2);
        sender.value = '';
        sender.focus();
        return false;
    }
    if (results.SERVICE_TYPE_ID != '1' && results.SERVICE_TYPE_ID != '5' && document.getElementById('' + ctrlcom + '_UCServices_hdnallowtestforbill').value.toLowerCase() != 'yes') {
        if (results.PRICE == "0") {
            $(".stoast").toastText("Info", "Zero Price Services are not allowing for Billing..!", 5, 3);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    /*if (document.getElementById('' + ctrlcom + '_UCServices_hdnallowpndg').value.toLowerCase() == 'yes') {
    if (results.IS_TARIFF_SRV_EXIST == 'Y') {
    $(".stoast").toastText("Info", "Is in pending service", 7, 2);
    return false;
    }
    else {
    ConfirmationRequiredForSaveWithParam_message_services(obj, param, 'Is in pending service. Do You Want To Continue..');
    return false;
    }
    }*/

    if (results.CHARGE_SETUP_DONE == 'N') {
        $(".stoast").toastText("warning", "Consultation Charge Setup Was Not Done For This Doctor.! ", 5, 3);
        sender.value = '';
        sender.focus();
        return false;
    }

    var umr_no = '';
    if (form_name == 'OP' || form_name == 'Cons') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else if (form_name == 'OPQUICK') {
        umr_no = '';
    }
    var Not_exist = 'N';
    if (results.SERVICE_DEPENDS == 'Y') {/* Dependent Services Exists Or Not */
        $.ajax({
            type: "POST",
            url: _iniUrl + "ServiceMasterWebService.asmx/Depends_Services",

            data: "{'_service_id':'" + results.SERVICE_ID + "','umr_no':'" + umr_no + "'}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false,
            error: function (jqXHR, textStatus, errorThrown) { alert("Error....."); },
            success: function (JData) {

                var data = JData;
                /* If Service Dependents Not Mapped Then */
                if (data.d == undefined || data.d == null || data.d == NaN || data.d == '')
                { }
                else { /* If Already Data Exists Starts */
                    var GvRowscount = 0;
                    var count = 0;
                    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                    var _index = grid.rows.length;
                    var Count_tot = 0;

                    for (var i = 0; i <= data.d.length - 1; i++) {
                        var srv_id = JData.d[i].DEPENDENT_SERVICE_ID;
                        var considering_days = JData.d[i].DEPENDENT_MAX_DAYS;
                        var Dependents_exists = JData.d[i].DEPENDENCE_EXISTS;
                        if (Dependents_exists == 'N') {
                            Not_exist = 'Y';
                            $(".stoast").toastText("warning", "This Service " + results.SERVICE_NAME + "  Has Dependent Services  With Name " + JData.d[i].DPND_SERVICE_NAME + " Please Post This Service", 5, 3);
                        }

                    }


                } /* If Already Data Exists Ends */
            }

        });
    }
    if (Not_exist == 'Y') {
        sender.value = '';
        sender.focus();
        return false;
    }
    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnIsallowed').value == "Y") {
        if (results.OP_TRAN_ALLOWED == "N") {
            $(".stoast").toastText("Info", "This Service is Not Applicapable..For This Admited Patient", 5, 2);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (results.SERVICE_TYPE_ID == '13' && (form_name == 'OPQUICK' || form_name == 'OP')) {
        $(".stoast").toastText("Info", "Operation Packages are not eligible for OP Patients", 5, 2);
        sender.value = '';
        sender.focus();
        return false;
    }
    if (form_name == 'OPQUICK') {
        if (results.NON_SHOW == 'DS' || results.NON_SHOW == 'NE') {
            $(".stoast").toastText("warning", "Based on Company Settings,this Service is Not Eligible", 5, 3);
            sender.value = '';
            sender.focus();
            return false;
        }
        if (results.NON_SHOW == 'AWA' || results.NON_SHOW == 'AR') {
            var obj = 'suvarna';
            var param = results;
            $(".stoast").toastText("Warning", "Based on Company Settings,this Service Required Authorization,Please Contact Administrator ", 5, 3);
            return false;
        }
        if (results.CHARGE_SETUP_DONE == 'N') {
            $(".stoast").toastText("warning", "Consultation Charge Setup Was Not Done For This Company  " + $('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val() + " under this tariff ", 5, 3);
            sender.value = '';
            sender.focus();
            return false;
        }
    } else {
        if (results.NON_SHOW == 'DS' || results.NON_SHOW == 'NE') {
            $(".stoast").toastText("warning", "Based on Company Settings,this Service is Not Eligible", 5, 3);
            sender.value = '';
            sender.focus();
            return false;
        }
        if (results.NON_SHOW == 'AWA' || results.NON_SHOW == 'AR') {
            var obj = 'suvarna';
            var param = results;
            $(".stoast").toastText("Warning", "Based on Company Settings,this Service Required Authorization,Please Contact Administrator ", 5, 3);
            return false;
        }
        if (results.CHARGE_SETUP_DONE == 'N') {
            $(".stoast").toastText("warning", "Consultation Charge Setup Was Not Done For This Company  " + $('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() + " under this tariff ", 5, 3);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    var Alter = '';
    if (results.SERVICE_ID == "2") {
        _value = results.DOCTOR_ID;
        Alter = 'Doctor';
        if ($.inArray(parseInt(_value), arrRequisations) != -1) {
            $(".stoast").toastText("Info", "This " + Alter + " is Already Exists in Consultation Requisitions!", 5, 2);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    else {
        _value = results.SERVICE_ID;
        Alter = 'Service';
    }
    if ($.inArray(parseInt(_value), arrServiceIds) != -1) {
        $(".stoast").toastText("Info", "This " + Alter + " is Already Exists", 5, 2);
        sender.value = '';
        sender.focus();
        return false;
    }
    /*if (results.Value == "2") {
    $("table[id$=tbl_tbl_PatRequisitions] tbody tr:has(td)").each(function () {
    var reqid = $(this).closest('tr').attr('data-key');
    if (reqid == _value) {
    $(".stoast").toastText("Info", "This " + Alter + " is Already having the Appoinment", 5, 2);
    RemoveGridRow(_value);
    return false;
    }

    });
    }*/
    var isnewborn = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnisnewborn').value;
    var patage = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblagedob').innerHTML;
    if (isnewborn == 'Y') {
        if (parseInt(results.FROM_DAYS) > 1) {
            $(".stoast").toastText("warning", "This Service Is Not Applicable For Newborn Babys!", 5, 3);
            return false;
        }
    }
    /*if (results.PRIV_SRV_POSTED_DT != null) {
    if (new Date(results.PRIV_SRV_POSTED_DT).format('dd-MMM-yyyy') == new Date().format('dd-MMM-yyyy') && results.SERVICE_TYPE_NAME != "Consultation") {
    param = results;
    _is_post = 'Y';
    if (results.SERVICECLASS_ID != "3") {
    ConfirmationRequiredForSaveWithParam_message_services(obj, param, 'This Service is Already Posted Today. Do You Want To Continue..');
    return false;
    }
    else {
    ConfirmationRequiredForSaveWithParam_message_services(obj, param, 'This Package is Already Posted Today. Do You Want To Continue..');
    return false;
    }
    }
    }*/
    document.getElementById('' + ctrlcom + '_UCServices_hdnisdoctorrequired').value = results.IS_DOCTOR_REQUIRED;
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    var S_Gen_ID = document.getElementById('' + ctrlcom + '_UCServices_hdnGender_ID').value;
    S_Gen_ID = S_Gen_ID || 0;
    var opsorpkgcons = $('#' + ctrlcom + '_UCServices_hdnOptions').val(); /*5-for opd ,3-for pkg con */
    var pat_type = '0';
    var umr_no = '';
    var pat_id = '';
    var docid = 0, docName = '';
    var reg_type = '';
    var emerg_pat = 'N';
    if (form_name == 'OPQUICK') {
        docid = results.DOCTOR_ID; /* document.getElementById('' + ctrlcom + '_ucConsultant__hiddenID').value;*/
        docName = document.getElementById('' + ctrlcom + '_ucConsultant_txtSearchControl').value;
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            var reg_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        } else {
            var reg_type = $('#' + ctrlcom + '_ddlPatientType').val();
        }

        emerg_pat = document.getElementById('' + ctrlcom + '_UCServices_hdnCasulity').value;
        if (reg_type == '2' || reg_type == '5' || reg_type == '8' || reg_type == '9' || reg_type == '10') {
            pat_type = '2';
        }
        else {
            pat_type = '1';
        }
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
            pat_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
        }
        else {
            umr_no = "no";
            pat_id = "no";
        }
    }
    else if (form_name == 'OP') {
        pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        reg_type = $('#' + ctrlcom + '_UCServices_hdnCasulity').val();
        if (reg_type == '5') {
            emerg_pat = 'Y';
        }
        else {
            emerg_pat = 'N';
        }

        if (document.getElementById('' + ctrlcom + '_chkIsOsp').checked == false) {
            umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
            pat_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
        }
        else {
            umr_no = "no";
            pat_id = "no";
        }
    }
    else if (form_name == 'Cons') {
        docid = results.DOCTOR_ID;
        docName = document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').value;
        pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        reg_type = $('#' + ctrlcom + '_UCServices_hdnCasulity').val();
        if (reg_type == '5') {
            emerg_pat = 'Y';
        }
        else {
            emerg_pat = 'N';
        }

        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        pat_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
    }

    if (umr_no != 'no' && pat_id != 'no' && (umr_no == undefined || umr_no == null || umr_no == '' || pat_id == undefined || pat_id == null || pat_id == '')) {
        $(".stoast").toastText("warning", "Please select umr number !", 5, 3);
        sender.value = '';
        sender.focus();
        return false;
    }
    if (results.GENDER_ID == "1" || results.GENDER_ID == "2") {
        if (S_Gen_ID > 0) {
            if (S_Gen_ID != results.GENDER_ID) {
                var Gen = '';
                if (S_Gen_ID == '1')
                { Gen = 'Male '; }
                else if (S_Gen_ID == '2')
                { Gen = 'Female '; }
                else {
                    Gen = 'this gender ';
                }
                $(".stoast").toastText("warning", "this service is not applicable for " + Gen, 5, 3);
                sender.value = '';
                sender.focus();
                return false;
            }
        }
    }
    is_reg_include = '';
    if (form_name == 'OPQUICK' && results.IS_REG_FEE_INCLUDED == 'Y') {
        var length = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length
        is_reg_include = 'Y';
        var servicename = $('[id$=UCServices_gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtServiceName]').val();
        if (servicename == 'REGISTRATION') {
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtRate]').val(0);
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtAmount]').val(0);
            $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(0);
            CalculateGridAmt(0);
        }
        else
        { PatientRegFeeAmounts(0); }

    }

    if (pat_type == '0') {
        $(".stoast").toastText("warning", "Please Select Patient Type Cash / Credit . ", 5, 3);
        sender.value = '';
        sender.focus();
        return false;
    }
    if (pat_type == "0" && (document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value == 0 || document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value == "")) {
        $(".stoast").toastText("warning", "Please Select Company/TPA.", 5, 3);
        sender.value = '';
        sender.focus();
        return false;
    }
    var pat_age = '';
    if (form_name == 'OP') {
        if (document.getElementById('' + ctrlcom + '_chkIsOsp').checked == true) {
            pat_age = $('#' + ctrlcom + '_newAgeUc_txtYear').val();
            $('#' + ctrlcom + '_UCServices_hdnPat_Age').val($('#' + ctrlcom + '_newAgeUc_txtYear').val());
        }
        else {
            pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
        }
    }
    else {
        pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
    }
    pat_age = pat_age || 0;
    pat_age = parseInt(pat_age);
    if (parseInt(results.FROM_DAYS) >= 0 && parseInt(results.TO_DAYS) > 0) {
        if ((parseInt(results.FROM_DAYS) <= parseInt(pat_age)) && (parseInt(pat_age) <= parseInt(results.TO_DAYS))) {

        }
        else {
            $(".stoast").toastText("warning", "This service is applicable for patient of age " + parseInt(results.FROM_DAYS) + ' To ' + parseInt(results.TO_DAYS), 5, 3);
            sender.value = '';
            sender.focus();
            return false;
        }
    }
    if (parseInt(results.DOCTOR_ID) > 0 && results.SERVICE_ID == '2') {
        if (docid == '' || docid == undefined || docid == null) { docid = "0"; }
        if (parseInt(docid) == parseInt(results.DOCTOR_ID)) {
            var _consID = 0;
            docName = results.SERVICE_NAME;
            var sedt = new Date(results.PRIV_SRV_POSTED_DT).format('dd-MMM-yyyy');
            var currDt = new Date().format('dd-MMM-yyyy');
            if (sedt == currDt) {
                if (document.getElementById('' + ctrlcom + '_hdnalwsameconsameday').value == "Yes") {
                    param = results;
                    return ConfirmationRequiredForSaveWithParam_message_services(obj, param, "Consultation For This Doctor (" + docName + ") Was Already Done On (" + sedt + "). Do You Want To Continue.");
                }
                else {
                    $(".stoast").toastText("warning", "Consultation For This Doctor (" + docName + ") Was Already Done On (" + sedt + "). System Doesnot allow More Than One Consultation For Same Doctor On Same Day", 5, 3);
                    sender.value = '';
                    sender.focus();
                    return false;
                }

            }
        }
    }
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');


    /*Casuality Credit Limit Starts*/
    var PS = '', AC = '';
    var Casual_credit_amt = document.getElementById('' + ctrlcom + '_UCServices_hdnCompanyCrdLmt').value;
    if (parseFloat(Casual_credit_amt) > 0) { } else { Casual_credit_amt = 0; }
    var PatCrdLmt = document.getElementById('' + ctrlcom + '_UCServices_hdnOPCreditLmt').value;
    var NetAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatNet').val(); /*Net Amount(Transaction).*/
    if (NetAmt == null || NetAmt == '' || NetAmt == undefined)
        NetAmt = '0';
    var totalNetAmt = '0';
    if (parseFloat(PatCrdLmt) > 0) { /* Patient Wise Credit Limits Checking */
        totalNetAmt = parseFloat(results.PRICE) + parseFloat(NetAmt);
        if (parseFloat(PatCrdLmt) < parseFloat(totalNetAmt)) {
            param = results;
            return ConfirmationRequiredForSaveWithParam_message_services(obj, param, 'Services Cannot Be Post More Than The Patient Credit Limit : ' + PatCrdLmt + '. Do You Want To Continue..');
        }
    }
    if (parseInt(Casual_credit_amt) > 0 && emerg_pat == 'Y') { /* casuality(emergency reg type) credit limit */
        totalNetAmt = parseFloat(results.PRICE) + parseFloat(NetAmt);
        if (parseFloat(Casual_credit_amt) < parseFloat(totalNetAmt)) {
            param = results;
            return ConfirmationRequiredForSaveWithParam_message_services(obj, param, 'Services Cannot Be Post More than The Casuality Credit Limit : ' + Casual_credit_amt + '. Do You Want To Continue..');
        }
    }
    /*  assay comparision Begin  */
    var assay_com_setting = $('#' + ctrlcom + '_UCServices_hdnassay_com_config').val();
    var MainValues = document.getElementById('' + ctrlcom + '_hdnSelection').value;
    if (assay_com_setting == 'True') {
        if ((MainValues != NaN) && (MainValues != '') && (MainValues != undefined)) {
            var DollarValue = MainValues.split('$');
            if (DollarValue.length > 0) {
                var ChildArray = new Array();
                for (var p = 0; p < DollarValue.length; p++) {
                    /*var SubArray=MainValues.split('-'); */
                    var SubArray = DollarValue[p].split('*');

                    if (SubArray[0].length > 0) {
                        var TestNames = SubArray[0].split(',');
                    }
                    if (SubArray[1].length > 0) {
                        var TestVal = SubArray[1].split(',');
                        for (var j = 0; j < TestVal.length; j++) {
                            ChildArray[Childcount] = TestVal[j];
                            Childcount++;
                        }
                    }

                    if ($.inArray(results.SERVICE_ID, ChildArray) == -1) {
                    }
                    else {
                        $(".stoast").toastText("warning", "This '" + results.SERVICE_NAME + "' Already Exists in '" + TestNames[1] + "'", 5, 3);
                        return false;
                    }
                }
            }
        }
    }
    /*assay end*/

    if (results.SERVICE_NAME != '') {
        var _value = '0';
        if (results.DOCTOR_ID == null || results.DOCTOR_ID == undefined || results.DOCTOR_ID == '') { results.DOCTOR_ID = "0"; }
        if (results.SERVICE_ID == "2" && parseInt(results.DOCTOR_ID) > 0) {
            _value = results.DOCTOR_ID;
        }
        else {
            _value = results.SERVICE_ID;
        }
        var id = '';

        if ($.inArray(parseInt(_value), arrServiceIds) == -1) {
            if (sender.id == undefined) {
                id = sender.attr('id');
            }
            else {
                id = sender.id;
            }

            AssignValues(id, results);
        }
        else {
            $(".stoast").toastText("warning", "Service " + results.SERVICE_NAME + " Is already exists.", 5, 3);
            document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').value = '';
            document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').focus();
            return false;
        }
    }
    return false;
}

function ClearAllConcessionControlforconrule() {
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        if ($(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val() > 0 && parseFloat($(this).closest('tr').find("[id*=txtAmount]").val()) > 0) {
            $(this).closest("tr").find("[id*=txtDiscP]").val('0');
            $(this).closest("tr").find("[id*=txtDiscAmt]").val('0');
            $(this).closest("tr").find("[id*=txthcPer]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtHcAmt]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txthcPer]").val('0');
            $(this).closest("tr").find("[id*=txtHcAmt]").val('0');
            $(this).closest("tr").find("[id*=txtmaPer]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtmgAmt]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtmaPer]").val('0');
            $(this).closest("tr").find("[id*=txtmgAmt]").val('0');
            $(this).closest("tr").find("[id*=txtstPer]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtstAmt]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtstPer]").val('0');
            $(this).closest("tr").find("[id*=txtstAmt]").val('0');
            $(this).closest("tr").find("[id*=txtebPer]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtebAmt]")[0].disabled = true;
            $(this).closest("tr").find("[id*=txtebPer]").val('0');
            $(this).closest("tr").find("[id*=txtebAmt]").val('0');

        }
    });
    CalculateGridAmt(0);



}
function cancelfunction() { return false; }
var GlobalRowIndex = 0;
var doctor_count_id = 0;
function AssignValues(id, results) {
    doctor_count_id = results.DOCTOR_ID;
    var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OPQUICK' || form_name == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_hdnconsultation_count_in_day').value == "True") {


            GetNonAsync(
    "Private/FrontOffice/OPDBILLNEW.aspx/Getconsutationcount",
     { doctor_count_id: doctor_count_id },
     function (data) {
         if (data.d.length != '' && data.d.length != undefined) {
             document.getElementById('ctl00_ContentPlaceHolder1_UCServices_txtdaycount').value = data.d[0][0][0].NO_OF_CONSULTATIONS;
             document.getElementById('ctl00_ContentPlaceHolder1_UCServices_txtconsutacont').value = data.d[0][0][0].DOCTOR_CONSULTATIONS;
             document.getElementById('ctl00_ContentPlaceHolder1_UCServices_txtdeptcount').value = data.d[0][0][0].DEPARTMENT_CONSULTATIONS;

         }
     },
      function () {
      });
        }
    }
    var gvServicesindex = 0;
    var checkRowIndex = 0;
    is_remarks_mandatory = results.IS_REMARKS_MANDATORY;
    if (is_remarks_mandatory == null || is_remarks_mandatory == '' || is_remarks_mandatory == undefined) { is_remarks_mandatory = 'N'; }
    document.getElementById('DivGrid_Header').className = '';
    document.getElementById('' + ctrlcom + '_UCServices_hdnSrvGenderId').value = '';
    document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFDays').value = '';
    document.getElementById('' + ctrlcom + '_UCServices_hdnSrvTDays').value = '';
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked && document.getElementById('' + ctrlcom + '_UCServices_hdnisadditinal').value != 'Y') {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = false;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
        var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
        if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
        { con_ruleId = 0; }
        if (con_ruleId > 0) {
            ClearAllConcessionControlforconrule();
        }
        var index_data = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length;
        if (index_data != 0) {
            index_data = index_data - 1;
        }
        CalculateGridAmt(index_data);
        $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
    }
    /* addiotion services disc purpose*/
    if (results.IS_ADDITIONAL == 'Y') {
        $('#' + ctrlcom + '_UCServices_hdnisadditinal').val('Y');
    }
    /* up to here */
    $('#' + ctrlcom + '_UCServices_hdnRowGenCd').val('0');
    if ((id == undefined || id == "ctl00_ContentPlaceHolder1_UCServices_gv_services_header_ctl03_txtServiceName") && results.SERVICE_TYPE_ID != '9') {
        var Is_Check_List = results.IS_SRV_CHECKLIST_REQUIRED;
        var foreign_srv = results.IS_FOREIGN_SERVICE;
        var concernform = results.CONCERN_FORM_REQ;
        var pre_req_On_Srv = results.IS_CLINICAL_HIST_REQ;
        var His = results.HISTORY_TYPE_ID;
        var Guide_lines = results.IS_SRV_GUIDELINES_REQUIRED;
        var is_fav = results.IS_FAVORITE_SERVICE;
        if (Guide_lines == '' || Guide_lines == undefined || Guide_lines == null)
        { Guide_lines = 'N'; }
        var is_instruction_req = results.IS_SRV_INSTRUCTION_REQ;
        if (is_instruction_req == '' || is_instruction_req == undefined || is_instruction_req == null) { is_instruction_req = 'N'; }
        if (is_fav == '' || is_fav == undefined || is_fav == null) { is_fav = 'N'; }
        document.getElementById('' + ctrlcom + '_UCServices_hdnRemarks').value = results.IS_REMARKS_MANDATORY;
        var History_types = 'N';
        if (parseInt(His) > 0) {
            History_types = 'Y';
        }
        else {
            History_types = 'N';
        }
        results.IS_POST = _is_post;
        var srv_hist = results.IS_POST;
        if ($.inArray(parseInt(results.SERVICE_ID), arrServiceIds) != -1) {
        }

        document.getElementById('' + ctrlcom + '_UCServices_hdnSrvGenderId').value = results.GENDER_ID;
        document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFDays').value = results.FROM_DAYS;
        document.getElementById('' + ctrlcom + '_UCServices_hdnSrvTDays').value = results.TO_DAYS;
        results.UTILZ_CMP_RULE_QTY = results.UTILZ_CMP_RULE_QTY == "" ? "0" : results.UTILZ_CMP_RULE_QTY;
        results.CMO_RUL_QTY = results.CMO_RUL_QTY == "" ? "0" : results.CMO_RUL_QTY;
        fn_AddFilterRow(foreign_srv, concernform, pre_req_On_Srv, History_types, srv_hist, Guide_lines, Is_Check_List, is_instruction_req, is_fav);
        gvServicesindex = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length - 1;
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdnisschedulerequired]').val(results.IS_SCHEDULE_REQUIRED);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdncmpruleqty]').val(results.CMO_RUL_QTY);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdnutilizedruleqty]').val(results.UTILZ_CMP_RULE_QTY);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdncmprefqty]').val(results.REFRL_QTY);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdnutilizedrefqty]').val(results.UTILIZED_REFRL_QTY);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('[id*=hdnOrgPrice]').val(results.ORG_PRICE);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('[id*=hdnDoctorPrice]').val(results.DOCTOR_PRICE);
        $('#' + ctrlcom + '_UCServices_hdnRowGenCd').val('149');
        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
        if (form_name == 'OP') {
            if (document.getElementById('' + ctrlcom + '_hdnView').value != 'VIEW_OP') {
                ServicesAutoContextKey();
            }
        }
        else {
            ServicesAutoContextKey();
        }
        /*patient Category Mapping Concept*/
        if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK') {
            var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
            var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
            var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
            if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
            if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
            if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_type) == 1)
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdnpatcatid]').val(pat_cat_id);
        }
    }
    /* Group Billing Condition Starts */
    if ((id == undefined || id == "ctl00_ContentPlaceHolder1_UCServices_gv_services_header_ctl03_txtServiceName") && results.SERVICE_TYPE_ID == '9') {
        getpackageincludesingvservices(results.SERVICE_ID, results.TARIFF_ID, 'G', '0', '0');
    }
    /* Group Billing Condition Ends */
    $("table[id*=UCServices_gvServices] tr:has(td)").each(function (e) {
        if (results.SERVICE_TYPE_ID == '9') {
            return false;
        }
        else {
            if ("ctl00_ContentPlaceHolder1_UCServices_gv_services_header_ctl03_txtServiceName" == id) {
                if (results.SERVICE_ID != '') {
                    var gvServices = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                    var rowIndex = gvServices.rows.length;
                    checkRowIndex = rowIndex - 1;
                    GlobalRowIndex = checkRowIndex;
                    var gridindex = 1;
                    var ev = this.rowIndex;
                    if (ev != undefined && ev != '' && ev != null) { ev = ev; } else { ev = 1; }
                    var RowAssign = $('#' + ctrlcom + '_UCServices_hdnRowGenCd').val();
                    if (RowAssign == "149") {
                        if (results.SERVICE_ID == '2') {
                            arrServiceIds[checkRowIndex] = parseInt(results.DOCTOR_ID);
                        }
                        else {
                            arrServiceIds[checkRowIndex] = parseInt(results.SERVICE_ID);
                        }
                        if (results.SERVICE_ID == '2') {
                            var _doctor_id = results.DOCTOR_ID;

                            var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
                            var pat_id = '';
                            var _company_id = '0';
                            if (form_name == 'OPQUICK') {
                                _company_id = $('#' + ctrlcom + '_EmployerInfo1_EmployerControl1__hiddenID').val();
                                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                                    pat_id = $('#' + ctrlcom + '_Umrlookup__hiddenID').val();
                                }
                                else {
                                    pat_id = 0;
                                }
                            }
                            else if (form_name == 'OP') {
                                _company_id = $('#' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').val();
                                if (document.getElementById('' + ctrlcom + '_chkIsOsp').checked == false) {
                                    pat_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
                                }
                                else {
                                    pat_id = "no";
                                }
                            }
                            else if (form_name == 'Cons') {
                                pat_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
                                _company_id = $('#' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').val();
                            }
                            if (_company_id == undefined || _company_id == '' || _company_id == null) {
                                _company_id = 0;
                            }
                            var _patient_id = pat_id;
                            var _tariff_id = 1;
                            if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && results.SERVICE_ID == 2) {
                                if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10') {
                                    _tariff_id = $("#" + ctrlcom + "_EmployerInfo1_uctpa__hiddenID").val();
                                    _company_id = _tariff_id;
                                }
                            }
                            else if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && results.SERVICE_ID == 2) || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && results.SERVICE_ID == 2)) {
                                if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') {
                                    _tariff_id = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                                    _company_id = _tariff_id;
                                }
                                else if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid') != null) {
                                    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value != '') {
                                        tariff_id = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnfrgncatgryid').value;
                                    }
                                }
                            }
                            else {
                                tariff_id = 1;
                            }
                            /*patient Category Mapping Concept*/
                            if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK') {
                                var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
                                var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
                                var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
                                var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
                                if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
                                if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
                                if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
                                if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1)
                                    _tariff_id = pat_tariff_id;
                            }
                            if (_company_id == undefined || _company_id == null || _company_id == '') { _company_id = "0"; }
                            if (_tariff_id == undefined || _tariff_id == null || _tariff_id == '') { _tariff_id = "1"; }
                            GetAsync( /*Wait untill reponse will gets*/
                              "Private/FrontOffice/OPDBILLNEW.aspx/Bind_Consultation_Det_Async",
                              { DOCTOR_ID: _doctor_id, PATIENT_ID: _patient_id, COMPANY_ID: _company_id, TARIFF_ID: _tariff_id },
                              function (msg) {
                                  if (msg.d.length != 0) {
                                      var daily = msg.d[0].P_D_NO_VISITS;
                                      var hospital = msg.d[0].P_NO_VISITS;
                                      if (daily == undefined || daily == null || daily == '')
                                      { daily = 0; }
                                      if (hospital == undefined || hospital == null || hospital == '')
                                      { hospital = 0; }
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(msg.d[0].PRICE);

                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val(msg.d[0].CONSULTATION_TYPE_ID);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnEmergency_Price]').val(msg.d[0].PRICE);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNormal_Price]').val(msg.d[0].PRICE);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=lblvisitdetails]')[0].innerHTML = 'D-H' + '/' + daily + '-' + hospital;
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=divsrvname]').addClass('btntxt srvdvisitdiv');
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=lblvisitdetails]').show();
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnDoctorPrice]').val(msg.d[0].DOCTOR_PRICE);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnDoctorPct]').val(msg.d[0].DOCTOR_PCT);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnOrgPrice]').val(msg.d[0].ORG_PRICE);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnOrgPct]').val(msg.d[0].ORG_PCT);
                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnsrvpriceID]').val(msg.d[0].SERVICE_PRICE_ID);
                                      var discount_pnt = parseFloat(results.CMP_DISC_PCNT);
                                      if (parseFloat(discount_pnt) > 0) {
                                          if (discount_pnt == null || discount_pnt == '' || discount_pnt == undefined)
                                          { discount_pnt = 0; }
                                          if (parseFloat(discount_pnt) > 0) {

                                              $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(parseFloat(discount_pnt));
                                              var pAmt = 0;

                                              pAmt = msg.d[0].PRICE;

                                              var emp_pcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
                                              var org_pcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
                                              if (emp_pcnt == undefined || emp_pcnt == null || emp_pcnt == '') { emp_pcnt = 0; }
                                              if (org_pcnt == undefined || org_pcnt == null || org_pcnt == '') { org_pcnt = 0; }
                                              var pAmt = Math.round((parseFloat(msg.d[0].PRICE) * parseFloat(emp_pcnt)) / 100);
                                              if (pAmt == undefined || pAmt == null || pAmt == '') { pAmt = 0; }
                                              var PconAmt = 0;
                                              PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));

                                              var tamt = Math.round((parseFloat(msg.d[0].PRICE) * (parseFloat(discount_pnt))) / parseFloat(100));
                                              var eamt = Math.round((parseFloat(pAmt) * (parseFloat(discount_pnt))) / parseFloat(100));
                                              var camt = Math.round((parseFloat(Math.round((parseFloat(msg.d[0].PRICE) * parseFloat(org_pcnt)) / 100)) * (parseFloat(discount_pnt))) / parseFloat(100));
                                              var tecamt = parseFloat(eamt) + parseFloat(camt);
                                              if (tamt != tecamt) {
                                                  if (parseFloat(tamt) > tecamt) {
                                                      var dispamt = parseFloat(tamt) - parseFloat(tecamt);

                                                      PconAmt = parseFloat(PconAmt) + parseFloat(dispamt);
                                                  }
                                                  else if (tecamt > tamt) {
                                                      var dispamt = parseFloat(tecamt) - parseFloat(tamt);

                                                      PconAmt = parseFloat(PconAmt) - parseFloat(dispamt);

                                                  }


                                              }

                                              $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
                                              $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);

                                              var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                              pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                              $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                              $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                                              $("#payitem2,._quick-div").show();
                                              $("._mdisc").css('width', '72%');
                                              $("#payitem1,#payitem3").hide();
                                              $('[id*=ConcessionAmt]')[0].style.display = 'none';
                                              $("#lbladvanced").addClass("select");
                                              $("#lblquick").removeClass("select");
                                              document.getElementById('ctl00_ContentPlaceHolder1_ReceiptControl2_ddlDiscountType').disabled = true;

                                          }
                                      }
                                      var hcid = '';
                                      var hcNo = '';
                                      var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
                                      if (form_name == 'OP' || form_name == 'Cons') {
                                          hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
                                          hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
                                      }
                                      else if (form_name == 'OPQUICK') {
                                          if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
                                              hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
                                              hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

                                          }
                                          else {
                                              hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
                                              hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
                                          }
                                      }
                                      hcid = hcid == '' ? 0 : hcid;
                                      hcNo = hcNo == '' ? 0 : hcNo;

                                      if (hcid > 0) {
                                          BindPatientHealthCrad(hcid, hcNo);
                                      }
                                      else {
                                          var Cmp_id = 0;
                                          if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
                                              Cmp_id = $('#' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').val();
                                          }
                                          else {
                                              Cmp_id = $('#' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').val();
                                          }
                                          if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '') { Cmp_id = '0'; }
                                          if (Cmp_id == 0) {

                                              var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
                                              if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
                                              { con_ruleId = 0; }
                                              if (con_ruleId > 0) {

                                                  var discount_pnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncrulepct]').val();

                                                  $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRulePer]').val(parseFloat(discount_pnt));
                                                  var pAmt = 0;
                                                  if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                                                      pAmt = msg.d[0].PRICE;
                                                  }
                                                  else {

                                                      pAmt = msg.d[0].PRICE;
                                                  }
                                                  var PconAmt = 0;
                                                  var pAmt = Math.round((parseFloat(pAmt) * parseFloat(100)) / 100);
                                                  if (pAmt == undefined || pAmt == null || pAmt == '') { pAmt = 0; }
                                                  PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));
                                                  $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
                                                  $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val(PconAmt);

                                                  var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                                  pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                                  var totrcamt = 0;
                                                  $("table[id*=gvServices] tr:has(td)").each(function (e) {
                                                      var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                                                      if (rcAmt == undefined || rcAmt == null || rcAmt == '' || rcAmt == NaN || rcAmt == "NaN") { rcAmt = 0; }
                                                      totrcamt = parseFloat(totrcamt) + parseFloat(rcAmt);
                                                  });
                                                  if (totrcamt > 0) {
                                                      $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                                      $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                                                      $("#payitem2,._quick-div").show();
                                                      $("._mdisc").css('width', '72%');
                                                      $("#payitem1,#payitem3").hide();
                                                      $('[id*=ConcessionAmt]')[0].style.display = 'none';
                                                      $("#lbladvanced").addClass("select");
                                                      $("#lblquick").removeClass("select");
                                                      document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
                                                      document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = true;
                                                      document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').disabled = true;
                                                      $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
                                                      var x = 1;
                                                      var disc_grid_length = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length;
                                                      if (disc_grid_length == 2) {
                                                          fn_AddRowWithDetais();
                                                      }
                                                      var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
                                                      $("table[id*=gvServices] tr:has(td)").each(function (e) {
                                                          var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                                                          var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                                                          var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                                                          var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                                                          var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                                                          var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                                                          if (chamt == undefined || chamt == null || chamt == '')
                                                          { chamt = 0; }
                                                          if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                                                          { chpcnt = 0; }
                                                          if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                                                          if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                                                          if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                                                          if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                                                          if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                                                          if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }


                                                          rcAmt = rcAmt || 0;
                                                          rcPer = rcPer || 0;

                                                          rcTotAmt += parseFloat(rcAmt);
                                                          rcTotPer += parseFloat(rcPer);
                                                          chtotamt += parseFloat(chamt);
                                                          chtotpcnt += parseFloat(chpcnt);
                                                          btot_amt += parseFloat(b_amt);
                                                          ntot_amt += parseFloat(n_amt);
                                                      });
                                                      var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
                                                      var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
                                                      chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
                                                      chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[1].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtcardno]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAutherizedPersion]')[0].disabled = true;
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]').val(2);
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtcardno]').val(results.CNCSN_RULE_NAME);
                                                      $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("input[type=hidden][id*=hdncardid]").val(results.CNCSN_RULE_ID);
                                                      $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("input[type=hidden][id*=hdnRuleid]").val(results.CNCSN_RULE_ID);
                                                      $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("[id*=ddlMultiDiscounttype]").val(6);
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtCRemks]').val(results.CNCSN_RULE_NAME);
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtCRemks]').removeClass('red');
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAutherizedPersion]').val(results.CNCSN_RULE_NAME);
                                                      $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find("input[type=hidden][id*=hdnauthid]").val(results.DEFINE_BY_ID);
                                                      $('[id*=pnlGridPop]').css("display", "none");



                                                  }
                                              }
                                          }
                                      }
                                      if (checkRowIndex > 0) {
                                          CalculateGridAmt(checkRowIndex);
                                      }
                                      else {
                                          CalculateGridAmt(0);
                                      }
                                  }
                              },
                              function (jqXHR, textStatus, errorThrown) {

                              });
                        }
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnrateexcgst]').val(results.PRICE_WITH_GST);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdntaxpct]').val(results.TAX_PCT);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncruleid]').val(results.CNCSN_RULE_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncrulepct]').val(results.CONC_PCT);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncrulename]').val(results.CNCSN_RULE_NAME);

                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncruledefindid]').val(results.DEFINE_BY_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncruledefindby]').val(results.CNCSN_RULE_NAME);

                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txttaxper]').val(results.TAX_PCT);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdntaxamount]').val(Math.round(results.TAX_AMOUNT));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtptax]').val(Math.round(results.TAX_AMOUNT));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnsgstpct]').val(Math.round(results.SGST_PCT));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncgstpct]').val(Math.round(results.CGST_PCT));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnsgstamount]').val(Math.round(results.SGST_AMOUNT));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncgstamount]').val(Math.round(results.CGST_AMOUNT));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnsaccd]').val(Math.round(results.SAC_CD));
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtServiceName]').val(results.SERVICE_NAME);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtServiceName]').attr("title", results.SERVICE_NAME);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtServiceCode]').val(results.SERVICE_CD);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnSrvUniCode]').val(results.SERVICE_UNICODE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnUniSrvTypeId]').val(results.UNI_SERVICE_TYPE_ID);
                        if ($('[id*=hdnDiagnosis_Cd]') != undefined && $('[id*=hdnDiagnosis_Cd]') != null) {
                            var hdnDiagnosisCd = $('[id*=hdnDiagnosis_Cd]').val();
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnDiagnosiscd]').val(hdnDiagnosisCd);
                        }
                        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
                        var pay_type = 0;
                        if (form_name == 'OP' || form_name == 'Cons') {
                            pay_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
                        }
                        else if (form_name == 'OPQUICK') {
                            var dd_type = $('#' + ctrlcom + '_ddlPatientType').val();
                            if (dd_type == '2' || dd_type == '5' || dd_type == '8' || dd_type == '9' || dd_type == '10') {
                                pay_type = '2';
                            }
                            else
                                pay_type = '1';
                        }

                        if (pay_type == '1') {
                            if (results.SERVICE_TYPE_ID == '12') {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnedit_srv_cd]').val('');
                            }
                            else {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnedit_srv_cd]').val(results.SERVICE_CD);
                            }
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtEqui_Srv_Name]').val(results.SERVICE_NAME);

                        }
                        else {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtEqui_Srv_Name]').val(results.EQUI_SERVICE_NAME);
                            if (results.SERVICE_TYPE_ID == '12') {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnedit_srv_cd]').val('');
                            }
                            else {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnedit_srv_cd]').val(results.EQUI_SERVICE_CD);
                            }
                        }

                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val(results.SERVICE_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnbillingheadid]').val(results.BILLING_HEAD_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtQty]').val(1);
                        if (results.PRIV_SRV_POSTED_DT != null) {
                            var priv_srv_post_dt = results.PRIV_SRV_POSTED_DT;
                            if (priv_srv_post_dt != '0') {
                                priv_srv_post_dt = new Date(priv_srv_post_dt).format('dd-MMM-yyyy');
                            }
                            else
                            { priv_srv_post_dt = ''; }

                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=txtPriv_Post_Dt]').text(priv_srv_post_dt)
                        }

                        var _emergency_price = "0";
                        if (results.EMERGENCY_PRICE != undefined && results.EMERGENCY_PRICE != null && results.EMERGENCY_PRICE != '') {
                            _emergency_price = (results.EMERGENCY_PRICE);
                        }
                        /*This Block Changed By Naresh For Company Discount Per On Rate Eny Issue Contact Me*/
                        var cmpdiscper = results.CMP_DISC_PCNT;

                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnCmpDiscPcnt]').val(cmpdiscper);
                        /*comented by naresh*/
                        /* if (parseFloat(cmpdiscper) > 0) {
                        var Rate = results.Price * cmpdiscper / 100;
                        var ApplyCoraporateRate = parseFloat(results.Price) - setProperDecimals(parseFloat(Rate));
                        if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(ApplyCoraporateRate);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('2');
                        }
                        else {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(ApplyCoraporateRate);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('1');
                        }
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNormal_Price]').val(ApplyCoraporateRate);
                        }
                        else {
                        if (results.VISIT_TYPE == "2") {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(_emergency_price);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('2');
                        }
                        else {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(results.Price);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('1');
                        }
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNormal_Price]').val(results.Price);
                        }*/
                        if (results.VISIT_TYPE == "2") {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(_emergency_price);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('2');
                        }
                        else {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(Math.round(parseFloat(results.PRICE)));
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('1');
                        }
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNormal_Price]').val(results.PRICE);

                        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').value = '';
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceClass]').val(results.SERVICECLASS_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val("0");
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val(results.SERVICE_GROUP_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceTypID]').val(results.SERVICE_TYPE_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val(results.DOCTOR_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val(results.DEPARTMENT_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Type_Name]').val(results.SERVICE_TYPE_NAME);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val(results.SERVICE_GROUP);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnIsRegInclude]').val(results.IS_REG_FEE_INCLUDED);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnEmergency_Price]').val(_emergency_price);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnTariffId]').val(results.TARIFF_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnhistorytypeID]').val(results.HISTORY_TYPE_ID);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnMin_Price]').val(results.MIN_PRICE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnMax_Price]').val(results.MAX_PRICE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNo_Nd_Dys]').val(results.NO_NEED_DAYS);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(results.CMP_DISC_PCNT);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnrefsrvqty]').val(results.REFRL_QTY);

                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnIsForeignSrv]').val(results.IS_FOREIGN_SERVICE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Name_A]').val(results.SERVICE_NAME);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnOrgPct]').val(results.ORG_PCT);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnDoctorPct]').val(results.DOCTOR_PCT);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnOrgPrice]').val(results.ORG_PRICE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnDoctorPrice]').val(results.DOCTOR_PRICE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdnsrvpriceID]').val(results.SERVICE_PRICE_ID);

                        var need_srv_grp_type_con = $('#' + ctrlcom + '_UCServices_hdnsrvgrp_type_con').val();

                        if (need_srv_grp_type_con == 'False') {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').attr('disabled', true);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').attr('disabled', true);
                        }
                        /* Service Group Wise Concession Row Creation Starts*/
                        var GvRowscount_grp = 0;
                        var count_grp = 0;
                        var grid_grp = document.getElementById('tbl_SrvGrp');
                        var _index_grp = 0;
                        var _index_grp = grid_grp.rows.length;
                        var grp_add_cnt = 0;
                        var first_count = 0;
                        var srv_grp_pcnt = 0;
                        var Grop_exist = 'N';
                        $("table[id$=tbl_SrvGrp] tr:has(td)").each(function (e) {
                            if (count_grp == 0) {
                                for (GvRowscount_grp = 0; GvRowscount_grp <= _index_grp; GvRowscount_grp++) {
                                    var srv_grp_nam = $('[id$=tbl_SrvGrp] tr').filter(':eq(' + GvRowscount_grp + ')').find('[id*=lblsrvgrpname]').text();
                                    if (srv_grp_nam == results.SERVICE_GROUP) {
                                        srv_grp_pcnt = $('[id$=tbl_SrvGrp] tr').filter(':eq(' + GvRowscount_grp + ')').find('input[type=text][id*=txtsrvgrppcnt]').val();
                                        grp_add_cnt++;
                                        Grop_exist = 'Y';
                                    }
                                }
                                count_grp++;
                                if (grp_add_cnt == 0) {
                                    fn_Add_SrvGrp_Disc(results.SERVICE_GROUP, 0);
                                }
                            }
                            first_count++;
                        });
                        if (first_count == 0) {
                            fn_Add_SrvGrp_Disc(results.SERVICE_GROUP, 0);
                        }
                        /* Service Group Wise Concession Row Creation Ends */
                        /* Service Type Wise Concession Row Creation Starts */
                        var GvRowscount_type = 0;
                        var count_type = 0;
                        var grid_type = document.getElementById('tbl_srv_type');
                        var _index_type = 0;
                        var _index_type = grid_type.rows.length;
                        var type_add_cnt = 0;
                        var first_count = 0;
                        var srv_type_pcnt = 0;
                        var type_exist = 'N';
                        $("table[id$=tbl_srv_type] tr:has(td)").each(function (e) {
                            if (count_type == 0) {
                                for (GvRowscount_type = 0; GvRowscount_type <= _index_type; GvRowscount_type++) {
                                    var srv_type_nam = $('[id$=tbl_srv_type] tr').filter(':eq(' + GvRowscount_type + ')').find('[id*=lblsrvtypename]').text();
                                    if (srv_type_nam == results.SERVICE_TYPE_NAME) {
                                        srv_type_pcnt = $('[id$=tbl_srv_type] tr').filter(':eq(' + GvRowscount_type + ')').find('input[type=text][id*=txtsrvTypepcnt]').val();
                                        type_add_cnt++;
                                        type_exist = 'Y';
                                    }
                                }
                                count_type++;
                                if (type_add_cnt == 0) {
                                    fn_Add_SrvType_Disc(results.SERVICE_TYPE_NAME, 0);
                                }
                            }
                            first_count++;
                        });
                        if (first_count == 0) {
                            fn_Add_SrvType_Disc(results.SERVICE_TYPE_NAME, 0);
                        }
                        /* Service Type wise Concession Ends */

                        if (need_srv_grp_type_con == 'True') {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').attr('disabled', false);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').attr('disabled', false);
                            var cmp_setting_outsrc = $('#' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').val();
                            var is_outsrc = $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnIsForeignSrv]').val();
                            if (is_outsrc == '' || is_outsrc == null || is_outsrc == undefined)
                            { is_outsrc = 'N'; }

                            if ((is_outsrc == 'N') || (is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
                                if (Grop_exist == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_Srv_Grp_Type_pcnt_0').checked == true) {
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(srv_grp_pcnt);
                                    var pAmt = results.PRICE;
                                    if (pAmt == undefined || pAmt == null || pAmt == '') {
                                        pAmt = 0;
                                    }
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
                                    var PconAmt = (parseFloat(pAmt) * parseFloat(srv_grp_pcnt)) / parseFloat(100);
                                    var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                    pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                }
                            }

                            if ((is_outsrc == 'N') || (is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
                                if (type_exist == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_Srv_Grp_Type_pcnt_1').checked == true) {
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(srv_type_pcnt);
                                    var pAmt = results.Price;
                                    if (pAmt == undefined || pAmt == null || pAmt == '') {
                                        pAmt = 0;
                                    }
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
                                    var PconAmt = (parseFloat(pAmt) * parseFloat(srv_type_pcnt)) / parseFloat(100);
                                    var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                    pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                }
                            }

                        }

                        if (results.SERVICECLASS_ID == 3) /*PACKAGE OR PROFILE */
                        {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnmax_opt_srvs]').val(results.MAX_OPT_SERVICES_ALLOWED);
                        }
                        else {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnmax_opt_srvs]').val(0);
                        }

                        if (results.IS_FOREIGN_SERVICE == "Y") {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').css("background-color", "#008000");
                        }
                        if (results.QYT_EDIT == 'Y') {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtQty]').attr("disabled", false);
                        }
                        else {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtQty]').attr("disabled", true);
                        }
                        if (results.RATE_EDIT == 'Y') {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').attr("disabled", false);
                        }
                        else {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').attr("disabled", true);
                        }
                        if (results.IS_REMARKS_MANDATORY == 'Y') {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnIsRemarks]').val(results.MAX_OPT_SERVICES_ALLOWED);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtremks]').css("background", "1px solid #f4785e");
                        }
                        else {
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnIsRemarks]').val(results.MAX_OPT_SERVICES_ALLOWED);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtremks]').css("background", "");
                        }
                        var Cmp_id = 0;
                        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
                            Cmp_id = $('#' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').val();
                        }
                        else {
                            Cmp_id = $('#' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').val();
                        }
                        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '') { Cmp_id = '0'; }

                        if (parseInt(Cmp_id) > 0) {
                            var Pr1 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri1').value;
                            var Pr2 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri2').value;
                            var Pr3 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri3').value;
                            var Pr4 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri4').value;
                            var PrC1 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC1').value;
                            var PrC2 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC2').value;
                            var PrC3 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC3').value;
                            var PrC4 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC4').value;
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=DivColors]').css("display", "block");
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("background", results.COLOR_CD);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("display", "block");

                            if (Pr1 == results.TARIFF_ID) {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=DivColors]').css("display", "block");
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("background", PrC1);
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("display", "block");
                            }
                            if (Pr2 == results.TARIFF_ID) {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=DivColors]').css("display", "block");
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("background", PrC2);
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("display", "block");

                            }
                            if (Pr3 == results.TARIFF_ID) {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=DivColors]').css("display", "block");
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("background", PrC3);
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("display", "block");

                            }
                            if (Pr4 == results.TARIFF_ID) {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=DivColors]').css("display", "block");
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("background", PrC4);
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("display", "block");

                            }
                        }
                        /*Assay Comparision */

                        if (results.SERVICECLASS_ID == 4) {
                            getpackageincludesingvservices(results.SERVICE_ID, results.TARIFF_ID, 'A', '0', '0');
                        }
                        if (results.SERVICECLASS_ID == 3) /*PACKAGE OR PROFILE */
                        {
                            $('#' + ctrlcom + '_UCServices_hdnopt_srv_cnt').val(results.MAX_OPT_SERVICES_ALLOWED);
                            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=imgOptionalSrv]').css('display', 'block');
                            getpackageincludesingvservices(results.SERVICE_ID, results.TARIFF_ID, 'P', '0', '0');
                        }

                        var hcid = '';
                        var hcNo = '';
                        var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
                        if (form_name == 'OP' || form_name == 'Cons') {
                            hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
                            hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
                        }
                        else if (form_name == 'OPQUICK') {
                            if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
                                hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
                                hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

                            }
                            else {
                                hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
                                hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
                            }
                        }
                        hcid = hcid == '' ? 0 : hcid;
                        hcNo = hcNo == '' ? 0 : hcNo;

                        if (hcid > 0) {
                            BindPatientHealthCrad(hcid, hcNo);
                        }






                        var _add_status = 'N'; var _add_dscn = '0';
                        var _l = _add_srv.length;

                        var discount_pnt = parseFloat(results.CMP_DISC_PCNT);

                        if (parseFloat(discount_pnt) > 0) {
                            if (discount_pnt == null || discount_pnt == '' || discount_pnt == undefined)
                            { discount_pnt = 0; }
                            if (parseFloat(discount_pnt) > 0) {

                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(parseFloat(discount_pnt));
                                var pAmt = 0;
                                if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                                    pAmt = _emergency_price;
                                }
                                else {
                                    pAmt = results.PRICE;
                                }

                                var emp_pcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
                                var org_pcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
                                if (emp_pcnt == undefined || emp_pcnt == null || emp_pcnt == '') { emp_pcnt = 0; }
                                if (org_pcnt == undefined || org_pcnt == null || org_pcnt == '') { org_pcnt = 0; }
                                var pAmt = Math.round((parseFloat(results.PRICE) * parseFloat(emp_pcnt)) / 100);
                                if (pAmt == undefined || pAmt == null || pAmt == '') { pAmt = 0; }
                                var PconAmt = 0;
                                PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));

                                var tamt = Math.round((parseFloat(results.PRICE) * (parseFloat(discount_pnt))) / parseFloat(100));
                                var eamt = Math.round((parseFloat(pAmt) * (parseFloat(discount_pnt))) / parseFloat(100));
                                var camt = Math.round((parseFloat(Math.round((parseFloat(results.PRICE) * parseFloat(org_pcnt)) / 100)) * (parseFloat(discount_pnt))) / parseFloat(100));
                                var tecamt = parseFloat(eamt) + parseFloat(camt);
                                if (tamt != tecamt) {
                                    if (parseFloat(tamt) > tecamt) {
                                        var dispamt = parseFloat(tamt) - parseFloat(tecamt);

                                        PconAmt = parseFloat(PconAmt) + parseFloat(dispamt);
                                    }
                                    else if (tecamt > tamt) {
                                        var dispamt = parseFloat(tecamt) - parseFloat(tamt);

                                        PconAmt = parseFloat(PconAmt) - parseFloat(dispamt);

                                    }


                                }

                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);

                                var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                                $("#payitem2,._quick-div").show();
                                $("._mdisc").css('width', '72%');
                                $("#payitem1,#payitem3").hide();
                                $('[id*=ConcessionAmt]')[0].style.display = 'none';
                                $("#lbladvanced").addClass("select");
                                $("#lblquick").removeClass("select");
                                document.getElementById('ctl00_ContentPlaceHolder1_ReceiptControl2_ddlDiscountType').disabled = true;
                            }
                        }


                        if (results.IS_ADDITIONAL == null || results.IS_ADDITIONAL == undefined || results.IS_ADDITIONAL == '') { results.IS_ADDITIONAL = 'N'; }
                        if (results.IS_ADDITIONAL == 'Y' || _add_status == 'Y') {
                            var discount_pnt = 0;
                            $('#' + ctrlcom + '_UCServices_hdnisadditinal').val('Y');
                            if (results.IS_ADDITIONAL == 'Y') {
                                discount_pnt = results.DISCOUNT_PERCENT;
                            }
                            else if (_add_status == 'Y') {
                                discount_pnt = _add_dscn;
                            }

                            if (discount_pnt == null || discount_pnt == '' || discount_pnt == undefined)
                            { discount_pnt = 0; }
                            if (parseFloat(discount_pnt) > 0) {
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdntxtDiscP]').val(discount_pnt);
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(discount_pnt);
                                var pAmt = 0;
                                if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                                    pAmt = _emergency_price;
                                }
                                else {
                                    pAmt = results.PRICE;
                                }

                                var emp_pcnt = results.EMP_PERCENT;
                                var org_pcnt = results.ORG_PERCENT;
                                var PconAmt = 0;
                                if (emp_pcnt == undefined || emp_pcnt == null || emp_pcnt == '') { emp_pcnt = 0; }
                                if (org_pcnt == undefined || org_pcnt == null || org_pcnt == '') { org_pcnt = 0; }

                                if (parseFloat(emp_pcnt) > 0) {
                                    pAmt = Math.round((parseFloat(pAmt) * parseFloat(emp_pcnt)) / 100);
                                    PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));
                                }
                                else if (parseFloat(emp_pcnt) == 0 && parseFloat(org_pcnt) == 100) {
                                    pAmt = 0;
                                    PconAmt = 0;
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(0);
                                }
                                else {
                                    PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));
                                }
                                if (pAmt == undefined || pAmt == null || pAmt == '') { pAmt = 0; }

                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);

                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
                                var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                OnPatDiscPcntChange(this, 'PAT');
                                var x = 1;
                                var disc_grid_length = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length;
                                if (disc_grid_length == 1) {
                                    fn_AddRowWithDetais();
                                }

                                $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                                $("#payitem2,._quick-div").show();
                                $("._mdisc").css('width', '72%');
                                $("#payitem1,#payitem3").hide();
                                $('[id*=ConcessionAmt]')[0].style.display = 'none';
                                $("#lbladvanced").addClass("select");
                                $("#lblquick").removeClass("select");
                                document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
                                $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
                                var hcTotAmt = 0, hcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
                                $("table[id*=gvServices] tr:has(td)").each(function (e) {
                                    var hcAmt = $(this).closest('tr').find("[id*=txtHcAmt]").val();
                                    var hcPer = $(this).closest("tr").find("[id*=txthcPer]").val();
                                    var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                                    var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                                    var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                                    var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                                    if (chamt == undefined || chamt == null || chamt == '')
                                    { chamt = 0; }
                                    if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                                    { chpcnt = 0; }
                                    if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                                    if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                                    if (hcAmt == undefined || hcAmt == null || hcAmt == '') { hcAmt = 0; }
                                    if (hcPer == undefined || hcPer == null || hcPer == '') { hcPer = 0; }
                                    if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                                    if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }


                                    hcPer = hcPer || 0;
                                    hcAmt = hcAmt || 0;

                                    hcTotAmt += parseFloat(hcAmt);
                                    hcTotPer += parseFloat(hcPer);
                                    chtotamt += parseFloat(chamt);
                                    chtotpcnt += parseFloat(chpcnt);
                                    btot_amt += parseFloat(b_amt);
                                    ntot_amt += parseFloat(n_amt);
                                });
                                var chTotalOnPatGrossper = (parseFloat(chtotamt) / parseFloat(btot_amt)) * 100;
                                var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
                                chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
                                chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

                                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
                                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
                                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]')[0].disabled = true;
                                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[0].disabled = true;
                                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]').val(1);
                                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]').val(2);
                            }
                        }
                        if (Cmp_id == 0) {
                            var isfav = results.IS_FAV;
                            if (isfav == undefined || isfav == null || isfav == '')
                            { isfav = 'N'; }
                            if (isfav != 'Y') {
                                var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
                                if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
                                { con_ruleId = 0; }
                                if (con_ruleId > 0) {


                                    var discount_pnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=hdncrulepct]').val();

                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRulePer]').val(parseFloat(discount_pnt));
                                    var pAmt = 0;
                                    if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                                        pAmt = _emergency_price;
                                    }
                                    else {
                                        pAmt = results.PRICE;
                                    }
                                    var PconAmt = 0;


                                    var pAmt = Math.round((parseFloat(results.PRICE) * parseFloat(100)) / 100);
                                    if (pAmt == undefined || pAmt == null || pAmt == '') { pAmt = 0; }
                                    PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
                                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val(PconAmt);

                                    var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                                    pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                                    var totrcamt = 0;
                                    $("table[id*=gvServices] tr:has(td)").each(function (e) {
                                        var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                                        if (rcAmt == undefined || rcAmt == null || rcAmt == '' || rcAmt == NaN || rcAmt == "NaN") { rcAmt = 0; }
                                        totrcamt = parseFloat(totrcamt) + parseFloat(rcAmt);
                                    });
                                    if (totrcamt > 0) {
                                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
                                        $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                                        $("#payitem2,._quick-div").show();
                                        $("._mdisc").css('width', '72%');
                                        $("#payitem1,#payitem3").hide();
                                        $('[id*=ConcessionAmt]')[0].style.display = 'none';
                                        $("#lbladvanced").addClass("select");
                                        $("#lblquick").removeClass("select");
                                        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
                                        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = true;
                                        document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').disabled = true;
                                        $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
                                        var x = 1;

                                        var disc_grid_length = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length;
                                        if (disc_grid_length == 2) {
                                            fn_AddRowWithDetais();
                                        }
                                        var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
                                        $("table[id*=gvServices] tr:has(td)").each(function (e) {
                                            var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                                            var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                                            var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                                            var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                                            var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                                            var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                                            if (chamt == undefined || chamt == null || chamt == '')
                                            { chamt = 0; }
                                            if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                                            { chpcnt = 0; }
                                            if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                                            if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                                            if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                                            if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                                            if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                                            if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }


                                            rcAmt = rcAmt || 0;
                                            rcPer = rcPer || 0;

                                            rcTotAmt += parseFloat(rcAmt);
                                            rcTotPer += parseFloat(rcPer);
                                            chtotamt += parseFloat(chamt);
                                            chtotpcnt += parseFloat(chpcnt);
                                            btot_amt += parseFloat(b_amt);
                                            ntot_amt += parseFloat(n_amt);
                                        });
                                        var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
                                        var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
                                        chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
                                        chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[1].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtcardno]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAutherizedPersion]')[0].disabled = true;
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]').val(2);
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtcardno]').val(results.CNCSN_RULE_NAME);
                                        $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("input[type=hidden][id*=hdncardid]").val(results.CNCSN_RULE_ID);
                                        $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("input[type=hidden][id*=hdnRuleid]").val(results.CNCSN_RULE_ID);
                                        $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("[id*=ddlMultiDiscounttype]").val(6);
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtCRemks]').val(results.CNCSN_RULE_NAME);
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtCRemks]').removeClass('red');
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAutherizedPersion]').val(results.CNCSN_RULE_NAME);
                                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find("input[type=hidden][id*=hdnauthid]").val(results.DEFINE_BY_ID);
                                        $('[id*=pnlGridPop]').css("display", "none");



                                    } else {

                                        document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').disabled = true;
                                    }

                                }
                            }
                        }
                        var index_data = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length;
                        index_data = index_data - 1;
                        CalculateGridAmt(index_data);

                        if (document.getElementById('' + ctrlcom + '_UCServices_hdnisdoctorrequired').value == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_hdnIsCnsltReqFrSrvPsting').value.toLowerCase() == 'true') {
                            serviceDoctor($('[id$=gvServices] tr').filter(':eq(' + x + ')').find('[id*=imgsrvdtr]'), index_data);
                        }
                        onExtendedGrid();
                    }
                }
            }
        }
        onExtendedGrid();
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').focus();
        return false;
    });

    if (results.SERVICE_ID == '2' && results.DOCTOR_ID > 0) {
        if (document.getElementById('' + ctrlcom + '_hdnAppsync').value.toLowerCase() == "true") {
            if (document.getElementById('' + ctrlcom + '_hdnisapptslotreq').value.toLowerCase() == "true") {
                BindSlotsCalling(checkRowIndex);
            }
        }
    }
    /* assign amount related info in to receipt control fields */
    classHideCmpAmts();

    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value != 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length == 0) {
        }
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length > 2) {
        }
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPasIntgrtnReq').value == "True") {
        DisplayCorpBlock();
    }
    var totaldiscount = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value;

    if (parseFloat(totaldiscount) > 0) {
        lblquick.disabled = true;
        $('[id*=lbladvanced]').trigger('click');
    }

    
    return false;


}
function BindSlotsCalling(checkRowIndex) {

    if (checkRowIndex == undefined || checkRowIndex == null || checkRowIndex == 'undefined' || checkRowIndex == '') { checkRowIndex = 0; }
    if (checkRowIndex == 0) {
        $("table[id*=UCServices_gvServices] tr:has(td)").each(function (e) {
            if ($(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val() == '2' && $(this).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val() > 0) {
                if ($(this).closest('tr').find("[id*=ddlSlotTiming]").val() == '' || $(this).closest('tr').find("[id*=ddlSlotTiming]").val() == undefined || $(this).closest('tr').find("[id*=ddlSlotTiming]").val() == '0,0') {
                    var checkRowIndexInner = $(this)[0].rowIndex;
                    checkRowIndexInner = checkRowIndexInner == ("" || undefined || 0) ? GlobalRowIndex : checkRowIndexInner;
                    SlotBind(checkRowIndexInner);
                }
            }
        });
    }
    else {
        SlotBind(checkRowIndex);
    }
}
 
/*Services Or Consultation Normal Or EmerGency Change */
function DropDownTypeChanges(ev) {

    var a = ev;
    var CurrentRowIndex = 0;
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    ddlrowindex = CurrentRowIndex;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();

    
    var _doctor_id = $(ev).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val();
    var _srv_name = $(ev).closest('tr').find("input[type=text][id*=txtServiceName]").val();

    var Cash_pcnt = $(ev).closest('tr').find("input[type=text][id*=txtDiscP]").val();
    var Hc_Pcnt = $(ev).closest('tr').find("input[type=text][id*=txthcPer]").val();
    var mg_pcnt = $(ev).closest('tr').find("input[type=text][id*=txtmaPer]").val();
    var Staff_pcnt = $(ev).closest('tr').find("input[type=text][id*=txtstPer]").val();
    var Eb_pcnt = $(ev).closest('tr').find("input[type=text][id*=txtebPer]").val();
    var cnlt_pcnt = $(ev).closest('tr').find("input[type=text][id*=txtRulePer]").val();
    if (parseFloat(Cash_pcnt) > 0) { } else { Cash_pcnt = 0; }
    if (parseFloat(Hc_Pcnt) > 0) { } else { Hc_Pcnt = 0; }
    if (parseFloat(mg_pcnt) > 0) { } else { mg_pcnt = 0; }
    if (parseFloat(Staff_pcnt) > 0) { } else { Staff_pcnt = 0; }
    if (parseFloat(Eb_pcnt) > 0) { } else { Eb_pcnt = 0; }
    if (parseFloat(cnlt_pcnt) > 0) { } else { cnlt_pcnt = 0; }


    var emergency_price = $(ev).closest('tr').find("input[type=hidden][id*=hdnEmergency_Price]").val();
    var Narmal_price = $(ev).closest('tr').find("input[type=hidden][id*=hdnNormal_Price]").val();
    var _ddlVisitType = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('select[id*=ddSType]').val();
    var _ddlVisitTypeName = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('select[id*=ddSType]').find('option:selected').text();
    var _txtServiceName = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=txtServiceName]').val();
    var servicename = _txtServiceName.split('-');
    var apendservicename = servicename[0] + '-' + _ddlVisitTypeName;
    
    var _dept_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
    var _companyid = $("#" + ctrlcom + "_hdnCompanyID").val();
    if (_doctor_id == undefined || _doctor_id == null || _doctor_id == '') { _doctor_id = "0"; }
    if (_ddlVisitType == undefined || _ddlVisitType == null || _ddlVisitType == '') { _ddlVisitType = "0"; }
    if (_companyid == undefined || _companyid == null || _companyid == '') { _companyid = "0"; }

    if (parseInt(_doctor_id) > 0 && _srvId == '2') {
        var tariffid = 1;
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && _srvId == '2') {
            if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10') {
                tariffid = $("#" + ctrlcom + "_EmployerInfo1_uctpa__hiddenID").val();
                _companyid = tariffid;
            }
        }
        else if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && _srvId == '2') || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && _srvId == '2')) {
            if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') {
                tariffid = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                _companyid = tariffid;
            }
        }
        else {
            tariffid = 1;
        }
        if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK') {
            var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
            var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
            var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
            var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
            if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
            if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
            if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
            if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1)
                tariffid = pat_tariff_id;
        }

        var ddlVisitVal = _ddlVisitType, DeptID = _dept_id, PatientID = "0", ConsTariffID = tariffid, CompanyID = _companyid, DoctorID = _doctor_id, PageType = 'OP';
        PatientID = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnPatientid').value;
        if (PatientID == '' || PatientID == null || PatientID == undefined) { PatientID = "0"; }
        if (form_name == 'OP' || form_name == 'Cons') {
            if (document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value == '10')
                PageType = 'OPCORP';
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')
                PageType = 'OPCORP';
        }





        if (PageType == "OPCORP") {
            GetAsync(
                 "GridService.asmx/CorpVisitTypePrice",
                { _srv_id: _srvId, ddlVisitVal: ddlVisitVal, DeptID: DeptID, PatientID: PatientID, DoctorID: DoctorID, ConsTariffID: ConsTariffID, CompanyID: CompanyID, PageType: PageType },
                function (data) {

                    if (data.d != null) {
                        CorpConsPrice(data);
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
        }
        else {
            GetAsync(
                 "GridService.asmx/CheckVistiTypeVales",
                { _srv_id: _srvId, ddlVisitVal: ddlVisitVal, DeptID: DeptID, PatientID: PatientID, DoctorID: DoctorID, ConsTariffID: ConsTariffID, CompanyID: CompanyID, PageType: PageType },
                function (data) {

                    if (data.d != null && data.d.length > 0) {
                        if (data.d[0].P_D_NO_VISITS == '0' && (_ddlVisitType == '3' || _ddlVisitType == '7' || _ddlVisitType == '8' || _ddlVisitType == '12' || _ddlVisitType == '13')) {
                            $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('select[id*=ddSType]').val('1');
                            $(".stoast").toastText("warning", "System does not allow Revisit", 5, 3);
                            DropDownTypeChanges(a);
                            return false;
                        }
                        else
                        { GetPriceDetails(data.d); }
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
        }
    }
    else {
        var tariffid = 1;
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && _srvId == '2') {
            if (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10') {
                tariffid = $("#" + ctrlcom + "_EmployerInfo1_uctpa__hiddenID").val();
                _companyid = tariffid;
            }
        }
        else if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && _srvId == '2') || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && _srvId == '2')) {
            if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10') {
                tariffid = $("#" + ctrlcom + "_uccorporate_CmpLookup__hiddenID").val();
                _companyid = tariffid;
            }
        }
        else {
            tariffid = 1;
        }
        if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK') {
            var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
            var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
            var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
            var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
            if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
            if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
            if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
            if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1)
                tariffid = pat_tariff_id;
        }
        PatientID = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnPatientid').value;
        if (PatientID == '' || PatientID == null || PatientID == undefined) { PatientID = "0"; }

        GetAsync(
                 "GridService.asmx/CheckVistiTypeValesforservice",
                { _srv_id: _srvId, ddlVisitVal: _ddlVisitType, PatientID: PatientID, TariffID: tariffid, CompanyID: _companyid },
                function (data) {

                    if (data.d != null && data.d.length > 0) {

                        GetPriceDetails(data.d);
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });


        var hcid = '';
        var hcNo = '';
        var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
        if (form_name == 'OP' || form_name == 'Cons') {
            hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
            hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
                hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
                hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

            }
            else {
                hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
                hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
            }
        }

        hcid = hcid == '' ? 0 : hcid;
        hcNo = hcNo == '' ? 0 : hcNo;
        if (hcid > 0) {
            BindPatientHealthCrad(hcid, hcNo);
        }

        /*CalculateGridAmt(CurrentRowIndex);*/
        var Pat_Amt = $(ev).closest('tr').find("input[type=text][id*=txtPamt]").val();
        if (parseFloat(Pat_Amt) > 0) { } else { Pat_Amt = 0; }
        var pat_curr_amt = parseFloat(Pat_Amt * Cash_pcnt) / parseFloat(100);
        var Hc_curr_amt = parseFloat(Pat_Amt * Hc_Pcnt) / parseFloat(100);
        var mg_curr_amt = parseFloat(Pat_Amt * mg_pcnt) / parseFloat(100);
        var Staff_curr_amt = parseFloat(Pat_Amt * Staff_pcnt) / parseFloat(100);
        var Eb_curr_amt = parseFloat(Pat_Amt * Eb_pcnt) / parseFloat(100);
        var cnlt_curr_amt = parseFloat(Pat_Amt * cnlt_pcnt) / parseFloat(100);
        if (parseFloat(pat_curr_amt) > 0) { } else { pat_curr_amt = 0; }
        if (parseFloat(Hc_curr_amt) > 0) { } else { Hc_curr_amt = 0; }
        if (parseFloat(mg_curr_amt) > 0) { } else { mg_curr_amt = 0; }
        if (parseFloat(Staff_curr_amt) > 0) { } else { Staff_curr_amt = 0; }
        if (parseFloat(Eb_curr_amt) > 0) { } else { Eb_curr_amt = 0; }
        if (parseFloat(cnlt_curr_amt) > 0) { } else { cnlt_curr_amt = 0; }
        var pat_net = parseFloat(Pat_Amt) - parseFloat(pat_curr_amt) - parseFloat(Hc_curr_amt) - parseFloat(mg_curr_amt) - parseFloat(Staff_curr_amt) - parseFloat(Eb_curr_amt) - parseFloat(cnlt_curr_amt);
        $(ev).closest('tr').find("input[type=text][id*=txtPNAmt]").val(pat_net);
        $(ev).closest('tr').find("input[type=text][id*=txtDiscAmt]").val(pat_curr_amt);
        $(ev).closest('tr').find("input[type=text][id*=txtHcAmt]").val(Hc_curr_amt);
        $(ev).closest('tr').find("input[type=text][id*=txtstAmt]").val(Staff_curr_amt);
        $(ev).closest('tr').find("input[type=text][id*=txtmgAmt]").val(mg_curr_amt);
        $(ev).closest('tr').find("input[type=text][id*=txtebAmt]").val(Eb_curr_amt);
        $(ev).closest('tr').find("input[type=text][id*=txtcncrlAmt]").val(cnlt_curr_amt);

        if (cnlt_curr_amt > 0) {
            var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                if (chamt == undefined || chamt == null || chamt == '')
                { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                { chpcnt = 0; }
                if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }

                
                rcAmt = rcAmt || 0;
                rcPer = rcPer || 0;

                rcTotAmt += parseFloat(rcAmt);
                rcTotPer += parseFloat(rcPer);
                chtotamt += parseFloat(chamt);
                chtotpcnt += parseFloat(chpcnt);
                btot_amt += parseFloat(b_amt);
                ntot_amt += parseFloat(n_amt);
            });
            var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
            var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
            chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
            chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

            if (chTotalOnPatGrossper == undefined || chTotalOnPatGrossper == null || chTotalOnPatGrossper == "" || isNaN(chTotalOnPatGrossper)) { chTotalOnPatGrossper = "0"; }
            if (chTotalOnPatGrossamt == undefined || chTotalOnPatGrossamt == null || chTotalOnPatGrossamt == "" || isNaN(chTotalOnPatGrossamt)) { chTotalOnPatGrossamt = "0"; }
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
        }
        CalculateGridAmt(CurrentRowIndex);
    }
}
/*Get visit type based prices of doctors*/
var ddlrowindex = 0;
function GetPriceDetails(resVal) {
    var CurrentRowIndex = 0;
    CurrentRowIndex = ddlrowindex;
    if (resVal[0] != null && resVal[0] != '') {
        var Price = typeof resVal[0].PRICE == "string" ? resVal[0].PRICE : '0';
        var OrgPrice = typeof resVal[0].ORG_PRICE == "string" ? resVal[0].ORG_PRICE : '0';
        var DocPrice = typeof resVal[0].DOCTOR_PRICE == "string" ? resVal[0].DOCTOR_PRICE : '0';
        var DoctorVisit = typeof (resVal[0].P_D_NO_VISITS == "string" || resVal[0].P_D_NO_VISITS == "number") ? resVal[0].P_D_NO_VISITS : '0';
        var HospVisit = typeof (resVal[0].P_NO_VISITS == "string" || resVal[0].P_NO_VISITS == "number") ? resVal[0].P_NO_VISITS : '0';
        var srvpriceid = typeof (resVal[0].SERVICE_PRICE_ID == "string" || resVal[0].SERVICE_PRICE_ID == "number") ? resVal[0].SERVICE_PRICE_ID : '0';
        var DOCTOR_PCT = typeof resVal[0].DOCTOR_PCT == "string" ? resVal[0].DOCTOR_PCT : '0';
        var ORG_PCT = typeof resVal[0].ORG_PCT == "string" ? resVal[0].ORG_PCT : '0';
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val(Price);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(Price);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val(Price);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(Price);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnsrvpriceID]').val(srvpriceid);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPrice]').val(DocPrice);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPct]').val(DOCTOR_PCT);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPrice]').val(OrgPrice);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPct]').val(ORG_PCT);


        var txtpatdiscount = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        var patnetamount = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var patdiscountamt = Math.round((parseFloat(patnetamount) * parseFloat(txtpatdiscount)) / parseFloat(100));
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(patdiscountamt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(patnetamount) - parseFloat(patdiscountamt));




    }
    else {
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCamt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCDiscP]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCDiscAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCNetAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPrice]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPct]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPrice]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPct]').val(0);
    }
    var hcid = '';
    var hcNo = '';
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (form_name == 'OP' || form_name == 'Cons') {
        hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
        hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
    }
    else if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
            hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
            hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

        }
        else {
            hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
            hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
        }
    }

    hcid = hcid == '' ? 0 : hcid;
    hcNo = hcNo == '' ? 0 : hcNo;
    if (hcid > 0) {
        BindPatientHealthCrad(hcid, hcNo);
    }

    CalculateGridAmt(CurrentRowIndex);
    var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    } else {
        if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

            } else {
                var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
            }
        }
    }
    if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
    { Cmp_id = 0; }
    if (Cmp_id > 0) {

        var txtpatdiscount = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        var patnetamount = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var patdiscountamt = Math.round((parseFloat(patnetamount) * parseFloat(txtpatdiscount)) / parseFloat(100));
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(patdiscountamt);
        CalculateGridAmt(CurrentRowIndex);
    }
    else {
        var con_ruleId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdncruleid]').val();
        if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
        { con_ruleId = 0; }
        if (con_ruleId > 0) {
            var con_rulepct = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRulePer]').val();
            var pamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();

            if (con_rulepct == undefined || con_rulepct == null || con_rulepct == "" || isNaN(con_rulepct)) { con_rulepct = "0"; }
            if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
            var con_ruleamt = Math.round(parseFloat(pamt) * parseFloat(con_rulepct) / 100);
            if (con_ruleamt == undefined || con_ruleamt == null || con_ruleamt == "" || isNaN(con_ruleamt)) { con_ruleamt = "0"; }
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val(parseFloat(con_ruleamt));
            var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                if (chamt == undefined || chamt == null || chamt == '')
                { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                { chpcnt = 0; }
                if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }

                
                rcPer = rcPer || 0;
                rcAmt = rcAmt || 0;
                rcTotAmt += parseFloat(rcAmt);
                rcTotPer += parseFloat(rcPer);
                chtotamt += parseFloat(chamt);
                chtotpcnt += parseFloat(chpcnt);
                btot_amt += parseFloat(b_amt);
                ntot_amt += parseFloat(n_amt);
            });
            var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
            var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
            chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
            chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

            if (chTotalOnPatGrossper == undefined || chTotalOnPatGrossper == null || chTotalOnPatGrossper == "" || isNaN(chTotalOnPatGrossper)) { chTotalOnPatGrossper = "0"; }
            if (chTotalOnPatGrossamt == undefined || chTotalOnPatGrossamt == null || chTotalOnPatGrossamt == "" || isNaN(chTotalOnPatGrossamt)) { chTotalOnPatGrossamt = "0"; }
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
        }

        CalculateGridAmt(CurrentRowIndex);
    }

}
function OnFailPatientHistory(result) {
    $(".stoast").toastText("warning", "Unable to connect service,Please try again !", 5, 3);
    return false;
}
/*Coroporate patient visit type based prices*/
function CorpConsPrice(results) {

    var CurrentRowIndex = 0;
    CurrentRowIndex = ddlrowindex;
    if (results == null || results == '') {
        var doctorName = $('[id*=ucConsultant_txtSearchControl]').val();
        $(".stoast").toastText("warning", "for  '" + doctorName + "' Consultation Charge Setup was not done! ", 5, 3);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCamt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCDiscP]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCDiscAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCNetAmt]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPrice]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPct]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPrice]').val(0);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPct]').val(0);
        CalculateGridAmt(CurrentRowIndex);
        return false;
    }
    else {
        var price = typeof (results.d[0].PRICE == "string" || results.d[0].PRICE == "number") ? results.d[0].PRICE : '0';

        var OrgPrice = typeof results.d[0].ORG_PRICE == "string" ? results.d[0].ORG_PRICE : '0';
        var DocPrice = typeof results.d[0].DOCTOR_PRICE == "string" ? results.d[0].DOCTOR_PRICE : '0';
        var srvpriceid = typeof (results.d[0].SERVICE_PRICE_ID == "string" || results.d[0].SERVICE_PRICE_ID == "number") ? results.d[0].SERVICE_PRICE_ID : '0';
        var DOCTOR_PCT = typeof results.d[0].DOCTOR_PCT == "string" ? results.d[0].DOCTOR_PCT : '0';
        var ORG_PCT = typeof results.d[0].ORG_PCT == "string" ? results.d[0].ORG_PCT : '0';
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val(price);
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(price);
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val(price);
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(price);

        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnsrvpriceID]').val(srvpriceid);



        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPrice]').val(DocPrice);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorPct]').val(DOCTOR_PCT);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPrice]').val(OrgPrice);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnOrgPct]').val(ORG_PCT);

        if ($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val() == 2 && $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val() > 0) {
            var discount_pnt = document.getElementById('' + ctrlcom + '_uccorporate_hbncondisamount').value;
            if (discount_pnt > 0) {
                corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
                emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
                if (price > 0) {
                    var empnetmat = (parseFloat(price) * parseFloat(emppcnt)) / 100;
                    var patdisamt = (parseFloat(empnetmat) * parseFloat(discount_pnt)) / 100;
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(parseFloat(patdisamt));
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(parseFloat(discount_pnt));

                } else {
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(0);
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(0);
                }
            }
        }
        CalculateGridAmt(CurrentRowIndex);
    }
}

/*Discount Types Changes */
function DiscountTypesChanges() {
    document.getElementById('' + ctrlcom + '_UCServices_txtDiscAmtSag').value = '0';
    if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true) {
        $("table[id*=gvServices] tr:has(td)").each(function (e) {
            var PatBAmt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
            var PatNAmt = $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val();
            var Out_Source = $(this).closest('tr').find("input[type=hidden][id*=hdnIsForeignSrv]").val();
            $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val('0');
            $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val('0');
            $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(PatBAmt);
            $(this).closest('tr').find("input[type=text][id*=txtDiscP]").attr("disabled", true);
            $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").attr("disabled", true);
        });
        DivFOrPcnt.style.display = "none";
        $("#lblquick").addClass("select");
        $("#lbladvanced").removeClass("select");
        lblquick.disabled = false;
        lbladvanced.disabled = false;

    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true) {
        $("table[id*=gvServices] tr:has(td)").each(function (e) {
            var PatBAmt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
            var PatNAmt = $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val();
            var Out_Source = $(this).closest('tr').find("input[type=hidden][id*=hdnIsForeignSrv]").val();
            $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(PatBAmt);
            $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val('0');
            $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val('0');
            if (document.getElementById('' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').value == 'False' && Out_Source == 'Y') {
                $(this).closest('tr').find("input[type=text][id*=txtDiscP]").attr("disabled", true);
                $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").attr("disabled", true);
            }
            else {
                $(this).closest('tr').find("input[type=text][id*=txtDiscP]").attr("disabled", false);
                $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").attr("disabled", false);
            }
        });
        DivFOrPcnt.style.display = "none";
        $("#lblquick").removeClass("select");
        $("#lbladvanced").addClass("select");
        lblquick.disabled = true;
        lbladvanced.disabled = true;
        $("#lbladvanced").trigger('click');
    }
    else {
        $("table[id*=gvServices] tr:has(td)").each(function (e) {
            var PatBAmt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
            var PatNAmt = $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val();
            var Out_Source = $(this).closest('tr').find("input[type=hidden][id*=hdnIsForeignSrv]").val();
            $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(PatBAmt);
            $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val('0');
            $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val('0');
            if (document.getElementById('' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').value == 'False' && Out_Source == 'Y') {
                $(this).closest('tr').find("input[type=text][id*=txtDiscP]").attr("disabled", true);
                $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").attr("disabled", true);
            }
            else {
                $(this).closest('tr').find("input[type=text][id*=txtDiscP]").attr("disabled", true);
                $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").attr("disabled", true);
            }
        });
        DivFOrPcnt.style.display = "block";
        $("#lblquick").removeClass("select");
        $("#lbladvanced").addClass("select");
        lblquick.disabled = true;
        lbladvanced.disabled = true;
        $("#lbladvanced").trigger('click');
    }
    return false;
}
/* Only numbers */
function checknumers(e) {
    var unicode = e.charCode ? e.charCode : e.keyCode
    if (unicode != 8) {
        if (unicode < 48 || unicode > 57)
            return false
    }
}
/*Qty Change Amounts Sagrigation */
var SrvSdul_ServiceId = ''; var HdnSrSdulIndex = '';
function OnQtyChange(ev) {

    console.log(document.getElementById('' + ctrlcom + '_UCServices_hdnsrvqtyCompany').value);
    /*this line comment by naveen.a bcoz In UHWI QTY Calculation Problams*/
    /* if (document.getElementById('' + ctrlcom + '_UCServices_hdnsrvqtyCompany').value == ev.value) {
    return false;
    }*/
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('Y');
    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
    }
    else if (form_name == 'OPQUICK') {
        pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
    }
    var srv_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    var qty = ev.value; HdnSrSdulIndex = CurrentRowIndex;
    if (pat_type == 2 || pat_type == 5 || pat_type == 8 || pat_type == 9 || pat_type == 10) {
        var cmpruleqty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdncmpruleqty]').val();
        var utilizedcmpruleqty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnutilizedruleqty]').val();
        var refqty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdncmprefqty]').val();
        var utilizedrefqty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnutilizedrefqty]').val();
        utilizedcmpruleqty = utilizedcmpruleqty == "" ? "0" : utilizedcmpruleqty;
        utilizedrefqty = utilizedrefqty == "" ? "0" : utilizedrefqty;
        var chkqty = cmpruleqty - utilizedcmpruleqty;
        if (cmpruleqty > 0) {
            if (parseInt(qty) > parseFloat(chkqty)) {
                $(".toast").toastText("warning", "Service is allowed for " + chkqty + " times only under this Company Rule Quantity", 5, 3);
                $("[id*=UCServices_gvServices] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('[id*=txtQty]').val(document.getElementById('' + ctrlcom + '_UCServices_hdnsrvqtyCompany').value);
                return false;
            }
        }
    }
    if (parseInt(qty) > 0) {
        
        if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnisschedulerequired]').val() == 'Y') {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=imgSrvShedu]').css('display', 'block');
        }
    }
    else if (parseInt(qty) == 0 || qty == '') {
        $(".stoast").toastText("warning", "Quantity Cannot Be Zero", 5, 3);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val('1');
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').focus();
    }


    var hcid = '';
    var hcNo = '';
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (form_name == 'OP' || form_name == 'Cons') {
        hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
        hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
    }
    else if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
            hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
            hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

        }
        else {
            hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
            hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
        }
    }

    hcid = hcid == '' ? 0 : hcid;
    hcNo = hcNo == '' ? 0 : hcNo;
    if (hcid > 0) {
        BindPatientHealthCrad(hcid, hcNo);
    }


    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (form_name == 'OP' || form_name == 'Cons') {
        credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
    }
    else if (form_name == 'OPQUICK') {
        credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();
    } else { }
    if (parseFloat(credit_limit) > 0) {
        if (parseFloat($('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCNetAmt]').val()) > 0) {
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
                var ev = $(this)[0].rowIndex;
                if (ev >= CurrentRowIndex) {

                    var cmpnetamt = $(this).closest('tr').find('input[type=text][id*=txtCNetAmt]').val();
                    if (parseFloat(cmpnetamt) > 0) {
                        ev = ev == undefined || NaN ? 1 : ev;
                        CalculateGridAmt(CurrentRowIndex)
                    }
                }
            });
        }
        else {
            CalculateGridAmt(CurrentRowIndex)
        }

    }
    else {
        CalculateGridAmt(CurrentRowIndex);
    }

    var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val();
    var rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val();
    var amt = parseFloat(qty) * parseFloat(rate);
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(amt);
    var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    } else {
        if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

            } else {
                var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
            }
        }
    }
    if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
    { Cmp_id = 0; }
    if (Cmp_id > 0) {
        CalculateGridAmt(CurrentRowIndex);
        var overallconamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
        var Pgrossamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPamt]").val();
        if (overallconamt == undefined || overallconamt == null || overallconamt == "" || isNaN(overallconamt)) { overallconamt = "0"; }
        if (Pgrossamt == undefined || Pgrossamt == null || Pgrossamt == "" || isNaN(Pgrossamt)) { Pgrossamt = "0"; }

        var PconAmt = Math.round((parseFloat(Pgrossamt) * parseFloat(overallconamt)) / parseFloat(100));
        if (PconAmt == undefined || PconAmt == null || PconAmt == "" || isNaN(PconAmt)) { PconAmt = "0"; }
        var PconNetAmt = parseFloat(Pgrossamt) - parseFloat(PconAmt);
        if (PconNetAmt == undefined || PconNetAmt == null || PconNetAmt == "" || isNaN(PconNetAmt)) { PconNetAmt = "0"; }
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(PconAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPNAmt]").val(PconNetAmt);
        CalculateGridAmt(CurrentRowIndex);
    } else {
        var con_ruleId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdncruleid]').val();
        if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
        { con_ruleId = 0; }
        if (con_ruleId > 0) {
            var con_rulepct = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRulePer]').val();
            var hcdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txthcPer]").val();
            var pdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
            var mandispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmaPer]").val();
            var staffdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstPer]").val();
            var eventdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebPer]").val();


            var pamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val();
            if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                var emp_per = document.getElementById('ctl00_ContentPlaceHolder1_hdnEmpPer').value;
                if (emp_per == undefined || emp_per == null || emp_per == "" || isNaN(emp_per)) { emp_per = "0"; }
                var cmp_pcr = document.getElementById('ctl00_ContentPlaceHolder1_hdnOrgPer').value;

            } else {

                var cmp_pcr = 0;

            }

            var cmpAmt = Math.round(((parseFloat(pamt) * parseFloat(cmp_pcr)) / parseFloat(100)));
            if (cmpAmt == undefined || cmpAmt == null || cmpAmt == "" || isNaN(cmpAmt)) { cmpAmt = "0"; }
            var empamt = Math.round(parseFloat(pamt) - parseFloat(cmpAmt));
            if (empamt == undefined || empamt == null || empamt == "" || isNaN(empamt)) { empamt = "0"; }

            if (hcdispcr == undefined || hcdispcr == null || hcdispcr == "" || isNaN(hcdispcr)) { hcdispcr = "0"; }
            if (pdispcr == undefined || pdispcr == null || pdispcr == "" || isNaN(pdispcr)) { pdispcr = "0"; }
            if (mandispcr == undefined || mandispcr == null || mandispcr == "" || isNaN(mandispcr)) { mandispcr = "0"; }
            if (staffdispcr == undefined || staffdispcr == null || staffdispcr == "" || isNaN(staffdispcr)) { staffdispcr = "0"; }
            if (eventdispcr == undefined || eventdispcr == null || eventdispcr == "" || isNaN(eventdispcr)) { eventdispcr = "0"; }



            var hcdisamt = Math.round(parseFloat(empamt) * parseFloat(hcdispcr) / 100);
            var pdisamt = Math.round(parseFloat(empamt) * parseFloat(pdispcr) / 100);
            var mandisamt = Math.round(parseFloat(empamt) * parseFloat(mandispcr) / 100);
            var staffdisamt = Math.round(parseFloat(empamt) * parseFloat(staffdispcr) / 100);
            var eventdisamt = Math.round(parseFloat(empamt) * parseFloat(eventdispcr) / 100);
            var condisamt = Math.round(parseFloat(empamt) * parseFloat(condispcr) / 100);
            if (hcdisamt == undefined || hcdisamt == null || hcdisamt == "" || isNaN(hcdisamt)) { hcdisamt = "0"; }
            if (pdisamt == undefined || pdisamt == null || pdisamt == "" || isNaN(pdisamt)) { pdisamt = "0"; }
            if (mandisamt == undefined || mandisamt == null || mandisamt == "" || isNaN(mandisamt)) { mandisamt = "0"; }
            if (staffdisamt == undefined || staffdisamt == null || staffdisamt == "" || isNaN(staffdisamt)) { staffdisamt = "0"; }
            if (eventdisamt == undefined || eventdisamt == null || eventdisamt == "" || isNaN(eventdisamt)) { eventdisamt = "0"; }


            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtHcAmt]").val(hcdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(pdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmgAmt]").val(mandisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstAmt]").val(staffdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebAmt]").val(eventdisamt);

            if (con_rulepct == undefined || con_rulepct == null || con_rulepct == "" || isNaN(con_rulepct)) { con_rulepct = "0"; }
            if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
            var con_ruleamt = Math.round(parseFloat(pamt) * parseFloat(con_rulepct) / 100);
            if (con_ruleamt == undefined || con_ruleamt == null || con_ruleamt == "" || isNaN(con_ruleamt)) { con_ruleamt = "0"; }
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val(parseFloat(con_ruleamt));
            var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                if (chamt == undefined || chamt == null || chamt == '')
                { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                { chpcnt = 0; }
                if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }

                
                rcAmt = rcAmt || 0;
                rcPer = rcPer || 0;
                rcTotAmt += parseFloat(rcAmt);
                rcTotPer += parseFloat(rcPer);
                chtotamt += parseFloat(chamt);
                chtotpcnt += parseFloat(chpcnt);
                btot_amt += parseFloat(b_amt);
                ntot_amt += parseFloat(n_amt);
            });
            var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
            var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
            chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
            chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

            if (chTotalOnPatGrossper == undefined || chTotalOnPatGrossper == null || chTotalOnPatGrossper == "" || isNaN(chTotalOnPatGrossper)) { chTotalOnPatGrossper = "0"; }
            if (chTotalOnPatGrossamt == undefined || chTotalOnPatGrossamt == null || chTotalOnPatGrossamt == "" || isNaN(chTotalOnPatGrossamt)) { chTotalOnPatGrossamt = "0"; }
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
        }
        else {
            var hcdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txthcPer]").val();
            var pdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
            var mandispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmaPer]").val();
            var staffdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstPer]").val();
            var eventdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebPer]").val();
            var condispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtRulePer]").val();


            var pamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val();
            if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                var emp_per = document.getElementById('ctl00_ContentPlaceHolder1_hdnEmpPer').value;
                if (emp_per == undefined || emp_per == null || emp_per == "" || isNaN(emp_per)) { emp_per = "0"; }
                var cmp_pcr = document.getElementById('ctl00_ContentPlaceHolder1_hdnOrgPer').value;

            } else {

                var cmp_pcr = 0;

            }

            var cmpAmt = Math.round(((parseFloat(pamt) * parseFloat(cmp_pcr)) / parseFloat(100)));
            if (cmpAmt == undefined || cmpAmt == null || cmpAmt == "" || isNaN(cmpAmt)) { cmpAmt = "0"; }
            var empamt = Math.round(parseFloat(pamt) - parseFloat(cmpAmt));
            if (empamt == undefined || empamt == null || empamt == "" || isNaN(empamt)) { empamt = "0"; }

            if (hcdispcr == undefined || hcdispcr == null || hcdispcr == "" || isNaN(hcdispcr)) { hcdispcr = "0"; }
            if (pdispcr == undefined || pdispcr == null || pdispcr == "" || isNaN(pdispcr)) { pdispcr = "0"; }
            if (mandispcr == undefined || mandispcr == null || mandispcr == "" || isNaN(mandispcr)) { mandispcr = "0"; }
            if (staffdispcr == undefined || staffdispcr == null || staffdispcr == "" || isNaN(staffdispcr)) { staffdispcr = "0"; }
            if (eventdispcr == undefined || eventdispcr == null || eventdispcr == "" || isNaN(eventdispcr)) { eventdispcr = "0"; }
            if (condispcr == undefined || condispcr == null || condispcr == "" || isNaN(condispcr)) { condispcr = "0"; }


            var hcdisamt = Math.round(parseFloat(empamt) * parseFloat(hcdispcr) / 100);
            var pdisamt = Math.round(parseFloat(empamt) * parseFloat(pdispcr) / 100);
            var mandisamt = Math.round(parseFloat(empamt) * parseFloat(mandispcr) / 100);
            var staffdisamt = Math.round(parseFloat(empamt) * parseFloat(staffdispcr) / 100);
            var eventdisamt = Math.round(parseFloat(empamt) * parseFloat(eventdispcr) / 100);
            var condisamt = Math.round(parseFloat(empamt) * parseFloat(condispcr) / 100);
            if (hcdisamt == undefined || hcdisamt == null || hcdisamt == "" || isNaN(hcdisamt)) { hcdisamt = "0"; }
            if (pdisamt == undefined || pdisamt == null || pdisamt == "" || isNaN(pdisamt)) { pdisamt = "0"; }
            if (mandisamt == undefined || mandisamt == null || mandisamt == "" || isNaN(mandisamt)) { mandisamt = "0"; }
            if (staffdisamt == undefined || staffdisamt == null || staffdisamt == "" || isNaN(staffdisamt)) { staffdisamt = "0"; }
            if (eventdisamt == undefined || eventdisamt == null || eventdisamt == "" || isNaN(eventdisamt)) { eventdisamt = "0"; }
            if (condisamt == undefined || condisamt == null || condisamt == "" || isNaN(condisamt)) { condisamt = "0"; }

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtHcAmt]").val(hcdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(pdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmgAmt]").val(mandisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstAmt]").val(staffdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebAmt]").val(eventdisamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtcncrlAmt]").val(condisamt);

        }

        CalculateGridAmt(CurrentRowIndex);
    }
    CalculateUpdateLinewiseMultidiscount();
}
function CalculateUpdateLinewiseMultidiscount() {
    var PatGrossAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgross').val();
    var hcTotAmt = 0, hcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0;
    var patTotAmt = 0, patTotPer = 0, MgTotAmt = 0, MgTotPer = 0, StafTotAmt = 0, StafTotPer = 0;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        if ($(this).closest("tr").find("input[type=hidden][id*=hdnServiceID]").val() > 0 && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0) {
            var hcAmt = $(this).closest('tr').find("[id*=txtHcAmt]").val();
            var EvAmt = $(this).closest('tr').find("[id*=txtebAmt]").val();
            var RlAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
            var PatAmt = $(this).closest('tr').find("[id*=txtDiscAmt]").val();
            var MgAmt = $(this).closest('tr').find("[id*=txtmgAmt]").val();
            var StafAmt = $(this).closest('tr').find("[id*=txtstAmt]").val();
            hcAmt = hcAmt || 0; hcTotAmt += parseFloat(hcAmt);
            RlAmt = RlAmt || 0; CnTotAmt += parseFloat(RlAmt);
            EvAmt = EvAmt || 0; EvTotAmt += parseFloat(EvAmt);
            PatAmt = PatAmt || 0; patTotAmt += parseFloat(PatAmt);
            MgAmt = MgAmt || 0; MgTotAmt += parseFloat(MgAmt);
            StafAmt = StafAmt || 0; StafTotAmt += parseFloat(StafAmt);
        }
    });
    patTotAmt = setProperDecimalsCorpPer(patTotAmt) || 0;
    MgTotAmt = setProperDecimalsCorpPer(MgTotAmt) || 0;
    StafTotAmt = setProperDecimalsCorpPer(StafTotAmt) || 0;
    hcTotAmt = setProperDecimalsCorpPer(hcTotAmt) || 0;
    EvTotAmt = setProperDecimalsCorpPer(EvTotAmt) || 0;
    CnTotAmt = setProperDecimalsCorpPer(CnTotAmt) || 0;
    patTotPer = (parseFloat(100) * parseFloat(patTotAmt)) / parseFloat(PatGrossAmt);
    MgTotPer = (parseFloat(100) * parseFloat(MgTotAmt)) / parseFloat(PatGrossAmt);
    StafTotPer = (parseFloat(100) * parseFloat(StafTotAmt)) / parseFloat(PatGrossAmt);
    hcTotPer = (parseFloat(100) * parseFloat(hcTotAmt)) / parseFloat(PatGrossAmt);
    EvTotPer = (parseFloat(100) * parseFloat(EvTotAmt)) / parseFloat(PatGrossAmt);
    CnTotPer = (parseFloat(100) * parseFloat(CnTotAmt)) / parseFloat(PatGrossAmt);
    patTotPer = setProperDecimalsCorpPer(patTotPer) || 0;
    MgTotPer = setProperDecimalsCorpPer(MgTotPer) || 0;
    StafTotPer = setProperDecimalsCorpPer(StafTotPer) || 0;
    hcTotPer = setProperDecimalsCorpPer(hcTotPer) || 0;
    EvTotPer = setProperDecimalsCorpPer(EvTotPer) || 0;
    CnTotPer = setProperDecimalsCorpPer(CnTotPer) || 0;
    $("table[id*=gvMultipleConcession] tr:has(td)").each(function (e) {
        var discounttypeid = $(this).closest('tr').find("[id*=ddlMultiDiscounttype]").val();
        var CountIncrementrow = $(this)[0].rowIndex;

        if (discounttypeid == 1) {
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtPersentage]').val(patTotPer);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtAmount]').val(patTotAmt);
        }
        if (discounttypeid == 2) {
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtPersentage]').val(hcTotPer);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtAmount]').val(hcTotAmt);
        }
        if (discounttypeid == 3) {
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtPersentage]').val(MgTotPer);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtAmount]').val(MgTotAmt);
        }
        if (discounttypeid == 4) {
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtPersentage]').val(StafTotPer);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtAmount]').val(StafTotAmt);
        }
        if (discounttypeid == 5) {
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtPersentage]').val(EvTotPer);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtAmount]').val(EvTotAmt);
        }
        if (discounttypeid == 6) {
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtPersentage]').val(CnTotPer);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CountIncrementrow + ")").find('[id*=txtAmount]').val(CnTotAmt);
        }
    });
}
function OnRateChange(ev) {
    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var srv_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    var rate = ev.value;
    if (parseInt(rate) > 0) {
        var hcid = '';
        var hcNo = '';
        var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
        if (form_name == 'OP' || form_name == 'Cons') {
            hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
            hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
                hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
                hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

            }
            else {
                hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
                hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
            }
        }
        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons') {
            var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        } else {
            if (form_name == 'OPQUICK') {
                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

                } else {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
                }
            }
        }
        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
        { Cmp_id = 0; }

        hcid = hcid == '' ? 0 : hcid;
        hcNo = hcNo == '' ? 0 : hcNo;

        if (hcid > 0) {
            BindPatientHealthCrad(hcid, hcNo);
        }

        var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val();
        var amt = parseFloat(qty) * parseFloat(rate);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(amt);
        
        if (Cmp_id > 0) {
            CalculateGridAmt(CurrentRowIndex);
            var overallconamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
            var Pgrossamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPamt]").val();
            if (overallconamt == undefined || overallconamt == null || overallconamt == "" || isNaN(overallconamt)) { overallconamt = "0"; }
            if (Pgrossamt == undefined || Pgrossamt == null || Pgrossamt == "" || isNaN(Pgrossamt)) { Pgrossamt = "0"; }

            var PconAmt = Math.round((parseFloat(Pgrossamt) * parseFloat(overallconamt)) / parseFloat(100));
            if (PconAmt == undefined || PconAmt == null || PconAmt == "" || isNaN(PconAmt)) { PconAmt = "0"; }
            var PconNetAmt = parseFloat(Pgrossamt) - parseFloat(PconAmt);
            if (PconNetAmt == undefined || PconNetAmt == null || PconNetAmt == "" || isNaN(PconNetAmt)) { PconNetAmt = "0"; }
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(PconAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPNAmt]").val(PconNetAmt);
            CalculateGridAmt(CurrentRowIndex);
        } else {
            var con_ruleId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdncruleid]').val();
            if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
            { con_ruleId = 0; }
            if (con_ruleId > 0) {
                var con_rulepct = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRulePer]').val();
                var pamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val();
                if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
                if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                    var emp_per = document.getElementById('ctl00_ContentPlaceHolder1_hdnEmpPer').value;
                    if (emp_per == undefined || emp_per == null || emp_per == "" || isNaN(emp_per)) { emp_per = "0"; }
                    var cmp_pcr = document.getElementById('ctl00_ContentPlaceHolder1_hdnOrgPer').value;

                } else {

                    var cmp_pcr = 0;

                }

                var cmpAmt = Math.round(((parseFloat(pamt) * parseFloat(cmp_pcr)) / parseFloat(100)));
                if (cmpAmt == undefined || cmpAmt == null || cmpAmt == "" || isNaN(cmpAmt)) { cmpAmt = "0"; }
                var empamt = Math.round(parseFloat(pamt) - parseFloat(cmpAmt));
                if (empamt == undefined || empamt == null || empamt == "" || isNaN(empamt)) { empamt = "0"; }
                if (con_rulepct == undefined || con_rulepct == null || con_rulepct == "" || isNaN(con_rulepct)) { con_rulepct = "0"; }
                var hcdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txthcPer]").val();
                var pdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
                var mandispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmaPer]").val();
                var staffdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstPer]").val();
                var eventdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebPer]").val();

                var con_ruleamt = Math.round(parseFloat(empamt) * parseFloat(con_rulepct) / 100);
                var hcdisamt = Math.round(parseFloat(empamt) * parseFloat(hcdispcr) / 100);
                var pdisamt = Math.round(parseFloat(empamt) * parseFloat(pdispcr) / 100);
                var mandisamt = Math.round(parseFloat(empamt) * parseFloat(mandispcr) / 100);
                var staffdisamt = Math.round(parseFloat(empamt) * parseFloat(staffdispcr) / 100);
                var eventdisamt = Math.round(parseFloat(empamt) * parseFloat(eventdispcr) / 100);

                if (hcdisamt == undefined || hcdisamt == null || hcdisamt == "" || isNaN(hcdisamt)) { hcdisamt = "0"; }
                if (pdisamt == undefined || pdisamt == null || pdisamt == "" || isNaN(pdisamt)) { pdisamt = "0"; }
                if (mandisamt == undefined || mandisamt == null || mandisamt == "" || isNaN(mandisamt)) { mandisamt = "0"; }
                if (staffdisamt == undefined || staffdisamt == null || staffdisamt == "" || isNaN(staffdisamt)) { staffdisamt = "0"; }
                if (eventdisamt == undefined || eventdisamt == null || eventdisamt == "" || isNaN(eventdisamt)) { eventdisamt = "0"; }


                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtHcAmt]").val(hcdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(pdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmgAmt]").val(mandisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstAmt]").val(staffdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebAmt]").val(eventdisamt);
                ;
                if (con_ruleamt == undefined || con_ruleamt == null || con_ruleamt == "" || isNaN(con_ruleamt)) { con_ruleamt = "0"; }
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val(parseFloat(con_ruleamt));
                var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
                $("table[id*=gvServices] tr:has(td)").each(function (e) {
                    var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                    var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                    var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                    var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                    var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                    var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                    if (chamt == undefined || chamt == null || chamt == '')
                    { chamt = 0; }
                    if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                    { chpcnt = 0; }
                    if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                    if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                    if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                    if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                    if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                    if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }

                    typeof rcAmt == 'string' ? (typeof rcAmt == 'undefined' || rcAmt.trim() == '' ? 0 : parseFloat(rcAmt)) : (typeof rcAmt == 'object' ? 0 : parseFloat(rcAmt));
                    typeof rcPer == 'string' ? (typeof rcPer == 'undefined' || rcPer.trim() == '' ? 0 : parseFloat(rcPer)) : (typeof rcPer == 'object' ? 0 : parseFloat(rcPer));
                    rcTotAmt += parseFloat(rcAmt);
                    rcTotPer += parseFloat(rcPer);
                    chtotamt += parseFloat(chamt);
                    chtotpcnt += parseFloat(chpcnt);
                    btot_amt += parseFloat(b_amt);
                    ntot_amt += parseFloat(n_amt);
                });
                var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
                var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
                chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
                chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

                if (chTotalOnPatGrossper == undefined || chTotalOnPatGrossper == null || chTotalOnPatGrossper == "" || isNaN(chTotalOnPatGrossper)) { chTotalOnPatGrossper = "0"; }
                if (chTotalOnPatGrossamt == undefined || chTotalOnPatGrossamt == null || chTotalOnPatGrossamt == "" || isNaN(chTotalOnPatGrossamt)) { chTotalOnPatGrossamt = "0"; }
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
            } else {
                var hcdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txthcPer]").val();
                var pdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
                var mandispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmaPer]").val();
                var staffdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstPer]").val();
                var eventdispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebPer]").val();
                var condispcr = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtRulePer]").val();


                var pamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val();
                if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
                if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                    var emp_per = document.getElementById('ctl00_ContentPlaceHolder1_hdnEmpPer').value;
                    if (emp_per == undefined || emp_per == null || emp_per == "" || isNaN(emp_per)) { emp_per = "0"; }
                    var cmp_pcr = document.getElementById('ctl00_ContentPlaceHolder1_hdnOrgPer').value;

                } else {

                    var cmp_pcr = 0;

                }

                var cmpAmt = Math.round(((parseFloat(pamt) * parseFloat(cmp_pcr)) / parseFloat(100)));
                if (cmpAmt == undefined || cmpAmt == null || cmpAmt == "" || isNaN(cmpAmt)) { cmpAmt = "0"; }
                var empamt = Math.round(parseFloat(pamt) - parseFloat(cmpAmt));
                if (empamt == undefined || empamt == null || empamt == "" || isNaN(empamt)) { empamt = "0"; }

                if (hcdispcr == undefined || hcdispcr == null || hcdispcr == "" || isNaN(hcdispcr)) { hcdispcr = "0"; }
                if (pdispcr == undefined || pdispcr == null || pdispcr == "" || isNaN(pdispcr)) { pdispcr = "0"; }
                if (mandispcr == undefined || mandispcr == null || mandispcr == "" || isNaN(mandispcr)) { mandispcr = "0"; }
                if (staffdispcr == undefined || staffdispcr == null || staffdispcr == "" || isNaN(staffdispcr)) { staffdispcr = "0"; }
                if (eventdispcr == undefined || eventdispcr == null || eventdispcr == "" || isNaN(eventdispcr)) { eventdispcr = "0"; }
                if (condispcr == undefined || condispcr == null || condispcr == "" || isNaN(condispcr)) { condispcr = "0"; }


                var hcdisamt = Math.round(parseFloat(empamt) * parseFloat(hcdispcr) / 100);
                var pdisamt = Math.round(parseFloat(empamt) * parseFloat(pdispcr) / 100);
                var mandisamt = Math.round(parseFloat(empamt) * parseFloat(mandispcr) / 100);
                var staffdisamt = Math.round(parseFloat(empamt) * parseFloat(staffdispcr) / 100);
                var eventdisamt = Math.round(parseFloat(empamt) * parseFloat(eventdispcr) / 100);
                var condisamt = Math.round(parseFloat(empamt) * parseFloat(condispcr) / 100);
                if (hcdisamt == undefined || hcdisamt == null || hcdisamt == "" || isNaN(hcdisamt)) { hcdisamt = "0"; }
                if (pdisamt == undefined || pdisamt == null || pdisamt == "" || isNaN(pdisamt)) { pdisamt = "0"; }
                if (mandisamt == undefined || mandisamt == null || mandisamt == "" || isNaN(mandisamt)) { mandisamt = "0"; }
                if (staffdisamt == undefined || staffdisamt == null || staffdisamt == "" || isNaN(staffdisamt)) { staffdisamt = "0"; }
                if (eventdisamt == undefined || eventdisamt == null || eventdisamt == "" || isNaN(eventdisamt)) { eventdisamt = "0"; }
                if (condisamt == undefined || condisamt == null || condisamt == "" || isNaN(condisamt)) { condisamt = "0"; }

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtHcAmt]").val(hcdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(pdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtmgAmt]").val(mandisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtstAmt]").val(staffdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtebAmt]").val(eventdisamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtcncrlAmt]").val(condisamt);


            }

            CalculateGridAmt(CurrentRowIndex);

        }
    }
}

/*Rate Editable Price Range Check */
function CheckPriceInRange(ev) {

    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var srv_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    var Min_Price = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnMin_Price]').val();
    var Max_Price = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnMax_Price]').val();
    var N_Rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnNormal_Price]').val();
    var E_Rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnEmergency_Price]').val();
    var DD_S_type = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddSType]').val()
    var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
    } else {
        if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

            } else {
                var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
            }
        }
    }
    if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
    { Cmp_id = 0; }

    if (parseInt(Min_Price) > 0) { } else { Min_Price = '0'; }
    if (parseInt(Max_Price) > 0) { } else { Max_Price = '0'; }
    if (parseInt(N_Rate) > 0) { } else { N_Rate = '0'; }
    if (parseInt(E_Rate) > 0) { } else { E_Rate = '0'; }
    var rate = ev.value;
    if (parseInt(rate) >= 0) {
        if ((parseFloat(Min_Price) <= parseFloat(rate)) && (parseFloat(rate) <= parseFloat(Max_Price))) {
        }
        else {
            if (parseInt(E_Rate) < parseInt(rate) && DD_S_type == '2') {
                $(".stoast").toastText("warning", "you cannot edit the rate beyond the defined range! Min Price '" + Min_Price + "' & Max Price '" + Max_Price + "' ", 5, 3);
            }
            if (DD_S_type == '1') { $(".stoast").toastText("warning", "you cannot edit the rate beyond the defined range! Min Price '" + Min_Price + "' & Max Price '" + Max_Price + "' ", 5, 3); }
            if (DD_S_type == '2') { ev.value = E_Rate; }
            else { ev.value = N_Rate; }
            var rate = ev.value;
            var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val();
            var amt = parseFloat(qty) * parseFloat(rate);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtAmount]').val(amt);



        }

        var hcid = '';
        var hcNo = '';
        var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
        if (form_name == 'OP' || form_name == 'Cons') {
            hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
            hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
                hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
                hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

            }
            else {
                hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
                hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
            }
        }

        hcid = hcid == '' ? 0 : hcid;
        hcNo = hcNo == '' ? 0 : hcNo;

        if (hcid > 0) {
            BindPatientHealthCrad(hcid, hcNo);
        }

    }
    if (Cmp_id > 0) {
        CalculateGridAmt(CurrentRowIndex);
        var overallconamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscP]").val();
        var Pgrossamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPamt]").val();
        if (overallconamt == undefined || overallconamt == null || overallconamt == "" || isNaN(overallconamt)) { overallconamt = "0"; }
        if (Pgrossamt == undefined || Pgrossamt == null || Pgrossamt == "" || isNaN(Pgrossamt)) { Pgrossamt = "0"; }

        var PconAmt = Math.round((parseFloat(Pgrossamt) * parseFloat(overallconamt)) / parseFloat(100));
        if (PconAmt == undefined || PconAmt == null || PconAmt == "" || isNaN(PconAmt)) { PconAmt = "0"; }
        var PconNetAmt = parseFloat(Pgrossamt) - parseFloat(PconAmt);
        if (PconNetAmt == undefined || PconNetAmt == null || PconNetAmt == "" || isNaN(PconNetAmt)) { PconNetAmt = "0"; }
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtDiscAmt]").val(PconAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtPNAmt]").val(PconNetAmt);
        CalculateGridAmt(CurrentRowIndex);
    } else {
        var con_ruleId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdncruleid]').val();
        if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
        { con_ruleId = 0; }
        if (con_ruleId > 0) {
            var con_rulepct = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRulePer]').val();
            var pamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();

            if (con_rulepct == undefined || con_rulepct == null || con_rulepct == "" || isNaN(con_rulepct)) { con_rulepct = "0"; }
            if (pamt == undefined || pamt == null || pamt == "" || isNaN(pamt)) { pamt = "0"; }
            var con_ruleamt = Math.round(parseFloat(pamt) * parseFloat(con_rulepct) / 100);
            if (con_ruleamt == undefined || con_ruleamt == null || con_ruleamt == "" || isNaN(con_ruleamt)) { con_ruleamt = "0"; }
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val(parseFloat(con_ruleamt));
            var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                if (chamt == undefined || chamt == null || chamt == '')
                { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                { chpcnt = 0; }
                if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }

                typeof rcAmt == 'string' ? (typeof rcAmt == 'undefined' || rcAmt.trim() == '' ? 0 : parseFloat(rcAmt)) : (typeof rcAmt == 'object' ? 0 : parseFloat(rcAmt));
                typeof rcPer == 'string' ? (typeof rcPer == 'undefined' || rcPer.trim() == '' ? 0 : parseFloat(rcPer)) : (typeof rcPer == 'object' ? 0 : parseFloat(rcPer));
                rcTotAmt += parseFloat(rcAmt);
                rcTotPer += parseFloat(rcPer);
                chtotamt += parseFloat(chamt);
                chtotpcnt += parseFloat(chpcnt);
                btot_amt += parseFloat(b_amt);
                ntot_amt += parseFloat(n_amt);
            });
            var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
            var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
            chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
            chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

            if (chTotalOnPatGrossper == undefined || chTotalOnPatGrossper == null || chTotalOnPatGrossper == "" || isNaN(chTotalOnPatGrossper)) { chTotalOnPatGrossper = "0"; }
            if (chTotalOnPatGrossamt == undefined || chTotalOnPatGrossamt == null || chTotalOnPatGrossamt == "" || isNaN(chTotalOnPatGrossamt)) { chTotalOnPatGrossamt = "0"; }
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + 1 + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
        }
        CalculateGridAmt(CurrentRowIndex);
    }
}
/* Services Wise Discount In Percent */
function OnPatDiscPcntChange(ev, Flag, flag2) {

    /* line item wise concession Starts */
    var allow_srv_group_pcnt = $('#' + ctrlcom + '_UCServices_hdnsrvgrp_type_con').val();
    if (allow_srv_group_pcnt == '' || allow_srv_group_pcnt == undefined || allow_srv_group_pcnt == null) {
        allow_srv_group_pcnt = 'False';
        $('#' + ctrlcom + '_UCServices_hdnsrvgrp_type_con').val('False');
    }
    if ($('#' + ctrlcom + '_UCServices_hdnsrvgrp_type_con').val() == 'False') {
        if (parseFloat(ev.value) == 0) {
            ev.value = 0;
        }
        var CurrentRowIndex = 0;
        CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
        CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
        var patPer = 0, ManPer = 0, staffPer = 0, TotPer = 0; ;
        $("table[id*=gvServices] tr:has(td)").each(function (e) {

            var patPercentage = $(this).closest('tr').find('input[type=text][id*=txtDiscP]').val();
            var MangPercentage = $(this).closest('tr').find('input[type=text][id*=txtmaPer]').val();
            var staffPercentage = $(this).closest('tr').find('input[type=text][id*=txtstPer]').val();

            if (patPercentage == undefined || patPercentage == null || patPercentage == '' || patPercentage == 'NaN') { patPercentage = '0'; }
            if (MangPercentage == undefined || MangPercentage == null || MangPercentage == '' || MangPercentage == 'NaN') { MangPercentage = '0'; }
            if (staffPercentage == undefined || staffPercentage == null || staffPercentage == '' || staffPercentage == 'NaN') { staffPercentage = '0'; }
            patPer = parseFloat(patPer) + parseFloat(patPercentage);
            ManPer = parseFloat(ManPer) + parseFloat(MangPercentage);
            staffPer = parseFloat(staffPer) + parseFloat(staffPercentage);
        });

        var _Gross = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var _patDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        var _hcDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txthcPer]').val();
        var _mngtDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val();
        var _staffDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val();
        var _ebDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtebPer]').val();
        var _cnclrlDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRulePer]').val();
        if (_patDiscamt == undefined || _patDiscamt == null || _patDiscamt == '' || _patDiscamt == 'NaN') { _patDiscamt = '0'; }
        if (_hcDiscamt == undefined || _hcDiscamt == null || _hcDiscamt == '' || _hcDiscamt == 'NaN') { _hcDiscamt = '0'; }
        if (_mngtDiscamt == undefined || _mngtDiscamt == null || _mngtDiscamt == '' || _mngtDiscamt == 'NaN') { _mngtDiscamt = '0'; }
        if (_staffDiscamt == undefined || _staffDiscamt == null || _staffDiscamt == '' || _staffDiscamt == 'NaN') { _staffDiscamt = '0'; }
        if (_ebDiscamt == undefined || _ebDiscamt == null || _ebDiscamt == '' || _ebDiscamt == 'NaN') { _ebDiscamt = '0'; }
        if (_cnclrlDiscamt == undefined || _cnclrlDiscamt == null || _cnclrlDiscamt == '' || _cnclrlDiscamt == 'NaN') { _cnclrlDiscamt = '0'; }
        var _Allconcessionamts = parseFloat(_patDiscamt) + parseFloat(_hcDiscamt) + parseFloat(_mngtDiscamt) + parseFloat(_staffDiscamt) + parseFloat(_ebDiscamt) + parseFloat(_cnclrlDiscamt);
        if (_Allconcessionamts == undefined || _Allconcessionamts == null || _Allconcessionamts == '' || _Allconcessionamts == 'NaN') { _Allconcessionamts = '0'; }

        var TotalConcPer = 0;
        var srv_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        if (pDPcnt == undefined || pDPcnt == null || pDPcnt == '' || pDPcnt == 'NaN') { pDPcnt = '0'; }
        if (Flag == 'PAT') {
            if (parseFloat(pDPcnt) > 100) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
                pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pAmt);

            }
            if (parseFloat(_Allconcessionamts) > 100) {
                pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pAmt);
            }
            TotalConcPer = pDPcnt;
            if (TotalConcPer > 100) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(100);
                pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
            }
            else {
                pDPcnt = pDPcnt;
            }
            var PconAmt = Math.round(parseFloat(pAmt) * parseFloat(pDPcnt) / 100);

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
            var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        }
        if (Flag == 'MG') {
            var mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val();
            var mgmtCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val();
            var NetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            if (parseFloat(mgmtCncPer) > 100) {
                mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
                mgmtCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val('');
            }
            if (parseFloat(_Allconcessionamts) > 100) {
                mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
                mgmtCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val('');
            }
            pAmt = typeof pAmt == "string" ? (pAmt.trim() == "" ? "0" : pAmt) : (typeof pAmt == "number" ? pAmt : "0");
            mgmtCncPer = typeof mgmtCncPer == "string" ? (mgmtCncPer.trim() == "" ? "0" : mgmtCncPer) : (typeof mgmtCncPer == "number" ? mgmtCncPer : "0");
            mgmtCncamt = typeof mgmtCncamt == "string" ? (mgmtCncamt.trim() == "" ? "0" : mgmtCncamt) : (typeof mgmtCncamt == "number" ? mgmtCncamt : "0");
            NetAmt = typeof NetAmt == "string" ? (NetAmt.trim() == "" ? "0" : NetAmt) : (typeof NetAmt == "number" ? NetAmt : "0");
            TotalConcPer = mgmtCncPer;
            TotalConcPer = typeof TotalConcPer == "string" ? (TotalConcPer.trim() == "" ? "0" : TotalConcPer) : (typeof TotalConcPer == "number" ? TotalConcPer : "0");
            if (TotalConcPer > 100) {
                mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val();
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val(100);
            }
            else {
                mgmtCncPer = mgmtCncPer;
            }
            var MgconAmt = (parseFloat(NetAmt) * parseFloat(mgmtCncPer)) / parseFloat(100);
            MgconAmt = typeof MgconAmt == "string" ? (MgconAmt.trim() == "" ? "0" : MgconAmt) : (typeof MgconAmt == "number" ? MgconAmt : "0");
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val(MgconAmt);
            PconAmt = typeof PconAmt == "string" ? (PconAmt.trim() == "" ? "0" : PconAmt) : (typeof PconAmt == "number" ? PconAmt : "0");

            var pNetAmt = parseFloat(pAmt) - parseFloat(MgconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        }
        if (Flag == 'STAF') {
            var StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val();
            var StCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val();
            var NetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            if (parseFloat(StCncPer) > 100) {
                StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
                StCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val('');
            }
            if (parseFloat(_Allconcessionamts) > 100) {
                StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
                StCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val('');
            }
            pAmt = typeof pAmt == "string" ? (pAmt.trim() == "" ? "0" : pAmt) : (typeof pAmt == "number" ? pAmt : "0");
            StCncPer = typeof StCncPer == "string" ? (StCncPer.trim() == "" ? "0" : StCncPer) : (typeof StCncPer == "number" ? StCncPer : "0");
            StCncamt = typeof StCncamt == "string" ? (StCncamt.trim() == "" ? "0" : StCncamt) : (typeof StCncamt == "number" ? StCncamt : "0");
            NetAmt = typeof NetAmt == "string" ? (NetAmt.trim() == "" ? "0" : NetAmt) : (typeof NetAmt == "number" ? NetAmt : "0");
            TotalConcPer = StCncPer;
            TotalConcPer = typeof TotalConcPer == "string" ? (TotalConcPer.trim() == "" ? "0" : TotalConcPer) : (typeof TotalConcPer == "number" ? TotalConcPer : "0");
            if (TotalConcPer > 100) {
                StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val();
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val(100);
            }
            else {
                StCncPer = StCncPer;
            }
            var StconAmt = (parseFloat(NetAmt) * parseFloat(StCncPer)) / parseFloat(100);
            StconAmt = typeof StconAmt == "string" ? (StconAmt.trim() == "" ? "0" : StconAmt) : (typeof StconAmt == "number" ? StconAmt : "0");
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val(StconAmt);
            PconAmt = typeof PconAmt == "string" ? (PconAmt.trim() == "" ? "0" : PconAmt) : (typeof PconAmt == "number" ? PconAmt : "0");

            var pNetAmt = parseFloat(pAmt) - parseFloat(StconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);

        }

        if (document.getElementById('' + ctrlcom + '_UCServices_hdnisallowgst').value.toUpperCase() == "YES" && tax_pct > 0) {
            var patnetamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val();
            var cmpnetamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCNetAmt]').val();
            var tax_pct = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=hdntaxpct]").val();
            var tax_amt = ((parseFloat(patnetamt) + parseFloat(cmpnetamt)) * tax_pct) / 100;
            tax_amt = tax_amt.toFixed(2);
            var pattaxamt = (parseFloat(patnetamt) * parseFloat(tax_pct) / 100);
            pattaxamt = pattaxamt.toFixed(2);
            var cmptaxamt = (parseFloat(cmpnetamt) * parseFloat(tax_pct) / 100); 
            cmptaxamt = cmptaxamt.toFixed(2);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtptax]').val(pattaxamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtcmptax]').val(cmptaxamt);

        }


        CalculateGridAmt(CurrentRowIndex);
        /*CalculateGridAmt(CurrentRowIndex);*/ /* comm by rani bcz additional service disc not wrkng*/
    } /* line item wise concession ends */
    else {/* service group wise and type wise concession Starts */
        var cmp_setting_outsrc = $('#' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').val();
        if (parseFloat(ev.value) == 0) {
            ev.value = 0;
        }
        if (parseFloat(ev.value) > 100) {
            ev.value = 0;
            $(".stoast").toastText("warning", " Discount cANNOT MORE THAN 100% !", 5, 3);

        }
        var CurrentRowIndex = 0;
        CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
        CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;

        var GvRowscount_grp = 0;
        var count_grp = 0;
        var grid_grp = document.getElementById('tbl_SrvGrp');
        var _index_grp = 0;
        var _index_grp = grid_grp.rows.length;
        var grp_add_cnt = 0;
        var first_count = 0;
        var srv_grp_pcnt = 0;
        var Grop_exist = 'N';

        var srv_grp_name_disc = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type = hidden][id*=hdnSrv_Grp_Name]').val();
        var srv_type_name_disc = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type = hidden][id*=hdnSrv_Type_Name]').val();
        var is_outsrc = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type = hidden][id*=hdnIsForeignSrv]').val();
        if (is_outsrc == '' || is_outsrc == null || is_outsrc == undefined)
        { is_outsrc = 'N'; }
        if (document.getElementById('' + ctrlcom + '_UCServices_Srv_Grp_Type_pcnt_0').checked == true) {
            $("table[id$=tbl_SrvGrp] tr:has(td)").each(function (e) {

                if (count_grp == 0) {
                    for (GvRowscount_grp = 0; GvRowscount_grp <= _index_grp; GvRowscount_grp++) {
                        var srv_grp_nam = $('[id$=tbl_SrvGrp] tr').filter(':eq(' + GvRowscount_grp + ')').find('[id*=lblsrvgrpname]').text();
                        if ((srv_grp_nam == srv_grp_name_disc && ev.value != undefined && is_outsrc == 'N') || (srv_grp_nam == srv_grp_name_disc && ev.value != undefined && is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
                            $('[id$=tbl_SrvGrp] tr').filter(':eq(' + GvRowscount_grp + ')').find('input[type=text][id*=txtsrvgrppcnt]').val(ev.value);
                            grp_add_cnt++;
                            Grop_exist = 'Y';
                        }

                    }

                    count_grp++;
                }

            });
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_Srv_Grp_Type_pcnt_1').checked == true) {
            $("table[id$=tbl_srv_type] tr:has(td)").each(function (e) {

                if (count_grp == 0) {
                    for (GvRowscount_grp = 0; GvRowscount_grp <= _index_grp; GvRowscount_grp++) {
                        var srv_type_nam = $('[id$=tbl_srv_type] tr').filter(':eq(' + GvRowscount_grp + ')').find('[id*=lblsrvtypename]').text();
                        if ((srv_type_nam == srv_type_name_disc && ev.value != undefined && is_outsrc == 'N') || (srv_type_nam == srv_type_name_disc && ev.value != undefined && is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
                            $('[id$=tbl_srv_type] tr').filter(':eq(' + GvRowscount_grp + ')').find('input[type=text][id*=txtsrvTypepcnt]').val(ev.value);
                            grp_add_cnt++;
                            Grop_exist = 'Y';
                        }

                    }

                    count_grp++;
                }

            });
        }
        if ((flag2 == 'disc' && is_outsrc == 'N') || (flag2 == 'disc' && is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
            SrvGrpClick();
        }

        var patPer = 0, ManPer = 0, staffPer = 0, TotPer = 0; ;
        $("table[id*=gvServices] tr:has(td)").each(function (e) {
            var patPercentage = $(this).closest('tr').find('input[type=text][id*=txtDiscP]').val();
            var MangPercentage = $(this).closest('tr').find('input[type=text][id*=txtmaPer]').val();
            var staffPercentage = $(this).closest('tr').find('input[type=text][id*=txtstPer]').val();
            var srv_grp_name_disc = $(this).closest('tr').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();

            if (patPercentage == undefined || patPercentage == null || patPercentage == '' || patPercentage == 'NaN') { patPercentage = '0'; }
            if (MangPercentage == undefined || MangPercentage == null || MangPercentage == '' || MangPercentage == 'NaN') { MangPercentage = '0'; }
            if (staffPercentage == undefined || staffPercentage == null || staffPercentage == '' || staffPercentage == 'NaN') { staffPercentage = '0'; }

            patPer = parseFloat(patPer) + parseFloat(patPercentage);
            ManPer = parseFloat(ManPer) + parseFloat(MangPercentage);
            staffPer = parseFloat(staffPer) + parseFloat(staffPercentage);
        });

        var _Gross = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var _patDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        var _hcDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txthcPer]').val();
        var _mngtDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val();
        var _staffDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val();
        var _ebDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtebPer]').val();
        var _cnclrlDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRulePer]').val();
        if (_patDiscamt == undefined || _patDiscamt == null || _patDiscamt == '' || _patDiscamt == 'NaN') { _patDiscamt = '0'; }
        if (_hcDiscamt == undefined || _hcDiscamt == null || _hcDiscamt == '' || _hcDiscamt == 'NaN') { _hcDiscamt = '0'; }
        if (_mngtDiscamt == undefined || _mngtDiscamt == null || _mngtDiscamt == '' || _mngtDiscamt == 'NaN') { _mngtDiscamt = '0'; }
        if (_staffDiscamt == undefined || _staffDiscamt == null || _staffDiscamt == '' || _staffDiscamt == 'NaN') { _staffDiscamt = '0'; }
        if (_ebDiscamt == undefined || _ebDiscamt == null || _ebDiscamt == '' || _ebDiscamt == 'NaN') { _ebDiscamt = '0'; }
        if (_cnclrlDiscamt == undefined || _cnclrlDiscamt == null || _cnclrlDiscamt == '' || _cnclrlDiscamt == 'NaN') { _cnclrlDiscamt = '0'; }
        var _Allconcessionamts = parseFloat(_patDiscamt) + parseFloat(_hcDiscamt) + parseFloat(_mngtDiscamt) + parseFloat(_staffDiscamt) + parseFloat(_ebDiscamt) + parseFloat(_cnclrlDiscamt);
        if (_Allconcessionamts == undefined || _Allconcessionamts == null || _Allconcessionamts == '' || _Allconcessionamts == 'NaN') { _Allconcessionamts = '0'; }

        var TotalConcPer = 0;
        var srv_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        if ((Flag == 'PAT' && is_outsrc == 'N') || (Flag == 'PAT' && is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
            if (parseFloat(pDPcnt) > 100) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
                pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pAmt);

            }
            if (parseFloat(_Allconcessionamts) > 100) {
                pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pAmt);
            }
            TotalConcPer = pDPcnt;
            if (TotalConcPer > 100) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(100);
                pDPcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
            }
            else {
                pDPcnt = pDPcnt;
            }
            var PconAmt = Math.round((parseFloat(pAmt) * parseFloat(pDPcnt)) / parseFloat(100));

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
            var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        }
        else if (Flag == 'PAT') {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
            $(".stoast").toastText("warning", " Discount Not Available For OutSource Services ,Please Contact Administrator !", 5, 3);

        }
        if ((Flag == 'MG' && is_outsrc == 'N') || (Flag == 'MG' && is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
            var mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val();
            var mgmtCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val();
            var NetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            if (parseFloat(mgmtCncPer) > 100) {
                mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
                mgmtCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val('');
            }
            if (parseFloat(_Allconcessionamts) > 100) {
                mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
                mgmtCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val('');
            }
            pAmt = typeof pAmt == "string" ? (pAmt.trim() == "" ? "0" : pAmt) : (typeof pAmt == "number" ? pAmt : "0");
            mgmtCncPer = typeof mgmtCncPer == "string" ? (mgmtCncPer.trim() == "" ? "0" : mgmtCncPer) : (typeof mgmtCncPer == "number" ? mgmtCncPer : "0");
            mgmtCncamt = typeof mgmtCncamt == "string" ? (mgmtCncamt.trim() == "" ? "0" : mgmtCncamt) : (typeof mgmtCncamt == "number" ? mgmtCncamt : "0");
            NetAmt = typeof NetAmt == "string" ? (NetAmt.trim() == "" ? "0" : NetAmt) : (typeof NetAmt == "number" ? NetAmt : "0");
            TotalConcPer = mgmtCncPer;
            TotalConcPer = typeof TotalConcPer == "string" ? (TotalConcPer.trim() == "" ? "0" : TotalConcPer) : (typeof TotalConcPer == "number" ? TotalConcPer : "0");
            if (TotalConcPer > 100) {
                mgmtCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val();
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val(100);
            }
            else {
                mgmtCncPer = mgmtCncPer;
            }
            var MgconAmt = Math.round((parseFloat(NetAmt) * parseFloat(mgmtCncPer)) / parseFloat(100));
            MgconAmt = typeof MgconAmt == "string" ? (MgconAmt.trim() == "" ? "0" : MgconAmt) : (typeof MgconAmt == "number" ? MgconAmt : "0");
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val(MgconAmt);
            PconAmt = typeof PconAmt == "string" ? (PconAmt.trim() == "" ? "0" : PconAmt) : (typeof PconAmt == "number" ? PconAmt : "0");

            var pNetAmt = parseFloat(pAmt) - parseFloat(MgconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        }
        else if (Flag == 'MG') {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
            $(".stoast").toastText("warning", " Discount Not Available For OutSource Services ,Please Contact Administrator !", 5, 3);

        }
        if ((Flag == 'STAF' && is_outsrc == 'N') || (Flag == 'STAF' && is_outsrc == 'Y' && cmp_setting_outsrc == 'True')) {
            var StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val();
            var StCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val();
            var NetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
            if (parseFloat(StCncPer) > 100) {
                StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
                StCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val('');
            }
            if (parseFloat(_Allconcessionamts) > 100) {
                StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
                StCncamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val('');
            }
            pAmt = typeof pAmt == "string" ? (pAmt.trim() == "" ? "0" : pAmt) : (typeof pAmt == "number" ? pAmt : "0");
            StCncPer = typeof StCncPer == "string" ? (StCncPer.trim() == "" ? "0" : StCncPer) : (typeof StCncPer == "number" ? StCncPer : "0");
            StCncamt = typeof StCncamt == "string" ? (StCncamt.trim() == "" ? "0" : StCncamt) : (typeof StCncamt == "number" ? StCncamt : "0");
            NetAmt = typeof NetAmt == "string" ? (NetAmt.trim() == "" ? "0" : NetAmt) : (typeof NetAmt == "number" ? NetAmt : "0");
            TotalConcPer = StCncPer;
            TotalConcPer = typeof TotalConcPer == "string" ? (TotalConcPer.trim() == "" ? "0" : TotalConcPer) : (typeof TotalConcPer == "number" ? TotalConcPer : "0");
            if (TotalConcPer > 100) {
                StCncPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val();
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val(100);
            }
            else {
                StCncPer = StCncPer;
            }
            var StconAmt = Math.round((parseFloat(NetAmt) * parseFloat(StCncPer)) / parseFloat(100));
            StconAmt = typeof StconAmt == "string" ? (StconAmt.trim() == "" ? "0" : StconAmt) : (typeof StconAmt == "number" ? StconAmt : "0");
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val(StconAmt);
            PconAmt = typeof PconAmt == "string" ? (PconAmt.trim() == "" ? "0" : PconAmt) : (typeof PconAmt == "number" ? PconAmt : "0");

            var pNetAmt = parseFloat(pAmt) - parseFloat(StconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        }
        else if (Flag == 'STAF') {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
            $(".stoast").toastText("warning", " Discount Not Available For OutSource Services ,Please Contact Administrator !", 5, 3);

        }
        CalculateGridAmt(CurrentRowIndex);


    } /* service group wise and type wise concession ends */
    UpdateAllDiscountMultiGrid();
}


/* Service Wise Discount In Flat */
function OnPatAmtChange(ev, FLAG, flag2) {

    var allow_srv_sroup_pcnt = $('#' + ctrlcom + '_UCServices_hdnsrvgrp_type_con').val();
    if (allow_srv_sroup_pcnt == '' || allow_srv_sroup_pcnt == null || allow_srv_sroup_pcnt == undefined) {
        allow_srv_sroup_pcnt = 'False';
        $('#' + ctrlcom + '_UCServices_hdnsrvgrp_type_con').val('False');
    }
    if (allow_srv_sroup_pcnt == 'False') {
        flag2 = '';
    }
    else {
    }
    var cmp_setting_outsrc = $('#' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').val();
    if (parseFloat(ev.value) == 0) {
        ev.value = 0;
    }
    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;

    var patPer = 0, ManPer = 0, staffPer = 0, TotPer = 0; ;
    var taxamt = '0', tax = '0'; var taxamt1 = 0, ptaxamt = 0, ctaxamt = 0;

    var _Gross = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
    var _patDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val();
    var _hcDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtHcAmt]').val();
    var _mngtDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val();
    var _staffDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val();
    var _ebDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtebAmt]').val();
    var _cnclrlDiscamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtcncrlAmt]').val();
    if (_patDiscamt == undefined || _patDiscamt == null || _patDiscamt == '' || _patDiscamt == 'NaN') { _patDiscamt = '0'; }
    if (_hcDiscamt == undefined || _hcDiscamt == null || _hcDiscamt == '' || _hcDiscamt == 'NaN') { _hcDiscamt = '0'; }
    if (_mngtDiscamt == undefined || _mngtDiscamt == null || _mngtDiscamt == '' || _mngtDiscamt == 'NaN') { _mngtDiscamt = '0'; }
    if (_staffDiscamt == undefined || _staffDiscamt == null || _staffDiscamt == '' || _staffDiscamt == 'NaN') { _staffDiscamt = '0'; }
    if (_ebDiscamt == undefined || _ebDiscamt == null || _ebDiscamt == '' || _ebDiscamt == 'NaN') { _ebDiscamt = '0'; }
    if (_cnclrlDiscamt == undefined || _cnclrlDiscamt == null || _cnclrlDiscamt == '' || _cnclrlDiscamt == 'NaN') { _cnclrlDiscamt = '0'; }
    var _Allconcessionamts = parseFloat(_patDiscamt) + parseFloat(_hcDiscamt) + parseFloat(_mngtDiscamt) + parseFloat(_staffDiscamt) + parseFloat(_ebDiscamt) + parseFloat(_cnclrlDiscamt);
    if (_Allconcessionamts == undefined || _Allconcessionamts == null || _Allconcessionamts == '' || _Allconcessionamts == 'NaN') { _Allconcessionamts = '0'; }
    if (FLAG == 'PAT') {
        var srv_id = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var pDFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val();
        var pDNetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val();
        if (parseFloat(pAmt) < parseFloat(pDFcnt)) {
            pDFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val();
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pAmt);
        }
        if (parseFloat(_Allconcessionamts) > parseFloat(pAmt)) {
            pDFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pAmt);
        }
        pAmt = typeof pAmt == 'string' ? (typeof pAmt == 'undefined' || pAmt.trim() == '' ? 0 : parseFloat(pAmt)) : (typeof pAmt == 'object' ? 0 : parseFloat(pAmt));
        pDFcnt = typeof pDFcnt == 'string' ? (typeof pDFcnt == 'undefined' || pDFcnt.trim() == '' ? 0 : parseFloat(pDFcnt)) : (typeof pDFcnt == 'object' ? 0 : parseFloat(pDFcnt));
        pDNetAmt = typeof pDNetAmt == 'string' ? (typeof pDNetAmt == 'undefined' || pDNetAmt.trim() == '' ? 0 : parseFloat(pDNetAmt)) : (typeof pDNetAmt == 'object' ? 0 : parseFloat(pDNetAmt));
        var PconPcnt = setProperDecimals((100) * pDFcnt / pAmt);
        var pNetAmt = setProperDecimals(pAmt - pDFcnt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val(PconPcnt);
    }
    if (flag2 != '') {
        var GvRowscount_grp = 0;
        var count_grp = 0;
        var grid_grp = document.getElementById('tbl_SrvGrp');
        var _index_grp = 0;
        var _index_grp = grid_grp.rows.length;
        var grp_add_cnt = 0;
        var first_count = 0;
        var srv_grp_pcnt = 0;
        var Grop_exist = 'N';

        var srv_grp_name_disc = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type = hidden][id*=hdnSrv_Grp_Name]').val();
        var srv_type_name_disc = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type = hidden][id*=hdnSrv_Type_Name]').val();
        if (document.getElementById('' + ctrlcom + '_UCServices_Srv_Grp_Type_pcnt_0').checked == true) { /* Service Group Wise Discount Start */
            $("table[id$=tbl_SrvGrp] tr:has(td)").each(function (e) {
                if (count_grp == 0) {
                    for (GvRowscount_grp = 0; GvRowscount_grp <= _index_grp; GvRowscount_grp++) {
                        var srv_grp_nam = $('[id$=tbl_SrvGrp] tr').filter(':eq(' + GvRowscount_grp + ')').find('[id*=lblsrvgrpname]').text();
                        if (srv_grp_nam == srv_grp_name_disc && ev.value != undefined) {
                            $('[id$=tbl_SrvGrp] tr').filter(':eq(' + GvRowscount_grp + ')').find('input[type=text][id*=txtsrvgrppcnt]').val(setProperDecimalsCorpPer(PconPcnt));
                            grp_add_cnt++;
                            Grop_exist = 'Y';
                        }
                    }
                    count_grp++;
                }
            });
        } /* Service Group Wise Discount Ends */
        else if (document.getElementById('' + ctrlcom + '_UCServices_Srv_Grp_Type_pcnt_1').checked == true) { /* Service Type Wise Discount Start */
            $("table[id$=tbl_srv_type] tr:has(td)").each(function (e) {
                if (count_grp == 0) {
                    for (GvRowscount_grp = 0; GvRowscount_grp <= _index_grp; GvRowscount_grp++) {
                        var srv_type_nam = $('[id$=tbl_srv_type] tr').filter(':eq(' + GvRowscount_grp + ')').find('[id*=lblsrvtypename]').text();
                        if (srv_type_nam == srv_type_name_disc && ev.value != undefined) {
                            $('[id$=tbl_srv_type] tr').filter(':eq(' + GvRowscount_grp + ')').find('input[type=text][id*=txtsrvTypepcnt]').val(setProperDecimalsCorpPer(PconPcnt));
                            grp_add_cnt++;
                            Grop_exist = 'Y';
                        }
                    }
                    count_grp++;
                }
            });
        } /* Service Type Wise Discount Ends */
        if (flag2 == 'amnt') {
            SrvGrpClick();
        }
    }
    if (FLAG == 'MG') {
        var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var pDFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val();
        var pDNetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val();
        if (parseFloat(pAmt) < parseFloat(pDFcnt)) {
            pDFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
        }
        if (parseFloat(_Allconcessionamts) > parseFloat(pAmt)) {
            pDFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmgAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val('');
        }
        pAmt = typeof pAmt == 'string' ? (typeof pAmt == 'undefined' || pAmt.trim() == '' ? 0 : parseFloat(pAmt)) : (typeof pAmt == 'object' ? 0 : parseFloat(pAmt));
        pDFcnt = typeof pDFcnt == 'string' ? (typeof pDFcnt == 'undefined' || pDFcnt.trim() == '' ? 0 : parseFloat(pDFcnt)) : (typeof pDFcnt == 'object' ? 0 : parseFloat(pDFcnt));
        var PconPcnt = Math.round(setProperDecimals((100) * pDFcnt / pAmt));
        PconPcnt = typeof PconPcnt == 'string' ? (typeof PconPcnt == 'undefined' || PconPcnt.trim() == '' ? 0 : parseFloat(PconPcnt)) : (typeof PconPcnt == 'object' ? 0 : parseFloat(PconPcnt));
        var pNetAmt = setProperDecimals(pAmt - pDFcnt);
        pNetAmt = typeof pNetAmt == 'string' ? (typeof pNetAmt == 'undefined' || pNetAmt.trim() == '' ? 0 : parseFloat(pNetAmt)) : (typeof pNetAmt == 'object' ? 0 : parseFloat(pNetAmt));
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtmaPer]').val(setProperDecimalsCorpPer(PconPcnt));
    }

    if (FLAG == 'STAF') {
        var pAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPamt]').val();
        var sTFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val();
        var pDNetAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val();
        if (parseFloat(pAmt) < parseFloat(sTFcnt)) {
            sTFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
        }
        if (parseFloat(_Allconcessionamts) > parseFloat(pAmt)) {
            sTFcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstAmt]').val('');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val('');
        }
        pAmt = typeof pAmt == 'string' ? (typeof pAmt == 'undefined' || pAmt.trim() == '' ? 0 : parseFloat(pAmt)) : (typeof pAmt == 'object' ? 0 : parseFloat(pAmt));
        sTFcnt = typeof sTFcnt == 'string' ? (typeof sTFcnt == 'undefined' || sTFcnt.trim() == '' ? 0 : parseFloat(sTFcnt)) : (typeof sTFcnt == 'object' ? 0 : parseFloat(sTFcnt));
        var sTconPcnt = setProperDecimals((100) * sTFcnt / pAmt);
        sTconPcnt = typeof sTconPcnt == 'string' ? (typeof sTconPcnt == 'undefined' || sTconPcnt.trim() == '' ? 0 : parseFloat(sTconPcnt)) : (typeof sTconPcnt == 'object' ? 0 : parseFloat(sTconPcnt));
        var pNetAmt = setProperDecimals(pAmt - pDFcnt);
        pNetAmt = typeof pNetAmt == 'string' ? (typeof pNetAmt == 'undefined' || pNetAmt.trim() == '' ? 0 : parseFloat(pNetAmt)) : (typeof pNetAmt == 'object' ? 0 : parseFloat(pNetAmt));
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtstPer]').val(sTconPcnt);

    }

    CalculateGridAmt(CurrentRowIndex);
    UpdateAllDiscountMultiGrid();
}
function EnableMulGird() {

    var gridMulTiDim = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession');
    var gridMulTiDimLength = gridMulTiDim.rows.length;
    if (gridMulTiDimLength == 2) {

        $("table[id*=gvMultipleConcession] tr:has(td)").each(function (e) {
            var DiscountId = $(this).closest('tr').find("[id*=ddlMultiDiscounttype]").val();
            if (DiscountId == 0) {
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=lblSNo]').text('');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=hdncardid]').val('0');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('input[type=hidden][id*=hdnauthid]').val('0');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('input[type=hidden][id*=hdnRuleid]').val('0');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('input[type=hidden][id*=hdneventid]').val('0');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=ddlMultiDiscounttype]').val(0);
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=txtcardno]').text('');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=ddlModes]').val(1);
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=txtPersentage]').text('');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=txtAutherizedPersion]').text('');
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=ddlMultiDiscounttype]')[0].disabled = false;
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=ddlModes]')[0].disabled = false;
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=txtAmount]')[0].disabled = false;
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=txtAutherizedPersion]')[0].disabled = false;
                $('table[id$=gvMultipleConcession]').find("tr:eq(1)").find('[id*=txtPersentage]').disabled = false;
                if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked == true) {
                    document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').disabled = true;
                }
                else {
                    var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
                    if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '') { con_ruleId = 0; }
                    var hccard = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
                    if (hccard == "" || hccard == undefined || hccard == null) { hccard = 0; }
                    if (con_ruleId > 0 || hccard != 0) {



                    }
                    else {


                        document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').disabled = false;
                    }
                }
            }
            else {
            }
        });
    }
}

/*OverAll Discount Sagrigation */
function DiscAmtOrPcntSagrigation() {
    var AllowConc = document.getElementById('' + ctrlcom + '_UCServices_hdnIsAllowCncn').value;
    var concpersent = document.getElementById('' + ctrlcom + '_UCServices_HdnUserWiseConce').value;
    var AllowConcAmt = parseFloat((concpersent * totPgrossamt)) / 100;
    AllowConcAmt = setProperDecimals(AllowConcAmt);
    if (AllowConc == 'yes') {
        if (parseFloat(overallconamt) > parseFloat(AllowConcAmt)) {
            $(".stoast").toastText("warning", "Sorry..!you can  give concession upto '" + concpersent + "' % only!", 5, 3);
            document.getElementById('' + ctrlcom + '_UCServices_txtDiscAmtSag').value = "0";
            return false;
        }
    }

    var ddFltOfPct = document.getElementById('' + ctrlcom + '_UCServices_DDDidcType').value;
    var overallconamt = document.getElementById('' + ctrlcom + '_UCServices_txtDiscAmtSag').value;
    var totpatGross = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
    var totPgrossamt = 0;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        var srv_name = $(this).closest('tr').find("input[type=text][id*=txtServiceName]").val();
        var srv_id = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val()
        var Out_Source = $(this).closest('tr').find("input[type=hidden][id*=hdnIsForeignSrv]").val();
        if (srv_name != '' && parseInt(srv_id) > 0) {
            var Pgrossamt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
            var pDiscPcnt = $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val();
            var PDiscFlat = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
            if (ddFltOfPct == '1') {
                /* Out  Source Services Check Concession Allowed Check */
                if (document.getElementById('' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').value == 'False' && Out_Source == 'Y') {
                    $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val('0');
                    $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val('0');
                    $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(Pgrossamt);
                }
                else {/* Normal Services */
                    $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val(overallconamt);
                    var PconAmt = (parseFloat(Pgrossamt) * parseFloat(overallconamt)) / parseFloat(100);
                    var PconNetAmt = parseFloat(Pgrossamt) - parseFloat(PconAmt);
                    $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val(PconAmt);
                    $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(PconNetAmt);
                }
            }
            else {
                /* Out  Source Services Check Concession Allowed Check */
                if (document.getElementById('' + ctrlcom + '_UCServices_hdnAllowOutSideConcs').value == 'False' && Out_Source == 'Y') {
                    $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val('0');
                    $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val('0');
                    $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(Pgrossamt);
                }
                else {/* Normal Services */
                    var total_pcnt = (parseFloat(overallconamt) * parseFloat(100)) / parseFloat(totpatGross);
                    $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val(total_pcnt);
                    var PconAmt = (parseFloat(Pgrossamt) * parseFloat(total_pcnt)) / parseFloat(100);
                    var PconNetAmt = parseFloat(Pgrossamt) - parseFloat(PconAmt);
                    $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val(PconAmt);
                    $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(PconNetAmt);
                }
            }
        }
    });
    CalculateGridAmt(0);
}
function onCheckPostCons(ev) {

    var CurrentRowIndex = 0;
    var Enable_slots = 'Y';
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var DocName = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if ((DocName == 'Cons' || DocName == 'OP') && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == 2)) {
        var conslimit = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpcons').value;
        var consover = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpconsdone').value;
        if (consover == "" || consover == null || consover == undefined) { consover = "0"; }
        var count = 0;
        var _doctor_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        var _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
        var _patient_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();

        var _dept_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();

        var _company_id = 0;
        if (_company_id == undefined || _company_id == null || _company_id == '')
        { _company_id = 0; }
        if (_patient_id == undefined || _patient_id == null || _patient_id == '')
        { _patient_id = 0; }
        var _tariff_id = 1;
        if ($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked') == true) {

            if (_srv_name == _dept_name) {
                $(".stoast").toastText("warning", "Please Select Doctor against to (" + _srv_name + ") Department ", 5, 3);
                Enable_slots = 'N';
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                return false;
            }
            else {

                GetAsync(
                          "Private/FrontOffice/OPDBILLNEW.aspx/Bind_Consultation_Det_Async",
                          { DOCTOR_ID: _doctor_id, PATIENT_ID: _patient_id, COMPANY_ID: _company_id, TARIFF_ID: _tariff_id },
                          function (msg) {

                              var Priv_dt = new Date(msg.d[0].BILL_DT).format('dd-MMM-yyyy');
                              var today_dt = new Date().format('dd-MMM-yyyy');

                              if (Priv_dt == today_dt) {
                                  if (document.getElementById('' + ctrlcom + '_hdnalwsameconsameday').value == "Yes") {
                                      param = results; var obj = 'suvarna';
                                      return ConfirmationRequiredForSaveWithParam_message_Cons(obj, param, "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). Do You Want To Continue..");
                                  }
                                  else {
                                      var doctorname = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
                                      $(".stoast").toastText("warning", "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). System Doesnot allow More Than One Consultation For Same Doctor On Same Day", 5, 3);
                                      Enable_slots = 'N';
                                      $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                                      return false;
                                  }
                              }

                              else {
                                  $('table[id*=UCServices_gvServices] tr').each(function (e) {
                                      var srvconcount = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceID]').val();
                                      if (srvconcount == 2) {
                                          var classsrvid = $(this).closest('tr').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                                          if (classsrvid > 0) {
                                              if ($(this).closest('tr').find('[id*=chkPstCons]')[0].checked == true) { count++; }
                                          }
                                          else { count++; }
                                      }
                                  });
                              }
                          },
                          function (jqXHR, textStatus, errorThrown) {

                          });
            }
        }
    }
    else if (DocName == 'OPQUICK' && document.getElementById('' + ctrlcom + '_ddlPatientType').value > 1) {
        var conslimit = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpcons').value;
        var consover = document.getElementById('' + ctrlcom + '_uccorporate_hdncmpconsdone').value;
        if (consover == "" || consover == null || consover == undefined) { consover = "0"; }
        var count = 0;
        var _doctor_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        var _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();

        var _dept_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
        var _patient_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
        var _company_id = 0;
        if (_company_id == undefined || _company_id == null || _company_id == '')
        { _company_id = 0; }
        if (_patient_id == undefined || _patient_id == null || _patient_id == '')
        { _patient_id = 0; }
        var _tariff_id = 1;
        if ($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked') == true) {
            if (_srv_name == _dept_name) {
                $(".stoast").toastText("warning", "Please Select Doctor against to (" + _srv_name + ") Department ", 5, 3);
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                Enable_slots = 'N';
                return false;
            }
            else {
                GetAsync(
                          "Private/FrontOffice/OPDBILLNEW.aspx/Bind_Consultation_Det_Async",
                          { DOCTOR_ID: _doctor_id, PATIENT_ID: _patient_id, COMPANY_ID: _company_id, TARIFF_ID: _tariff_id },
                          function (msg) {

                              var Priv_dt = new Date(msg.d[0].BILL_DT).format('dd-MMM-yyyy');
                              var today_dt = new Date().format('dd-MMM-yyyy');

                              if (Priv_dt == today_dt) {
                                  if (document.getElementById('' + ctrlcom + '_hdnalwsameconsameday').value == "Yes") {
                                      param = results; var obj = 'suvarna';
                                      return ConfirmationRequiredForSaveWithParam_message_Cons(obj, param, "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). Do You Want To Continue..");
                                  }
                                  else {
                                      var doctorname = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
                                      $(".stoast").toastText("warning", "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). System Doesnot allow More Than One Consultation For Same Doctor On Same Day", 5, 3);
                                      Enable_slots = 'N';
                                      $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                                      return false;
                                  }
                              }

                              else {
                                  $('table[id*=UCServices_gvServices] tr').each(function (e) {
                                      var srvconcount = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceID]').val();
                                      if (srvconcount == 2) {
                                          var classsrvid = $(this).closest('tr').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                                          if (classsrvid > 0) {
                                              if ($(this).closest('tr').find('[id*=chkPstCons]')[0].checked == true) { count++; }
                                          }
                                          else { count++; }
                                      }
                                  });

                              }
                          },
                          function (jqXHR, textStatus, errorThrown) {

                          });
            }
        }
    }
    else {

        if ((DocName == 'OP') && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == 1)) {
            var _doctor_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
            var _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
            var _patient_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();

            var _dept_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
            var _company_id = 0;
            if (_company_id == undefined || _company_id == null || _company_id == '')
            { _company_id = 0; }
            if (_patient_id == undefined || _patient_id == null || _patient_id == '')
            { _patient_id = 0; }
            var _tariff_id = 1;
            if ($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked') == true) {
                if (_srv_name == _dept_name) {
                    $(".stoast").toastText("warning", "Please Select Doctor against to (" + _srv_name + ") Department ", 5, 3);
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                    Enable_slots = 'N';
                    return false;
                }
                else {
                    GetAsync(
                          "Private/FrontOffice/OPDBILLNEW.aspx/Bind_Consultation_Det_Async",
                          { DOCTOR_ID: _doctor_id, PATIENT_ID: _patient_id, COMPANY_ID: _company_id, TARIFF_ID: _tariff_id },
                          function (msg) {

                              var Priv_dt = new Date(msg.d[0].BILL_DT).format('dd-MMM-yyyy');
                              var today_dt = new Date().format('dd-MMM-yyyy');

                              if (Priv_dt == today_dt) {
                                  if (document.getElementById('' + ctrlcom + '_hdnalwsameconsameday').value == "Yes") {
                                      param = results; var obj = 'suvarna';
                                      return ConfirmationRequiredForSaveWithParam_message_Cons(obj, param, "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). Do You Want To Continue..");
                                  }
                                  else {
                                      var doctorname = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
                                      $(".stoast").toastText("warning", "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). System Doesnot allow More Than One Consultation For Same Doctor On Same Day", 5, 3);
                                      $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                                      Enable_slots = 'N';
                                      return false;
                                  }
                              }
                          },
                          function (jqXHR, textStatus, errorThrown) {

                          });
                }
            }
        }
        else if ((DocName == 'OPQUICK') && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == 1)) {
            var _doctor_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
            var _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
            var _patient_id = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();

            var _dept_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
            var _company_id = 0;
            if (_company_id == undefined || _company_id == null || _company_id == '')
            { _company_id = 0; }
            if (_patient_id == undefined || _patient_id == null || _patient_id == '')
            { _patient_id = 0; }
            var _tariff_id = 1;
            if ($('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked') == true) {
                if (_srv_name == _dept_name) {
                    $(".stoast").toastText("warning", "Please Select Doctor against to (" + _srv_name + ") Department ", 5, 3);
                    $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                    Enable_slots = 'N';
                    return false;
                }
                else {
                    GetAsync(
                          "Private/FrontOffice/OPDBILLNEW.aspx/Bind_Consultation_Det_Async",
                          { DOCTOR_ID: _doctor_id, PATIENT_ID: _patient_id, COMPANY_ID: _company_id, TARIFF_ID: _tariff_id },
                          function (msg) {

                              var Priv_dt = new Date(msg.d[0].BILL_DT).format('dd-MMM-yyyy');
                              var today_dt = new Date().format('dd-MMM-yyyy');

                              if (Priv_dt == today_dt) {
                                  if (document.getElementById('' + ctrlcom + '_hdnalwsameconsameday').value == "Yes") {
                                      param = results; var obj = 'suvarna';
                                      return ConfirmationRequiredForSaveWithParam_message_Cons(obj, param, "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). Do You Want To Continue..");
                                  }
                                  else {
                                      var doctorname = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
                                      $(".stoast").toastText("warning", "Consultation For This Doctor (" + doctorname + ") Was Already Done On (" + today_dt + "). System Doesnot allow More Than One Consultation For Same Doctor On Same Day", 5, 3);
                                      $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=checkbox]').prop('checked', false);
                                      Enable_slots = 'N';
                                      return false;
                                  }
                              }
                          },
                          function (jqXHR, textStatus, errorThrown) {

                          });
                }
            }
        }
    }

    if (Enable_slots == 'Y') {
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddlSlotTiming]').attr('disabled', false);
    }
}
function Removepkgrelated(srvid) {

    var GvRowscount = 0;
    var count = 0;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _index = 0;
    var _index = grid.rows.length;
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
        var pkg_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
        var gen_srv_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        if (gen_srv_id == srvid) {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + e + ')').remove();
            GvRowscount = e;
            arrServiceIds = $.grep(arrServiceIds, function (value) {
                return value != gen_srv_id;
            });
            GvRowscount = 0;
        }
        GvRowscount++;
    });
    RemoveSrvClearAmnts();
    CalculateGridAmt(GvRowscount);
}
function getpackageincludesingvservices(srvid, tariffid, pkg, order_id, order_det_id) {

    var Form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    var Umr_no = '';
    var PAT_CATEGORY_ID = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
    if (PAT_CATEGORY_ID == undefined || PAT_CATEGORY_ID == null || PAT_CATEGORY_ID == '' || PAT_CATEGORY_ID == '--select--') { PAT_CATEGORY_ID = 0; }
    var cmp_id = '0';
    var referal_letter_id = '0';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
        var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        else
            referal_letter_id = 0;
        cmp_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
    }
    if (cmp_id == undefined || cmp_id == null || cmp_id == '') { cmp_id = "0"; }

    if (Form_name == 'OP') {
        if (document.getElementById('' + ctrlcom + '_chkIsOsp').checked == true)
        { }
        else {
            Umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
    }
    else if (Form_name == 'Cons') {
        Umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else if (Form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            Umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
    }
    GetAsync(
                 "GridService.asmx/pkgincludesubNEW",
                { srvid: srvid, tariffid: tariffid, pkg: pkg, Umr_no: Umr_no, PAT_CATEGORY_ID: PAT_CATEGORY_ID, cmp_id: cmp_id },
                function (data) {
                    if (data.d == null) {
                        $(".stoast").toastText("warning", "This Package Does not Contain Any Includes So, Please Contact Administrator", 5, 3);
                        Removepkgrelated(srvid);
                        return false;
                    }
                    data.d = data.d[0][0];
                    if (data.d != null) {
                        if (data.d.length == 0) {
                            $(".stoast").toastText("warning", "This Package Does not Contain Any Includes So, Please Contact Administrator", 5, 3);
                            Removepkgrelated(srvid);

                            /*if (Form_name == 'OPQUICK' && is_reg_include == 'Y') {
                            var regfee = document.getElementById('' + ctrlcom + '_hdnregfee').value;
                            PatientRegFeeAmounts(regfee);
                            }*/
                            return false;
                        }
                        else {
                            /*written by sitaram for removing package if includes is matching in first package*/
                            var pkg_success = 0;
                            for (var i = 0; i < data.d.length; i++) {
                                if ($.inArray(parseInt(data.d[i].SERVICE_ID), arrServiceIds) != -1) {
                                    Removepkgrelated(srvid);
                                    $(".stoast").toastText("warning", "Some of services in the both packages are same so, Please Contact Administrator", 5, 3);
                                    pkg_success = 1;

                                }
                            }
                            if (pkg_success == 0) {
                                /*****************************/
                                onpkgsucess(data.d, pkg, order_id, order_det_id);
                            }
                            else if (pkg_success == 1) {
                                var hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
                                if (cmp_id == 0 && hcid == 0) {

                                    var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
                                    if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
                                    { con_ruleId = 0; }
                                    if (con_ruleId > 0) {

                                        var con_rule_name = $('#' + ctrlcom + '_UCServices_hdnconrulename').val();

                                        BindDataPatientconsutionrule(con_ruleId, con_rule_name);
                                    }
                                }

                            }
                        }
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
}
var Optional = []; var O = 0;
function onpkgsucess(objts, pkg, order_id, order_det_id) {
    $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        $(this).closest('tr').remove();

    });
    var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
    if (pkg == 'A') { /* A- Means Assay Comparision */
        if (form_name == 'OPQUICK' || form_name == 'OP') {
            if (objts != null) {
                onassycomsucess(objts, pkg, order_id, order_det_id)
            }
        }
    }
    var ExistServices = '';
    if (objts != null) {
        var gridid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        for (var i = 0; i < objts.length; i++) { /* for loop starts */
            var srv_not_req = 'N'; var _deptID = objts[i].DEPARTMENT_ID
            if (_deptID == '' || _deptID == null || _deptID == undefined) { _deptID = 0; }
            if (pkg == 'P' || pkg == 'G') {
                $("table[id*=UCServices_gvServices] tr:has(td)").each(function () {
                    var RowIndexForGrid = $(this)[0].rowIndex;
                    var _srv_id = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceID]').val();
                    var _srv_doctorId = $(this).closest('tr').find('input[type=hidden][id*=hdnDoctorID]').val();
                    var _service_name = $(this).closest('tr').find('input[type=text][id*=txtServiceName]').val();
                    var hdnDepartment_Id = $(this).closest('tr').find('[id*=hdnDepartment_Id]').val();

                    if ((_srv_id != '') && (_srv_id != undefined)) {
                        if (_srv_id == objts[i].SERVICE_ID) {
                            /*changed by sitaram,let me know before change it*/
                            if (_srv_id == "2" && hdnDepartment_Id > 0 && _srv_id != "1")/*This is for Consultation Service */
                            {
                                if (parseInt(_srv_doctorId) > 1) {
                                    if (_srv_doctorId == objts[i].DOCTOR_ID || _srv_doctorId == objts[i].DOCTOR_ID) {
                                        $(".stoast").toastText("warning", "Consultation For Doctor '" + _service_name + "'Already Exists in  Package", 5, 3);

                                        $(this).closest('tr').remove();
                                        CalculateGridAmt(RowIndexForGrid);
                                        ExistServices = ExistServices + _service_name + ",";
                                    }
                                }
                            }
                            else {
                                if (_srv_id != "1") {
                                    $(this).closest('tr').remove();
                                    CalculateGridAmt(RowIndexForGrid);
                                    $(".stoast").toastText("warning", "This Service(s) '" + _service_name + "'Already Exists in  Package", 5, 3);
                                }
                            }
                        }
                    }
                    AssignSno(RowIndexForGrid);
                });
                var j = gridid.rows.length - 1;
                var sno = j + 1;

                var pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
                if (pat_age == undefined || pat_age == null || pat_age == '') { pat_age = 0; }
                if (parseInt(objts[i].FROM_AGE) >= 0 && parseInt(objts[i].TO_AGE) > 0) {
                    if ((parseInt(objts[i].FROM_AGE) <= parseInt(pat_age)) && (parseInt(pat_age) <= parseInt(objts[i].TO_AGE))) {

                    }
                    else {
                        $(".stoast").toastText("warning", " '" + objts[i].SERVICE_NAME + "' is applicable for patient of age '" + parseInt(objts[i].FROM_AGE) + "' To '" + parseInt(objts[i].TO_AGE) + "' ", 5, 3);
                        srv_not_req = 'Y';
                    }
                }
                var isnewborn = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnisnewborn').value;
                var patage = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblagedob').innerHTML;
                if (isnewborn == 'Y') {
                    if (parseInt(objts[i].FROM_AGE) > 1) {
                        $(".stoast").toastText("warning", "This Service Is Not Applicable For Newborn Babys!", 5, 3);
                        srv_not_req = 'Y';
                    }
                }
                if (objts[i].RECORD_STATUS == "I") {
                    $(".stoast").toastText("warning", "This Service '" + objts[i].SERVICE_NAME + "'  is InActive", 5, 3);
                    srv_not_req = 'Y';
                }
                if (objts[i].IS_ADDITIONAL == 'Y') {
                    var sid = objts[i].SERVICE_ID;
                    var dscn = objts[i].DISCOUNT_PERCENT;
                    var all = sid + ':' + dscn;
                    _add_srv.push(all);
                }

                if (objts[i].CONCESSION == undefined || objts[i].CONCESSION == null || objts[i].CONCESSION == '' || objts[i].CONCESSION == NaN) { objts[i].CONCESSION = ''; }
                if (objts[i].GENDER_ID == "1" || objts[i].GENDER_ID == "2") {
                    if (document.getElementById('' + ctrlcom + '_UCServices_hdnGender_ID').value != objts[i].GENDER_ID) {
                        $(".stoast").toastText("warning", "This Service '" + objts[i].SERVICE_NAME + "'  is not Suitable for this Patient", 5, 3);
                        srv_not_req = 'Y';
                    }
                    else {
                        if (pkg != 'A') {
                            _is_free_followup = objts[i].IS_FREE_FOLLOWUP;
                            if (_is_free_followup == '' || _is_free_followup == undefined || _is_free_followup == null) { _is_free_followup = 'N'; }
                            if (objts[i].IS_OPTIONAL == 'Y' && srv_not_req == 'N' && objts[i].IS_ADDITIONAL != 'Y') {
                                Optional[O] = objts[i];
                                O++;
                                fn_AddFilterRow_Optional(pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_NAME, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].EFFECT_FROM_DT, objts[i].EFFECT_TO_DT, objts[i].DEPARTMENT_ID, objts[i].GENDER_ID, order_id, order_det_id, objts[i].FROM_AGE, objts[i].TO_AGE, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD);
                            }
                            else {
                                _is_free_followup = objts[i].IS_FREE_FOLLOWUP;
                                if (_is_free_followup == '' || _is_free_followup == undefined || _is_ll) { _is_free_followup = 'N'; }
                                if (srv_not_req == 'N' && objts[i].IS_ADDITIONAL != 'Y') {
                                    free_followup == nu
                                    fn_AddFilterRow_pkgbillSelection(pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_NAME, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].EFFECT_FROM_DT, objts[i].EFFECT_TO_DT, objts[i].DEPARTMENT_ID, objts[i].GENDER_ID, order_id, order_det_id, objts[i].FROM_AGE, objts[i].TO_AGE, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD, '', '', '', '', '', objts[i].QUANTITY, '0', objts[i].ITEM_ID, objts[i].ITEM_GROUP_ID, '0', '0', objts[i].BILLING_HEAD_ID, objts[i].IS_DOCTOR_REQUIRED, '', objts[i].TAX_PCT, '', '', objts[i].SGST_TAX_PCT, objts[i].CGST_TAX_PCT, objts[i].SAC_CD, '', '', '', '0', objts[i].DOCTOR_PCT, '0', objts[i].ORG_PCT, objts[i].SERVICE_PRICE_ID, '', '', '');
                                    var gridID = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                                }
                            }
                        }
                    }
                }
                else {
                    if (pkg != 'A') {
                        if (objts[i].IS_OPTIONAL == 'Y' && srv_not_req == 'N' && objts[i].IS_ADDITIONAL != 'Y') {
                            Optional[O] = objts[i];
                            O++;
                            fn_AddFilterRow_Optional(pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_NAME, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].EFFECT_FROM_DT, objts[i].EFFECT_TO_DT, objts[i].DEPARTMENT_ID, objts[i].GENDER_ID, order_id, order_det_id, objts[i].FROM_AGE, objts[i].TO_AGE, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD);
                        }
                        else {
                            _is_free_followup = objts[i].IS_FREE_FOLLOWUP;
                            if (_is_free_followup == '' || _is_free_followup == undefined || _is_free_followup == null) { _is_free_followup = 'N'; }
                            if (srv_not_req == 'N' && objts[i].IS_ADDITIONAL != 'Y') {
                                ptax = parseFloat((objts[i].Price) * (objts[i].TAX_PCT) / 100)
                                if (pkg == 'G') {
                                    fn_AddFilterRow_pkgbillSelection(pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_NAME, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].EFFECT_FROM_DT, objts[i].EFFECT_TO_DT, objts[i].DEPARTMENT_ID, objts[i].GENDER_ID, order_id, order_det_id, objts[i].FROM_AGE, objts[i].TO_AGE, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD, '', '', '', objts[i].IS_SRV_GUIDELINES_REQUIRED, '', objts[i].QUANTITY, '0', objts[i].ITEM_ID, objts[i].ITEM_GROUP_ID, '0', '0', objts[i].BILLING_HEAD_ID, objts[i].IS_DOCTOR_REQUIRED, '', objts[i].TAX_PCT, '', '', objts[i].SGST_TAX_PCT, objts[i].CGST_TAX_PCT, objts[i].SAC_CD, objts[i].CONC_PCT, objts[i].CNCSN_RULE_ID, objts[i].CNCSN_RULE_NAME, '0', objts[i].DOCTOR_PCT, '0', objts[i].ORG_PCT, objts[i].SERVICE_PRICE_ID, '', '', '');
                                    var gridID = document.getElementById('' + ctrlcom + '_UCServices_gvServices');

                                }
                                else {
                                    fn_AddFilterRow_pkgbillSelection(pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_NAME, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].EFFECT_FROM_DT, objts[i].EFFECT_TO_DT, objts[i].DEPARTMENT_ID, objts[i].GENDER_ID, order_id, order_det_id, objts[i].FROM_AGE, objts[i].TO_AGE, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD, '', '', '', objts[i].IS_SRV_GUIDELINES_REQUIRED, '', objts[i].QUANTITY, '0', objts[i].ITEM_ID, objts[i].ITEM_GROUP_ID, '0', '0', objts[i].BILLING_HEAD_ID, objts[i].IS_DOCTOR_REQUIRED, '', objts[i].TAX_PCT, '', '', objts[i].SGST_TAX_PCT, objts[i].CGST_TAX_PCT, objts[i].SAC_CD, '', '', '', '0', objts[i].DOCTOR_PCT, '0', objts[i].ORG_PCT, objts[i].SERVICE_PRICE_ID, '', '', '');
                                    var gridID = document.getElementById('' + ctrlcom + '_UCServices_gvServices');

                                }
                            }
                        }
                    }
                }
                if (pkg == 'P' || pkg == 'O') {
                    var index = gridid.rows.length - 1;
                    $("table[id*=UCServices_gvServices] tr:has(td)").filter(':eq(' + index + ')').find('[id*=ddSType]')[0].disabled = true;
                }
                /*patient Category Mapping Concept*/
                if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK') {
                    var index = gridid.rows.length - 1;
                    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
                    var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
                    var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
                    if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
                    if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
                    if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_type) == 1)
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnpatcatid]').val(pat_cat_id);
                }
            }

        } /* for loop ends */
    }
    var length = document.getElementById('tbl_Optional').rows.length;
    if (length > 1) {
        $("#divOptional").show();
    }
    showhcforbindpats();

}

function showhcforbindpats() {
    var hc_req = $('#' + ctrlcom + '_UCServices_hdnhcdiscsts').val();
    if (hc_req == 'Y') {
        $('.ghcdisc').show();
    }
    else {
        $('.ghcdisc').hide();
    }
}
/*Assay Comparision Includes Assigning Start*/
var selection = ''; var SrvCount = 0;
function onassycomsucess(objts, pkg, order_id, order_det_id) {
    var assayDeleteCont = 0;
    var ExistsAssayNames = '';
    if (objts != null) {
        var Selection = document.getElementById('' + ctrlcom + '_hdnSelection');
        if ((Selection.value != '') && (Selection.value != NaN) && (Selection.value != undefined)) {
            Selection.value += "$";
            Selection.value += objts[0].PKG_SRV_IDS + "," + objts[0].PKG_SRV_NAME + "*";
        }
        else {
            Selection.value += objts[0].PKG_SRV_IDS + "," + objts[0].PKG_SRV_NAME + "*";
        }
        SrvCount++;
        for (var i = 0; i < objts.length; i++) {
            var pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
            if (pat_age == undefined || pat_age == null || pat_age == '') { pat_age = 0; }
            if (parseInt(objts[i].FROM_DAYS) >= 0 && parseInt(objts[i].TO_DAYS) >= 0) {
                if (((parseInt(objts[i].FROM_DAYS) <= parseInt(pat_age)) && (parseInt(pat_age) <= parseInt(objts[i].TO_DAYS))) || (parseInt(objts[i].FROM_DAYS) == 0 && parseInt(objts[i].TO_DAYS) == 0)) {
                    if (objts[i].SRV_GENDER_ID == "1" || objts[i].SRV_GENDER_ID == "2") {
                        if (document.getElementById('' + ctrlcom + '_UCServices_hdnGender_ID').value != objts[i].SRV_GENDER_ID) {
                            $(".stoast").toastText("warning", "This Service '" + objts[i].TEXT + "'  is not Suitable for this Patient", 5, 3);
                        }
                        else {
                            Selection.value += objts[i].VALUE + ",";
                            SrvCount++;
                            $("table[id*=gvServices] tr:has(td)").each(function () {
                                var srvID = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
                                var Srv = $(this).closest('tr').find("input[type=text][id*=txtServiceName]").val();
                                if ((srvID != '' && Srv != '') || (srvID != undefined && Srv != undefined)) {
                                    if (srvID == objts[i].VALUE) {
                                        ExistsAssayNames = ExistsAssayNames + Srv + ",";
                                        assayDeleteCont++;
                                        $(this).closest('tr').remove();
                                        arrServiceIds = $.grep(arrServiceIds, function (value) {
                                            return value != srvID
                                        });

                                    }
                                }
                            });
                        }
                    }
                    else {
                        Selection.value += objts[i].VALUE + ",";
                        SrvCount++;
                        $("table[id*=gvServices] tr:has(td)").each(function () {
                            var srvID = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
                            var Srv = $(this).closest('tr').find("input[type=text][id*=txtServiceName]").val();
                            if ((srvID != '' && Srv != '') || (srvID != undefined && Srv != undefined)) {
                                if (srvID == objts[i].VALUE) {
                                    ExistsAssayNames = ExistsAssayNames + Srv + ",";
                                    assayDeleteCont++;
                                    $(this).closest('tr').remove();
                                    arrServiceIds = $.grep(arrServiceIds, function (value) {
                                        return value != srvID
                                    });

                                }
                            }
                        });


                    }
                }
                else {
                    $(".stoast").toastText("warning", 'This service is applicable for patient of age ' + parseInt(objts[i].FROM_DAYS) + ' To ' + parseInt(objts[i].TO_DAYS), 5, 3);
                }
            }


        }
        if (assayDeleteCont > 0) {
            $(".stoast").toastText("warning", "This Service(s) '" + ExistsAssayNames + "' Already Exists in '" + objts[0].PKG_SRV_NAME + "' ", 5, 3);
            AssignSno('0');

        }
    }
}
/* End */
function RemovePkgsrvsService(ev) {
    $(".stoast").toastText("warning", "Package Includes Cannot Delete", 5, 3);
    return false;
}
/* pkg includes start */
var index = 0;
var rowColor = 0;

function fn_AddFilterRow_pkgbillSelection(pkg, foreignsrv, concernforn, pre_Cau_On_Srv, History_Types, Srv_hist, sno, service_id, service_name, service_cd, service_type, amount, concession_amt, net_amt, SPECIMEN_NAME, DOSAGE_QTY, VACCUTAINER_NAME, service_classID, service_groupID, Service_typeID, Doctor_id, tariff_id, clinichistory, IsForeignSrv, report_dispatch_time, SPECIMEN_NAME, SPECIMEN_ID, history_type, pkg_id, HISTORY_TYPE_ID, EMERGENCY_PRICE, MIN_PRICE, MAX_PRICE, NO_NEED_SRV, CONCERN_FORM_REQ, PRIV_SRV_POSTED_DT, NO_NEED_DAYS, QYT_EDIT, RATE_EDIT, START_DT, END_DT, department_id, SRV_GENDER_ID, order_id, order_det_id, FROM_DAYS, TO_DAYS, VisitTypeID, reqid, slottime, slotid, remarks, refrl_qty, EQUI_SERVICE_NAME, EQUI_SERVICE_CD, IS_REMARKS_MANDATORY, IS_ADDITIONAL, DISCOUNT_PERCENT, guidlines, service_unicode, quantity, uni_srv_type_id, item_id, item_group_id, event_track_id, srv_indent_status, billing_head_id, is_doctor_req, is_stat, tax_pct, ptax, ctax, SGST_PCT, CGST_PCT, SAC_CD, txt_cruleprc, txt_cruleid, txt_crulename, DoctorPrice, DoctorPct, OrgPrice, OrgPct, srvpriceID, txt_cruledefindid, txt_cruledefindby, CMP_DISC_PCNT, is_optinal) {
    if (pkg == 'G') {
        $('#' + ctrlcom + '_UCServices_gv_services_header_ctl03_txtServiceName').val('');
    }
    var newids = reqid;
    newids = newids + ',' + '';
    if (newids.split(',').length > 2) {

        var reqsrvid = newids.split(',')[1];
        reqid = newids.split(',')[0];
    }

    var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
    if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
    { con_ruleId = 0; }
    document.getElementById('DivGrid_Header').className = '';
    if (pkg == 'I' || pkg == 'P' || pkg == 'N' || pkg == 'R') {
        if (NO_NEED_SRV == 'Y' && pkg != 'P') {
            $(".stoast").toastText("warning", "This Service '" + service_name + "' is Already Posted No Need To Post According To Service Configarations", 5, 3);
            return false;
        }
        if (SRV_GENDER_ID == "1" || SRV_GENDER_ID == "2") {
            if (document.getElementById('' + ctrlcom + '_UCServices_hdnGender_ID').value != SRV_GENDER_ID) {
                $(".stoast").toastText("warning", "This Service '" + service_name + "' is not Suitable for this Patient", 5, 3);
                return false;
            }
        }
        if (srv_indent_status == "R") {
            $(".stoast").toastText("warning", "This Service '" + service_name + "' Verification is Rejected", 5, 3);
            return false;
        }
        if (srv_indent_status == "P") {
            $(".stoast").toastText("warning", "This Service '" + service_name + "' Verification is Pending", 5, 3);
            return false;
        }

        var pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
        if (parseInt(FROM_DAYS) > 0 && parseInt(TO_DAYS) > 0) {
            if ((parseInt(FROM_DAYS) <= parseInt(pat_age)) && (parseInt(pat_age) <= parseInt(TO_DAYS))) {

            }
            else {
                $(".stoast").toastText("warning", "This Service '" + service_name + "' Applicable Only For '" + parseInt(FROM_DAYS) + "' To '" + parseInt(TO_DAYS) + "' ", 5, 3);
                return false;
            }
        }
    }
    
    var gvServices = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var rowIndex = gvServices.rows.length;
    var checkRowIndex = rowIndex - 1;
    var gridindex = 1;

    if (service_id == '2') {
        arrServiceIds[rowIndex] = parseInt(Doctor_id);
    }
    else {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnRegconSetting').value == "Yes" && document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
            if (getParameterByName("MODE") != "VIEW" && getParameterByName("MODE") != "VIEW_OP") {
                if (service_name.trim() != "REGISTRATION") {
                    arrServiceIds[rowIndex] = parseInt(service_id);
                }
            }
        }
        else {
            /* commented by pushkar Let Me Know Before Uncomment */

            if (getParameterByName("MODE") != "VIEW" && getParameterByName("MODE") != "VIEW_OP") {
                arrServiceIds[rowIndex] = parseInt(service_id);
            }
        }
    }
    var newRow = gvServices.insertRow(rowIndex);
    if (rowColor == 0) {
        newRow.className = 'gridAlternaterow'
        rowColor++;
    }
    else {
        newRow.className = 'gridrow'
        rowColor = 0;
    }

    /* Sno And Colors */
    var newCell = newRow.insertCell(0);
    var divSno = document.createElement('div'); divSno.id = 'divSno';
    divSno.className = "legendinfo";
    var hdnServiceID = document.createElement('input'); hdnServiceID.type = 'hidden'; hdnServiceID.id = 'hdnServiceID' + index; hdnServiceID.value = service_id; newCell.appendChild(hdnServiceID);
    var hdnrefsrvqty = document.createElement('input'); hdnrefsrvqty.type = 'hidden'; hdnrefsrvqty.id = 'hdnrefsrvqty' + index; hdnrefsrvqty.value = refrl_qty; newCell.appendChild(hdnrefsrvqty);


    if (tax_pct == undefined || tax_pct == null || tax_pct == '') { tax_pct = "0"; }
    if (ptax == undefined || ptax == null || ptax == '' || ptax == NaN || ptax == 'NaN') { ptax = "0"; }
    if (ctax == undefined || ctax == null || ctax == '' || ctax == NaN || ctax == 'NaN') { ctax = "0"; }
    if (SGST_PCT == undefined || SGST_PCT == null || SGST_PCT == '' || SGST_PCT == NaN) { SGST_PCT = "0"; }
    if (CGST_PCT == undefined || CGST_PCT == null || CGST_PCT == '' || CGST_PCT == NaN) { CGST_PCT = "0"; }

    if (is_optinal == undefined || is_optinal == null || is_optinal == '' || is_optinal == NaN) { is_optinal = "N"; }


    if (srvpriceID == undefined || srvpriceID == "undefined" || srvpriceID == null || srvpriceID == '' || srvpriceID == NaN) { srvpriceID = "0"; }
    if (DoctorPrice == undefined || DoctorPrice == "undefined" || DoctorPrice == null || DoctorPrice == '' || DoctorPrice == NaN) { DoctorPrice = "0"; }

    if (DoctorPct == undefined || DoctorPct == "undefined" || DoctorPct == null || DoctorPct == '' || DoctorPct == NaN) { DoctorPct = "0"; }
    if (OrgPrice == undefined || OrgPrice == "undefined" || OrgPrice == null || OrgPrice == '' || OrgPrice == NaN) { OrgPrice = "0"; }
    if (OrgPct == undefined || OrgPct == "undefined" || OrgPct == null || OrgPct == '' || OrgPct == NaN) { OrgPct = "0"; }

    var hdnis_optinal = document.createElement('input'); hdnis_optinal.type = 'hidden'; hdnis_optinal.id = 'hdnis_optinal' + index; hdnis_optinal.value = is_optinal; newCell.appendChild(hdnis_optinal);
    var hdnsrvpriceID = document.createElement('input'); hdnsrvpriceID.type = 'hidden'; hdnsrvpriceID.id = 'hdnsrvpriceID' + index; hdnsrvpriceID.value = srvpriceID; newCell.appendChild(hdnsrvpriceID);
    var hdnDoctorPrice = document.createElement('input'); hdnDoctorPrice.type = 'hidden'; hdnDoctorPrice.id = 'hdnDoctorPrice' + index; hdnDoctorPrice.value = DoctorPrice; newCell.appendChild(hdnDoctorPrice);
    var hdnDoctorPct = document.createElement('input'); hdnDoctorPct.type = 'hidden'; hdnDoctorPct.id = 'hdnDoctorPct' + index; hdnDoctorPct.value = DoctorPct; newCell.appendChild(hdnDoctorPct);
    var hdnOrgPrice = document.createElement('input'); hdnOrgPrice.type = 'hidden'; hdnOrgPrice.id = 'hdnOrgPrice' + index; hdnOrgPrice.value = OrgPrice; newCell.appendChild(hdnOrgPrice);
    var hdnOrgPct = document.createElement('input'); hdnOrgPct.type = 'hidden'; hdnOrgPct.id = 'hdnOrgPct' + index; hdnOrgPct.value = OrgPct; newCell.appendChild(hdnOrgPct);

    var hdnsgstpct = document.createElement('input'); hdnsgstpct.type = 'hidden'; hdnsgstpct.id = 'hdnsgstpct' + index; hdnsgstpct.value = SGST_PCT; newCell.appendChild(hdnsgstpct);
    var hdncgstpct = document.createElement('input'); hdncgstpct.type = 'hidden'; hdncgstpct.id = 'hdncgstpct' + index; hdncgstpct.value = CGST_PCT; newCell.appendChild(hdncgstpct);
    var hdntaxpct = document.createElement('input'); hdntaxpct.type = 'hidden'; hdntaxpct.id = 'hdntaxpct' + index; hdntaxpct.value = tax_pct; newCell.appendChild(hdntaxpct);
    var hdncruleid = document.createElement('input'); hdncruleid.type = 'hidden'; hdncruleid.id = 'hdncruleid' + index; hdncruleid.value = txt_cruleid; newCell.appendChild(hdncruleid);
    var hdncrulepct = document.createElement('input'); hdncrulepct.type = 'hidden'; hdncrulepct.id = 'hdncrulepct' + index; hdncrulepct.value = txt_cruleprc; newCell.appendChild(hdncrulepct);
    var hdncrulename = document.createElement('input'); hdncrulename.type = 'hidden'; hdncrulename.id = 'hdncrulename' + index; hdncrulename.value = txt_crulename; newCell.appendChild(hdncrulename);


    var hdncruledefindid = document.createElement('input'); hdncruledefindid.type = 'hidden'; hdncruledefindid.id = 'hdncruledefindid' + index; hdncruledefindid.value = txt_cruledefindid; newCell.appendChild(hdncruledefindid);
    var hdncruledefindby = document.createElement('input'); hdncruledefindby.type = 'hidden'; hdncruledefindby.id = 'hdncruledefindby' + index; hdncruledefindby.value = txt_cruledefindby; newCell.appendChild(hdncruledefindby);

    var hdnnetamountold = document.createElement('input'); hdnnetamountold.type = 'hidden'; hdnnetamountold.id = 'hdnnetamountold' + index; hdnnetamountold.value = "0"; newCell.appendChild(hdnnetamountold);
    var hdncursamountold = document.createElement('input'); hdncursamountold.type = 'hidden'; hdncursamountold.id = 'hdncursamountold' + index; hdncursamountold.value = "0"; newCell.appendChild(hdncursamountold);
    var hdnmanagementoldamt = document.createElement('input'); hdnmanagementoldamt.type = 'hidden'; hdnmanagementoldamt.id = 'hdnmanagementoldamt' + index; hdnmanagementoldamt.value = "0"; newCell.appendChild(hdnmanagementoldamt);
    var hdnstaffoldamt = document.createElement('input'); hdnstaffoldamt.type = 'hidden'; hdnstaffoldamt.id = 'hdnstaffoldamt' + index; hdnstaffoldamt.value = "0"; newCell.appendChild(hdnstaffoldamt);
    var hdncasholdamt = document.createElement('input'); hdncasholdamt.type = 'hidden'; hdncasholdamt.id = 'hdncasholdamt' + index; hdncasholdamt.value = "0"; newCell.appendChild(hdncasholdamt);


    var hdnsgstamount = document.createElement('input'); hdnsgstamount.type = 'hidden'; hdnsgstamount.id = 'hdnsgstamount' + index; newCell.appendChild(hdnsgstamount);
    var hdncgstamount = document.createElement('input'); hdncgstamount.type = 'hidden'; hdncgstamount.id = 'hdncgstamount' + index; newCell.appendChild(hdncgstamount);
    var hdnconrequistionid = document.createElement('input'); hdnconrequistionid.type = 'hidden'; hdnconrequistionid.id = 'hdnconrequistionid' + index; hdnconrequistionid.value = reqid;
    newCell.appendChild(hdnconrequistionid);


    var hdnconrequistionsrvid = document.createElement('input'); hdnconrequistionsrvid.type = 'hidden'; hdnconrequistionsrvid.id = 'hdnconrequistionsrvid' + index; hdnconrequistionsrvid.value = reqsrvid;
    newCell.appendChild(hdnconrequistionsrvid);

    var lblSNo = document.createElement('label'); lblSNo.id = 'lblSNo' + index; lblSNo.innerHTML = rowIndex + 1;
    var DivColors = document.createElement('div');
    DivColors.id = 'DivColors' + index; DivColors.className = "slegend";
    DivColors.style.display = 'block';
    var iframe = document.createElement('i');
    if (concernforn == 'Y') {
        iframe.className = "cosernform";
    }
    else {
        iframe.style.display = 'none';
    }
    var iframe1 = document.createElement('i');
    if (foreignsrv == 'Y') {
        iframe1.className = "fser";
    }
    else {
        iframe1.style.display = 'none';
    }
    var iframe3 = document.createElement('i');
    if (pkg == 'P' || pkg == 'O') {
        iframe3.className = "pkg";
    }
    else if (pkg == 'V' && parseInt(service_classID) > 0) {
        iframe3.className = "pkg";
    }
    else {
        iframe3.style.display = 'none';
    }

    var iframe2 = document.createElement('i');
    iframe2.id = 'iframe2' + index;
    iframe2.className = "Tariff";
    iframe2.style.display = 'none';
    DivColors.appendChild(iframe); DivColors.appendChild(iframe1); DivColors.appendChild(iframe3);
    DivColors.appendChild(iframe2);
    divSno.appendChild(lblSNo);
    divSno.appendChild(DivColors);
    newCell.className = 'sno';
    newCell.appendChild(divSno);

    /* Manage Buttons */
    newCell = newRow.insertCell(1);
    var divmanage = document.createElement('div');
    divmanage.className = 'divmanage';

    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPasIntgrtnReq').value == "True") {
        var itaglist = document.createElement('i');
        itaglist.id = 'tagList' + index;
        itaglist.className = "icon-list tooltip";
        itaglist.title = 'Insurance List';
        itaglist.setAttribute("data-tooltip-content", "#tooltip_content");
        itaglist.onclick = function () { return ShowInsuranceDtls(this); }
        divmanage.appendChild(itaglist);
    }


    var pkg_dlts = $('#' + ctrlcom + '_UCServices_hdnpkgincdlt').val();
    if (pkg == 'P' && pkg_dlts == 'True') {

    } else {
        var imgBtnDelete = document.createElement('i');
        imgBtnDelete.className = 'icon-cancel-circled sdelete';
        imgBtnDelete.id = 'imgBtnDelete' + index;
        if (pkg_dlts == undefined || pkg_dlts == null || pkg_dlts == '') {
            pkg_dlts = 'False';
        }
        if (pkg == 'P' && pkg_dlts == 'False') {
            imgBtnDelete.onclick = function () { RemovePkgsrvsService(this) };
        }
        else {
            imgBtnDelete.onclick = function () { RemoveGridViewService(this) };
        }
        imgBtnDelete.title = 'Remove';
        divmanage.appendChild(imgBtnDelete);
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
            var imgStar = document.createElement('i');
            imgStar.className = 'su-star-empty FavColor';
            imgStar.id = 'imgStar' + index;
            imgStar.onclick = function () { fn_Favourites(service_id, imgStar.id) };
            imgStar.title = 'Favourites';
            $('[id$=hdnStarIndex]').val(imgStar.id);
            divmanage.appendChild(imgStar);
        }
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP') {
        var imgStar = document.createElement('i');
        imgStar.className = 'su-star-empty FavColor';
        imgStar.id = 'imgStar' + index;
        imgStar.onclick = function () { fn_Favourites(service_id, imgStar.id) };
        imgStar.title = 'Favourites';
        $('[id$=hdnStarIndex]').val(imgStar.id);
        divmanage.appendChild(imgStar);
    }
    var imgClinicalHistory = document.createElement('i');
    imgClinicalHistory.className = 'icon-file-powerpoint prerequest';
    imgClinicalHistory.id = 'imgClinicalHistory' + index;
    imgClinicalHistory.onclick = function () { ShowPre_Cus_On_Srvs(this) };
    imgClinicalHistory.title = 'Pre Requisite';
    if (pre_Cau_On_Srv == 'Y') {
        imgClinicalHistory.style.display = 'block';
    }
    else
    { imgClinicalHistory.style.display = 'none'; }
    divmanage.appendChild(imgClinicalHistory);

    var imgbtnhisttype = document.createElement('i');
    imgbtnhisttype.className = 'icon-history historytype';
    imgbtnhisttype.id = 'imgbtnhisttype' + index;
    imgbtnhisttype.onclick = function () { historytype(this) };
    imgbtnhisttype.title = 'History Type';
    if (parseInt(HISTORY_TYPE_ID) > 0)
    { imgbtnhisttype.style.display = 'block'; } /* not required so commented */
    else {
        imgbtnhisttype.style.display = 'none';
    }
    divmanage.appendChild(imgbtnhisttype);


    var ImgSrvHist = document.createElement('i');
    ImgSrvHist.className = ' icon-book historytype';
    ImgSrvHist.id = 'ImgSrvHist' + index;
    ImgSrvHist.onclick = function () { ServiceWiseHistory(this) };
    ImgSrvHist.title = 'Service Dtls';
    if (Srv_hist == 'Y') {
        ImgSrvHist.style.display = 'block';
    }
    else {
        ImgSrvHist.style.display = 'none';
    }
    divmanage.appendChild(ImgSrvHist);

    var imgSrvShedul = document.createElement('i');
    imgSrvShedul.className = 'icon-calendar historytype';
    imgSrvShedul.id = 'imgSrvShedul' + index;
    imgSrvShedul.onclick = function () { Show_Srv_ScheduleDtls(this) };
    imgSrvShedul.title = 'Service Schedule';

    if (parseInt(quantity) > 1) {
        imgSrvShedul.style.display = 'block';
    }
    else {
        imgSrvShedul.style.display = 'none';
    }
    divmanage.appendChild(imgSrvShedul);

    var imgOptionalSrv = document.createElement('i');
    imgOptionalSrv.className = 'icon-doc-1 historytype';
    imgOptionalSrv.id = 'imgOptionalSrv' + index;
    imgOptionalSrv.onclick = function () { Show_OptionalSrvDtls(this) };
    imgOptionalSrv.title = 'Optional Services';

    imgOptionalSrv.style.display = 'none';

    divmanage.appendChild(imgOptionalSrv);


    var imgconcernforn = document.createElement('i');
    imgconcernforn.className = 'icon-building-filled historytype';
    imgconcernforn.id = 'imgconcernforn' + index;
    imgconcernforn.onclick = function () { Show_concernfornDtls(this) };
    imgconcernforn.title = 'Consent Form Details';
    if (concernforn == 'Y')
    { imgconcernforn.style.display = 'block'; }
    else {
        imgconcernforn.style.display = 'none';
    }

    divmanage.appendChild(imgconcernforn);

    var chkPstCons = GetEmergecnyCheckBox("chkPstCons");
    chkPstCons.align = 'right';
    chkPstCons.className = "PstCons";
    chkPstCons.onclick = function () { onCheckPostCons(this); };
    chkPstCons.title = 'Post Consultations';

    if ((parseInt(Doctor_id) > 0 && pkg != 'G' && Service_typeID == '1') || (parseInt(department_id) > 0 && parseInt(Doctor_id) == 0 && pkg != 'G' && Service_typeID == '1')) {
        if ($('[id*=hdnisosp]').val() == 'Y') { chkPstCons.style.display = 'none'; } else {
            chkPstCons.style.display = 'block';
        }
    }
    else
    { chkPstCons.style.display = 'none'; }
    divmanage.appendChild(chkPstCons);

    var imgGuidelines = document.createElement('i');
    imgGuidelines.className = 'icon-building-filled historytype';
    imgGuidelines.id = 'imgGuidelines' + index;
    imgGuidelines.onclick = function () { onGuidelinesClick(this) };
    imgGuidelines.title = 'Guide Lines';
    if (guidlines == 'Y')
    { imgGuidelines.style.display = 'block'; }
    else {
        imgGuidelines.style.display = 'none';
    }

    divmanage.appendChild(imgGuidelines);
    if ((parseInt(Doctor_id) > 0 && pkg != 'G' && Service_typeID == '1') || (parseInt(department_id) > 0 && parseInt(Doctor_id) == 0 && pkg != 'G' && Service_typeID == '1') && (is_doctor_req == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_hdnIsCnsltReqFrSrvPsting').value.toLowerCase() == 'true')) {
    }
    else {
        if (is_doctor_req == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_hdnIsCnsltReqFrSrvPsting').value.toLowerCase() == 'true') {
            var imgsrvdtr = document.createElement('i');
            imgsrvdtr.className = "su-doctor doccl";
            imgsrvdtr.id = 'imgsrvdtr' + index;
            imgsrvdtr.onclick = function () { serviceDoctor(this) };
            imgsrvdtr.title = 'Doctor';
            divmanage.appendChild(imgsrvdtr);
        }
    }

    newCell.className = 'Manage';
    newCell.appendChild(divmanage);

    /* Priv Service Posted Date */
    newCell = newRow.insertCell(2);
    var txtPriv_Post_Dt = document.createElement('span');
    txtPriv_Post_Dt.id = 'txtPriv_Post_Dt' + index;
    txtPriv_Post_Dt.disabled = true;
    var priv_srv_post_dt = PRIV_SRV_POSTED_DT;
    if (priv_srv_post_dt != '0' && priv_srv_post_dt != undefined && priv_srv_post_dt != null && priv_srv_post_dt != '' && pkg != 'P') {

        priv_srv_post_dt = new Date(priv_srv_post_dt).format('dd-MMM-yyyy');
    }
    else
    { priv_srv_post_dt = ''; }
    txtPriv_Post_Dt.innerHTML = priv_srv_post_dt;
    newCell.className = 'PrivPostDt';
    newCell.appendChild(txtPriv_Post_Dt);

    /*Service Name */
    newCell = newRow.insertCell(3);
    var divsrvname = document.createElement('div'); divsrvname.id = 'divsrvname';
    divsrvname.className = "btntxt";
    var txtServiceName = document.createElement('input');
    txtServiceName.type = 'text';
    txtServiceName.className = 'SampleReg';
    txtServiceName.id = 'txtServiceName' + index;
    txtServiceName.value = service_name;
    txtServiceName.title = service_name;
    var divBtnSrc = document.createElement('div');
    divBtnSrc.id = 'divBtnSrc';
    divBtnSrc.className = "txtbtn";
    var BtnSrvSearch = document.createElement('input');
    BtnSrvSearch.type = 'button';
    BtnSrvSearch.className = 'tb_Btn searchbtn';
    BtnSrvSearch.id = 'BtnSrvSearch' + index;
    BtnSrvSearch.align = "right";
    BtnSrvSearch.onclick = function () { OnServicesSearchLookup(this); }
    var lblvisitdetails = document.createElement('label');
    lblvisitdetails.id = 'lblvisitdetails' + index;
    divsrvname.appendChild(txtServiceName);
    lblvisitdetails.className = "srvdvisit";
    divsrvname.appendChild(divBtnSrc);
    divBtnSrc.appendChild(BtnSrvSearch);
    divBtnSrc.appendChild(lblvisitdetails);
    txtServiceName.disabled = true;
    if (service_id == '2' || service_id == '' || department_id > 0) {
        BtnSrvSearch.disabled = false;
    }
    else {
        BtnSrvSearch.disabled = true;
    }
    newCell.className = 'sd-name';
    newCell.appendChild(divsrvname);

    /*  Sys.Application.add_init(function () {
    $create(AjaxControlToolkit.AutoCompleteBehavior, { "firstRowSelected": true, "completionListCssClass": "autocomplete_completionListElement", "completionListItemCssClass": "autocomplete_listItem", "highlightedItemCssClass": "autocomplete_highlightedListItem", "id": "autoComplete1" + index, "minimumPrefixLength": 2, "serviceMethod": "GetAllOPServiceAuto", "servicePath": _iniUrl + "ServiceMasterWebService.asmx", "useContextKey": true, "contextKey": "SERVICE_NAME" }, { "itemSelected": OnItemSelection }, null, $get(txtServiceName.id));
    }); */

    /*service Doctor*/
    newCell = newRow.insertCell(4);
    var txtsrvdoctor = document.createElement('input'); txtsrvdoctor.type = 'text';
    txtsrvdoctor.id = 'txtsrvdoctor' + index;
    txtsrvdoctor.disabled = true;
    newCell.className = 'txtsrvdoctor';
    newCell.appendChild(txtsrvdoctor);

    slotid = slotid == undefined || slotid == "" ? 0 : slotid;

    if (slotid == '' || slotid == undefined || slotid == null) {
        newCell = newRow.insertCell(5);
        var ddldiv1 = document.createElement('div');
        var ddlSlotTiming = document.createElement('select');
        ddlSlotTiming.id = 'ddlSlotTiming' + index;
        var opt = '', _VisitVal = '';
        var _SlotVal = document.createElement("option");
        ddlSlotTiming.options.add(_SlotVal, 0);
        ddlSlotTiming.onchange = function () { return SlotChnage(this); }
        if (pkg == 'P' && (Doctor_id > 0 || department_id > 0) && Service_typeID == '1') {
            ddlSlotTiming.disabled = true;
        }

        ddldiv1.appendChild(ddlSlotTiming);
        newCell.className = 'Slots';
        newCell.appendChild(ddlSlotTiming);
    } else {
        newCell = newRow.insertCell(5);
        var ddldiv1 = document.createElement('div');
        var ddlSlotTiming = document.createElement('select');
        ddlSlotTiming.id = 'ddlSlotTiming' + index;
        var opt = '', _VisitVal = '';
        var _SlotVal = document.createElement("option");
        if (document.getElementById('' + ctrlcom + '_hdnAppsync').value.toLowerCase() == "true") {
            if (document.getElementById('' + ctrlcom + '_hdnisapptslotreq').value.toLowerCase() == "true") {

                _SlotVal.text = slottime;
                _SlotVal.value = slotid;
                ddlSlotTiming.options.add(_SlotVal, 1);
            }
        }
        else {
            ddlSlotTiming.options.add(_SlotVal, 0);

        }

        ddlSlotTiming.options.add(_SlotVal, 1);
        ddlSlotTiming.onchange = function () { return SlotChnage(this); }
        if (pkg == 'P' && (Doctor_id > 0 || department_id > 0) && Service_typeID == '1') {
            ddlSlotTiming.disabled = true;
        }
        ddldiv1.appendChild(ddlSlotTiming);
        newCell.className = 'Slots';
        newCell.appendChild(ddlSlotTiming);
    }
    /*Service Code */

    newCell = newRow.insertCell(6);
    var hdnSrvUniCode = document.createElement('input'); hdnSrvUniCode.type = 'hidden'; hdnSrvUniCode.id = 'hdnSrvUniCode' + index; hdnSrvUniCode.value = service_unicode; newCell.appendChild(hdnSrvUniCode);

    var hdnItem_id = document.createElement('input'); hdnItem_id.type = 'hidden'; hdnItem_id.id = 'hdnItem_id' + index; hdnItem_id.value = item_id; newCell.appendChild(hdnItem_id);
    var hdnitem_group_id = document.createElement('input'); hdnitem_group_id.type = 'hidden'; hdnitem_group_id.id = 'hdnitem_group_id' + index; hdnitem_group_id.value = item_group_id; newCell.appendChild(hdnitem_group_id);
    var hdndoctorpasno = document.createElement('input'); hdndoctorpasno.type = 'hidden'; hdndoctorpasno.id = 'hdndoctorpasno' + index; hdndoctorpasno.value = ''; newCell.appendChild(hdndoctorpasno);
    var hdnUniSrvTypeId = document.createElement('input'); hdnUniSrvTypeId.type = 'hidden'; hdnUniSrvTypeId.id = 'hdnUniSrvTypeId' + index; hdnUniSrvTypeId.value = uni_srv_type_id; newCell.appendChild(hdnUniSrvTypeId);
    var hdnDiagnosiscd = document.createElement('input'); hdnDiagnosiscd.type = 'hidden'; hdnDiagnosiscd.id = 'hdnDiagnosiscd' + index;
    if ($('[id*=hdnDiagnosis_Cd]').val() != undefined && $('[id*=hdnDiagnosis_Cd]').val() != null) {
        hdnSrvUniCode.value = $('[id*=hdnDiagnosis_Cd]').val();
    }
    newCell.appendChild(hdnDiagnosiscd);

    var hdnIsRegInclude = document.createElement('input'); hdnIsRegInclude.type = 'hidden'; hdnIsRegInclude.id = 'hdnIsRegInclude' + index; newCell.appendChild(hdnIsRegInclude);


    var hdnEvent_track_id = document.createElement('input'); hdnEvent_track_id.type = 'hidden'; hdnEvent_track_id.id = 'hdnEvent_track_id' + index; hdnEvent_track_id.value = event_track_id;
    newCell.appendChild(hdnEvent_track_id);

    var txtServiceCd = document.createElement('input'); txtServiceCd.type = 'text'; txtServiceCd.disabled = true;
    txtServiceCd.id = 'txtServiceCode' + index;
    if (Service_typeID == '12') {
        txtServiceCd.value = '';
    }
    else {
        txtServiceCd.value = service_cd;
    }
    var form_name = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnDocName').value;
    if (form_name == 'OP' || form_name == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPasIntgrtnReq').value == "True") {
            txtServiceCd.style.width = "55px";
            var italist = document.createElement('i');
            italist.id = 'tagList' + index;
            italist.className = " icon-info-circled";
            italist.style.float = "right";
            italist.style.width = "15px";
            italist.style.margin = "4px 0px 0px 0px"
            italist.title = 'Info';
            italist.setAttribute("data-tooltip-content", "#tooltip_content");
            italist.onclick = function () { return PasServiceCodesInfo(this); }
            newCell.className = 'scode';
            newCell.appendChild(txtServiceCd);
            newCell.appendChild(italist);
        }
        else {
            newCell.className = 'scode';
            newCell.appendChild(txtServiceCd);
        }
    }
    else {
        newCell.className = 'scode';
        newCell.appendChild(txtServiceCd);
    }

    /* S Type */
    newCell = newRow.insertCell(7);
    var ddldiv = document.createElement('div');
    var ddSType = document.createElement('select');
    ddSType.id = 'ddSType' + index;
    var ddSType = document.createElement('select');
    ddSType.id = 'ddSType' + index;
    var opt = '', _VisitVal = '';

    for (var i = 0; i < VisitTypes.length; i++) {
        if (service_id != '2') {
            if (VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"].toLowerCase() == "normal" || VisitTypes[i]["TYPE_OF_CONSULTATION_ID"] == "1") {
                var _VisitVal = document.createElement("option"); _VisitVal.text = VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"]; _VisitVal.value = VisitTypes[i]["TYPE_OF_CONSULTATION_ID"];
                ddSType.options.add(_VisitVal, i);
            }
            if (VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"].toLowerCase() == "emergency") {
                var _VisitVal = document.createElement("option"); _VisitVal.text = VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"]; _VisitVal.value = VisitTypes[i]["TYPE_OF_CONSULTATION_ID"];
                ddSType.options.add(_VisitVal, i);
            }
        }
        else {
            var _VisitVal = document.createElement("option");
            _VisitVal.text = VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"];
            _VisitVal.value = VisitTypes[i]["TYPE_OF_CONSULTATION_ID"];
            ddSType.options.add(_VisitVal, i);
        }
    }

    ddSType.onchange = function () { return DropDownTypeChanges(this); }
    ddldiv.appendChild(ddSType);
    if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y')
        { ddSType.value = '2'; }
        else {
            ddSType.value = '1';
        }
    }
    else {
        VisitTypeID = VisitTypeID || 1;
        ddSType.value = VisitTypeID;
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && reqcons == 'P') { ddSType.disabled = true; }
    newCell.className = 'stype';
    newCell.appendChild(ddSType);

    /* Qty */

    newCell = newRow.insertCell(8);
    var txtQty = document.createElement('input'); txtQty.type = 'text';
    if (quantity == undefined || quantity == null || quantity == NaN)
    { quantity = 1; }
    txtQty.className = 'Aright';
    txtQty.id = 'txtQty' + index;
    txtQty.maxLength = 3;
    if (pkg == 'P' && quantity != '') {
        txtQty.value = quantity;
    }
    else {
        txtQty.value = '1';
    }
    if (QYT_EDIT == 'Y') {
        if (pkg == 'P' || pkg == 'O') {
            txtQty.disabled = true;
        }
        else {
            txtQty.disabled = false;
        }
    }
    else
    { txtQty.disabled = true; }


    txtQty.onkeypress = function () { numeralsOnly1(event); };
    txtQty.onkeyup = function () { OnQtyChange(this) };
    txtQty.onfocus = function () { CheckCurrentQty(this) };
    txtQty.onblur = function () { OnQtyChange(this) };
    newCell.className = 'Qty';
    newCell.appendChild(txtQty);

    /* Rate */
    newCell = newRow.insertCell(9);
    var txtRate = document.createElement('input'); txtRate.type = 'text';
    txtRate.className = 'Aright';
    txtRate.id = 'txtRate' + index;
    if (RATE_EDIT == 'Y') {
        if (pkg == 'P' || pkg == 'O') {
            txtRate.disabled = true;
        }
        else {
            txtRate.disabled = false;
        }
    }
    else
    { txtRate.disabled = true; }
    txtRate.onkeypress = function () { numeralsOnly1(event); };
    txtRate.onkeyup = function () { OnRateChange(this); };
    txtRate.onblur = function () { OnRateChange(this); CheckPriceInRange(this); };
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y' && pkg != 'P') {
        if (EMERGENCY_PRICE == null || EMERGENCY_PRICE == undefined || EMERGENCY_PRICE == '') {
            EMERGENCY_PRICE = '0';
        }
        txtRate.value = EMERGENCY_PRICE;
    }
    else {
        txtRate.value = amount;
    }
    newCell.className = 'charge';
    newCell.appendChild(txtRate);

    /* Amount */
    newCell = newRow.insertCell(10);
    var txtAmount = document.createElement('input'); txtAmount.type = 'text';
    txtAmount.className = 'Aright';
    txtAmount.id = 'txtAmount' + index;
    txtAmount.disabled = true;
    newCell.className = 'amount';
    newCell.appendChild(txtAmount);


    /* EmerGency Check Box */
    newCell = newRow.insertCell(11);
    var chkstat = GetEmergecnyCheckBox("chkstat");
    chkstat.align = 'center';
    if (service_id == '2' && Doctor_id > 0) {
        chkstat.style.display = 'none';
    }
    else {
        chkstat.style.display = 'inline-block';
    }
    chkstat.onclick = function () { onCheckEmergency(this); };
    if (is_stat == 'Y') { chkstat.checked = true; }
    newCell.className = 'stat';
    newCell.appendChild(chkstat);
    var hdnIsEmergency = document.createElement('input'); hdnIsEmergency.type = 'hidden'; hdnIsEmergency.id = 'hdnIsEmergency' + index; hdnIsEmergency.style.textAlign = "center";
    newCell.appendChild(hdnIsEmergency);
    var hdnIsPrerequisit = document.createElement('input'); hdnIsPrerequisit.type = 'hidden'; hdnIsPrerequisit.id = 'hdnIsPrerequisit' + index;
    newCell.appendChild(hdnIsPrerequisit);
    var hdnIsForeignSrv = document.createElement('input'); hdnIsForeignSrv.type = 'hidden'; hdnIsForeignSrv.id = 'hdnIsForeignSrv' + index; hdnIsForeignSrv.value = IsForeignSrv;
    newCell.appendChild(hdnIsForeignSrv);

    var hdnprorate = document.createElement('input'); hdnprorate.type = 'hidden'; hdnprorate.id = 'hdnprorate' + index;
    newCell.appendChild(hdnprorate);

    var hdnISSamplecoll = document.createElement('input'); hdnISSamplecoll.type = 'hidden'; hdnISSamplecoll.id = 'hdnISSamplecoll' + index; hdnISSamplecoll.style.textAlign = "center";
    newCell.appendChild(hdnISSamplecoll);

    if (EQUI_SERVICE_CD == undefined || EQUI_SERVICE_CD == null || EQUI_SERVICE_CD == NaN)
    { EQUI_SERVICE_CD = ''; }
    if (Service_typeID == '12') {
        EQUI_SERVICE_CD = '';
        service_cd = '';
    }
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    var pay_type = 0;
    if (form_name == 'OP' || form_name == 'Cons') {
        pay_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
    }
    else if (form_name == 'OPQUICK') {
        var dd_type = $('#' + ctrlcom + '_ddlPatientType').val();
        if (dd_type == '2' || dd_type == '5' || dd_type == '8') {
            pay_type = '2';
        }
        else
            pay_type = '1';
    }
    if (pay_type == '1') {
        if (Service_typeID == '12') {
            var hdnedit_srv_cd = document.createElement('input'); hdnedit_srv_cd.type = 'hidden'; hdnedit_srv_cd.id = 'hdnedit_srv_cd' + index; hdnedit_srv_cd.value = '';
            newCell.appendChild(hdnedit_srv_cd);
        }
        else {
            var hdnedit_srv_cd = document.createElement('input'); hdnedit_srv_cd.type = 'hidden'; hdnedit_srv_cd.id = 'hdnedit_srv_cd' + index; hdnedit_srv_cd.value = service_cd;
            newCell.appendChild(hdnedit_srv_cd);
        }
    }
    else {
        if (Service_typeID == '12') {
            var hdnedit_srv_cd = document.createElement('input'); hdnedit_srv_cd.type = 'hidden'; hdnedit_srv_cd.id = 'hdnedit_srv_cd' + index; hdnedit_srv_cd.value = EQUI_SERVICE_CD;
            newCell.appendChild(hdnedit_srv_cd);
        }
        else {
            var hdnedit_srv_cd = document.createElement('input'); hdnedit_srv_cd.type = 'hidden'; hdnedit_srv_cd.id = 'hdnedit_srv_cd' + index; hdnedit_srv_cd.value = EQUI_SERVICE_CD;
            newCell.appendChild(hdnedit_srv_cd);
        }
    }


    var hdnmax_opt_srvs = document.createElement('input'); hdnmax_opt_srvs.type = 'hidden'; hdnmax_opt_srvs.id = 'hdnmax_opt_srvs' + index;
    newCell.appendChild(hdnmax_opt_srvs);

    var hdnsrvdates = document.createElement('input'); hdnsrvdates.type = 'hidden'; hdnsrvdates.id = 'hdnsrvdates' + index;
    newCell.appendChild(hdnsrvdates);

    var hdnSrvShcedulSave = document.createElement('input'); hdnSrvShcedulSave.type = 'hidden'; hdnSrvShcedulSave.id = 'hdnSrvShcedulSave' + index; hdnSrvShcedulSave.value = ''; newCell.appendChild(hdnSrvShcedulSave);
    var hdn_is_free_followup = document.createElement('input'); hdn_is_free_followup.type = 'hidden'; hdn_is_free_followup.id = 'hdn_is_free_followup' + index; hdn_is_free_followup.value = _is_free_followup; newCell.appendChild(hdn_is_free_followup);

    var hdn_remarks_mandatory = document.createElement('input'); hdn_remarks_mandatory.type = 'hidden'; hdn_remarks_mandatory.id = 'hdn_remarks_mandatory' + index; hdn_remarks_mandatory.value = is_remarks_mandatory; newCell.appendChild(hdn_remarks_mandatory);

    var hdnTockenNO = document.createElement('input'); hdnTockenNO.type = 'hidden'; hdnTockenNO.id = 'hdnTockenNO' + index; hdnTockenNO.value = ''; newCell.appendChild(hdnTockenNO);
    var hdnreqid = document.createElement('input'); hdnreqid.type = 'hidden'; hdnreqid.id = 'hdnreqid' + index; hdnreqid.value = '0'; newCell.appendChild(hdnreqid);
    var IsGSTApplicable = document.getElementById('' + ctrlcom + '_UCServices_hdnisallowgst').value;
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnPrePrintedBarcodeReq').value == 'Yes') {
        /* Bar Code */
        newCell = newRow.insertCell(12);
        var txtBarcode = document.createElement('input'); txtBarcode.type = 'text';
        newCell.className = 'sbarcd';
        txtBarcode.id = 'txtBarcode' + index;
        txtBarcode.onclick = function () { barcodevalidate(this); };
        newCell.className = 'sbarcd barcdhead';
        newCell.appendChild(txtBarcode);

        var hdnServiceClass = document.createElement('input'); hdnServiceClass.type = 'hidden'; hdnServiceClass.id = 'hdnServiceClass' + index; hdnServiceClass.value = service_classID; newCell.appendChild(hdnServiceClass);
        var hdnClass_Srv_ID = document.createElement('input'); hdnClass_Srv_ID.type = 'hidden'; hdnClass_Srv_ID.id = 'hdnClass_Srv_ID' + index;
        if (pkg == 'P' || pkg == 'O') {
            hdnClass_Srv_ID.value = pkg_id;
        }
        else {
            hdnClass_Srv_ID.value = '0';
        }
        newCell.appendChild(hdnClass_Srv_ID);
        var hdnServiceGrpID = document.createElement('input'); hdnServiceGrpID.type = 'hidden'; hdnServiceGrpID.id = 'hdnServiceGrpID' + index; hdnServiceGrpID.value = service_groupID; newCell.appendChild(hdnServiceGrpID);
        var hdnServiceTypID = document.createElement('input'); hdnServiceTypID.type = 'hidden'; hdnServiceTypID.id = 'hdnServiceTypID' + index; hdnServiceTypID.value = Service_typeID; newCell.appendChild(hdnServiceTypID);
        var hdnDoctorID = document.createElement('input'); hdnDoctorID.type = 'hidden'; hdnDoctorID.id = 'hdnDoctorID' + index; hdnDoctorID.value = Doctor_id; newCell.appendChild(hdnDoctorID);

        var hdnDepartment_Id = document.createElement('input'); hdnDepartment_Id.type = 'hidden'; hdnDepartment_Id.id = 'hdnDepartment_Id' + index; hdnDepartment_Id.value = department_id; newCell.appendChild(hdnDepartment_Id);
        var hdnbillingheadid = document.createElement('input'); hdnbillingheadid.type = 'hidden'; hdnbillingheadid.id = 'hdnbillingheadid' + index; hdnbillingheadid.value = billing_head_id; newCell.appendChild(hdnbillingheadid);

        if (Doctor_id > 0 && department_id > 0) {
            hdnServiceID.value = 2;
        }
        var hdnSrv_Type_Name = document.createElement('input'); hdnSrv_Type_Name.type = 'hidden'; hdnSrv_Type_Name.id = 'hdnSrv_Type_Name' + index; hdnSrv_Type_Name.value = service_type; newCell.appendChild(hdnSrv_Type_Name);
        var hdnSrv_Grp_Name = document.createElement('input'); hdnSrv_Grp_Name.type = 'hidden'; hdnSrv_Grp_Name.id = 'hdnSrv_Grp_Name' + index; hdnSrv_Grp_Name.value = service_type; newCell.appendChild(hdnSrv_Grp_Name);
        var hdnPat_Class_Id = document.createElement('input'); hdnPat_Class_Id.type = 'hidden'; hdnPat_Class_Id.id = 'hdnPat_Class_Id' + index; hdnPat_Class_Id.value = '2'; newCell.appendChild(hdnPat_Class_Id);
        var hdnEmergency_Price = document.createElement('input'); hdnEmergency_Price.type = 'hidden'; hdnEmergency_Price.id = 'hdnEmergency_Price' + index;
        if (EMERGENCY_PRICE == undefined || EMERGENCY_PRICE == null || EMERGENCY_PRICE == '') { EMERGENCY_PRICE = "0"; }
        hdnEmergency_Price.value = EMERGENCY_PRICE; newCell.appendChild(hdnEmergency_Price);
        var hdnNormal_Price = document.createElement('input'); hdnNormal_Price.type = 'hidden'; hdnNormal_Price.id = 'hdnNormal_Price' + index; hdnNormal_Price.value = amount; newCell.appendChild(hdnNormal_Price);
        var hdnTariffId = document.createElement('input'); hdnTariffId.type = 'hidden'; hdnTariffId.id = 'hdnTariffId' + index; hdnTariffId.value = tariff_id; newCell.appendChild(hdnTariffId);
        var hdnhistorytypeID = document.createElement('input'); hdnhistorytypeID.type = 'hidden'; hdnhistorytypeID.id = 'hdnhistorytypeID' + index; hdnhistorytypeID.value = HISTORY_TYPE_ID; newCell.appendChild(hdnhistorytypeID);
        var hdnMin_Price = document.createElement('input'); hdnMin_Price.type = 'hidden'; hdnMin_Price.id = 'hdnMin_Price' + index; hdnMin_Price.value = MIN_PRICE; newCell.appendChild(hdnMin_Price);
        var hdnMax_Price = document.createElement('input'); hdnMax_Price.type = 'hidden'; hdnMax_Price.id = 'hdnMax_Price' + index; hdnMax_Price.value = MAX_PRICE; newCell.appendChild(hdnMax_Price);
        var hdnNo_Nd_Dys = document.createElement('input'); hdnNo_Nd_Dys.type = 'hidden'; hdnNo_Nd_Dys.id = 'hdnNo_Nd_Dys' + index; hdnNo_Nd_Dys.value = NO_NEED_DAYS; newCell.appendChild(hdnNo_Nd_Dys);
        var hdnMedicationType = document.createElement('input'); hdnMedicationType.type = 'hidden'; hdnMedicationType.id = 'hdnMedicationType' + index; newCell.appendChild(hdnMedicationType);
        var hdnDosageqty = document.createElement('input'); hdnDosageqty.type = 'hidden'; hdnDosageqty.id = 'hdnDosageqty' + index; newCell.appendChild(hdnDosageqty);
        var hdnIsTakenToday = document.createElement('input'); hdnIsTakenToday.type = 'hidden'; hdnIsTakenToday.id = 'hdnIsTakenToday' + index; newCell.appendChild(hdnIsTakenToday);
        var hdnLmpCal = document.createElement('input'); hdnLmpCal.type = 'hidden'; hdnLmpCal.id = 'hdnLmpCal' + index; newCell.appendChild(hdnLmpCal);
        var hdnOutherMedic = document.createElement('input'); hdnOutherMedic.type = 'hidden'; hdnOutherMedic.id = 'hdnOutherMedic' + index; newCell.appendChild(hdnOutherMedic);
        var hdncount = document.createElement('input'); hdncount.type = 'hidden'; hdncount.id = 'hdncount' + index; newCell.appendChild(hdncount);
        var con_discpcr = "0";
        if (hdnServiceID.value == 2 && Doctor_id > 0) {
            con_discpcr = document.getElementById('' + ctrlcom + '_uccorporate_hbncondisamount').value;
            if (con_discpcr == undefined || con_discpcr == null || con_discpcr == '') { con_discpcr = "0"; }
        }

        var hdnCmpDiscPcnt = document.createElement('input'); hdnCmpDiscPcnt.type = 'hidden'; hdnCmpDiscPcnt.id = 'hdnCmpDiscPcnt' + index; hdnCmpDiscPcnt.value = con_discpcr; newCell.appendChild(hdnCmpDiscPcnt);
        var hdn_ord_id = document.createElement('input'); hdn_ord_id.type = 'hidden'; hdn_ord_id.id = 'hdn_ord_id' + index; hdn_ord_id.value = order_id; newCell.appendChild(hdn_ord_id);
        var hdnord_det_id = document.createElement('input'); hdnord_det_id.type = 'hidden'; hdnord_det_id.id = 'hdnord_det_id' + index; hdnord_det_id.value = order_det_id; newCell.appendChild(hdnord_det_id);
        var hdnSrv_Name_A = document.createElement('input'); hdnSrv_Name_A.type = 'hidden'; hdnSrv_Name_A.id = 'hdnSrv_Name_A' + index; hdnSrv_Name_A.value = service_name; newCell.appendChild(hdnSrv_Name_A);
        var hdn_ind_doc_id = document.createElement('input'); hdn_ind_doc_id.type = 'hidden'; hdn_ind_doc_id.id = 'hdn_ind_doc_id' + index; hdn_ind_doc_id.value = ''; newCell.appendChild(hdn_ind_doc_id);
        var hdnpatcatid = document.createElement('input'); hdnpatcatid.type = 'hidden'; hdnpatcatid.id = 'hdnpatcatid' + index;
        /*patient Category Mapping Concept*/
        /*is-registered case only@opd reg screen*/
        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons' || form_name == 'OPQUICK' || form_name == 'REG') {
            var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
            var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
            var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
            var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
            if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
            if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
            if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
            if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1)
                hdnpatcatid.value = pat_cat_id;
        }
        newCell.appendChild(hdnpatcatid);
        /*Patient Bill Amount */
        newCell = newRow.insertCell(13);
        var txtPamt = document.createElement('input'); txtPamt.type = 'text';
        txtPamt.className = 'Aright';
        txtPamt.style.width = '97%';
        txtPamt.id = 'txtPamt' + index;
        txtPamt.disabled = true;
        newCell.className = 'pamt gpatamts';
        newCell.appendChild(txtPamt);

        /*Patient Discount In Percent */
        newCell = newRow.insertCell(14);
        var txtDiscP = document.createElement('input'); txtDiscP.type = 'text';
        txtDiscP.className = 'Aright';
        txtDiscP.id = 'txtDiscP' + index;
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscP.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscP.disabled = false; }
        else
        { txtDiscP.disabled = true; }
        txtDiscP.onkeypress = function () { numeralsOnly1(event); };
        txtDiscP.onkeyup = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); };
        txtDiscP.onclick = function () { ClearTextbox(this); }
        txtDiscP.onblur = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); AssignZero(this); }
        newCell.className = 'pdisc gpatamts';
        newCell.appendChild(txtDiscP);

        /*Patient Discount In Flat */
        newCell = newRow.insertCell(15);
        var txtDiscAmt = document.createElement('input'); txtDiscAmt.type = 'text';
        txtDiscAmt.className = 'Aright';
        txtDiscAmt.id = 'txtDiscAmt' + index;
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscAmt.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscAmt.disabled = false; }
        else
        { txtDiscAmt.disabled = true; }
        txtDiscAmt.onkeypress = function () { numeralsOnly1(event); };
        txtDiscAmt.onkeyup = function () { OnPatAmtChange(this, 'PAT', 'amnt'); };
        txtDiscAmt.onclick = function () { ClearTextbox(this); }
        txtDiscAmt.onblur = function () { OnPatAmtChange(this, 'PAT', 'amnt'); AssignZero(this); }
        txtDiscAmt.value = concession_amt;
        newCell.className = 'pdiscamt gpatamts';
        newCell.appendChild(txtDiscAmt);

        /* Patient Net Amt */
        newCell = newRow.insertCell(16);
        var txtPNAmt = document.createElement('input'); txtPNAmt.type = 'text';
        txtPNAmt.className = 'Aright';
        txtPNAmt.id = 'txtPNAmt' + index;
        txtPNAmt.disabled = true;
        newCell.className = 'pnamt gpatamts';
        newCell.appendChild(txtPNAmt);

        var insrenceAmt = 0;
        $('table[id*=GvIns] tr:has(td)').each(function () {
            var insamt = $(this).closest('tr').find('[id*=lblinsamt]').text();
            if (insamt == undefined || insamt == null || insamt == '') { insamt = 0; }
            insrenceAmt = parseFloat(insrenceAmt) + parseFloat(insamt);
        });

        var pattpy = document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value;
        if (parseFloat(insrenceAmt) > 0) {
            pattpy = 2;
        }
        /* Corporate Bill Amt */
        newCell = newRow.insertCell(17);
        var txtCamt = document.createElement('input'); txtCamt.type = 'text';
        txtCamt.className = 'Aright';
        txtCamt.id = 'txtCamt' + index;
        txtCamt.disabled = true;
        if (pattpy == '2')
        { txtCamt.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'camt gcompany';
        newCell.appendChild(txtCamt);

        /* Corporate Disc Pcnt */
        newCell = newRow.insertCell(18);
        var txtCDiscP = document.createElement('input'); txtCDiscP.type = 'text';
        txtCDiscP.className = 'Aright';
        txtCDiscP.id = 'txtCDiscP' + index;
        txtCDiscP.disabled = true;
        if (pattpy == '2')
        { txtCDiscP.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'cdisc gcompany';
        newCell.appendChild(txtCDiscP);

        /* Corporate Disc Amt */
        newCell = newRow.insertCell(19);
        var txtCDiscAmt = document.createElement('input'); txtCDiscAmt.type = 'text';
        txtCDiscAmt.className = 'Aright';
        txtCDiscAmt.id = 'txtCDiscAmt' + index;
        txtCDiscAmt.disabled = true;
        if (pattpy == '2')
        { txtCDiscAmt.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'cdiscamt gcompany';
        newCell.appendChild(txtCDiscAmt);

        /* Corporate Net Amt */
        newCell = newRow.insertCell(20);
        var txtCNetAmt = document.createElement('input'); txtCNetAmt.type = 'text';
        txtCNetAmt.className = 'Aright';
        txtCNetAmt.id = 'txtCNetAmt' + index;
        txtCNetAmt.disabled = true;
        if (pattpy == '2')
        { txtCNetAmt.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'cnamt gcompany';
        newCell.appendChild(txtCNetAmt);

        if (EQUI_SERVICE_NAME == undefined || EQUI_SERVICE_NAME == null || EQUI_SERVICE_NAME == NaN)
        { EQUI_SERVICE_NAME = ''; }

        /*eQUI sERVICE nAME */
        newCell = newRow.insertCell(21);
        var txtEqui_Srv_Name = document.createElement('input'); txtEqui_Srv_Name.type = 'text';
        txtEqui_Srv_Name.id = 'txtEqui_Srv_Name' + index;
        txtEqui_Srv_Name.disabled = true;
        if (pay_type == '1') {
            txtEqui_Srv_Name.value = service_name;
        }
        else {
            txtEqui_Srv_Name.value = EQUI_SERVICE_NAME;
        }
        if (pattpy == '2')
        { txtEqui_Srv_Name.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'Equi_Srv_Name gcompany';
        newCell.appendChild(txtEqui_Srv_Name);


        /*Newly Added By Naresh Begin*/

        /*Newly Added By Naresh Begin*/

        newCell = newRow.insertCell(22);
        var txthcPer = document.createElement('input'); txthcPer.type = 'text';
        txthcPer.id = 'txthcPer' + index;
        txthcPer.className = "Aright";
        txthcPer.onblur = function () { CalConcessionAmount('P'); };
        txthcPer.onkeypress = function () { numeralsOnly1(event) };
        txthcPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "HCPER ghcdisc";
        newCell.appendChild(txthcPer);

        newCell = newRow.insertCell(23);
        var txtHcAmt = document.createElement('input'); txtHcAmt.type = 'text';
        txtHcAmt.id = 'txtHcAmt' + index;
        txtHcAmt.className = "Aright";
        txtHcAmt.disabled = true;
        txtHcAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "HCAMT ghcdisc";
        newCell.appendChild(txtHcAmt);



        newCell = newRow.insertCell(24);
        var txtmaPer = document.createElement('input'); txtmaPer.type = 'text';
        txtmaPer.id = 'txtmaPer' + index;
        txtmaPer.className = "Aright";
        txtmaPer.onkeyup = function () { OnPatDiscPcntChange(this, 'MG'); };
        txtmaPer.onclick = function () { ClearTextbox(this); }
        txtmaPer.onblur = function () { OnPatDiscPcntChange(this, 'MG'); AssignZero(this); }
        txtmaPer.onkeypress = function () { numeralsOnly1(event) };
        txtmaPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "MGPER gmgdisc";
        newCell.appendChild(txtmaPer);

        newCell = newRow.insertCell(25);
        var txtmgAmt = document.createElement('input'); txtmgAmt.type = 'text';
        txtmgAmt.id = 'txtmgAmt' + index;
        txtmgAmt.className = "Aright";
        txtmgAmt.onkeyup = function () { OnPatAmtChange(this, 'MG'); };
        txtmgAmt.onclick = function () { ClearTextbox(this); }
        txtmgAmt.onblur = function () { OnPatAmtChange(this, 'MG'); AssignZero(this); }
        txtmgAmt.onkeypress = function () { numeralsOnly1(event) };
        txtmgAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "MGAMT gmgdisc";
        newCell.appendChild(txtmgAmt);


        newCell = newRow.insertCell(26);
        var txtstPer = document.createElement('input'); txtstPer.type = 'text';
        txtstPer.id = 'txtstPer' + index;
        txtstPer.className = "Aright";
        txtstPer.onkeyup = function () { OnPatDiscPcntChange(this, 'STAF'); };
        txtstPer.onclick = function () { ClearTextbox(this); }
        txtstPer.onblur = function () { OnPatDiscPcntChange(this, 'STAF'); AssignZero(this); }
        txtstPer.onkeypress = function () { numeralsOnly1(event) };
        txtstPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "STAFPER gstdisc";
        newCell.appendChild(txtstPer);


        newCell = newRow.insertCell(27);
        var txtstAmt = document.createElement('input'); txtstAmt.type = 'text';
        txtstAmt.id = 'txtstAmt' + index;
        txtstAmt.className = "Aright";
        txtstAmt.onkeyup = function () { OnPatAmtChange(this, 'STAF'); };
        txtstAmt.onclick = function () { ClearTextbox(this); }
        txtstAmt.onblur = function () { OnPatAmtChange(this, 'STAF'); AssignZero(this); }
        txtstAmt.onkeypress = function () { numeralsOnly1(event) };
        txtstAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "STAMT gstdisc";
        newCell.appendChild(txtstAmt);


        newCell = newRow.insertCell(28);
        var txtebPer = document.createElement('input'); txtebPer.type = 'text';
        txtebPer.id = 'txtebPer' + index;
        txtebPer.className = "Aright";
        txtebPer.onblur = function () { CalConcessionAmount('P'); };
        txtebPer.onkeypress = function () { numeralsOnly1(event) };
        txtebPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "EBPER gevdisc";
        newCell.appendChild(txtebPer);


        newCell = newRow.insertCell(29);
        var txtebAmt = document.createElement('input'); txtebAmt.type = 'text';
        txtebAmt.id = 'txtebAmt' + index;
        txtebAmt.className = "Aright";
        txtebAmt.disabled = true;
        txtebAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "EBAMT gevdisc";
        newCell.appendChild(txtebAmt);

        newCell = newRow.insertCell(30);
        var txtRulePer = document.createElement('input'); txtRulePer.type = 'text';
        txtRulePer.id = 'txtRulePer' + index;
        txtRulePer.className = "Aright";
        txtRulePer.disabled = true;
        txtRulePer.onkeypress = function () { numeralsOnly1(event) };


        newCell.style.display = 'none';

        newCell.className = "CNCRLPER gcrdisc";
        newCell.appendChild(txtRulePer);

        newCell = newRow.insertCell(31);
        var txtcncrlAmt = document.createElement('input'); txtcncrlAmt.type = 'text';
        txtcncrlAmt.id = 'txtcncrlAmt' + index;
        txtcncrlAmt.className = "Aright";
        txtcncrlAmt.disabled = true;
        txtcncrlAmt.onkeypress = function () { numeralsOnly1(event) };

        newCell.style.display = 'none';

        newCell.className = "CNCRLAMT gcrdisc";
        newCell.appendChild(txtcncrlAmt);

        newCell = newRow.insertCell(32);
        var txtremks = document.createElement('input'); txtremks.type = 'text';
        txtremks.id = 'txtremks' + index;
        if (remarks == "0")
            remarks = "";
        if (remarks != undefined) {
            txtremks.value = remarks;
        }
        else {
            txtremks.value = "";
        }
        txtremks.onkeypress = function () { OnNullValue(this) };
        if (is_remarks_mandatory == null || is_remarks_mandatory == undefined || is_remarks_mandatory == '') { is_remarks_mandatory = 'N'; }
        if (is_remarks_mandatory == 'Y') {
            txtremks.className = 'red';
        }
        else
        { txtremks.className = 'grey'; }
        newCell.className = "remarks";
        newCell.appendChild(txtremks);
        
        newCell = newRow.insertCell(33);
        var txttaxper = document.createElement('input'); txttaxper.type = 'text';
        txttaxper.id = 'txttaxper' + index; txttaxper.value = tax_pct;
        txttaxper.className = "Aright";
        txttaxper.disabled = true;
        txttaxper.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "taxper gsttax";
        newCell.appendChild(txttaxper);


        newCell = newRow.insertCell(34);
        var txtptax = document.createElement('input'); txtptax.type = 'text';
        txtptax.id = 'txtptax' + index; txtptax.value = ptax;
        txtptax.className = "Aright";
        txtptax.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "pattax gsttax";
        newCell.appendChild(txtptax);


        newCell = newRow.insertCell(35);
        var txtcmptax = document.createElement('input'); txtcmptax.type = 'text';
        txtcmptax.id = 'txtcmptax' + index; txtcmptax.value = ctax;
        txtcmptax.className = "Aright";
        txtcmptax.disabled = true;

        if (pattpy == '2') {
            if (IsGSTApplicable.toUpperCase() == "YES") {
                txtcmptax.style.display = 'block';
            }
        }
        else
        { newCell.style.display = 'none'; }



        newCell.className = "cmptax gcompany";
        newCell.appendChild(txtcmptax);


    }
    else {
        var hdnServiceClass = document.createElement('input'); hdnServiceClass.type = 'hidden'; hdnServiceClass.id = 'hdnServiceClass' + index; hdnServiceClass.value = service_classID; newCell.appendChild(hdnServiceClass);
        var hdnClass_Srv_ID = document.createElement('input'); hdnClass_Srv_ID.type = 'hidden'; hdnClass_Srv_ID.id = 'hdnClass_Srv_ID' + index;
        if (pkg == 'P' || pkg == 'O') {
            hdnClass_Srv_ID.value = pkg_id;
        }
        else {
            hdnClass_Srv_ID.value = '0';
        }
        newCell.appendChild(hdnClass_Srv_ID);
        var hdnServiceGrpID = document.createElement('input'); hdnServiceGrpID.type = 'hidden'; hdnServiceGrpID.id = 'hdnServiceGrpID' + index; hdnServiceGrpID.value = service_groupID; newCell.appendChild(hdnServiceGrpID);
        var hdnServiceTypID = document.createElement('input'); hdnServiceTypID.type = 'hidden'; hdnServiceTypID.id = 'hdnServiceTypID' + index; hdnServiceTypID.value = Service_typeID; newCell.appendChild(hdnServiceTypID);
        var hdnDoctorID = document.createElement('input'); hdnDoctorID.type = 'hidden'; hdnDoctorID.id = 'hdnDoctorID' + index; hdnDoctorID.value = Doctor_id; newCell.appendChild(hdnDoctorID);

        var hdnDepartment_Id = document.createElement('input'); hdnDepartment_Id.type = 'hidden'; hdnDepartment_Id.id = 'hdnDepartment_Id' + index; hdnDepartment_Id.value = department_id; newCell.appendChild(hdnDepartment_Id);
        var hdnSrv_Type_Name = document.createElement('input'); hdnSrv_Type_Name.type = 'hidden'; hdnSrv_Type_Name.id = 'hdnSrv_Type_Name' + index; hdnSrv_Type_Name.value = service_type; newCell.appendChild(hdnSrv_Type_Name);
        var hdnSrv_Grp_Name = document.createElement('input'); hdnSrv_Grp_Name.type = 'hidden'; hdnSrv_Grp_Name.id = 'hdnSrv_Grp_Name' + index; hdnSrv_Grp_Name.value = service_type; newCell.appendChild(hdnSrv_Grp_Name);
        var hdnPat_Class_Id = document.createElement('input'); hdnPat_Class_Id.type = 'hidden'; hdnPat_Class_Id.id = 'hdnPat_Class_Id' + index; hdnPat_Class_Id.value = '2'; newCell.appendChild(hdnPat_Class_Id);
        var hdnEmergency_Price = document.createElement('input'); hdnEmergency_Price.type = 'hidden'; hdnEmergency_Price.id = 'hdnEmergency_Price' + index;
        if (EMERGENCY_PRICE == undefined || EMERGENCY_PRICE == null || EMERGENCY_PRICE == '') { EMERGENCY_PRICE = "0"; }
        hdnEmergency_Price.value = (EMERGENCY_PRICE); newCell.appendChild(hdnEmergency_Price);
        var hdnNormal_Price = document.createElement('input'); hdnNormal_Price.type = 'hidden'; hdnNormal_Price.id = 'hdnNormal_Price' + index; hdnNormal_Price.value = amount; newCell.appendChild(hdnNormal_Price);
        var hdnTariffId = document.createElement('input'); hdnTariffId.type = 'hidden'; hdnTariffId.id = 'hdnTariffId' + index; hdnTariffId.value = tariff_id; newCell.appendChild(hdnTariffId);
        var hdnhistorytypeID = document.createElement('input'); hdnhistorytypeID.type = 'hidden'; hdnhistorytypeID.id = 'hdnhistorytypeID' + index; hdnhistorytypeID.value = HISTORY_TYPE_ID; newCell.appendChild(hdnhistorytypeID);
        var hdnMin_Price = document.createElement('input'); hdnMin_Price.type = 'hidden'; hdnMin_Price.id = 'hdnMin_Price' + index; hdnMin_Price.value = MIN_PRICE; newCell.appendChild(hdnMin_Price);
        var hdnMax_Price = document.createElement('input'); hdnMax_Price.type = 'hidden'; hdnMax_Price.id = 'hdnMax_Price' + index; hdnMax_Price.value = MAX_PRICE; newCell.appendChild(hdnMax_Price);
        var hdnNo_Nd_Dys = document.createElement('input'); hdnNo_Nd_Dys.type = 'hidden'; hdnNo_Nd_Dys.id = 'hdnNo_Nd_Dys' + index; hdnNo_Nd_Dys.value = NO_NEED_DAYS; newCell.appendChild(hdnNo_Nd_Dys);

        var hdnMedicationType = document.createElement('input'); hdnMedicationType.type = 'hidden'; hdnMedicationType.id = 'hdnMedicationType' + index; newCell.appendChild(hdnMedicationType);
        var hdnDosageqty = document.createElement('input'); hdnDosageqty.type = 'hidden'; hdnDosageqty.id = 'hdnDosageqty' + index; newCell.appendChild(hdnDosageqty);
        var hdnIsTakenToday = document.createElement('input'); hdnIsTakenToday.type = 'hidden'; hdnIsTakenToday.id = 'hdnIsTakenToday' + index; newCell.appendChild(hdnIsTakenToday);
        var hdnLmpCal = document.createElement('input'); hdnLmpCal.type = 'hidden'; hdnLmpCal.id = 'hdnLmpCal' + index; newCell.appendChild(hdnLmpCal);
        var hdnOutherMedic = document.createElement('input'); hdnOutherMedic.type = 'hidden'; hdnOutherMedic.id = 'hdnOutherMedic' + index; newCell.appendChild(hdnOutherMedic);
        var hdncount = document.createElement('input'); hdncount.type = 'hidden'; hdncount.id = 'hdncount' + index; newCell.appendChild(hdncount);

        var hdnCmpDiscPcnt = document.createElement('input'); hdnCmpDiscPcnt.type = 'hidden'; hdnCmpDiscPcnt.id = 'hdnCmpDiscPcnt' + index; hdnCmpDiscPcnt.value = "0"; newCell.appendChild(hdnCmpDiscPcnt);


        var hdn_ord_id = document.createElement('input'); hdn_ord_id.type = 'hidden'; hdn_ord_id.id = 'hdn_ord_id' + index; hdn_ord_id.value = order_id; newCell.appendChild(hdn_ord_id);
        var hdnord_det_id = document.createElement('input'); hdnord_det_id.type = 'hidden'; hdnord_det_id.id = 'hdnord_det_id' + index; hdnord_det_id.value = order_det_id; newCell.appendChild(hdnord_det_id);
        var hdnSrv_Name_A = document.createElement('input'); hdnSrv_Name_A.type = 'hidden'; hdnSrv_Name_A.id = 'hdnSrv_Name_A' + index; hdnSrv_Name_A.value = service_name; newCell.appendChild(hdnSrv_Name_A);

        /*Patient Bill Amount */
        newCell = newRow.insertCell(12);
        var txtPamt = document.createElement('input'); txtPamt.type = 'text';
        txtPamt.className = 'Aright';
        txtPamt.style.width = '97%';
        txtPamt.id = 'txtPamt' + index;
        txtPamt.disabled = true;
        newCell.className = 'pamt gpatamts';
        newCell.appendChild(txtPamt);

        /*Patient Discount In Percent */
        newCell = newRow.insertCell(13);
        var txtDiscP = document.createElement('input'); txtDiscP.type = 'text';
        txtDiscP.className = 'Aright';
        txtDiscP.id = 'txtDiscP' + index;
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscP.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscP.disabled = false; }
        else
        { txtDiscP.disabled = true; }
        txtDiscP.onkeypress = function () { numeralsOnly1(event); };
        txtDiscP.onkeyup = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); };
        txtDiscP.onclick = function () { ClearTextbox(this); }
        txtDiscP.onblur = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); AssignZero(this); }
        newCell.className = 'pdisc gpatamts';
        newCell.appendChild(txtDiscP);

        /*Patient Discount In Flat */
        newCell = newRow.insertCell(14);
        var txtDiscAmt = document.createElement('input'); txtDiscAmt.type = 'text';
        txtDiscAmt.className = 'Aright';
        txtDiscAmt.id = 'txtDiscAmt' + index;
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscAmt.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscAmt.disabled = false; }
        else
        { txtDiscAmt.disabled = true; }
        txtDiscAmt.onkeypress = function () { numeralsOnly1(event); };
        txtDiscAmt.onkeyup = function () { OnPatAmtChange(this, 'PAT', 'amnt'); };
        txtDiscAmt.onclick = function () { ClearTextbox(this); }
        txtDiscAmt.onblur = function () { OnPatAmtChange(this, 'PAT', 'amnt'); AssignZero(this); }
        newCell.className = 'pdiscamt gpatamts';
        newCell.appendChild(txtDiscAmt);

        /* Patient Net Amt */
        newCell = newRow.insertCell(15);
        var txtPNAmt = document.createElement('input'); txtPNAmt.type = 'text';
        txtPNAmt.className = 'Aright';
        txtPNAmt.id = 'txtPNAmt' + index;
        txtPNAmt.disabled = true;
        newCell.className = 'pnamt gpatamts';
        newCell.appendChild(txtPNAmt);
        var insrenceAmt = 0;
        $('table[id*=GvIns] tr:has(td)').each(function () {
            var insamt = $(this).closest('tr').find('[id*=lblinsamt]').text();
            if (insamt == undefined || insamt == null || insamt == '') { insamt = 0; }
            insrenceAmt = parseFloat(insrenceAmt) + parseFloat(insamt);
        });

        if (insrenceAmt == undefined || insrenceAmt == null || insrenceAmt == '') { insrenceAmt = "0"; }

        /* Corporate Bill Amt */
        newCell = newRow.insertCell(16);
        var txtCamt = document.createElement('input'); txtCamt.type = 'text';
        txtCamt.className = 'Aright';
        txtCamt.id = 'txtCamt' + index;
        txtCamt.disabled = true;
        var pattpy = document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value;
        if (parseFloat(insrenceAmt) > 0) {
            pattpy = '2';
        }
        if (pattpy == '2')
        { txtCamt.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'camt gcompany';
        newCell.appendChild(txtCamt);

        /* Corporate Disc Pcnt */
        newCell = newRow.insertCell(17);
        var txtCDiscP = document.createElement('input'); txtCDiscP.type = 'text';
        txtCDiscP.className = 'Aright';
        txtCDiscP.id = 'txtCDiscP' + index;
        txtCDiscP.disabled = true;
        if (pattpy == '2')
        { txtCDiscP.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'cdisc gcompany';
        newCell.appendChild(txtCDiscP);

        /* Corporate Disc Amt */
        newCell = newRow.insertCell(18);
        var txtCDiscAmt = document.createElement('input'); txtCDiscAmt.type = 'text';
        txtCDiscAmt.className = 'Aright';
        txtCDiscAmt.id = 'txtCDiscAmt' + index;
        txtCDiscAmt.disabled = true;
        if (pattpy == '2')
        { txtCDiscAmt.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'cdiscamt gcompany';
        newCell.appendChild(txtCDiscAmt);

        /* Corporate Net Amt */
        newCell = newRow.insertCell(19);
        var txtCNetAmt = document.createElement('input'); txtCNetAmt.type = 'text';
        txtCNetAmt.className = 'Aright';
        txtCNetAmt.id = 'txtCNetAmt' + index;
        txtCNetAmt.disabled = true;
        if (pattpy == '2')
        { txtCNetAmt.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'cnamt gcompany';
        newCell.appendChild(txtCNetAmt);

        if (EQUI_SERVICE_NAME == undefined || EQUI_SERVICE_NAME == null || EQUI_SERVICE_NAME == NaN)
        { EQUI_SERVICE_NAME = ''; }

        /*eQUI sERVICE nAME */
        newCell = newRow.insertCell(20);
        var txtEqui_Srv_Name = document.createElement('input'); txtEqui_Srv_Name.type = 'text';
        txtEqui_Srv_Name.id = 'txtEqui_Srv_Name' + index;
        txtEqui_Srv_Name.disabled = true;
        if (pay_type == '1') {
            txtEqui_Srv_Name.value = service_name;
        }
        else {
            txtEqui_Srv_Name.value = EQUI_SERVICE_NAME;
        }
        newCell.className = 'Equi_Srv_Name';
        if (pattpy == '2')
        { txtEqui_Srv_Name.style.display = 'block'; }
        else
        { newCell.style.display = 'none'; }
        newCell.className = 'Equi_Srv_Name gcompany';
        newCell.appendChild(txtEqui_Srv_Name);

        /*Newly Added By Naresh Begin*/

        newCell = newRow.insertCell(21);
        var txthcPer = document.createElement('input'); txthcPer.type = 'text';
        txthcPer.id = 'txthcPer' + index;
        txthcPer.className = "Aright";
        txthcPer.onblur = function () { CalConcessionAmount('P'); };
        txthcPer.onkeypress = function () { numeralsOnly1(event) };
        txthcPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "HCPER ghcdisc";
        newCell.appendChild(txthcPer);

        newCell = newRow.insertCell(22);
        var txtHcAmt = document.createElement('input'); txtHcAmt.type = 'text';
        txtHcAmt.id = 'txtHcAmt' + index;
        txtHcAmt.className = "Aright";
        txtHcAmt.disabled = true;
        txtHcAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "HCAMT ghcdisc";
        newCell.appendChild(txtHcAmt);



        newCell = newRow.insertCell(23);
        var txtmaPer = document.createElement('input'); txtmaPer.type = 'text';
        txtmaPer.id = 'txtmaPer' + index;
        txtmaPer.className = "Aright";
        txtmaPer.onkeyup = function () { OnPatDiscPcntChange(this, 'MG'); };
        txtmaPer.onclick = function () { ClearTextbox(this); }
        txtmaPer.onblur = function () { OnPatDiscPcntChange(this, 'MG'); AssignZero(this); }
        txtmaPer.onkeypress = function () { numeralsOnly1(event) };
        txtmaPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "MGPER gmgdisc";
        newCell.appendChild(txtmaPer);

        newCell = newRow.insertCell(24);
        var txtmgAmt = document.createElement('input'); txtmgAmt.type = 'text';
        txtmgAmt.id = 'txtmgAmt' + index;
        txtmgAmt.className = "Aright";
        txtmgAmt.onkeyup = function () { OnPatAmtChange(this, 'MG'); };
        txtmgAmt.onclick = function () { ClearTextbox(this); }
        txtmgAmt.onblur = function () { OnPatAmtChange(this, 'MG'); AssignZero(this); }
        txtmgAmt.onkeypress = function () { numeralsOnly1(event) };
        txtmgAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "MGAMT gmgdisc";
        newCell.appendChild(txtmgAmt);


        newCell = newRow.insertCell(25);
        var txtstPer = document.createElement('input'); txtstPer.type = 'text';
        txtstPer.id = 'txtstPer' + index;
        txtstPer.className = "Aright";
        txtstPer.onkeyup = function () { OnPatDiscPcntChange(this, 'STAF'); };
        txtstPer.onclick = function () { ClearTextbox(this); }
        txtstPer.onblur = function () { OnPatDiscPcntChange(this, 'STAF'); AssignZero(this); }
        txtstPer.onkeypress = function () { numeralsOnly1(event) };
        txtstPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "STAFPER gstdisc";
        newCell.appendChild(txtstPer);


        newCell = newRow.insertCell(26);
        var txtstAmt = document.createElement('input'); txtstAmt.type = 'text';
        txtstAmt.id = 'txtstAmt' + index;
        txtstAmt.className = "Aright";
        txtstAmt.onkeyup = function () { OnPatAmtChange(this, 'STAF'); };
        txtstAmt.onclick = function () { ClearTextbox(this); }
        txtstAmt.onblur = function () { OnPatAmtChange(this, 'STAF'); AssignZero(this); }
        txtstAmt.onkeypress = function () { numeralsOnly1(event) };
        txtstAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "STAMT gstdisc";
        newCell.appendChild(txtstAmt);


        newCell = newRow.insertCell(27);
        var txtebPer = document.createElement('input'); txtebPer.type = 'text';
        txtebPer.id = 'txtebPer' + index;
        txtebPer.className = "Aright";
        txtebPer.onblur = function () { CalConcessionAmount('P'); };
        txtebPer.onkeypress = function () { numeralsOnly1(event) };
        txtebPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "EBPER gevdisc";
        newCell.appendChild(txtebPer);


        newCell = newRow.insertCell(28);
        var txtebAmt = document.createElement('input'); txtebAmt.type = 'text';
        txtebAmt.id = 'txtebAmt' + index;
        txtebAmt.className = "Aright";
        txtebAmt.disabled = true;
        txtebAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "EBAMT gevdisc";
        newCell.appendChild(txtebAmt);

        newCell = newRow.insertCell(29);
        var txtRulePer = document.createElement('input'); txtRulePer.type = 'text';
        txtRulePer.id = 'txtRulePer' + index;
        txtRulePer.className = "Aright";
        txtRulePer.disabled = true;
        txtRulePer.onkeypress = function () { numeralsOnly1(event) };

        newCell.style.display = 'none';

        newCell.className = "CNCRLPER gcrdisc";
        newCell.appendChild(txtRulePer);

        newCell = newRow.insertCell(30);
        var txtcncrlAmt = document.createElement('input'); txtcncrlAmt.type = 'text';
        txtcncrlAmt.id = 'txtcncrlAmt' + index;
        txtcncrlAmt.className = "Aright";
        txtcncrlAmt.disabled = true;
        txtcncrlAmt.onkeypress = function () { numeralsOnly1(event) };

        newCell.style.display = 'none';

        newCell.className = "CNCRLAMT gcrdisc";
        newCell.appendChild(txtcncrlAmt);

        newCell = newRow.insertCell(31);
        var txtremks = document.createElement('input'); txtremks.type = 'text';
        txtremks.id = 'txtremks' + index;
        if (remarks == "0")
            remarks = "";
        if (remarks != undefined) {
            txtremks.value = remarks;
        }
        else {
            txtremks.value = "";
        }
        newCell.className = "remarks";
        newCell.appendChild(txtremks);
        var hdnIsRemarks_Mandatory = document.createElement('input'); hdnIsRemarks_Mandatory.type = 'hidden'; hdnIsRemarks_Mandatory.id = 'hdnIsRemarks_Mandatory' + index; hdnIsRemarks_Mandatory.value = IS_REMARKS_MANDATORY; newCell.appendChild(hdnIsRemarks_Mandatory);


        newCell = newRow.insertCell(32);
        var txttaxper = document.createElement('input'); txttaxper.type = 'text';
        txttaxper.id = 'txttaxper' + index; txttaxper.value = tax_pct;
        txttaxper.className = "Aright";
        txttaxper.disabled = true;
        txttaxper.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "taxper gsttax";
        newCell.appendChild(txttaxper);


        newCell = newRow.insertCell(33);
        var txtptax = document.createElement('input'); txtptax.type = 'text';
        txtptax.id = 'txtptax' + index; txtptax.value = ptax;
        txtptax.className = "Aright";
        txtptax.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "pattax gsttax";
        newCell.appendChild(txtptax);


        newCell = newRow.insertCell(34);
        var txtcmptax = document.createElement('input'); txtcmptax.type = 'text';
        txtcmptax.id = 'txtcmptax' + index; txtcmptax.value = ctax;
        txtcmptax.className = "Aright";
        txtcmptax.disabled = true;
        if (pattpy == '2') {
            if (IsGSTApplicable.toUpperCase() == "YES") {
                txtcmptax.style.display = 'block';
            }
        }
        else
        { newCell.style.display = 'none'; }
        newCell.className = "cmptax gcompany";
        newCell.appendChild(txtcmptax);
        /*Newly Added By Naresh End*/


    }

    if (IsGSTApplicable.toUpperCase() == "YES") {
        $(".gsttax").show();

    }
    var Cmp_id = 0;
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        Cmp_id = $('#' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').val();
    }
    else {
        Cmp_id = $('#' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').val();
    }
    if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '') { Cmp_id = '0'; }
    if (parseInt(Cmp_id) > 0) {
        if (pkg == 'R' || pkg == 'I') {
            var Pr1 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri1').value;
            var Pr2 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri2').value;
            var Pr3 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri3').value;
            var Pr4 = document.getElementById('' + ctrlcom + '_UCServices_HdnPri4').value;
            var PrC1 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC1').value;
            var PrC2 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC2').value;
            var PrC3 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC3').value;
            var PrC4 = document.getElementById('' + ctrlcom + '_UCServices_HdnPriC4').value;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=DivColors]').css("display", "block");
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=iframe2]').css("display", "block");

            if (Pr1 == tariff_id) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=DivColors]').css("display", "block");
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("background", PrC1);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("display", "block");
            }
            if (Pr2 == tariff_id) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=DivColors]').css("display", "block");
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("background", PrC2);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("display", "block");

            }
            if (Pr3 == tariff_id) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=DivColors]').css("display", "block");
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("background", PrC3);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("display", "block");

            }
            if (Pr4 == tariff_id) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=DivColors]').css("display", "block");
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("background", PrC4);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=iframe2]').css("display", "block");

            }
        }
    }



    if ($('#ctl00_ContentPlaceHolder1_uccorporate_ddlPaymentBy').val() == 1) {
        if ($('#' + ctrlcom + '_UCServices_hdnconruleid').val() > 0) {
            $('.gcrdisc').show();
        }
        else {
            $('.gcrdisc').hide();
        }
    }
    else {
        $('.gcrdisc').hide();
    }
    var discount_pnt = parseFloat(CMP_DISC_PCNT);

    if (parseFloat(discount_pnt) > 0) {
        if (discount_pnt == null || discount_pnt == '' || discount_pnt == undefined)
        { discount_pnt = 0; }
        if (parseFloat(discount_pnt) > 0) {

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtDiscP]').val(parseFloat(discount_pnt));
            var actcualAmt = 0;
            if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                actcualAmt = EMERGENCY_PRICE;
            }
            else {
                actcualAmt = amount;
            }

            var emp_pcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
            var org_pcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
            if (emp_pcnt == undefined || emp_pcnt == null || emp_pcnt == '') { emp_pcnt = 0; }
            if (org_pcnt == undefined || org_pcnt == null || org_pcnt == '') { org_pcnt = 0; }
            var pAmt = Math.round((parseFloat(actcualAmt) * parseFloat(emp_pcnt)) / 100);
            if (pAmt == undefined || pAmt == null || pAmt == '') { pAmt = 0; }
            var PconAmt = 0;
            PconAmt = Math.round((parseFloat(pAmt) * parseFloat(discount_pnt)) / parseFloat(100));

            var tamt = Math.round((parseFloat(actcualAmt) * (parseFloat(discount_pnt))) / parseFloat(100));
            var eamt = Math.round((parseFloat(pAmt) * (parseFloat(discount_pnt))) / parseFloat(100));
            var camt = Math.round((parseFloat(Math.round((parseFloat(actcualAmt) * parseFloat(org_pcnt)) / 100)) * (parseFloat(discount_pnt))) / parseFloat(100));
            var tecamt = parseFloat(eamt) + parseFloat(camt);
            if (tamt != tecamt) {
                if (parseFloat(tamt) > tecamt) {
                    var dispamt = parseFloat(tamt) - parseFloat(tecamt);

                    PconAmt = parseFloat(PconAmt) + parseFloat(dispamt);
                }
                else if (tecamt > tamt) {
                    var dispamt = parseFloat(tecamt) - parseFloat(tamt);

                    PconAmt = parseFloat(PconAmt) - parseFloat(dispamt);

                }

            }

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('[id*=hdnCmpDiscPcnt]').val(discount_pnt);
            var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);
            $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
            $("#payitem2,._quick-div").show();
            $("._mdisc").css('width', '72%');
            $("#payitem1,#payitem3").hide();
            $('[id*=ConcessionAmt]')[0].style.display = 'none';
            $("#lbladvanced").addClass("select");
            $("#lblquick").removeClass("select");
            document.getElementById('ctl00_ContentPlaceHolder1_ReceiptControl2_ddlDiscountType').disabled = true;
        }
    }



    if (IS_ADDITIONAL == 'Y') {
        var discount_pnt = DISCOUNT_PERCENT;
        if (discount_pnt == null || discount_pnt == '' || discount_pnt == undefined)
        { discount_pnt = 0; }
        if (parseFloat(discount_pnt) > 0) {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtDiscP]').val(discount_pnt);
            var pAmt = 0;
            if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                pAmt = EMERGENCY_PRICE;
            }
            else {
                pAmt = amount;
            }
            var PconAmt = Math.round(parseFloat(pAmt) * parseFloat(discount_pnt) / 100);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtPamt]').val(pAmt);

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
            var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
            pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + rowIndex + ')').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);

            var x = 1;
            var disc_grid_length = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length;
            if (disc_grid_length == 1) {
                fn_AddRowWithDetais();
            }
            $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
            $("#payitem2,._quick-div").show();
            $("._mdisc").css('width', '72%');
            $("#payitem1,#payitem3").hide();
            $('[id*=ConcessionAmt]')[0].style.display = 'none';
            $("#lbladvanced").addClass("select");
            $("#lblquick").removeClass("select");
            document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
            $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
            var hcTotAmt = 0, hcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                var hcAmt = $(this).closest('tr').find("[id*=txtHcAmt]").val();
                var hcPer = $(this).closest("tr").find("[id*=txthcPer]").val();
                var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                if (chamt == undefined || chamt == null || chamt == '')
                { chamt = 0; }
                if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                { chpcnt = 0; }
                typeof hcPer == 'string' ? (typeof hcPer == 'undefined' || hcPer.trim() == '' ? 0 : parseFloat(hcPer)) : (typeof hcPer == 'object' ? 0 : parseFloat(hcPer));
                typeof hcAmt == 'string' ? (typeof hcAmt == 'undefined' || hcAmt.trim() == '' ? 0 : parseFloat(hcAmt)) : (typeof hcAmt == 'object' ? 0 : parseFloat(hcAmt));
                hcTotAmt += parseFloat(hcAmt);
                hcTotPer += parseFloat(hcPer);
                chtotamt += parseFloat(chamt);
                chtotpcnt += parseFloat(chpcnt);
                btot_amt += parseFloat(b_amt);
                ntot_amt += parseFloat(n_amt);
            });
            var chTotalOnPatGrossper = (parseFloat(chtotamt) / parseFloat(btot_amt)) * 100;
            var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
            chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
            chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]')[0].disabled = true;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[0].disabled = true;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]').val(1);
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]').val(2);
        }
    }

    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndex').value = rowIndex;

    if (service_classID == 3 || service_classID == 4) 
    {
        var pkg = 'P';
        if (service_classID == 4) { pkg = 'A'; }
        getpackageincludesingvservices(service_id, tariff_id, pkg, order_id, order_det_id);
        CalculateGridAmt(rowIndex);
    }
    if (pkg != 'P' && pkg != 'O') {
        CalculateGridAmt(rowIndex);
    }
    index++;
    onExtendedGrid();
    AssignSno(rowIndex);
    setTimeout(function () {
        if (slotid == 0) {

            if (service_id == 2 && Doctor_id > 0) {
                if (document.getElementById('' + ctrlcom + '_hdnAppsync').value.toLowerCase() == "true") {
                    if (document.getElementById('' + ctrlcom + '_hdnisapptslotreq').value.toLowerCase() == "true") {
                        BindSlotsCalling(rowIndex);
                    }
                }
            }
        }
    }, 1000);

    ManageAutoAdjustmentWidth();
    var data_grd = document.getElementById("ctl00_ContentPlaceHolder1_UCServices_gvServices").rows.length;
    var scrolwidth = $(".scwidth").width();

    var form_name = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnDocName').value;
    if (form_name == 'OPQUICK' || form_name == 'Cons') {
        if (data_grd >= 3) {
            $("#DivGrid_Body").addClass('sergridH_opd');
            width_change = 'N';
        }
    }
    else {
        if (data_grd >= 8) {
            if (data_grd == 8)
                $("#DivGrid_Header").width($("#DivGrid_Header").width() - scrolwidth);
            $("#DivGrid_Body").addClass('sergridH');
            width_change = 'N';
        }
    }
    onExtendedGrid();
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPasIntgrtnReq').value == "True") {
        DisplayCorpBlock();
    } var hcid = '';
    var hcNo = '';
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    if (form_name == 'OP' || form_name == 'Cons') {
        hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
        hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
    }
    else if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chkhccrd').checked == true) {
            hcid = $('#' + ctrlcom + '_Address1_uchccrdtype__hiddenID').val();
            hcNo = $('#' + ctrlcom + '_Address1_ddhccrdno').find('option:selected').text();

        }
        else {
            hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
            hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
        }
    }
    hcid = hcid == '' ? 0 : hcid;
    hcNo = hcNo == '' ? 0 : hcNo;
    var con_discount_pnt = txt_cruleprc;
    if (hcid > 0) {
        BindPatientHealthCrad(hcid, hcNo);
    }

    else {
        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons') {
            var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        } else {
            if (form_name == 'OPQUICK') {
                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

                } else {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
                }
            }
        }
        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
        { Cmp_id = 0; }
        if (Cmp_id == 0) {

            if (con_ruleId > 0) {

                var con_rule_name = $('#' + ctrlcom + '_UCServices_hdnconrulename').val();

                BindDataPatientconsutionrule(con_ruleId, con_rule_name);
            }
        }
    }

}
/*Newly Added by Naresh Begin*/
function hidecolumnsPageLoad(val) {



    var Hideval = new Array();
    Hideval = val;
    var hide = Hideval.split(',');
    for (var i = 0; i <= hide.length; i++) {
        $(".gvServices-width > tbody > tr > th:nth-child('" + hide[i] + "'),.gvServices-width > tbody > tr > td:nth-child('" + hide[i] + "')").hide();
    }
}
/*Newly Added by Naresh End*/
/*pkg Includes End */
var VisitTypes = new Array();
function BindVisitTypes() {
    //GetAsync("GridService.asmx/BindVisitType",
    GetNonAsync("Private/FrontOffice/OPDBILLNEW.aspx/BindVisitType",
            {},
            function (jdata) {
                var _optionsVal = ''; var _VisitVal = '';
                if (jdata.d != null) {
                    VisitTypes = JSON.parse(jdata.d);
                    jdata = JSON.parse(jdata.d);
                }
                for (var i = 0; i < jdata.length; i++) {
                    //if (jdata[i]["TYPE_OF_CONSULTATION_ID"] == "2" || jdata[i]["TYPE_OF_CONSULTATION_ID"] == "3") {
                        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
                            if (jdata[i]["TYPE_OF_CONSULTATION_CD"].toUpperCase() == "NORMAL" || VisitTypes[i]["TYPE_OF_CONSULTATION_ID"] == "1")
                                _VisitVal += "<OPTION selected value='" + jdata[i]["TYPE_OF_CONSULTATION_ID"] + "'>" + jdata[i]["TYPE_OF_CONSULTATION_NAME"] + "</OPTION>";
                            if (jdata[i]["TYPE_OF_CONSULTATION_CD"].toUpperCase() == "EMER")
                                _VisitVal += "<OPTION  value='" + jdata[i]["TYPE_OF_CONSULTATION_ID"] + "'>" + jdata[i]["TYPE_OF_CONSULTATION_NAME"] + "</OPTION>";
                        }
                        else {
                            //if (jdata[i]["TYPE_OF_CONSULTATION_ID"] == "2" || jdata[i]["TYPE_OF_CONSULTATION_ID"] == "3") {
                                if (jdata[i]["TYPE_OF_CONSULTATION_CD"].toUpperCase() == "NORMAL" || VisitTypes[i]["TYPE_OF_CONSULTATION_ID"] == "1") {
                                    _VisitVal += "<OPTION selected value='" + jdata[i]["TYPE_OF_CONSULTATION_ID"] + "'>" + jdata[i]["TYPE_OF_CONSULTATION_NAME"] + "</OPTION>";
                                }
                                else {
                                    _VisitVal += "<OPTION  value='" + jdata[i]["TYPE_OF_CONSULTATION_ID"] + "'>" + jdata[i]["TYPE_OF_CONSULTATION_NAME"] + "</OPTION>";
                                }
                            //}
                        }
                    //}
                }
                $('[id*=UCServices_gvServices] tr').find('select[id*=ddSType]').empty().html(_VisitVal);
            },
            function () {
            });
}
/* Pop Up Selection Row Click Event */
function onServicesSelection(key) {
    ctl00_ContentPlaceHolder1_UCServices_PanelSrvsLup.style.display = "none";
    var umr_no = ""; var patid = 0;
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val()
        patid = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
    }
    else {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val()
        patid = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup__hiddenID').val();
    }
    if (umr_no == undefined || umr_no == null || umr_no == '') {
        if (patid == undefined || patid == null || patid == '' || patid == '0') {
            $(".stoast").toastText("warning", "Please select umr number  !", 5, 3);
            return false;
        }
    }
    if (key.SRV_GENDER_ID == "1" || key.SRV_GENDER_ID == "2") {
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnGender_ID').value != key.SRV_GENDER_ID) {
            $(".stoast").toastText("warning", "This Service is not Suitable for this Patient", 5, 3);
            return false;
        }
    }
    var pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
    if (parseInt(key.FROM_DAYS) > 0 && parseInt(key.TO_DAYS) > 0) {
        if ((parseInt(key.FROM_DAYS) > parseInt(pat_age)) && (parseInt(pat_age) < parseInt(key.TO_DAYS))) {

        }
        else {
            $(".stoast").toastText("warning", "This Service Applicable Only For '" + parseInt(key.FROM_DAYS) + "' To '" + parseInt(key.TO_DAYS) + "' ", 5, 3);
            return false;
        }
    }
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    /*Package Start Here     */
    var PkgCollection = document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value;
    if ((PkgCollection != NaN) && (PkgCollection != '') && (PkgCollection != undefined)) {
        var PackValue = PkgCollection.split('$');
        if (PackValue.length > 0) {
            var PkgArray = new Array();
            for (var p = 0; p < PackValue.length; p++) {
                var ChildPkgArray = PackValue[p].split('*');

                if (ChildPkgArray[0].length > 0) {
                    var PackNames = ChildPkgArray[0].split(',');
                }
                if (ChildPkgArray[1].length > 0) {
                    var PackVal = ChildPkgArray[1].split(',');
                    for (var j = 0; j < PackVal.length; j++) {
                        PkgArray[pkgCount] = PackVal[j];
                        pkgCount++;
                    }
                }

                if (results.SERVICE_ID == "2") {
                    if ($.inArray(parseInt(key.DOCTOR_ID), PkgArray) == -1) {
                    }
                    else {
                        $(".stoast").toastText("warning", "Service '" + key.SERVICE_NAME + "' Is already exists In '" + PackNames[1] + "' ", 5, 3);
                        document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                        document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();
                        return false;
                    }
                }
                else {
                    if ($.inArray(parseInt(key.SERVICE_ID), PkgArray) == -1) {
                    }
                    else {
                        $(".stoast").toastText("warning", "Service '" + key.SERVICE_NAME + "' Is already exists In '" + PackNames[1] + "' ", 5, 3);
                        return false;
                    }
                }
            }
        }
    }

    /*Package End  */
    if (key.SERVICE_NAME != '') {

        if ($.inArray(parseInt(key.SERVICE_ID), arrServiceIds) == -1) {

            AssignLookupValues(key);
        }
        else {
            $(".stoast").toastText("warning", "Service '" + key.SERVICE_NAME + "' Is already exists.", 5, 3);
            return false;
        }
    }
    return false;
}
function AssignLookupValues(key) {

    $("table[id*=UCServices_gvServices] tr:has(td)").each(function (e) {
        $('#' + ctrlcom + '_UCServices_hdnRowGenCd').val('0');
        if (key.SERVICE_TYPE_ID != '9') {
            var foreign_srv = key.IS_FOREIGN_SERVICE;
            var concernform = key.CONCERN_FORM_REQ;
            var pre_req_On_Srv = key.IS_CLINICAL_HIST_REQ;
            var Guidelines = key.IS_SRV_GUIDELINES_REQUIRED;
            if (Guidelines == '' || Guidelines == null || Guidelines == undefined)
            { Guidelines = 'N'; }
            var is_instruction_req = key.IS_SRV_INSTRUCTION_REQ;
            if (is_instruction_req == '' || is_instruction_req == undefined || is_instruction_req == null) { is_instruction_req = 'N'; }
            var History_types = 'N'
            var His = key.HISTORY_TYPE_ID;
            if (parseInt(His) > 0) {
                History_types = 'Y';
            }
            else {
                History_types = 'N';
            }

            var srv_hist = key.IS_POST;
            var Is_Check_List = results.IS_SRV_CHECKLIST_REQUIRED;
            fn_AddFilterRow(foreign_srv, concernform, pre_req_On_Srv, History_types, srv_hist, Guidelines, Is_Check_List, is_instruction_req);
            $('#' + ctrlcom + '_UCServices_hdnRowGenCd').val('149');
            var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
            if (form_name == 'OP') {
                if (document.getElementById('' + ctrlcom + '_hdnView').value != 'VIEW_OP') {
                    ServicesAutoContextKey();
                }
            }
            else {
                ServicesAutoContextKey();
            }

        }
        if (key != '') {
            if (key.SERVICE_TYPE_ID == '9') {

                getpackageincludesingvservices(key.SERVICE_ID, key.TARIFF_ID, 'G', '0', '0');
                return false;
            }
            else {

                var gvServices = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                var rowIndex = gvServices.rows.length;
                var checkRowIndex = rowIndex - 1;
                var gridindex = 1;
                var ev = this.rowIndex;
                if (ev != undefined && ev != '' && ev != null) { ev = ev; } else { ev = 1; }
                var RowAssign = $('#' + ctrlcom + '_UCServices_hdnRowGenCd').val();
                if (RowAssign == "149") {
                    if (key.SERVICE_ID == '2') {
                        arrServiceIds[checkRowIndex] = parseInt(key.DOCTOR_ID);
                    }
                    else {
                        arrServiceIds[checkRowIndex] = parseInt(key.SERVICE_ID);
                    }
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtServiceName]').val(key.SERVICE_NAME);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtServiceCode]').val(key.SERVICE_CD);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val(key.SERVICE_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnbillingheadid]').val(key.BILLING_HEAD_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtQty]').val("1");
                    var _emer_price = "0";
                    if (key.EMERGENCY_PRICE == undefined && key.EMERGENCY_PRICE == null && key.EMERGENCY_PRICE == '') {
                        _emer_price = key.EMERGENCY_PRICE;
                    }
                    if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(_emer_price);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('2');

                    }
                    else {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').val(key.PRICE);
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('[id*=ddSType]').val('1');

                    }

                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + 1 + ')').find('input[type=text][id*=txtServiceName]').val('');
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceClass]').val(key.SERVICE_CLASS_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val("0");
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val(key.SERVICE_GROUP_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnServiceTypID]').val(key.SERVICE_TYPE_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val(key.DOCTOR_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Type_Name]').val(key.SERVICE_TYPE_NAME);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val(key.SERVICE_GROUP_NAME);

                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnEmergency_Price]').val(key._emer_price);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNormal_Price]').val(key.PRICE);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnTariffId]').val(key.TARIFF_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnhistorytypeID]').val(key.HISTORY_TYPE_ID);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnMin_Price]').val(key.MIN_PRICE);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnMax_Price]').val(key.MAX_PRICE);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnNo_Nd_Dys]').val(key.NO_NEED_DAYS);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(key.CMP_DISC_PCNT);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnrefsrvqty]').val(key.REFRL_QTY);
                    $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtEqui_Srv_Name]').val(key.EQUI_SERVICE_NAME);

                    if (key.SERVICE_CLASS_ID == 3 || key.SERVICE_CLASS_ID == 4) 
                    {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnmax_opt_srvs]').val(key.MAX_OPT_SERVICES_ALLOWED);
                    }
                    else {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=hidden][id*=hdnmax_opt_srvs]').val(0);
                    }
                    if (key.QYT_EDIT == 'Y') {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtQty]').attr("disabled", false);

                    }
                    else {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtQty]').attr("disabled", true);
                    }
                    if (key.RATE_EDIT == 'Y') {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').attr("disabled", false);
                    }
                    else {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').find('input[type=text][id*=txtRate]').attr("disabled", true);
                    }

                    if (key.SERVICE_CLASS_ID == 3 || key.SERVICE_CLASS_ID == 4) 
                    {
                        var pkg = 'P';
                        if (key.SERVICE_CLASS_ID == 4) { pkg = 'A'; }
                        $('#ctl00_ContentPlaceHolder1_UCServices_hdnopt_srv_cnt').val(key.MAX_OPT_SERVICES_ALLOWED);
                        getpackageincludesingvservices(key.SERVICE_ID, key.TARIFF_ID, pkg, '0', '0');
                        return false;
                    }
                    CalculateGridAmt(checkRowIndex);
                    return false;
                }
                else {
                    if (key.SERVICE_ID == '2') {
                        arrServiceIds[this.rowIndex] = parseInt(key.DOCTOR_ID);
                    }
                    else {
                        arrServiceIds[this.rowIndex] = parseInt(key.SERVICE_ID);
                    }
                    $(this).closest('tr').find("input[type=text][id*=txtServiceName]").val(key.SERVICE_NAME);
                    $(this).closest('tr').find("input[type=text][id*=txtServiceCode]").val(key.SERVICE_CD);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val(key.SERVICE_ID);
                    $(this).closest('tr').find("input[type=text][id*=txtQty]").val("1");
                    var _emer_price = "0";
                    if (key.EMERGENCY_PRICE == undefined && key.EMERGENCY_PRICE == null && key.EMERGENCY_PRICE == '') {
                        _emer_price = key.EMERGENCY_PRICE;
                    }
                    if (document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value == 'Y') {
                        $(this).closest('tr').find("input[type=text][id*=txtRate]").val(key._emer_price);
                        $(this).closest('tr').find('[id*=ddSType]').val('2');
                    }
                    else {
                        $(this).closest('tr').find("input[type=text][id*=txtRate]").val(key.PRICE);
                        $(this).closest('tr').find('[id*=ddSType]').val('1');

                    }
                    $(this).closest('tr').find("input[type=hidden][id*=hdnServiceClass]").val(key.SERVICE_CLASS_ID);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val("0");
                    $(this).closest('tr').find("input[type=hidden][id*=hdnServiceGrpID]").val(key.SERVICE_GROUP_ID);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnServiceTypID]").val(key.SERVICE_TYPE_ID);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val(key.DOCTOR_ID);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnSrv_Type_Name]").val(key.SERVICE_TYPE_NAME);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnSrv_Grp_Name]").val(key.SERVICE_GROUP_NAME);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnEmergency_Price]").val(key._emer_price);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnNormal_Price]").val(key.PRICE);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnTariffId]").val(key.TARIFF_ID);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnhistorytypeID]").val(key.HISTORY_TYPE_ID);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnMin_Price]").val(key.MIN_PRICE);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnMax_Price]").val(key.MAX_PRICE);
                    $(this).closest('tr').find("input[type=hidden][id*=hdnNo_Nd_Dys]").val(key.NO_NEED_DAYS);
                    $(this).closest('tr').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(key.CMP_DISC_PCNT);
                    $(this).closest('tr').find('input[type=hidden][id*=hdnrefsrvqty]').val(key.REFRL_QTY);
                    $(this).closest('tr').find('input[type=text][id*=txtEqui_Srv_Name]').val(key.EQUI_SERVICE_NAME);
                    if (key.SERVICE_CLASS_ID == 3 || key.SERVICE_CLASS_ID == 4) 
                    {
                        $(this).closest('tr').find('input[type=hidden][id*=hdnmax_opt_srvs]').val(key.MAX_OPT_SERVICES_ALLOWED);
                    }
                    else {
                        $(this).closest('tr').find('input[type=hidden][id*=hdnmax_opt_srvs]').val(0);
                    }
                    if (key.QYT_EDIT == 'Y') {
                        $(this).closest('tr').find("input[type=text][id*=txtQty]").attr("disabled", false);

                    }
                    else {
                        $(this).closest('tr').find("input[type=text][id*=txtQty]").attr("disabled", true);
                    }
                    if (key.RATE_EDIT == 'Y') {
                        $(this).closest('tr').find("input[type=text][id*=txtRate]").attr("disabled", false);
                    }
                    else {
                        $(this).closest('tr').find("input[type=text][id*=txtRate]").attr("disabled", true);
                    }

                    if (key.SERVICE_CLASS_ID == 3 || key.SERVICE_CLASS_ID == 4) 
                    {
                        var pkg = 'P';
                        if (key.SERVICE_CLASS_ID == 4) { pkg = 'A'; }
                        $('#ctl00_ContentPlaceHolder1_UCServices_hdnopt_srv_cnt').val(key.MAX_OPT_SERVICES_ALLOWED);
                        getpackageincludesingvservices(key.SERVICE_ID, key.TARIFF_ID, pkg, '0', '0');
                        return false;
                    }
                    CalculateGridAmt(this);
                    return false;
                }
            }
        }
    });
}
function GetEmergecnyCheckBox(value) {
    var checkbox;
    checkbox = document.createElement('input'); checkbox.id = value + index; checkbox.type = 'checkbox'; 
    return checkbox;
}

function GetSrvTypeDropDown(value, index) {

    var dropdown;
    dropdown = document.createElement('select');
    dropdown.id = value + index;
    return dropdown;
}
/*Corporate Header Fields Show */
function classDisplayCmpAmts() {
    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    var Pat_cmp = '0';
    var Disc_Count = 0;
    if (form_name == 'OPQUICK') {
        var reg_type = $('#' + ctrlcom + '_ddlRegType').val();
        if (reg_type == '9') {
            Pat_cmp = '2';
        }
        else {
            Pat_cmp = '1';
        }
        var pat_type = $('#' + ctrlcom + '_ddlPatientType').val();
        if (pat_type == '2' || pat_type == '9' || pat_type == '10' || pat_type == '5' || pat_type == '8') {
            Pat_cmp = '2';
        }
        else {
            Pat_cmp = '1';
        }
    }
    else if (form_name == 'OP' || form_name == 'Cons') {
        Pat_cmp = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        var insrenceAmt = 0;
        $('table[id*=GvIns] tr:has(td)').each(function () {
            var insamt = $(this).closest('tr').find('[id*=lblinsamt]').text();
            if (insamt == undefined || insamt == null || insamt == '') { insamt = 0; }
            insrenceAmt = parseFloat(insrenceAmt) + parseFloat(insamt);
        });
        if (insrenceAmt == undefined || insrenceAmt == null || insrenceAmt == '') { insrenceAmt = "0"; }
        if (parseFloat(insrenceAmt) > 0) {
            Pat_cmp = 2;
        }
    }

    var SetBsdBarcd = document.getElementById('' + ctrlcom + '_UCServices_hdnPrePrintedBarcodeReq').value;
    if (Pat_cmp == '2' && SetBsdBarcd == 'Yes') {/* cmp with barcd*/
        $(".gcompany").show();
        $('.barcdhead').show();
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "table-cell";
    }
    else if (Pat_cmp == '2' && SetBsdBarcd != 'Yes') {/* cmp without barcd*/
        $(".gcompany").show();
        $('.barcdhead').hide();
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "table-cell";
    }
    else if (Pat_cmp != '2' && SetBsdBarcd == 'Yes') /*pat with bartcd */
    {
        $(".gcompany").hide();
        $('.barcdhead').show();
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "none";
    }
    else if (Pat_cmp != '2' && SetBsdBarcd != 'Yes') /* pat without barcd */
    {
        $(".gcompany").hide();
        $('.barcdhead').hide();
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "none";
    }

    var IsGSTApplicable = document.getElementById('' + ctrlcom + '_UCServices_hdnisallowgst').value;
    if (Pat_cmp == '2' && IsGSTApplicable.toUpperCase() == "YES") {/* cmp with barcd*/
        $(".gsttax").show();
    }
    else
        $(".gsttax").hide();
    $('.ghcdisc').hide();
    $('.gmgdisc').hide();
    $('.gstdisc').hide();
    $('.gevdisc').hide();
    $('.gcrdisc').hide();
    $('.patient').hide();


}
/*Corporate Header Fields Hide */
function classHideCmpAmts() {

    var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    var Pat_cmp = '0';
    if (form_name == 'OPQUICK') {
        var reg_type = $('#' + ctrlcom + '_ddlRegType').val();
        var ptypevalue = ctl00_ContentPlaceHolder1_ddlPatientType.value;
        if (ptypevalue == "2" || ptypevalue == "5" || ptypevalue == "8" || ptypevalue == "9" || ptypevalue == "10") {
            reg_type = '9';
        }
        if (reg_type == '9') {
            Pat_cmp = '2';
        }
        else {
            Pat_cmp = '1';
        }
    }
    else if (form_name == 'OP' || form_name == 'Cons') {
        Pat_cmp = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
    }

    var SetBsdBarcd = document.getElementById('' + ctrlcom + '_UCServices_hdnPrePrintedBarcodeReq').value;


    var insrenceAmt = 0;
    $('table[id*=GvIns] tr:has(td)').each(function () {
        var insamt = $(this).closest('tr').find('[id*=lblinsamt]').text();
        if (insamt == undefined || insamt == null || insamt == '') { insamt = 0; }
        insrenceAmt = parseFloat(insrenceAmt) + parseFloat(insamt);
    });
    if (parseFloat(insrenceAmt) > 0) {
        Pat_cmp = 2;
    }
    if (Pat_cmp == '2' && SetBsdBarcd == 'Yes') { /* cmp with barcd */
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "table-cell";
        $('.gcompany').show();
        $('.barcdhead').show();
    }
    else if (Pat_cmp == '2' && SetBsdBarcd != 'Yes') { /* cmp without barcd */
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "table-cell";
        $('.gcompany').show();
        $('.barcdhead').hide();
    }
    else if (Pat_cmp != '2' && SetBsdBarcd == 'Yes') { /* pat with barcd */
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "none";
        $('.gcompany').hide();
        $('.barcdhead').show();
    }

    else if (Pat_cmp != '2' && SetBsdBarcd != 'Yes') { /* pat without barcd */
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "none";
        $('.gcompany').hide();
        $('.barcdhead').hide();
    }

    var IsGSTApplicable = document.getElementById('' + ctrlcom + '_UCServices_hdnisallowgst').value;
    if (IsGSTApplicable.toUpperCase() == "YES") {/* gst */
        $(".gsttax").show();
    }

    else {
        $(".gsttax").hide();
    }

    if ($('#' + ctrlcom + '_UCServices_hdnconruleid').val() > 0) {
        $('.gcrdisc').show();
    }
    else {
        $('.gcrdisc').hide();
    }

    $('.ghcdisc').hide();
    $('.gmgdisc').hide();
    $('.gstdisc').hide();
    $('.gevdisc').hide();
    $('.patient').hide();

}

var index = 0;
var rowColor = 0;
if (width_change == 'N')
{ }
else {
    width_change = 'Y';
}
function fn_GetFavourites() {

    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        if (umr_no == '') {
            $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
            return false;
        }
        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
            $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
            $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
            return false;
        }
        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
            if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                return false;
            }
        }


    }
    if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
            if (umr_no == '') {
                $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
                $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }
            }
        }
        else {
            var pat_type = $('#' + ctrlcom + '_ddlPatientType').val();
            if (pat_type == 2 || pat_type == 5 || pat_type == 7 || pat_type == 10) {
                if ($('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }

            }

        }
    }

    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
    if (hdnallowtariffslcn == 'true') {

        var pat_type = '';
        if (form_name == 'OP' || form_name == 'Cons') {
            pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
            }
            else {
                pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
            }
        }
        if (pat_type == 1) {
            var PatientCategory = document.getElementById('' + ctrlcom + '_UCServices_ddlpatcat').value;
            if (PatientCategory == undefined || PatientCategory == null || PatientCategory == '' || PatientCategory == '--select--' || PatientCategory == '0') {
                $(".stoast").toastText("warning", "Please Select Patient Category", 5, 3);
                return false;

            }
            var taiff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;
            if (taiff_id == undefined || taiff_id == null || taiff_id == '' || taiff_id == '--select--' || taiff_id == '0') {
                $(".stoast").toastText("warning", "Please Select Tariff", 5, 3);
                $(".stoast").toastText("warning", "Sorry  No Tariff Mapped To This Patient Category", 5, 2);
                return false;
            }
        }
    }


    FavLst.style.display = "block";
    tbl_Favourites.style.display = "block";
    var fDt = ''; var tDt = ''; var cName = ''; var pText = '';
    var param = param || {};
    var defpagesize = $('[id*=hdninitialgridpagecount]').val();
    if (defpagesize == "" || defpagesize == null || defpagesize == undefined) {
        defpagesize = 10;
    }
    var tariff_id = 1;
    var _count = "0";
    var user_id = document.getElementById('ctl00_hdnUserId').value;
    var company_id = '0';
    var referal_letter_id = '0';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
        var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        else
            referal_letter_id = 0;
        company_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        company_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
    }


    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
    var pat_cat_id = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
    var pat_tariff_id = $('#' + ctrlcom + '_UCServices_ddltariff').val();
    var pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
    if (pat_cat_id == undefined || pat_cat_id == null || pat_cat_id == '' || pat_cat_id == '--select--') { pat_cat_id = 0; }
    if (pat_tariff_id == undefined || pat_tariff_id == null || pat_tariff_id == '' || pat_tariff_id == '--select--') { pat_tariff_id = 0; }
    if (company_id == undefined || company_id == null || company_id == '' || company_id == NaN || company_id == "NaN") { company_id = 0; }
    if (pat_type == undefined || pat_type == null || pat_type == '' || pat_type == '--select--' || pat_type == '0' || pat_type == 0) { pat_type = 1; }
    if (hdnallowtariffslcn == 'true' && parseInt(pat_cat_id) > 0 && parseInt(pat_tariff_id) > 0 && parseInt(pat_type) == 1) {
        tariff_id = pat_tariff_id;
    }

    tariff_id = tariff_id == undefined ? 1 : tariff_id;
    var PAT_CATEGORY_ID = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
    if (PAT_CATEGORY_ID == undefined || PAT_CATEGORY_ID == null || PAT_CATEGORY_ID == '' || PAT_CATEGORY_ID == '--select--') { PAT_CATEGORY_ID = 0; }
    param.pageSize = defpagesize;
    param.pageNum = 1;
    param.dataKey = "SERVICE_ID";
    param.defaultWSParams = { UserId: user_id, Tariff_id: tariff_id, _cName: cName, _pText: pText, _advSrch: '', _company_id: company_id, count: _count, PAT_CATEGORY_ID: PAT_CATEGORY_ID };
    param.wsPath = "GridService.asmx/GetFavourites";
    param.wsFilterPath = "GridService.asmx/GetFavourites";
    param.template = [
                              "SERVICE_NAME*SERVICE_NAME"
                              , "SERVICE_CD*SERVICE_CD"
                              , "SERVICE_TYPE_NAME*SERVICE_TYPE_NAME"
                              , "SERVICE_GROUP*SERVICE_GROUP"];

    param.header = [{ col: "Services ", sort: true, filter: true }
                    , { col: "Services code", sort: true, filter: true }
                    , { col: "Services type", sort: true, filter: true }
                    , { col: "Services Group Name", sort: true, filter: true}];
    param.enablePaging = true;
    param.enableTrace = false;
    param.enableFilter = true;
    param.enableCheckbox = true;
    param.enableSorting = true;
    param.likeLookup = true;
    param.enableDMS = false;
    param.RowNo = true; param.tableTemplate = true;
    param.rowClick = function () {
        favsriviceid = [];
        favserviceres = [];

    }

    FavgridControl = $("#tbl_Favourites").jtable(param);
    return false;
}
function CloseFavlst() {
    $('[id$=FavLst]').hide();

    return false;
}

var favsriviceid = new Array();
var favserviceres = new Array();

function fn_AssignFavs() {
    newprogressbar.style.display = 'block';
    $('table[id$=tbl_Favourites] tbody tr').each(function (e) {
        var len = $('table[id$=tbl_Favourites] tbody tr').length;
        if ($(this).find('.ajaxTablecheckboxtbl_Favourites')[0].checked == true) {

            var _SrvID = $(this).find('.ajaxTablecheckboxtbl_Favourites').attr('data-key');
            var res = FavgridControl.getDataRow(_SrvID);
            favsriviceid.push(_SrvID);
            favserviceres.push(res);
            $("#" + $('[id$=hdnStarIndex]').val() + "").addClass('FavColorAdd');
        }


        if (len == parseFloat(e) + 1) {
            $('[id$=FavLst]').hide();
        }
    });
    var percentage = 0;
    for (var i = 1; i <= favsriviceid.length; i++) {

        (function (index) {
            setTimeout(function () {
                percentage = parseInt(((parseFloat(parseFloat(index)) / favsriviceid.length) * 100), 10);
                if (percentage == undefined || percentage == null || percentage == '' || percentage == "NaN")
                { percentage = 0; }
                $('#message').text('Loading....');
                $(".progressbar-bar").progressbar({
                    value: percentage
                });
                $(".progressbar-label").text(percentage + "% Complete");
                if ($.inArray(parseInt(favsriviceid[parseFloat(parseFloat(index) - 1)]), arrServiceIds) == -1) {
                    OnAssignSerice($('[id*=txtServiceName]'), favserviceres[parseFloat(parseFloat(index) - 1)]);




                    if (favsriviceid.length == parseFloat(index)) {
                        percentage = 0;
                        $(".progressbar-bar").progressbar({
                            value: percentage
                        });
                        $(".progressbar-label").text(percentage + "% Complete");
                        newprogressbar.style.display = 'none';
                    }
                }
                else if (favsriviceid.length == parseFloat(index)) {
                    percentage = 0;
                    $(".progressbar-bar").progressbar({
                        value: percentage
                    });
                    $(".progressbar-label").text(percentage + "% Complete");
                    newprogressbar.style.display = 'none';


                }

            }, i * 0.001);
        })(i);
    }
    if (favsriviceid.length == 0) {

        percentage = 0;
        $(".progressbar-label").text(percentage + "% Complete");
        newprogressbar.style.display = 'none';
    }
    var form_name = $('#ctl00_ContentPlaceHolder1_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var Cmp_id = document.getElementById('ctl00_ContentPlaceHolder1_uccorporate_CmpLookup__hiddenID').value;
    } else {
        if (form_name == 'OPQUICK') {
            if (document.getElementById('ctl00_ContentPlaceHolder1_chk_old').checked == true) {
                var Cmp_id = document.getElementById('ctl00_ContentPlaceHolder1_uccorporate_CmpLookup__hiddenID').value;

            } else {
                var Cmp_id = document.getElementById('ctl00_ContentPlaceHolder1_hdnCompanyID').value;
            }
        }
    }
    if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
    { Cmp_id = 0; }
    var patient_calss_id = document.getElementById('ctl00_ContentPlaceHolder1_UCServices_ddlpatcat').value;
    if (patient_calss_id == undefined || patient_calss_id == null || patient_calss_id == '' || patient_calss_id == '--select--') { patient_calss_id = 0; }
    var taiff_id = document.getElementById('ctl00_ContentPlaceHolder1_UCServices_ddltariff').value;
    if (taiff_id == undefined || taiff_id == null || taiff_id == '')
    { taiff_id = 1; }


    if (Cmp_id == 0) {

        var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
        if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
        { con_ruleId = 0; }
        if (con_ruleId > 0) {

            var con_rule_name = $('#' + ctrlcom + '_UCServices_hdnconrulename').val();

            BindDataPatientconsutionrule(con_ruleId, con_rule_name);
        }
    }

    return false;
}

function fn_Favourites(_serviceID, Index) {
    var user_id = document.getElementById('ctl00_hdnUserId').value;
    GetAsync("GridService.asmx/SaveFavourites",
           { srvId: _serviceID, user_id: user_id },
            function (jdata) {
                if (jdata.d == "D") {
                    $(".stoast").toastText("Info", "Removed From Favourites", 5, 4);
                    $("#" + Index + "").removeClass('FavColorAdd');
                }
                else {
                    $(".stoast").toastText("Info", "Added to Favourites", 5, 1);
                    $("#" + Index + "").addClass('FavColorAdd');

                }
            },
            function () {
            });
}

function fn_AddFilterRow(foreignsrv, concernforn, pre_Cau_On_Srv, History_Types, Srv_History, Guidelines, Srv_checkList, is_instruction_req, is_fav) {
    var gvServices = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var rowIndex = gvServices.rows.length;
    var checkRowIndex = rowIndex - 1;
    var gridindex = 1;
    var newRow = gvServices.insertRow(rowIndex);
    if (rowColor == 0) {
        newRow.className = 'gridAlternaterow'
        rowColor++;
    }
    else {
        newRow.className = 'gridrow'
        rowColor = 0;
    }
    /* sNO aND Colors According To Service Cat */
    var newCell = newRow.insertCell(0);
    var divSno = document.createElement('div'); divSno.id = 'divSno';

    divSno.className = "legendinfo";
    var hdnServiceID = document.createElement('input'); hdnServiceID.type = 'hidden'; hdnServiceID.id = 'hdnServiceID' + index; newCell.appendChild(hdnServiceID);
    var hdnbillingheadid = document.createElement('input'); hdnbillingheadid.type = 'hidden'; hdnbillingheadid.id = 'hdnbillingheadid' + index; newCell.appendChild(hdnbillingheadid);
    var hdnrefsrvqty = document.createElement('input'); hdnrefsrvqty.type = 'hidden'; hdnrefsrvqty.id = 'hdnrefsrvqty' + index; newCell.appendChild(hdnrefsrvqty);
    var hdnItem_id = document.createElement('input'); hdnItem_id.type = 'hidden'; hdnItem_id.id = 'hdnItem_id' + index; newCell.appendChild(hdnItem_id);
    var hdnitem_group_id = document.createElement('input'); hdnitem_group_id.type = 'hidden'; hdnitem_group_id.id = 'hdnitem_group_id' + index; newCell.appendChild(hdnitem_group_id);

    var hdnIsRegInclude = document.createElement('input'); hdnIsRegInclude.type = 'hidden'; hdnIsRegInclude.id = 'hdnIsRegInclude' + index; newCell.appendChild(hdnIsRegInclude);

    var hdnconrequistionsrvid = document.createElement('input'); hdnconrequistionsrvid.type = 'hidden'; hdnconrequistionsrvid.id = 'hdnconrequistionsrvid' + index; newCell.appendChild(hdnconrequistionsrvid);
    var hdnconrequistionid = document.createElement('input'); hdnconrequistionid.type = 'hidden'; hdnconrequistionid.id = 'hdnconrequistionid' + index; newCell.appendChild(hdnconrequistionid);
    var hdncmpruleqty = document.createElement('input'); hdncmpruleqty.type = 'hidden'; hdncmpruleqty.id = 'hdncmpruleqty' + index; newCell.appendChild(hdncmpruleqty);
    var hdnutilizedruleqty = document.createElement('input'); hdnutilizedruleqty.type = 'hidden'; hdnutilizedruleqty.id = 'hdnutilizedruleqty' + index; newCell.appendChild(hdnutilizedruleqty);
    var hdncmprefqty = document.createElement('input'); hdncmprefqty.type = 'hidden'; hdncmprefqty.id = 'hdncmprefqty' + index; newCell.appendChild(hdncmprefqty);
    var hdnutilizedrefqty = document.createElement('input'); hdnutilizedrefqty.type = 'hidden'; hdnutilizedrefqty.id = 'hdnutilizedrefqty' + index; newCell.appendChild(hdnutilizedrefqty);
    var hdnsrvdoctorID = document.createElement('input'); hdnsrvdoctorID.type = 'hidden'; hdnsrvdoctorID.id = 'hdnsrvdoctorID' + index; newCell.appendChild(hdnsrvdoctorID);
    var hdnisdoctorrequired = document.createElement('input'); hdnisdoctorrequired.type = 'hidden'; hdnisdoctorrequired.id = 'hdnisdoctorrequired' + index; newCell.appendChild(hdnisdoctorrequired);
    var hdnisschedulerequired = document.createElement('input'); hdnisschedulerequired.type = 'hidden'; hdnisschedulerequired.id = 'hdnisschedulerequired' + index; newCell.appendChild(hdnisschedulerequired);
    var hdnIsCnsltReqFrSrvPsting = document.createElement('input'); hdnIsCnsltReqFrSrvPsting.type = 'hidden'; hdnIsCnsltReqFrSrvPsting.id = 'hdnIsCnsltReqFrSrvPsting' + index; newCell.appendChild(hdnIsCnsltReqFrSrvPsting);
    var hdnOrgPrice = document.createElement('input'); hdnOrgPrice.type = 'hidden'; hdnOrgPrice.id = 'hdnOrgPrice' + index; hdnOrgPrice.value = ''; newCell.appendChild(hdnOrgPrice);
    var hdnDoctorPrice = document.createElement('input'); hdnDoctorPrice.type = 'hidden'; hdnDoctorPrice.id = 'hdnDoctorPrice' + index; hdnDoctorPrice.value = ''; newCell.appendChild(hdnDoctorPrice);
    var hdnOrgPct = document.createElement('input'); hdnOrgPct.type = 'hidden'; hdnOrgPct.id = 'hdnOrgPct' + index; hdnOrgPct.value = ''; newCell.appendChild(hdnOrgPct);
    var hdnDoctorPct = document.createElement('input'); hdnDoctorPct.type = 'hidden'; hdnDoctorPct.id = 'hdnDoctorPct' + index; hdnDoctorPct.value = ''; newCell.appendChild(hdnDoctorPct);
    var hdnsrvpriceID = document.createElement('input'); hdnsrvpriceID.type = 'hidden'; hdnsrvpriceID.id = 'hdnsrvpriceID' + index; hdnsrvpriceID.value = ''; newCell.appendChild(hdnsrvpriceID);
    var hdntxtDiscP = document.createElement('input'); hdntxtDiscP.type = 'hidden'; hdntxtDiscP.id = 'hdntxtDiscP' + index; hdntxtDiscP.value = ''; newCell.appendChild(hdntxtDiscP);
    var lblSNo = document.createElement('label'); lblSNo.id = 'lblSNo' + index; lblSNo.innerHTML = rowIndex + 1;
    var DivColors = document.createElement('div');
    DivColors.id = 'DivColors' + index; DivColors.className = "slegend";
    if (foreignsrv == 'Y' || concernforn == 'Y') {
        DivColors.style.display = 'block';
    }
    else {
        DivColors.style.display = 'none';
    }
    var iframe = document.createElement('i');
    if (concernforn == 'Y') {
        iframe.className = "cosernform";
    }
    else {
        iframe.style.display = 'none';
    }
    var iframe1 = document.createElement('i');
    if (foreignsrv == 'Y') {
        iframe1.className = "fser";
    }
    else {
        iframe1.style.display = 'none';
    }
    var iframe2 = document.createElement('i');
    iframe2.id = 'iframe2' + index;
    iframe2.className = "Tariff";
    iframe2.style.display = 'none';
    DivColors.appendChild(iframe); DivColors.appendChild(iframe1);
    DivColors.appendChild(iframe2);
    divSno.appendChild(lblSNo);
    divSno.appendChild(DivColors);
    newCell.className = 'sno';
    newCell.appendChild(divSno);
    /* Manage Icons */
    newCell = newRow.insertCell(1);
    var divmanage = document.createElement('div');
    divmanage.className = 'divmanage';

    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPasIntgrtnReq').value == "True") {
        var itaglist = document.createElement('i');
        itaglist.id = 'tagList' + index;
        itaglist.className = "icon-list tooltip";
        itaglist.title = 'Insurance List';
        itaglist.setAttribute("data-tooltip-content", "#tooltip_content");
        itaglist.onclick = function () { return ShowInsuranceDtls(this); }
        divmanage.appendChild(itaglist);
    }

    var imgBtnDelete = document.createElement('i');
    imgBtnDelete.className = 'icon-cancel-circled sdelete';
    imgBtnDelete.id = 'imgBtnDelete' + index;
    imgBtnDelete.onclick = function () { RemoveGridViewService(this) };
    imgBtnDelete.title = 'Remove';
    divmanage.appendChild(imgBtnDelete);

    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
            var imgStar = document.createElement('i');
            imgStar.className = 'su-star-empty FavColor';
            if (is_fav == 'Y') {
                imgStar.className = 'su-star-empty FavColorAdd';
            }
            imgStar.id = 'imgStar' + index;
            imgStar.onclick = function () { fn_Favourites(hdnServiceID.value, imgStar.id) };
            imgStar.title = 'Favourites';
            $('[id$=hdnStarIndex]').val(imgStar.id);
            divmanage.appendChild(imgStar);
        }
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP') {
        var imgStar = document.createElement('i');
        imgStar.className = 'su-star-empty FavColor';
        if (is_fav == 'Y') {
            imgStar.className = 'su-star-empty FavColorAdd';
        }
        imgStar.id = 'imgStar' + index;
        imgStar.onclick = function () { fn_Favourites(hdnServiceID.value, imgStar.id) };
        imgStar.title = 'Favourites';
        $('[id$=hdnStarIndex]').val(imgStar.id);
        divmanage.appendChild(imgStar);
    }
    var imgClinicalHistory = document.createElement('i');
    imgClinicalHistory.className = 'icon-file-powerpoint prerequest';
    imgClinicalHistory.id = 'imgClinicalHistory' + index;
    imgClinicalHistory.onclick = function () { ShowPre_Cus_On_Srvs(this) };
    imgClinicalHistory.title = 'Pre Requisite';
    if (pre_Cau_On_Srv == 'Y') {
        imgClinicalHistory.style.display = 'block';
    }
    else
    { imgClinicalHistory.style.display = 'none'; }
    divmanage.appendChild(imgClinicalHistory);

    var imgbtnhisttype = document.createElement('i');
    imgbtnhisttype.className = 'icon-history historytype';
    imgbtnhisttype.id = 'imgbtnhisttype' + index;
    imgbtnhisttype.onclick = function () { historytype(this) };
    imgbtnhisttype.title = 'History Type';
    if (History_Types == 'Y')
    { imgbtnhisttype.style.display = 'block'; } /* history servicewise noot required */
    else {
        imgbtnhisttype.style.display = 'none';
    }
    divmanage.appendChild(imgbtnhisttype);

    var ImgSrvHist = document.createElement('i');
    ImgSrvHist.className = 'icon-book historytype';
    ImgSrvHist.id = 'ImgSrvHist' + index;
    ImgSrvHist.onclick = function () { ServiceWiseHistory(this) };

    ImgSrvHist.title = 'Service Dtls';
    if (Srv_History == 'Y') {
        ImgSrvHist.style.display = 'block';
    }
    else {
        ImgSrvHist.style.display = 'none';
    }
    divmanage.appendChild(ImgSrvHist);

    var imgSrvShedul = document.createElement('i');
    imgSrvShedul.className = 'icon-calendar historytype';
    imgSrvShedul.id = 'imgSrvShedul' + index;
    imgSrvShedul.onclick = function () { Show_Srv_ScheduleDtls(this) };
    imgSrvShedul.title = 'Service Schedule';

    imgSrvShedul.style.display = 'none';

    divmanage.appendChild(imgSrvShedul);

    var imgconcernforn = document.createElement('i');
    imgconcernforn.className = 'icon-building-filled historytype';
    imgconcernforn.id = 'imgconcernforn' + index;
    imgconcernforn.onclick = function () { Show_concernfornDtls(this) };
    imgconcernforn.title = 'Consent Form Details';
    if (concernforn == 'Y')
    { imgconcernforn.style.display = 'block'; }
    else {
        imgconcernforn.style.display = 'none';
    }

    divmanage.appendChild(imgconcernforn);

    var imgOptionalSrv = document.createElement('i');
    imgOptionalSrv.className = 'icon-doc-1 historytype';
    imgOptionalSrv.id = 'imgOptionalSrv' + index;
    imgOptionalSrv.onclick = function () { Show_OptionalSrvDtls(this) };
    imgOptionalSrv.title = 'Optional Services';

    imgOptionalSrv.style.display = 'none';

    divmanage.appendChild(imgOptionalSrv);

    var chkPstCons = GetEmergecnyCheckBox("chkPstCons");
    chkPstCons.align = 'right';
    chkPstCons.className = "PstCons";
    chkPstCons.onclick = function () { onCheckPostCons(this); };
    chkPstCons.title = 'Post Consultations';
    chkPstCons.style.display = 'none';
    divmanage.appendChild(chkPstCons);

    var imgGuidelines = document.createElement('i');
    imgGuidelines.className = 'icon-building-filled historytype';
    imgGuidelines.id = 'imgGuidelines' + index;
    imgGuidelines.onclick = function () { onGuidelinesClick(this) };
    imgGuidelines.title = 'Guide Lines';
    if (Guidelines == 'Y')
    { imgGuidelines.style.display = 'block'; }
    else {
        imgGuidelines.style.display = 'none';
    }

    divmanage.appendChild(imgGuidelines);

    var imgCheckList = document.createElement('i');
    imgCheckList.className = ' icon-check';
    imgCheckList.id = 'imgCheckList' + index;
    imgCheckList.onclick = function () { onCheckListClick(this) };
    imgCheckList.title = 'Check List';
    if (Srv_checkList == 'Y')
    { imgCheckList.style.display = 'block'; }
    else {
        imgCheckList.style.display = 'none';
    }

    divmanage.appendChild(imgCheckList);
    var imgInstructionList = document.createElement('i');
    imgInstructionList.className = ' icon-check';
    imgInstructionList.id = 'imgInstructionList' + index;
    imgInstructionList.onclick = function () { onCheckInstructionClick(this) };
    imgInstructionList.title = 'Instruction';
    if (is_instruction_req == 'Y')
    { imgInstructionList.style.display = 'block'; }
    else {
        imgInstructionList.style.display = 'none';
    }

    divmanage.appendChild(imgInstructionList);
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnisdoctorrequired').value == 'Y' && document.getElementById('' + ctrlcom + '_UCServices_hdnIsCnsltReqFrSrvPsting').value.toLowerCase() == 'true') {
        var imgsrvdtr = document.createElement('i');
        imgsrvdtr.className = "su-doctor doccl";
        imgsrvdtr.id = 'imgsrvdtr' + index;
        imgsrvdtr.onclick = function () { serviceDoctor(this) };
        imgsrvdtr.title = 'Doctor';
        divmanage.appendChild(imgsrvdtr);
    }

    newCell.className = 'Manage';
    newCell.appendChild(divmanage);
    /* Priv Srv Posted Date */
    newCell = newRow.insertCell(2);
    var txtPriv_Post_Dt = document.createElement('span');
    txtPriv_Post_Dt.id = 'txtPriv_Post_Dt' + index;
    txtPriv_Post_Dt.disabled = true;
    newCell.className = 'PrivPostDt';
    newCell.appendChild(txtPriv_Post_Dt);
    /*Service Name */
    newCell = newRow.insertCell(3);
    var divsrvname = document.createElement('div'); divsrvname.id = 'divsrvname';
    divsrvname.className = "btntxt";
    var txtServiceName = document.createElement('input');
    txtServiceName.type = 'text';
    txtServiceName.className = 'SampleReg';
    txtServiceName.id = 'txtServiceName' + index;
    var divBtnSrc = document.createElement('div');
    divBtnSrc.id = 'divBtnSrc';
    divBtnSrc.className = "txtbtn";
    var BtnSrvSearch = document.createElement('input');
    BtnSrvSearch.type = 'button';
    BtnSrvSearch.className = 'tb_Btn searchbtn';
    BtnSrvSearch.id = 'BtnSrvSearch' + index;
    BtnSrvSearch.align = "right";
    txtServiceName.disabled = true;
    BtnSrvSearch.disabled = true;
    BtnSrvSearch.onclick = function () { OnServicesSearchLookup(this); }
    var lblvisitdetails = document.createElement('label');
    lblvisitdetails.id = 'lblvisitdetails' + index;
    lblvisitdetails.className = "srvdvisit";
    divsrvname.appendChild(txtServiceName);
    divsrvname.appendChild(divBtnSrc);
    divBtnSrc.appendChild(BtnSrvSearch);
    divBtnSrc.appendChild(lblvisitdetails);
    newCell.className = 'sd-name';
    newCell.appendChild(divsrvname);

    /*  Sys.Application.add_init(function () {
    $create(AjaxControlToolkit.AutoCompleteBehavior, { "firstRowSelected": true, "completionListCssClass": "autocomplete_completionListElement", "completionListItemCssClass": "autocomplete_listItem", "highlightedItemCssClass": "autocomplete_highlightedListItem", "id": "autoComplete1" + index, "minimumPrefixLength": 2, "serviceMethod": "GetAllOPServiceAuto", "servicePath": _iniUrl + "ServiceMasterWebService.asmx", "useContextKey": true, "contextKey": "SERVICE_NAME" }, { "itemSelected": OnItemSelection }, null, $get(txtServiceName.id));
    }); */
    /*service Doctor*/
    newCell = newRow.insertCell(4);
    var txtsrvdoctor = document.createElement('input'); txtsrvdoctor.type = 'text';
    txtsrvdoctor.id = 'txtsrvdoctor' + index;
    txtsrvdoctor.disabled = true;
    newCell.className = 'txtsrvdoctor';
    newCell.appendChild(txtsrvdoctor);

    /* Cell Creation Begin*/
    newCell = newRow.insertCell(5);
    var ddldiv1 = document.createElement('div');
    var ddlSlotTiming = document.createElement('select');
    ddlSlotTiming.id = 'ddlSlotTiming' + index;


    var opt = '', _VisitVal = '';
    var _SlotVal = document.createElement("option");
    ddlSlotTiming.options.add(_SlotVal, 0);
    ddlSlotTiming.onchange = function () { return SlotChnage(this); }
    ddldiv1.appendChild(ddlSlotTiming);
    newCell.className = 'Slots';
    newCell.appendChild(ddlSlotTiming);
    /* Cell Creation End*/

    /*Service Code */
    newCell = newRow.insertCell(6);
    var hdnSrvUniCode = document.createElement('input'); hdnSrvUniCode.type = 'hidden'; hdnSrvUniCode.id = 'hdnSrvUniCode' + index; newCell.appendChild(hdnSrvUniCode);
    var hdndoctorpasno = document.createElement('input'); hdndoctorpasno.type = 'hidden'; hdndoctorpasno.id = 'hdndoctorpasno' + index; newCell.appendChild(hdndoctorpasno);
    var hdnUniSrvTypeId = document.createElement('input'); hdnUniSrvTypeId.type = 'hidden'; hdnUniSrvTypeId.id = 'hdnUniSrvTypeId' + index; newCell.appendChild(hdnUniSrvTypeId);
    var hdnDiagnosiscd = document.createElement('input'); hdnDiagnosiscd.type = 'hidden'; hdnDiagnosiscd.id = 'hdnDiagnosiscd' + index; newCell.appendChild(hdnDiagnosiscd);

    var txtServiceCd = document.createElement('input'); txtServiceCd.type = 'text'; txtServiceCd.disabled = true;
    txtServiceCd.id = 'txtServiceCode' + index;
    newCell.className = 'scode';
    var form_name = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnDocName').value;
    if (form_name == 'OP' || form_name == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPasIntgrtnReq').value == "True") {
            txtServiceCd.style.width = "55px";
            var italist = document.createElement('i');
            italist.id = 'tagList' + index;
            italist.className = " icon-info-circled";
            italist.style.float = "right";
            italist.style.width = "15px";
            italist.style.margin = "4px 0px 0px 0px"

            italist.title = 'Info';
            italist.setAttribute("data-tooltip-content", "#tooltip_content");
            italist.onclick = function () { return PasServiceCodesInfo(this); }
            newCell.appendChild(txtServiceCd);
            newCell.appendChild(italist);
        }
        else {
            newCell.appendChild(txtServiceCd);
        }
    }
    else {
        newCell.appendChild(txtServiceCd);
    }
    /*S Types */
    newCell = newRow.insertCell(7);
    var ddldiv = document.createElement('div');
    var ddSType = document.createElement('select');
    ddSType.id = 'ddSType' + index;


    var opt = '', _VisitVal = '';

    for (var i = 0; i < VisitTypes.length; i++) {
        //if (VisitTypes[i]["TYPE_OF_CONSULTATION_ID"] == "2" || VisitTypes[i]["TYPE_OF_CONSULTATION_ID"] == "3") {
            if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
                if (VisitTypes[i]["TYPE_OF_CONSULTATION_CD"].toLowerCase() == "normal" || VisitTypes[i]["TYPE_OF_CONSULTATION_ID"] == "1") {
                    var _VisitVal = document.createElement("option"); _VisitVal.text = VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"]; _VisitVal.value = VisitTypes[i]["TYPE_OF_CONSULTATION_ID"];
                    ddSType.options.add(_VisitVal, i);
                }
                if (VisitTypes[i]["TYPE_OF_CONSULTATION_CD"].toLowerCase() == "emergency") {
                    var _VisitVal = document.createElement("option"); _VisitVal.text = VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"]; _VisitVal.value = VisitTypes[i]["TYPE_OF_CONSULTATION_ID"];
                    ddSType.options.add(_VisitVal, i);
                }
            }
            else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
                var _VisitVal = document.createElement("option");
                _VisitVal.text = VisitTypes[i]["TYPE_OF_CONSULTATION_NAME"];
                _VisitVal.value = VisitTypes[i]["TYPE_OF_CONSULTATION_ID"];
                ddSType.options.add(_VisitVal, i);
            }
        //}
    }
    ddSType.onchange = function () { return DropDownTypeChanges(this); }

    ddldiv.appendChild(ddSType);
    newCell.className = 'stype';
    newCell.appendChild(ddSType);

    /*Qty Textbox */
    newCell = newRow.insertCell(8);
    var txtQty = document.createElement('input'); txtQty.type = 'text';
    txtQty.className = 'Aright';
    txtQty.id = 'txtQty' + index;
    txtQty.maxLength = 3;
    txtQty.onkeypress = function () { numeralsOnly1(event) };
    txtQty.onkeyup = function () { OnQtyChange(this) };
    txtQty.onfocus = function () { CheckCurrentQty(this) };
    txtQty.onblur = function () { OnQtyChange(this) };
    newCell.className = 'Qty';
    newCell.appendChild(txtQty);

    /*Rate */
    newCell = newRow.insertCell(9);
    var txtRate = document.createElement('input'); txtRate.type = 'text';
    txtRate.className = 'Aright';
    txtRate.id = 'txtRate' + index;
    txtRate.onkeypress = function () { numeralsOnly1(event) };
    txtRate.onkeyup = function () { OnRateChange(this) };
    txtRate.onblur = function () { CheckPriceInRange(this); };
    newCell.className = 'charge';
    newCell.appendChild(txtRate);

    /*Amount */
    newCell = newRow.insertCell(10);
    var txtAmount = document.createElement('input'); txtAmount.type = 'text';
    txtAmount.className = 'Aright';
    txtAmount.id = 'txtAmount' + index;
    txtAmount.disabled = true;
    newCell.className = 'amount';
    newCell.appendChild(txtAmount);

    /*Emergency Check Box */
    newCell = newRow.insertCell(11);
    var chkstat = GetEmergecnyCheckBox("chkstat");


    chkstat.onclick = function () { onCheckEmergency(this); };
    if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
        chkstat.style.display = 'none';
    }
    else {
        chkstat.style.display = 'table-cell';
    }
    newCell.className = "stat";
    newCell.appendChild(chkstat);
    var hdnIsEmergency = document.createElement('input'); hdnIsEmergency.type = 'hidden'; hdnIsEmergency.id = 'hdnIsEmergency' + index; hdnIsEmergency.style.textAlign = "center";
    newCell.appendChild(hdnIsEmergency);
    var hdnIsPrerequisit = document.createElement('input'); hdnIsPrerequisit.type = 'hidden'; hdnIsPrerequisit.id = 'hdnIsPrerequisit' + index;
    newCell.appendChild(hdnIsPrerequisit);
    var hdnIsForeignSrv = document.createElement('input'); hdnIsForeignSrv.type = 'hidden'; hdnIsForeignSrv.id = 'hdnIsForeignSrv' + index;
    newCell.appendChild(hdnIsForeignSrv);

    var hdnprorate = document.createElement('input'); hdnprorate.type = 'hidden'; hdnprorate.id = 'hdnprorate' + index;
    newCell.appendChild(hdnprorate);

    var hdnISSamplecoll = document.createElement('input'); hdnISSamplecoll.type = 'hidden'; hdnISSamplecoll.id = 'hdnISSamplecoll' + index; hdnISSamplecoll.style.textAlign = "center";
    newCell.appendChild(hdnISSamplecoll);

    var hdnedit_srv_cd = document.createElement('input'); hdnedit_srv_cd.type = 'hidden'; hdnedit_srv_cd.id = 'hdnedit_srv_cd' + index; hdnedit_srv_cd.style.textAlign = "center";
    newCell.appendChild(hdnedit_srv_cd);

    var hdnmax_opt_srvs = document.createElement('input'); hdnmax_opt_srvs.type = 'hidden'; hdnmax_opt_srvs.id = 'hdnmax_opt_srvs' + index;
    newCell.appendChild(hdnmax_opt_srvs);

    var hdnsrvdates = document.createElement('input'); hdnsrvdates.type = 'hidden'; hdnsrvdates.id = 'hdnsrvdates' + index;
    newCell.appendChild(hdnsrvdates);

    var hdnSrvShcedulSave = document.createElement('input'); hdnSrvShcedulSave.type = 'hidden'; hdnSrvShcedulSave.id = 'hdnSrvShcedulSave' + index; hdnSrvShcedulSave.value = ''; newCell.appendChild(hdnSrvShcedulSave);
    var hdn_is_free_followup = document.createElement('input'); hdn_is_free_followup.type = 'hidden'; hdn_is_free_followup.id = 'hdn_is_free_followup' + index; hdn_is_free_followup.value = _is_free_followup; newCell.appendChild(hdn_is_free_followup);

    var hdn_remarks_mandatory = document.createElement('input'); hdn_remarks_mandatory.type = 'hidden'; hdn_remarks_mandatory.id = 'hdn_remarks_mandatory' + index; hdn_remarks_mandatory.value = is_remarks_mandatory; newCell.appendChild(hdn_remarks_mandatory);

    var hdnTockenNO = document.createElement('input'); hdnTockenNO.type = 'hidden'; hdnTockenNO.id = 'hdnTockenNO' + index; hdnTockenNO.value = ''; newCell.appendChild(hdnTockenNO);
    var hdnreqid = document.createElement('input'); hdnreqid.type = 'hidden'; hdnreqid.id = 'hdnreqid' + index; hdnreqid.value = '0'; newCell.appendChild(hdnreqid);
    var hdnEvent_track_id = document.createElement('input'); hdnEvent_track_id.type = 'hidden'; hdnEvent_track_id.id = 'hdnEvent_track_id' + index; hdnEvent_track_id.value = ''; newCell.appendChild(hdnEvent_track_id);


    if (document.getElementById('' + ctrlcom + '_UCServices_hdnPrePrintedBarcodeReq').value == 'Yes') {
        /*Bar Code */
        newCell = newRow.insertCell(12);
        var txtBarcode = document.createElement('input'); txtBarcode.type = 'text';
        txtBarcode.className = "barcddata";
        txtBarcode.id = 'txtBarcode' + index;
        txtBarcode.onclick = function () { barcodevalidate(this); };

        newCell.className = 'sbarcd';
        newCell.appendChild(txtBarcode);

        var hdnServiceClass = document.createElement('input'); hdnServiceClass.type = 'hidden'; hdnServiceClass.id = 'hdnServiceClass' + index; newCell.appendChild(hdnServiceClass);
        var hdnClass_Srv_ID = document.createElement('input'); hdnClass_Srv_ID.type = 'hidden'; hdnClass_Srv_ID.id = 'hdnClass_Srv_ID' + index; newCell.appendChild(hdnClass_Srv_ID);
        var hdnServiceGrpID = document.createElement('input'); hdnServiceGrpID.type = 'hidden'; hdnServiceGrpID.id = 'hdnServiceGrpID' + index; newCell.appendChild(hdnServiceGrpID);
        var hdnServiceTypID = document.createElement('input'); hdnServiceTypID.type = 'hidden'; hdnServiceTypID.id = 'hdnServiceTypID' + index; newCell.appendChild(hdnServiceTypID);
        var hdnDoctorID = document.createElement('input'); hdnDoctorID.type = 'hidden'; hdnDoctorID.id = 'hdnDoctorID' + index; newCell.appendChild(hdnDoctorID);

        var hdnDepartment_Id = document.createElement('input'); hdnDepartment_Id.type = 'hidden'; hdnDepartment_Id.id = 'hdnDepartment_Id' + index; hdnDepartment_Id.value = '0'; newCell.appendChild(hdnDepartment_Id);
        var hdnSrv_Type_Name = document.createElement('input'); hdnSrv_Type_Name.type = 'hidden'; hdnSrv_Type_Name.id = 'hdnSrv_Type_Name' + index; newCell.appendChild(hdnSrv_Type_Name);
        var hdnSrv_Grp_Name = document.createElement('input'); hdnSrv_Grp_Name.type = 'hidden'; hdnSrv_Grp_Name.id = 'hdnSrv_Grp_Name' + index; newCell.appendChild(hdnSrv_Grp_Name);
        var hdnPat_Class_Id = document.createElement('input'); hdnPat_Class_Id.type = 'hidden'; hdnPat_Class_Id.id = 'hdnPat_Class_Id' + index; newCell.appendChild(hdnPat_Class_Id);
        var hdnEmergency_Price = document.createElement('input'); hdnEmergency_Price.type = 'hidden'; hdnEmergency_Price.id = 'hdnEmergency_Price' + index; newCell.appendChild(hdnEmergency_Price);
        var hdnNormal_Price = document.createElement('input'); hdnNormal_Price.type = 'hidden'; hdnNormal_Price.id = 'hdnNormal_Price' + index; newCell.appendChild(hdnNormal_Price);
        var hdnTariffId = document.createElement('input'); hdnTariffId.type = 'hidden'; hdnTariffId.id = 'hdnTariffId' + index; newCell.appendChild(hdnTariffId);
        var hdnhistorytypeID = document.createElement('input'); hdnhistorytypeID.type = 'hidden'; hdnhistorytypeID.id = 'hdnhistorytypeID' + index; newCell.appendChild(hdnhistorytypeID);
        var hdnMin_Price = document.createElement('input'); hdnMin_Price.type = 'hidden'; hdnMin_Price.id = 'hdnMin_Price' + index; newCell.appendChild(hdnMin_Price);
        var hdnMax_Price = document.createElement('input'); hdnMax_Price.type = 'hidden'; hdnMax_Price.id = 'hdnMax_Price' + index; newCell.appendChild(hdnMax_Price);
        var hdnNo_Nd_Dys = document.createElement('input'); hdnNo_Nd_Dys.type = 'hidden'; hdnNo_Nd_Dys.id = 'hdnNo_Nd_Dys' + index; newCell.appendChild(hdnNo_Nd_Dys);
        var hdnMedicationType = document.createElement('input'); hdnMedicationType.type = 'hidden'; hdnMedicationType.id = 'hdnMedicationType' + index; newCell.appendChild(hdnMedicationType);
        var hdnDosageqty = document.createElement('input'); hdnDosageqty.type = 'hidden'; hdnDosageqty.id = 'hdnDosageqty' + index; newCell.appendChild(hdnDosageqty);
        var hdnIsTakenToday = document.createElement('input'); hdnIsTakenToday.type = 'hidden'; hdnIsTakenToday.id = 'hdnIsTakenToday' + index; newCell.appendChild(hdnIsTakenToday);
        var hdnLmpCal = document.createElement('input'); hdnLmpCal.type = 'hidden'; hdnLmpCal.id = 'hdnLmpCal' + index; newCell.appendChild(hdnLmpCal);
        var hdnOutherMedic = document.createElement('input'); hdnOutherMedic.type = 'hidden'; hdnOutherMedic.id = 'hdnOutherMedic' + index; newCell.appendChild(hdnOutherMedic);
        var hdncount = document.createElement('input'); hdncount.type = 'hidden'; hdncount.id = 'hdncount' + index; newCell.appendChild(hdncount);
        var hdnCmpDiscPcnt = document.createElement('input'); hdnCmpDiscPcnt.type = 'hidden'; hdnCmpDiscPcnt.id = 'hdnCmpDiscPcnt' + index; newCell.appendChild(hdnCmpDiscPcnt);
        var hdn_ord_id = document.createElement('input'); hdn_ord_id.type = 'hidden'; hdn_ord_id.id = 'hdn_ord_id' + index; newCell.appendChild(hdn_ord_id);
        var hdnord_det_id = document.createElement('input'); hdnord_det_id.type = 'hidden'; hdnord_det_id.id = 'hdnord_det_id' + index; newCell.appendChild(hdnord_det_id);
        var hdnSrv_Name_A = document.createElement('input'); hdnSrv_Name_A.type = 'hidden'; hdnSrv_Name_A.id = 'hdnSrv_Name_A' + index; newCell.appendChild(hdnSrv_Name_A);
        var hdnSrvGenderId = document.createElement('input'); hdnSrvGenderId.type = 'hidden'; hdnSrvGenderId.id = 'hdnSrvGenderId' + index; hdnSrvGenderId.value = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvGenderId').value; newCell.appendChild(hdnSrvGenderId);
        var hdnSrvFDays = document.createElement('input'); hdnSrvFDays.type = 'hidden'; hdnSrvFDays.id = 'hdnSrvFDays' + index; hdnSrvFDays.value = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFDays').value; newCell.appendChild(hdnSrvFDays);
        var hdnSrvTDays = document.createElement('input'); hdnSrvTDays.type = 'hidden'; hdnSrvTDays.id = 'hdnSrvTDays' + index; hdnSrvTDays.value = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvTDays').value; newCell.appendChild(hdnSrvTDays);
        var hdnpatcatid = document.createElement('input'); hdnpatcatid.type = 'hidden'; hdnpatcatid.id = 'hdnpatcatid' + index; newCell.appendChild(hdnpatcatid);
        var hdnrateexcgst = document.createElement('input'); hdnrateexcgst.type = 'hidden'; hdnrateexcgst.id = 'hdnrateexcgst' + index; newCell.appendChild(hdnrateexcgst);
        var hdntaxpct = document.createElement('input'); hdntaxpct.type = 'hidden'; hdntaxpct.id = 'hdntaxpct' + index; newCell.appendChild(hdntaxpct);
        var hdncruleid = document.createElement('input'); hdncruleid.type = 'hidden'; hdncruleid.id = 'hdncruleid' + index; newCell.appendChild(hdncruleid);
        var hdncrulepct = document.createElement('input'); hdncrulepct.type = 'hidden'; hdncrulepct.id = 'hdncrulepct' + index; newCell.appendChild(hdncrulepct);
        var hdncrulename = document.createElement('input'); hdncrulename.type = 'hidden'; hdncrulename.id = 'hdncrulename' + index; newCell.appendChild(hdncrulename);
        var hdntaxamount = document.createElement('input'); hdntaxamount.type = 'hidden'; hdntaxamount.id = 'hdntaxamount' + index; newCell.appendChild(hdntaxamount);
        var hdncruledefindid = document.createElement('input'); hdncruledefindid.type = 'hidden'; hdncruledefindid.id = 'hdncruledefindid' + index; newCell.appendChild(hdncruledefindid);
        var hdncruledefindby = document.createElement('input'); hdncruledefindby.type = 'hidden'; hdncruledefindby.id = 'hdncruledefindby' + index; newCell.appendChild(hdncruledefindby);
        var hdnsgstpct = document.createElement('input'); hdnsgstpct.type = 'hidden'; hdnsgstpct.id = 'hdnsgstpct' + index; newCell.appendChild(hdnsgstpct);
        var hdncgstpct = document.createElement('input'); hdncgstpct.type = 'hidden'; hdncgstpct.id = 'hdncgstpct' + index; newCell.appendChild(hdncgstpct);
        var hdnsgstamount = document.createElement('input'); hdnsgstamount.type = 'hidden'; hdnsgstamount.id = 'hdnsgstamount' + index; newCell.appendChild(hdnsgstamount);
        var hdncgstamount = document.createElement('input'); hdncgstamount.type = 'hidden'; hdncgstamount.id = 'hdncgstamount' + index; newCell.appendChild(hdncgstamount);
        var hdnsaccd = document.createElement('input'); hdnsaccd.type = 'hidden'; hdnsaccd.id = 'hdnsaccd' + index; newCell.appendChild(hdnsaccd);

        var hdnnetamountold = document.createElement('input'); hdnnetamountold.type = 'hidden'; hdnnetamountold.id = 'hdnnetamountold' + index; newCell.appendChild(hdnnetamountold);
        var hdncursamountold = document.createElement('input'); hdncursamountold.type = 'hidden'; hdncursamountold.id = 'hdncursamountold' + index; newCell.appendChild(hdncursamountold);
        var hdnmanagementoldamt = document.createElement('input'); hdnmanagementoldamt.type = 'hidden'; hdnmanagementoldamt.id = 'hdnmanagementoldamt' + index; newCell.appendChild(hdnmanagementoldamt);
        var hdnstaffoldamt = document.createElement('input'); hdnstaffoldamt.type = 'hidden'; hdnstaffoldamt.id = 'hdnstaffoldamt' + index; newCell.appendChild(hdnstaffoldamt);
        var hdncasholdamt = document.createElement('input'); hdncasholdamt.type = 'hidden'; hdncasholdamt.id = 'hdncasholdamt' + index; newCell.appendChild(hdncasholdamt);
        
        newCell = newRow.insertCell(13);
        var txtPamt = document.createElement('input'); txtPamt.type = 'text';
        txtPamt.className = 'Aright';
        txtPamt.style.width = '97%';
        txtPamt.id = 'txtPamt' + index;
        txtPamt.disabled = true;
        newCell.className = 'pamt gpatamts';
        newCell.appendChild(txtPamt);

        /* Patient Discount In Percent */
        newCell = newRow.insertCell(14);
        var txtDiscP = document.createElement('input'); txtDiscP.type = 'text';
        txtDiscP.className = 'Aright';
        txtDiscP.id = 'txtDiscP' + index;
        txtDiscP.onkeypress = function () { numeralsOnly1(event); OnPatDiscPcntChange(this, 'PAT', 'disc'); AssignZero(this); };
        txtDiscP.onkeyup = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); };
        txtDiscP.onclick = function () { ClearTextbox(this); }
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscP.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscP.disabled = false; }
        else
        { txtDiscP.disabled = true; }
        txtDiscP.onpaste = function () { return false; }
        newCell.className = 'pdisc gpatamts';
        newCell.appendChild(txtDiscP);

        /* Patient Discount In Flat */
        newCell = newRow.insertCell(15);
        var txtDiscAmt = document.createElement('input'); txtDiscAmt.type = 'text';
        txtDiscAmt.className = 'Aright';
        txtDiscAmt.id = 'txtDiscAmt' + index;
        txtDiscAmt.onkeypress = function () { numeralsOnly1(event); OnPatAmtChange(this, 'PAT', 'amnt'); AssignZero(this); };
        txtDiscAmt.onkeyup = function () { OnPatAmtChange(this, 'PAT', 'amnt'); };
        txtDiscAmt.onclick = function () { ClearTextbox(this); }
        
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscAmt.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscAmt.disabled = false; }
        else
        { txtDiscAmt.disabled = true; }
        txtDiscAmt.onpaste = function () { return false; }
        newCell.className = 'pdiscamt gpatamts';
        newCell.appendChild(txtDiscAmt);

        /* Patient Net Amt */
        newCell = newRow.insertCell(16);
        var txtPNAmt = document.createElement('input'); txtPNAmt.type = 'text';
        txtPNAmt.className = 'Aright';
        txtPNAmt.id = 'txtPNAmt' + index;
        txtPNAmt.disabled = true;
        newCell.className = 'pnamt gpatamts';
        newCell.appendChild(txtPNAmt);

        newCell = newRow.insertCell(17);
        /* CRedit Bill Amount */
        var txtCamt = document.createElement('input'); txtCamt.type = 'text';
        txtCamt.className = 'Aright';
        txtCamt.id = 'txtCamt' + index;
        txtCamt.disabled = true;
        var paymentby = document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value;
        if (paymentby == '2') {
            txtCamt.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'camt gcompany';
        newCell.appendChild(txtCamt);

        /* Credit Discount In Percent */
        newCell = newRow.insertCell(18);
        var txtCDiscP = document.createElement('input'); txtCDiscP.type = 'text';
        txtCDiscP.className = 'Aright';
        txtCDiscP.id = 'txtCDiscP' + index;
        txtCDiscP.disabled = true;
        if (paymentby == '2') {
            txtCDiscP.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'cdisc gcompany';
        newCell.appendChild(txtCDiscP);

        /* Credit Discount In Flat */
        newCell = newRow.insertCell(19);
        var txtCDiscAmt = document.createElement('input'); txtCDiscAmt.type = 'text';
        txtCDiscAmt.className = 'Aright';
        txtCDiscAmt.id = 'txtCDiscAmt' + index;
        txtCDiscAmt.disabled = true;
        if (paymentby == '2') {
            txtCDiscAmt.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'cdiscamt gcompany';
        newCell.appendChild(txtCDiscAmt);

        /* Credit Net Amount */
        newCell = newRow.insertCell(20);
        var txtCNetAmt = document.createElement('input'); txtCNetAmt.type = 'text';
        txtCNetAmt.className = 'Aright';
        txtCNetAmt.id = 'txtCNetAmt' + index;
        txtCNetAmt.disabled = true;
        if (paymentby == '2') {
            txtCNetAmt.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'cnamt gcompany';
        newCell.appendChild(txtCNetAmt);

        /*eQUI sERVICE nAME fOR CORPORATE */
        newCell = newRow.insertCell(21);
        var txtEqui_Srv_Name = document.createElement('input'); txtEqui_Srv_Name.type = 'text';
        txtEqui_Srv_Name.id = 'txtEqui_Srv_Name' + index;
        txtEqui_Srv_Name.disabled = true;
        if (paymentby == '2') {
            txtEqui_Srv_Name.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'Equi_Srv_Name gcompany';
        newCell.appendChild(txtEqui_Srv_Name);


        /*Newly Added By Naresh Begin*/

        newCell = newRow.insertCell(22);
        var txthcPer = document.createElement('input'); txthcPer.type = 'text';
        txthcPer.id = 'txthcPer' + index;
        txthcPer.className = "Aright";
        txthcPer.onblur = function () { CalConcessionAmount('P'); };
        txthcPer.onkeypress = function () { numeralsOnly1(event) };
        txthcPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "HCPER ghcdisc";
        newCell.appendChild(txthcPer);

        newCell = newRow.insertCell(23);
        var txtHcAmt = document.createElement('input'); txtHcAmt.type = 'text';
        txtHcAmt.id = 'txtHcAmt' + index;
        txtHcAmt.className = "Aright";
        txtHcAmt.disabled = true;
        txtHcAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "HCAMT ghcdisc";
        newCell.appendChild(txtHcAmt);



        newCell = newRow.insertCell(24);
        var txtmaPer = document.createElement('input'); txtmaPer.type = 'text';
        txtmaPer.id = 'txtmaPer' + index;
        txtmaPer.className = "Aright";
        txtmaPer.onkeyup = function () { OnPatDiscPcntChange(this, 'MG'); };
        txtmaPer.onclick = function () { ClearTextbox(this); }
        txtmaPer.onblur = function () { OnPatDiscPcntChange(this, 'MG'); AssignZero(this); }
        txtmaPer.onkeypress = function () { numeralsOnly1(event) };
        txtmaPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "MGPER gmgdisc";
        newCell.appendChild(txtmaPer);

        newCell = newRow.insertCell(25);
        var txtmgAmt = document.createElement('input'); txtmgAmt.type = 'text';
        txtmgAmt.id = 'txtmgAmt' + index;
        txtmgAmt.className = "Aright";
        txtmgAmt.onkeyup = function () { OnPatAmtChange(this, 'MG'); };
        txtmgAmt.onclick = function () { ClearTextbox(this); }
        txtmgAmt.onblur = function () { OnPatAmtChange(this, 'MG'); AssignZero(this); }
        txtmgAmt.onkeypress = function () { numeralsOnly1(event) };
        txtmgAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "MGAMT gmgdisc";
        newCell.appendChild(txtmgAmt);


        newCell = newRow.insertCell(26);
        var txtstPer = document.createElement('input'); txtstPer.type = 'text';
        txtstPer.id = 'txtstPer' + index;
        txtstPer.className = "Aright";
        txtstPer.onkeyup = function () { OnPatDiscPcntChange(this, 'STAF'); };
        txtstPer.onclick = function () { ClearTextbox(this); }
        txtstPer.onblur = function () { OnPatDiscPcntChange(this, 'STAF'); AssignZero(this); }
        txtstPer.onkeypress = function () { numeralsOnly1(event) };
        txtstPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "STAFPER gstdisc";
        newCell.appendChild(txtstPer);


        newCell = newRow.insertCell(27);
        var txtstAmt = document.createElement('input'); txtstAmt.type = 'text';
        txtstAmt.id = 'txtstAmt' + index;
        txtstAmt.className = "Aright";
        txtstAmt.onkeyup = function () { OnPatAmtChange(this, 'STAF'); };
        txtstAmt.onclick = function () { ClearTextbox(this); }
        txtstAmt.onblur = function () { OnPatAmtChange(this, 'STAF'); AssignZero(this); }
        txtstAmt.onkeypress = function () { numeralsOnly1(event) };
        txtstAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "STAMT gstdisc";
        newCell.appendChild(txtstAmt);


        newCell = newRow.insertCell(28);
        var txtebPer = document.createElement('input'); txtebPer.type = 'text';
        txtebPer.id = 'txtebPer' + index;
        txtebPer.className = "Aright";
        txtebPer.onblur = function () { CalConcessionAmount('P'); };
        txtebPer.onkeypress = function () { numeralsOnly1(event) };
        txtebPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "EBPER gevdisc";
        newCell.appendChild(txtebPer);


        newCell = newRow.insertCell(29);
        var txtebAmt = document.createElement('input'); txtebAmt.type = 'text';
        txtebAmt.id = 'txtebAmt' + index;
        txtebAmt.className = "Aright";
        txtebAmt.disabled = true;
        txtebAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "EBAMT gevdisc";
        newCell.appendChild(txtebAmt);

        newCell = newRow.insertCell(30);
        var txtRulePer = document.createElement('input'); txtRulePer.type = 'text';
        txtRulePer.id = 'txtRulePer' + index;
        txtRulePer.className = "Aright";
        txtRulePer.disabled = true;
        txtRulePer.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "CNCRLPER gcrdisc";
        newCell.appendChild(txtRulePer);

        newCell = newRow.insertCell(31);
        var txtcncrlAmt = document.createElement('input'); txtcncrlAmt.type = 'text';
        txtcncrlAmt.id = 'txtcncrlAmt' + index;
        txtcncrlAmt.className = "Aright";
        txtcncrlAmt.disabled = true;
        txtcncrlAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "CNCRLAMT gcrdisc";
        newCell.appendChild(txtcncrlAmt);

        newCell = newRow.insertCell(32);
        var txtremks = document.createElement('input'); txtremks.type = 'text';
        txtremks.id = 'txtremks' + index;
        if (is_remarks_mandatory == null || is_remarks_mandatory == undefined || is_remarks_mandatory == '') { is_remarks_mandatory = 'N'; }
        txtremks.onkeypress = function () { OnNullValue(this) };
        if (is_remarks_mandatory == 'Y') {
            txtremks.className = 'red';
        }
        else { txtremks.className = 'grey'; }
        newCell.className = "remarks";
        newCell.appendChild(txtremks);

        newCell = newRow.insertCell(33);
        var txttaxper = document.createElement('input'); txttaxper.type = 'text';
        txttaxper.id = 'txttaxper' + index;
        txttaxper.className = "Aright";
        txttaxper.disabled = true;
        txttaxper.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "taxper gsttax";
        newCell.appendChild(txttaxper);


        newCell = newRow.insertCell(34);
        var txtptax = document.createElement('input'); txtptax.type = 'text';
        txtptax.id = 'txtptax' + index;
        txtptax.className = "Aright";
        txtptax.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "pattax gsttax";
        newCell.appendChild(txtptax);


        newCell = newRow.insertCell(35);
        var txtcmptax = document.createElement('input'); txtcmptax.type = 'text';
        txtcmptax.id = 'txtcmptax' + index;
        txtcmptax.className = "Aright";
        txtcmptax.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "cmptax gcompany";
        newCell.appendChild(txtcmptax);

        var hdnIsRemarks_Mandatory = document.createElement('input'); hdnIsRemarks_Mandatory.type = 'hidden'; hdnIsRemarks_Mandatory.id = 'hdnIsRemarks_Mandatory' + index; newCell.appendChild(hdnIsRemarks_Mandatory);
        /*Newly Added By Naresh End*/
    }
    else {
        var hdnServiceClass = document.createElement('input'); hdnServiceClass.type = 'hidden'; hdnServiceClass.id = 'hdnServiceClass' + index; newCell.appendChild(hdnServiceClass);
        var hdnClass_Srv_ID = document.createElement('input'); hdnClass_Srv_ID.type = 'hidden'; hdnClass_Srv_ID.id = 'hdnClass_Srv_ID' + index; newCell.appendChild(hdnClass_Srv_ID);
        var hdnServiceGrpID = document.createElement('input'); hdnServiceGrpID.type = 'hidden'; hdnServiceGrpID.id = 'hdnServiceGrpID' + index; newCell.appendChild(hdnServiceGrpID);
        var hdnServiceTypID = document.createElement('input'); hdnServiceTypID.type = 'hidden'; hdnServiceTypID.id = 'hdnServiceTypID' + index; newCell.appendChild(hdnServiceTypID);
        var hdnDoctorID = document.createElement('input'); hdnDoctorID.type = 'hidden'; hdnDoctorID.id = 'hdnDoctorID' + index; newCell.appendChild(hdnDoctorID);
        var hdnDepartment_Id = document.createElement('input'); hdnDepartment_Id.type = 'hidden'; hdnDepartment_Id.id = 'hdnDepartment_Id' + index; hdnDepartment_Id.value = '0'; newCell.appendChild(hdnDepartment_Id);
        var hdnSrv_Type_Name = document.createElement('input'); hdnSrv_Type_Name.type = 'hidden'; hdnSrv_Type_Name.id = 'hdnSrv_Type_Name' + index; newCell.appendChild(hdnSrv_Type_Name);
        var hdnSrv_Grp_Name = document.createElement('input'); hdnSrv_Grp_Name.type = 'hidden'; hdnSrv_Grp_Name.id = 'hdnSrv_Grp_Name' + index; newCell.appendChild(hdnSrv_Grp_Name);
        var hdnPat_Class_Id = document.createElement('input'); hdnPat_Class_Id.type = 'hidden'; hdnPat_Class_Id.id = 'hdnPat_Class_Id' + index; newCell.appendChild(hdnPat_Class_Id);
        var hdnEmergency_Price = document.createElement('input'); hdnEmergency_Price.type = 'hidden'; hdnEmergency_Price.id = 'hdnEmergency_Price' + index; newCell.appendChild(hdnEmergency_Price);
        var hdnNormal_Price = document.createElement('input'); hdnNormal_Price.type = 'hidden'; hdnNormal_Price.id = 'hdnNormal_Price' + index; newCell.appendChild(hdnNormal_Price);
        var hdnTariffId = document.createElement('input'); hdnTariffId.type = 'hidden'; hdnTariffId.id = 'hdnTariffId' + index; newCell.appendChild(hdnTariffId);
        var hdnhistorytypeID = document.createElement('input'); hdnhistorytypeID.type = 'hidden'; hdnhistorytypeID.id = 'hdnhistorytypeID' + index; newCell.appendChild(hdnhistorytypeID);
        var hdnMin_Price = document.createElement('input'); hdnMin_Price.type = 'hidden'; hdnMin_Price.id = 'hdnMin_Price' + index; newCell.appendChild(hdnMin_Price);
        var hdnMax_Price = document.createElement('input'); hdnMax_Price.type = 'hidden'; hdnMax_Price.id = 'hdnMax_Price' + index; newCell.appendChild(hdnMax_Price);
        var hdnNo_Nd_Dys = document.createElement('input'); hdnNo_Nd_Dys.type = 'hidden'; hdnNo_Nd_Dys.id = 'hdnNo_Nd_Dys' + index; newCell.appendChild(hdnNo_Nd_Dys);
        var hdnMedicationType = document.createElement('input'); hdnMedicationType.type = 'hidden'; hdnMedicationType.id = 'hdnMedicationType' + index; newCell.appendChild(hdnMedicationType);
        var hdnDosageqty = document.createElement('input'); hdnDosageqty.type = 'hidden'; hdnDosageqty.id = 'hdnDosageqty' + index; newCell.appendChild(hdnDosageqty);
        var hdnIsTakenToday = document.createElement('input'); hdnIsTakenToday.type = 'hidden'; hdnIsTakenToday.id = 'hdnIsTakenToday' + index; newCell.appendChild(hdnIsTakenToday);
        var hdnLmpCal = document.createElement('input'); hdnLmpCal.type = 'hidden'; hdnLmpCal.id = 'hdnLmpCal' + index; newCell.appendChild(hdnLmpCal);
        var hdnOutherMedic = document.createElement('input'); hdnOutherMedic.type = 'hidden'; hdnOutherMedic.id = 'hdnOutherMedic' + index; newCell.appendChild(hdnOutherMedic);
        var hdncount = document.createElement('input'); hdncount.type = 'hidden'; hdncount.id = 'hdncount' + index; newCell.appendChild(hdncount);
        var hdnCmpDiscPcnt = document.createElement('input'); hdnCmpDiscPcnt.type = 'hidden'; hdnCmpDiscPcnt.id = 'hdnCmpDiscPcnt' + index; newCell.appendChild(hdnCmpDiscPcnt);
        var hdn_ord_id = document.createElement('input'); hdn_ord_id.type = 'hidden'; hdn_ord_id.id = 'hdn_ord_id' + index; newCell.appendChild(hdn_ord_id);
        var hdnord_det_id = document.createElement('input'); hdnord_det_id.type = 'hidden'; hdnord_det_id.id = 'hdnord_det_id' + index; newCell.appendChild(hdnord_det_id);
        var hdnSrv_Name_A = document.createElement('input'); hdnSrv_Name_A.type = 'hidden'; hdnSrv_Name_A.id = 'hdnSrv_Name_A' + index; newCell.appendChild(hdnSrv_Name_A);
        var hdnSrvGenderId = document.createElement('input'); hdnSrvGenderId.type = 'hidden'; hdnSrvGenderId.id = 'hdnSrvGenderId' + index; hdnSrvGenderId.value = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvGenderId').value; newCell.appendChild(hdnSrvGenderId);
        var hdnSrvFDays = document.createElement('input'); hdnSrvFDays.type = 'hidden'; hdnSrvFDays.id = 'hdnSrvFDays' + index; hdnSrvFDays.value = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFDays').value; newCell.appendChild(hdnSrvFDays);
        var hdnSrvTDays = document.createElement('input'); hdnSrvTDays.type = 'hidden'; hdnSrvTDays.id = 'hdnSrvTDays' + index; hdnSrvTDays.value = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvTDays').value; newCell.appendChild(hdnSrvTDays);
        var hdnpatcatid = document.createElement('input'); hdnpatcatid.type = 'hidden'; hdnpatcatid.id = 'hdnpatcatid' + index; newCell.appendChild(hdnpatcatid);
        var hdnrateexcgst = document.createElement('input'); hdnrateexcgst.type = 'hidden'; hdnrateexcgst.id = 'hdnrateexcgst' + index; newCell.appendChild(hdnrateexcgst);
        var hdntaxpct = document.createElement('input'); hdntaxpct.type = 'hidden'; hdntaxpct.id = 'hdntaxpct' + index; newCell.appendChild(hdntaxpct);
        var hdncruleid = document.createElement('input'); hdncruleid.type = 'hidden'; hdncruleid.id = 'hdncruleid' + index; newCell.appendChild(hdncruleid);
        var hdncrulepct = document.createElement('input'); hdncrulepct.type = 'hidden'; hdncrulepct.id = 'hdncrulepct' + index; newCell.appendChild(hdncrulepct);
        var hdncrulename = document.createElement('input'); hdncrulename.type = 'hidden'; hdncrulename.id = 'hdncrulename' + index; newCell.appendChild(hdncrulename);

        var hdncruledefindid = document.createElement('input'); hdncruledefindid.type = 'hidden'; hdncruledefindid.id = 'hdncruledefindid' + index; newCell.appendChild(hdncruledefindid);
        var hdncruledefindby = document.createElement('input'); hdncruledefindby.type = 'hidden'; hdncruledefindby.id = 'hdncruledefindby' + index; newCell.appendChild(hdncruledefindby);


        var hdntaxamount = document.createElement('input'); hdntaxamount.type = 'hidden'; hdntaxamount.id = 'hdntaxamount' + index; newCell.appendChild(hdntaxamount);
        var hdnsgstpct = document.createElement('input'); hdnsgstpct.type = 'hidden'; hdnsgstpct.id = 'hdnsgstpct' + index; newCell.appendChild(hdnsgstpct);
        var hdncgstpct = document.createElement('input'); hdncgstpct.type = 'hidden'; hdncgstpct.id = 'hdncgstpct' + index; newCell.appendChild(hdncgstpct);
        var hdnsgstamount = document.createElement('input'); hdnsgstamount.type = 'hidden'; hdnsgstamount.id = 'hdnsgstamount' + index; newCell.appendChild(hdnsgstamount);
        var hdncgstamount = document.createElement('input'); hdncgstamount.type = 'hidden'; hdncgstamount.id = 'hdncgstamount' + index; newCell.appendChild(hdncgstamount);
        var hdnsaccd = document.createElement('input'); hdnsaccd.type = 'hidden'; hdnsaccd.id = 'hdnsaccd' + index; newCell.appendChild(hdnsaccd);
        
        var hdnnetamountold = document.createElement('input'); hdnnetamountold.type = 'hidden'; hdnnetamountold.id = 'hdnnetamountold' + index; newCell.appendChild(hdnnetamountold);
        var hdnmanagementoldamt = document.createElement('input'); hdnmanagementoldamt.type = 'hidden'; hdnmanagementoldamt.id = 'hdnmanagementoldamt' + index; newCell.appendChild(hdnmanagementoldamt);
        var hdnstaffoldamt = document.createElement('input'); hdnstaffoldamt.type = 'hidden'; hdnstaffoldamt.id = 'hdnstaffoldamt' + index; newCell.appendChild(hdnstaffoldamt);
        var hdncasholdamt = document.createElement('input'); hdncasholdamt.type = 'hidden'; hdncasholdamt.id = 'hdncasholdamt' + index; newCell.appendChild(hdncasholdamt);
        /* Patient Amount */
        newCell = newRow.insertCell(12);
        var txtPamt = document.createElement('input'); txtPamt.type = 'text';
        txtPamt.className = 'Aright';
        txtPamt.style.width = '97%';
        txtPamt.id = 'txtPamt' + index;
        txtPamt.disabled = true;
        newCell.className = 'pamt gpatamts';
        newCell.appendChild(txtPamt);

        /* Patient Discount In Percent */
        newCell = newRow.insertCell(13);
        var txtDiscP = document.createElement('input'); txtDiscP.type = 'text';
        txtDiscP.className = 'Aright';
        txtDiscP.id = 'txtDiscP' + index;
        txtDiscP.onkeypress = function () { numeralsOnly1(event); };
        txtDiscP.onkeyup = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); };
        txtDiscP.onclick = function () { ClearTextbox(this); }
        txtDiscP.onblur = function () { OnPatDiscPcntChange(this, 'PAT', 'disc'); AssignZero(this); }
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscP.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscP.disabled = false; }
        else
        { txtDiscP.disabled = true; }
        newCell.className = 'pdisc gpatamts';
        newCell.appendChild(txtDiscP);

        /* Patient Discount In Flat */
        newCell = newRow.insertCell(14);
        var txtDiscAmt = document.createElement('input'); txtDiscAmt.type = 'text';
        txtDiscAmt.className = 'Aright';
        txtDiscAmt.id = 'txtDiscAmt' + index;
        txtDiscAmt.onkeypress = function () { numeralsOnly1(event); };
        txtDiscAmt.onkeyup = function () { OnPatAmtChange(this, 'PAT', 'amnt'); };
        txtDiscAmt.onclick = function () { ClearTextbox(this); }
        txtDiscAmt.onblur = function () { OnPatAmtChange(this, 'PAT', 'amnt'); AssignZero(this); }
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_0').checked == true)
        { txtDiscAmt.disabled = true; }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnDiscTypes_1').checked == true)
        { txtDiscAmt.disabled = false; }
        else
        { txtDiscAmt.disabled = true; }
        newCell.className = 'pdiscamt gpatamts';
        newCell.appendChild(txtDiscAmt);

        /* Patient Net Amt */
        newCell = newRow.insertCell(15);
        var txtPNAmt = document.createElement('input'); txtPNAmt.type = 'text';
        txtPNAmt.className = 'Aright';
        txtPNAmt.id = 'txtPNAmt' + index;
        txtPNAmt.disabled = true;
        newCell.className = 'pnamt gpatamts';
        newCell.appendChild(txtPNAmt);

        newCell = newRow.insertCell(16);
        /* CRedit Bill Amount */
        var txtCamt = document.createElement('input'); txtCamt.type = 'text';
        txtCamt.className = 'Aright';
        txtCamt.id = 'txtCamt' + index;
        txtCamt.disabled = true;
        var paymentby = document.getElementById('' + ctrlcom + '_UCServices_ddlPatientType').value;
        if (paymentby == '2') {
            txtCamt.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'camt gcompany';
        newCell.appendChild(txtCamt);

        /* Credit Discount In Percent */
        newCell = newRow.insertCell(17);
        var txtCDiscP = document.createElement('input'); txtCDiscP.type = 'text';
        txtCDiscP.className = 'Aright';
        txtCDiscP.id = 'txtCDiscP' + index;
        txtCDiscP.disabled = true;
        if (paymentby == '2') {
            txtCDiscP.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'cdisc gcompany';
        newCell.appendChild(txtCDiscP);

        /* Credit Discount In Flat */
        newCell = newRow.insertCell(18);
        var txtCDiscAmt = document.createElement('input'); txtCDiscAmt.type = 'text';
        txtCDiscAmt.className = 'Aright';
        txtCDiscAmt.id = 'txtCDiscAmt' + index;
        txtCDiscAmt.disabled = true;
        if (paymentby == '2') {
            txtCDiscAmt.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'cdiscamt gcompany';
        newCell.appendChild(txtCDiscAmt);

        /* Credit Net Amount */
        newCell = newRow.insertCell(19);
        var txtCNetAmt = document.createElement('input'); txtCNetAmt.type = 'text';
        txtCNetAmt.className = 'Aright';
        txtCNetAmt.id = 'txtCNetAmt' + index;
        txtCNetAmt.disabled = true;
        if (paymentby == '2') {
            txtCNetAmt.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'cnamt gcompany';
        newCell.appendChild(txtCNetAmt);

        /*eQUI sERVICE nAME fOR CORPORATE */
        newCell = newRow.insertCell(20);
        var txtEqui_Srv_Name = document.createElement('input'); txtEqui_Srv_Name.type = 'text';
        txtEqui_Srv_Name.className = 'Aright';
        txtEqui_Srv_Name.id = 'txtEqui_Srv_Name' + index;
        txtEqui_Srv_Name.disabled = true;
        if (paymentby == '2') {
            txtEqui_Srv_Name.style.display = 'block';
        }
        else {
            newCell.style.display = 'none';
        }
        newCell.className = 'Equi_Srv_Name gcompany';
        newCell.appendChild(txtEqui_Srv_Name);


        /*Newly Added By Naresh Begin*/

        newCell = newRow.insertCell(21);
        var txthcPer = document.createElement('input'); txthcPer.type = 'text';
        txthcPer.id = 'txthcPer' + index;
        txthcPer.className = "Aright";
        txthcPer.onblur = function () { CalConcessionAmount('P'); };
        txthcPer.onkeypress = function () { numeralsOnly1(event) };
        txthcPer.disabled = true;
        newCell.style.display = 'none';
        newCell.className = 'HCPER ghcdisc';
        newCell.appendChild(txthcPer);

        newCell = newRow.insertCell(22);
        var txtHcAmt = document.createElement('input'); txtHcAmt.type = 'text';
        txtHcAmt.id = 'txtHcAmt' + index;
        txtHcAmt.className = "Aright";
        txtHcAmt.disabled = true;
        txtHcAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = 'HCAMT ghcdisc';
        newCell.appendChild(txtHcAmt);



        newCell = newRow.insertCell(23);
        var txtmaPer = document.createElement('input'); txtmaPer.type = 'text';
        txtmaPer.id = 'txtmaPer' + index;
        txtmaPer.className = "Aright";
        txtmaPer.disabled = true;
        txtmaPer.onkeypress = function () { numeralsOnly1(event); };
        txtmaPer.onkeyup = function () { OnPatDiscPcntChange(this, 'MG'); };
        txtmaPer.onclick = function () { ClearTextbox(this); }
        txtmaPer.onblur = function () { OnPatDiscPcntChange(this, 'MG'); AssignZero(this); }
        newCell.style.display = 'none';
        newCell.className = 'MGPER gmgdisc';
        newCell.appendChild(txtmaPer);

        newCell = newRow.insertCell(24);
        var txtmgAmt = document.createElement('input'); txtmgAmt.type = 'text';
        txtmgAmt.id = 'txtmgAmt' + index;
        txtmgAmt.className = "Aright";
        txtmgAmt.onkeypress = function () { numeralsOnly1(event); };
        txtmgAmt.onkeyup = function () { OnPatAmtChange(this, 'MG'); };
        txtmgAmt.onclick = function () { ClearTextbox(this); }
        txtmgAmt.onblur = function () { OnPatAmtChange(this, 'MG'); AssignZero(this); }
        txtmgAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = 'MGAMT gmgdisc';
        newCell.appendChild(txtmgAmt);


        newCell = newRow.insertCell(25);
        var txtstPer = document.createElement('input'); txtstPer.type = 'text';
        txtstPer.id = 'txtstPer' + index;
        txtstPer.className = "Aright";
        txtstPer.disabled = true;
        txtstPer.onkeypress = function () { numeralsOnly1(event); };
        txtstPer.onkeyup = function () { OnPatDiscPcntChange(this, 'STAF'); };
        txtstPer.onclick = function () { ClearTextbox(this); }
        txtstPer.onblur = function () { OnPatDiscPcntChange(this, 'STAF'); AssignZero(this); }
        newCell.style.display = 'none';
        newCell.className = 'STAFPER gstdisc';
        newCell.appendChild(txtstPer);


        newCell = newRow.insertCell(26);
        var txtstAmt = document.createElement('input'); txtstAmt.type = 'text';
        txtstAmt.id = 'txtstAmt' + index;
        txtstAmt.className = "Aright";
        txtstAmt.onkeypress = function () { numeralsOnly1(event); };
        txtstAmt.onkeyup = function () { OnPatAmtChange(this, 'STAF'); };
        txtstAmt.onclick = function () { ClearTextbox(this); }
        txtstAmt.onblur = function () { OnPatAmtChange(this, 'STAF'); AssignZero(this); }
        txtstAmt.disabled = true;
        newCell.style.display = 'none';
        newCell.className = 'STAMT gstdisc';
        newCell.appendChild(txtstAmt);


        newCell = newRow.insertCell(27);
        var txtebPer = document.createElement('input'); txtebPer.type = 'text';
        txtebPer.id = 'txtebPer' + index;
        txtebPer.className = "Aright";
        txtebPer.disabled = true;
        txtebPer.onblur = function () { CalConcessionAmount('P'); };
        txtebPer.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = 'EBPER gevdisc';
        newCell.appendChild(txtebPer);


        newCell = newRow.insertCell(28);
        var txtebAmt = document.createElement('input'); txtebAmt.type = 'text';
        txtebAmt.id = 'txtebAmt' + index;
        txtebAmt.className = "Aright";
        txtebAmt.disabled = true;
        txtebAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = 'EBAMT gevdisc';
        newCell.appendChild(txtebAmt);


        newCell = newRow.insertCell(29);
        var txtRulePer = document.createElement('input'); txtRulePer.type = 'text';
        txtRulePer.id = 'txtRulePer' + index;
        txtRulePer.className = "Aright";
        txtRulePer.disabled = true;
        txtRulePer.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = 'CNCRLPER gcrdisc';
        newCell.appendChild(txtRulePer);

        newCell = newRow.insertCell(30);
        var txtcncrlAmt = document.createElement('input'); txtcncrlAmt.type = 'text';
        txtcncrlAmt.id = 'txtcncrlAmt' + index;
        txtcncrlAmt.className = "Aright";
        txtcncrlAmt.disabled = true;
        txtcncrlAmt.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = 'CNCRLAMT gcrdisc';
        newCell.appendChild(txtcncrlAmt);

        newCell = newRow.insertCell(31);
        var txtremks = document.createElement('input'); txtremks.type = 'text';
        txtremks.id = 'txtremks' + index;
        newCell.className = "remarks";
        newCell.appendChild(txtremks);


        newCell = newRow.insertCell(32);
        var txttaxper = document.createElement('input'); txttaxper.type = 'text';
        txttaxper.id = 'txttaxper' + index;
        txttaxper.className = "Aright";
        txttaxper.disabled = true;
        txttaxper.onkeypress = function () { numeralsOnly1(event) };
        newCell.style.display = 'none';
        newCell.className = "taxper gsttax";
        newCell.appendChild(txttaxper);


        newCell = newRow.insertCell(33);
        var txtptax = document.createElement('input'); txtptax.type = 'text';
        txtptax.id = 'txtptax' + index;
        txtptax.className = "Aright";
        txtptax.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "pattax gsttax";
        newCell.appendChild(txtptax);


        newCell = newRow.insertCell(34);
        var txtcmptax = document.createElement('input'); txtcmptax.type = 'text';
        txtcmptax.id = 'txtcmptax' + index;
        txtcmptax.className = "Aright";
        txtcmptax.disabled = true;
        newCell.style.display = 'none';
        newCell.className = "cmptax gcompany";
        newCell.appendChild(txtcmptax);
        /*Newly Added By Naresh End*/

    }
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndex').value = rowIndex;
    index++;



    ManageAutoAdjustmentWidth();
    var data_grd = document.getElementById("ctl00_ContentPlaceHolder1_UCServices_gvServices").rows.length;
    $("#DivGrid_Body").scrollTop($(DivGrid_Body).offset().top);
    var scrolwidth = $(".scwidth").width();
    var form_name = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnDocName').value;
    if (form_name == 'OPQUICK' || form_name == 'Cons') {
        if (data_grd >= 3) {
            $("#DivGrid_Body").addClass('sergridH_opd');
            width_change = 'N';
        }
    }
    else {
        if (data_grd >= 8) {
            if (data_grd == 8)
                $("#DivGrid_Header").width($("#DivGrid_Header").width() - scrolwidth);
            $("#DivGrid_Body").addClass('sergridH');
            width_change = 'N';

        }
    }
}
function clearDiscounts() {
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length > 2) {
        $("table[id*=gvMultipleConcession] tr:has(td)").each(function (i, j) {
            $(this).remove();
        });
    }
    document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').value = 0;
    CheckCardDisable(document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType'));

    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length == 1) {
        fn_AddRowWithDetais();

    }
}
/*  payment related script */

function IsEmptyReplaceWithZero(event) {
    if ($('#' + event.id + '').val() == '') {
        $('#' + event.id + '').val('0');
    }
}
function OnLostFoucs(txtid) {
    try {
        if (txtid != null)
            txtid.blur();
    }
    catch (exp) { }
}
function DschrgRedirect(obj) {

    $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('Y');
    if (obj == undefined || obj == '' || obj == null) { obj = 0; }
    CalculateGridAmt(obj);
    return false;
}
function ondschrgfail() {

    var CurrentRowIndex = $('#' + ctrlcom + '_UCServices_hdncrd_ltd_indx').val();
    if (CurrentRowIndex == undefined || CurrentRowIndex == '' || CurrentRowIndex == null) { /* index not found */

    }
    else {
        var _srvId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        var _doctor_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        var _srv_class_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
        var _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
        var _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();

        if (_srv_class_id == '3' || _srv_class_id == '4') {
            var GvRowscount = 0;
            var count = 0;
            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
            var _index = 0;
            var _index = grid.rows.length;
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
                for (GvRowscount = 0; GvRowscount <= _index; GvRowscount++) {
                    var pkg_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                    var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                    if (pkg_id == _srvId) {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount + ')').remove();
                        arrServiceIds = $.grep(arrServiceIds, function (value) {
                            return value != pkg_srv_id;
                        });
                        GvRowscount = 0;
                    }

                }
            });


        }

        else {
            var GvRowscount = 0;
            var count = 0;
            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
            var _index = 0;
            var _index = grid.rows.length;
            GvRowscount = _index;
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
                for (GvRowscount; GvRowscount >= 0; GvRowscount--) {
                    var pkg_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                    var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                    var Doc_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
                    if (pkg_id == _srvId) {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount + ')').remove();
                        var DisableMultiGrid = false;
                        var Number = 0;
                        if (pkg_srv_id == '2') {
                            pkg_srv_id = Doc_id;
                        }
                        arrServiceIds = $.grep(arrServiceIds, function (value) {
                            return value != pkg_srv_id;
                        });
                    }
                }

            });
        }

        if (parseInt(CurrentRowIndex) >= 0) {
            var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            if (parseInt(pkg_srv_id) > 0) {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').remove();
                arrServiceIds = $.grep(arrServiceIds, function (value) {
                    return value != pkg_srv_id;
                });
            }
        }

    }
    $("#divOptional").hide();
    CalculateGridAmt(CurrentRowIndex);
    return false;
}
function CalculateGridAmt(ev) {
    if (parseInt(ev) >= 0) { /* This Is With Index */
        var RegSrv = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtServiceName]').val();
        var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtQty]').val();
        var rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[id*=txtRate]').val();
        qty = typeof qty == 'string' ? (typeof qty == 'undefined' || qty.trim() == '' ? 0 : parseFloat(qty)) : (typeof qty == 'object' ? 0 : parseFloat(qty));
        rate = typeof rate == 'string' ? (typeof rate == 'undefined' || rate.trim() == '' ? 0 : parseFloat(rate)) : (typeof rate == 'object' ? 0 : parseFloat(rate));
        var amt = parseInt(qty) * parseInt(rate);
        var EmpDiscPT = '0';
        var EmpDiscFT = '0';
        var _netamt = 0;

        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtAmount]').val(amt);
        var PDiPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val();
        var PDiAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val();

        var StPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val();
        var StAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val();


        var mgmtyPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val();
        var mgmtAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val();


        var HcPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val();
        var HCAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val();

        var ConcesrulePcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val();
        var ConcesruleAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val();


        var EventBasedPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val();
        var EventBaseAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val();

        EventBasedPer = typeof EventBasedPer == 'string' ? (typeof EventBasedPer == 'undefined' || EventBasedPer.trim() == '' ? 0 : parseFloat(EventBasedPer)) : (typeof EventBasedPer == 'object' ? 0 : parseFloat(EventBasedPer));
        EventBaseAmt = typeof EventBaseAmt == 'string' ? (typeof EventBaseAmt == 'undefined' || EventBaseAmt.trim() == '' ? 0 : parseFloat(EventBaseAmt)) : (typeof EventBaseAmt == 'object' ? 0 : parseFloat(EventBaseAmt));


        ConcesrulePcntS = typeof ConcesrulePcntS == 'string' ? (typeof ConcesrulePcntS == 'undefined' || ConcesrulePcntS.trim() == '' ? 0 : parseFloat(ConcesrulePcntS)) : (typeof ConcesrulePcntS == 'object' ? 0 : parseFloat(ConcesrulePcntS));
        ConcesruleAmt = typeof ConcesruleAmt == 'string' ? (typeof ConcesruleAmt == 'undefined' || ConcesruleAmt.trim() == '' ? 0 : parseFloat(ConcesruleAmt)) : (typeof ConcesruleAmt == 'object' ? 0 : parseFloat(ConcesruleAmt));

        HcPcntS = typeof HcPcntS == 'string' ? (typeof HcPcntS == 'undefined' || HcPcntS.trim() == '' ? 0 : parseFloat(HcPcntS)) : (typeof HcPcntS == 'object' ? 0 : parseFloat(HcPcntS));
        HCAmtS = typeof HCAmtS == 'string' ? (typeof HCAmtS == 'undefined' || HCAmtS.trim() == '' ? 0 : parseFloat(HCAmtS)) : (typeof HCAmtS == 'object' ? 0 : parseFloat(HCAmtS));

        mgmtyPcntS = typeof mgmtyPcntS == "string" ? (mgmtyPcntS.trim() == "" ? "0" : mgmtyPcntS) : (typeof mgmtyPcntS == "number" ? mgmtyPcntS : "0");
        mgmtAmtS = typeof mgmtAmtS == "string" ? (mgmtAmtS.trim() == "" ? "0" : mgmtAmtS) : (typeof mgmtAmtS == "number" ? mgmtAmtS : "0");



        StPcntS = typeof StPcntS == "string" ? (StPcntS.trim() == "" ? "0" : StPcntS) : (typeof StPcntS == "number" ? StPcntS : "0");
        StAmtS = typeof StAmtS == "string" ? (StAmtS.trim() == "" ? "0" : StAmtS) : (typeof StAmtS == "number" ? StAmtS : "0");
        var corppcnt = "0"; var emppcnt = "0";
        var credit_limit = '0';
        if (PDiPcntS == undefined || PDiPcntS == null || isNaN(PDiPcntS) || PDiPcntS == '') { PDiPcntS = '0'; }
        if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }

        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
        var pat_type = '1';
        if (form_name == 'OP' || form_name == 'Cons') {
            pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
            credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
        }
        else if (form_name == 'OPQUICK') {
            pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
            credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();

        }
        if ((form_name == 'OP' || form_name == 'Cons') && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) {
            if (document.getElementById('' + ctrlcom + '_uccorporate_chkEmpDue').checked == true) {
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = "0";
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = "100";
                corppcnt = "0";
                emppcnt = "100";
            }
            else {
                corppcnt = parseFloat(corppcnt);
                emppcnt = parseFloat(emppcnt);
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = document.getElementById('' + ctrlcom + '_hdnOrgPer').value;
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = document.getElementById('' + ctrlcom + '_hdnEmpPer').value;
            }
            corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
            emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
            if (corppcnt == undefined || corppcnt == null || corppcnt == "") { corppcnt = "0"; }
            if (emppcnt == undefined || emppcnt == null || emppcnt == "") { emppcnt = "0"; }
            if ((form_name == 'OP' || form_name == 'Cons') && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) {
            }
        }
        if ((form_name == 'OPQUICK' && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10'))) {
            if (document.getElementById('' + ctrlcom + '_EmployerInfo1_chkEmpDue').checked == true) {
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = "0";
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = "100";
                corppcnt = "0";
                emppcnt = "100";
            } else {
                corppcnt = parseFloat(corppcnt);
                emppcnt = parseFloat(emppcnt);
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = document.getElementById('' + ctrlcom + '_hdnOrgPer').value;
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = document.getElementById('' + ctrlcom + '_hdnEmpPer').value;
            }
            corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
            emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
            if (corppcnt == undefined || corppcnt == null || corppcnt == "") { corppcnt = "0"; }
            if (emppcnt == undefined || emppcnt == null || emppcnt == "") { emppcnt = "0"; }
            if ((form_name == 'OP' && pat_type == '2') || (form_name == 'Cons' && pat_type == '2')) {
            }
        }
        var CompanyPayTotalServiceWise = 0;
        var GvRowscount_net1 = 0;
        var grid1 = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index_net1 = 0;
        var _index_net1 = grid1.rows.length;
        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net1; GvRowscount_net1 < _index_net1; GvRowscount_net1++) {
                if (GvRowscount_net1 != ev) {

                    if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net1 + ')').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                        var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net1 + ')').find('input[type=text][id*=txtCNetAmt]').val();
                        if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                        CompanyPayTotalServiceWise = parseFloat(CompanyPayTotalServiceWise) + parseFloat(cmp_n_amt);

                    }
                }
            }
        });
        var cmpAmt = "0", empamt = "0";
        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {
            if (RegSrv != 'REGISTRATION') {
                cmpAmt = Math.round(((parseFloat(amt) * parseFloat(corppcnt)) / parseFloat(100)));
                empamt = Math.round(parseFloat(amt) - parseFloat(cmpAmt));  
            }
        }
        var cmpdiscpcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(); /* Company Master Tariff Wise Discount Pcnt */
        /*Only Op */
        var cmpNAmt = 0;
        var CmpDiscAmt = '0';
        var cmpDiscPcnt = '0';
        if (parseFloat(cmpdiscpcnt) > 0) {
            cmpDiscPcnt = cmpdiscpcnt;
            CmpDiscAmt = Math.round((parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100));
            cmpNAmt = Math.round(parseFloat(cmpAmt) - parseFloat(CmpDiscAmt));
        }
        else {
            cmpNAmt = parseFloat(cmpAmt);
        }
        /*New Changes Begin*/
        if (credit_limit >= 1) {
            if (CompanyPayTotalServiceWise == credit_limit) {
                $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('Y');
                corppcnt = 0;
                emppcnt = 100;
            } else
            { }
        }
        /*New Changes End*/


        var GvRowscount_net = 0;
        var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index_net = 0;
        var _index_net = grid.rows.length;
        if (RegSrv != 'REGISTRATION') {
            if (grid.rows.length == 1 && qty > 1) {
                var cmp_t_net_amt = 0;
            }
            else if (grid.rows.length == 1) {
                var cmp_t_net_amt = cmpNAmt;
            } else {
                var cmp_t_net_amt = cmpNAmt;
            }
        }

        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net; GvRowscount_net < _index_net; GvRowscount_net++) {
                if (GvRowscount_net != ev) {
                    if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                        var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtCNetAmt]').val();
                        if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                        cmp_t_net_amt = parseFloat(cmp_t_net_amt) + parseFloat(cmp_n_amt);
                    }
                }
            }
        });
        var post = $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val();
        if (parseFloat(credit_limit) >= 1) {
            if (parseFloat(cmp_t_net_amt) > parseFloat(credit_limit) && post != 'Y') {

                var obj = ev;
                $('#' + ctrlcom + '_UCServices_hdncrd_ltd_indx').val(ev);
                if (getParameterByName("MODE") != "VIEW") {
                    setTimeout(function () {
                        $(".smessagebox").scustommessagebox(2, "Credit Limit", "Company Pay Amount Exceeding Credit Limit Amount. Do You Want To Continue..?", DschrgRedirect, obj, ondschrgfail);
                    }, 1 * 1000);
                    return false;
                } else { DschrgRedirect(obj); }
            }
        }
        if (parseFloat(credit_limit) > 0) {

            if (post == 'Y' && RegSrv != 'REGISTRATION') {

                if (cmp_t_net_amt == "" || cmp_t_net_amt == undefined || cmp_t_net_amt == null) { cmp_t_net_amt = 0; }
                if (credit_limit == "" || credit_limit == undefined || credit_limit == null) { credit_limit = 0; }
                var chng_amt = parseFloat(cmp_t_net_amt) - parseFloat(credit_limit);

                empamt = (parseFloat(empamt) + parseFloat(chng_amt) + parseFloat(CmpDiscAmt));
                cmpAmt = (parseFloat(cmpAmt) - parseFloat(chng_amt) - parseFloat(CmpDiscAmt));

                PDiAmtS = Math.round((parseFloat(empamt) * parseFloat(cmpDiscPcnt)) / parseFloat(100));
                if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }
                CmpDiscAmt = Math.round((parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100));

                if (parseFloat(CmpDiscAmt) > 0) { } else { CmpDiscAmt = 0; }
                cmpNAmt = (parseFloat(cmpAmt) - parseFloat(CmpDiscAmt));

                $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('N');
            }
        }

        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {/* Company And Patient Sagrigation */

            if (RegSrv != 'REGISTRATION') {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(empamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(mgmtyPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(StPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(HcPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(ConcesrulePcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(EventBasedPer);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(empamt) - parseFloat(PDiAmtS));
                /*Company Has To Implement */

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val(cmpAmt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val(CmpDiscAmt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val(cmpNAmt);
            }
            else {/* Only Patient Amounts */
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(mgmtyPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(StPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(HcPcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(ConcesrulePcntS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(EventBasedPer);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);


                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - parseFloat(PDiAmtS));

                /*Company Has To Implement */
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
            }

        }
        else {/* Only Patient Amounts */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(mgmtyPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(StPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(HcPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(ConcesrulePcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(EventBasedPer);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);


            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - (parseFloat(PDiAmtS)));

            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
        }
    }
    else if (ev == 0)
    { }
    else { /* This Is WithOut Index */
        var CurrentRowIndex = 0;
        CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
        CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 1 : CurrentRowIndex;
        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
        var credit_limit = '0';
        if (form_name == 'OP' || form_name == 'Cons') {
            credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
        }
        else if (form_name == 'OPQUICK') {
            credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();
        }
        var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val();
        var rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val();
        var amt = parseInt(qty) * parseInt(rate);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtAmount]').val(amt);
        var PDiPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        var PDiAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val();
        if (PDiPcntS == undefined || PDiPcntS == null || isNaN(PDiPcntS) || PDiPcntS == '') { PDiPcntS = '0'; }
        if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }
        var corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
        var emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
        if (corppcnt == undefined || corppcnt == null || corppcnt == "" || isNaN(corppcnt)) { corppcnt = "0"; }
        if (emppcnt == undefined || emppcnt == null || emppcnt == "" || isNaN(emppcnt)) { emppcnt = "0"; }
        corppcnt = parseFloat(corppcnt);
        emppcnt = parseFloat(emppcnt);
        var cmpAmt = "0", empamt = "0";
        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {
            cmpAmt = (parseFloat(amt) * parseFloat(corppcnt)) / parseFloat(100);
            empamt = (parseFloat(amt) * parseFloat(emppcnt)) / parseFloat(100);
        }
        var cmpdiscpcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(); /* Company Master Tariff Wise Discount Pcnt */
        /*Only Op */
        var cmpNAmt = 0;
        var CmpDiscAmt = '0';
        var cmpDiscPcnt = '0';
        if (parseFloat(cmpdiscpcnt) > 0) {
            cmpDiscPcnt = cmpdiscpcnt;
            CmpDiscAmt = (parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100);
            cmpNAmt = parseFloat(cmpAmt) - parseFloat(CmpDiscAmt);
        }
        else {
            cmpNAmt = parseFloat(cmpAmt);
        }
        var GvRowscount_net = 0;
        var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index_net = 0;
        var _index_net = grid.rows.length;
        var cmp_t_net_amt = cmpNAmt;
        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net; GvRowscount_net < _index_net; GvRowscount_net++) {
                var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtCNetAmt]').val();
                if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                cmp_t_net_amt = parseFloat(cmp_t_net_amt) + parseFloat(cmp_n_amt);
            }
        });
        if (parseFloat(credit_limit) >= 1) {
            if (parseFloat(cmp_t_net_amt) > parseFloat(credit_limit)) {
                var obj = 'suvarna';
                var param = CurrentRowIndex;
                $('#' + ctrlcom + '_UCServices_hdncrd_ltd_indx').val(CurrentRowIndex);
                ConfirmationRequiredForSaveWithParam_message_transaction(obj, param, 'Company Pay Amount Exceeding Credit Limit Amount. Do You Want To Continue..');
                return false;
            }
        }
        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {/* Company And Patient Sagrigation */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(empamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(empamt) - parseFloat(PDiAmtS));
            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val(cmpAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val(CmpDiscAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val(cmpNAmt);

        }
        else {/* Only Patient Amounts */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - parseFloat(PDiAmtS));
            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
        }
    }
    var Perconces = 0, concession = 0, txtPayAmt = 0, dec = 2;
    var sGrid = document.getElementById('' + ctrlcom + '_gvServices');
    var TAmount = 0, GAmount = 0, Amount = 0, NetAmount = 0, Qty = 0, Rate = 0, IndivConcession = 0, InitialAmount = 0, TotConcession = 0;
    var CmpTBAmt = 0, CmpTCAmt = 0, CmpTNAmt = 0;
    var PatTBAmt = 0, PatTCAmt = 0, PatMgCAmt = 0, StMgCAmt = 0, PatTNAmt = 0, HCAmt = 0, CncRuleAmt = 0, EventBasedAmt = 0;
    var TOTALTAXAMOUNT = 0; var netamount = 0;
    var cmptaxamt = 0;
    var taxamt = 0, ptaxamt = 0, ctaxamt = 0; var totalsgstamount = 0; var totalcgstamount = 0;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        Qty = $(this).closest('tr').find("input[type=text][id*=txtQty]").val();
        Rate = $(this).closest('tr').find("input[id*=txtRate]").val();
        Amount = parseFloat(Qty) * parseFloat(Rate);
        if ($('#' + ctrlcom + '_UCServices_hdnisadditinal').val() == 'Y') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
        }
        var CMPCNCSper = $(this).closest('tr').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val();
        if (CMPCNCSper == undefined || CMPCNCSper == null || CMPCNCSper == "" || isNaN(CMPCNCSper)) { CMPCNCSper = "0"; }


        /* up to here */
        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons') {
            var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        } else {
            if (form_name == 'OPQUICK') {
                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

                } else {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
                }
            }
        }
        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
        { Cmp_id = 0; }
        if (Cmp_id == 0) {
            if ($(this).closest('tr').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                if (CMPCNCSper == 0) {
                    var con_id = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
                    if (con_id == undefined || con_id == null || con_id == '' || con_id == "0")
                    { con_id = 0; }
                    if (con_id == 0) {
                        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked == false) {
                            var _dscper = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis');
                        }
                    }
                }
            }
        }
        var Class_Srv_id = $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val();
        var Service_Class_id = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceClass]").val();
        var mgmtAmt = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
        var StmtAmt = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
        var Discamt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
        var HcDiscamt = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();
        var CncsnRuleamtInner = $(this).closest('tr').find("input[type=text][id*=txtcncrlAmt]").val();
        var EventBasedInner = $(this).closest('tr').find("input[type=text][id*=txtebAmt]").val();

        EventBasedInner = typeof EventBasedInner == 'string' ? (typeof EventBasedInner == 'undefined' || EventBasedInner.trim() == '' ? 0 : parseFloat(EventBasedInner)) : (typeof EventBasedInner == 'object' ? 0 : parseFloat(EventBasedInner));
        CncsnRuleamtInner = typeof CncsnRuleamtInner == 'string' ? (typeof CncsnRuleamtInner == 'undefined' || CncsnRuleamtInner.trim() == '' ? 0 : parseFloat(CncsnRuleamtInner)) : (typeof CncsnRuleamtInner == 'object' ? 0 : parseFloat(CncsnRuleamtInner));
        Discamt = typeof Discamt == "string" ? (Discamt.trim() == "" ? "0" : Discamt) : (typeof Discamt == "number" ? Discamt : "0");
        mgmtAmt = typeof mgmtAmt == "string" ? (mgmtAmt.trim() == "" ? "0" : mgmtAmt) : (typeof mgmtAmt == "number" ? mgmtAmt : "0");
        StmtAmt = typeof StmtAmt == "string" ? (StmtAmt.trim() == "" ? "0" : StmtAmt) : (typeof StmtAmt == "number" ? StmtAmt : "0");
        HcDiscamt = typeof HcDiscamt == 'string' ? (typeof HcDiscamt == 'undefined' || HcDiscamt.trim() == '' ? 0 : parseFloat(HcDiscamt)) : (typeof HcDiscamt == 'object' ? 0 : parseFloat(HcDiscamt));
        CncRuleAmt = typeof CncRuleAmt == 'string' ? (typeof CncRuleAmt == 'undefined' || CncRuleAmt.trim() == '' ? 0 : parseFloat(CncRuleAmt)) : (typeof CncRuleAmt == 'object' ? 0 : parseFloat(CncRuleAmt));

        if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
            Amount = '0';
        }
        if (!isNaN(Amount))
            GAmount = parseFloat(GAmount) + parseFloat(Amount);

        if (!isNaN(IndivConcession))
            TotConcession = parseFloat(TotConcession) + parseFloat(IndivConcession); 
        var PatBAmt = $(this).closest('tr').find("input[id*=txtPamt]").val();
        var PatCAmt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
        var PatMgCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
        var patStCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
        var PatPNAmt = $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val();
        var HCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();
        var tax_pct = $(this).closest('tr').find("input[id*=hdntaxpct]").val();
        var conamount = $(this).closest('tr').find("input[type=text][id*=txtpatgrossamt]").val();
        var seramount = $(this).closest('tr').find('input[type=text][id*=txtPamt]').val();
        var cmpNamt = $(this).closest('tr').find('input[type=text][id*=txtCNetAmt]').val();
        var cmpconamt = $(this).closest('tr').find('input[type=text][id*=txtCDiscAmt]').val();
        PatMgCAmtInner = typeof PatMgCAmtInner == "string" ? (PatMgCAmtInner.trim() == "" ? "0" : PatMgCAmtInner) : (typeof PatMgCAmtInner == "number" ? PatMgCAmtInner : "0");
        patStCAmtInner = typeof patStCAmtInner == "string" ? (patStCAmtInner.trim() == "" ? "0" : patStCAmtInner) : (typeof patStCAmtInner == "number" ? patStCAmtInner : "0");
        HCAmtInner = typeof HCAmtInner == 'string' ? (typeof HCAmtInner == 'undefined' || HCAmtInner.trim() == '' ? 0 : parseFloat(HCAmtInner)) : (typeof HCAmtInner == 'object' ? 0 : parseFloat(HCAmtInner));
        if (cmpconamt == undefined || cmpconamt == null || cmpconamt == "" || isNaN(cmpconamt)) { cmpconamt = "0"; }
        if (cmpNamt == undefined || cmpNamt == null || cmpNamt == "" || isNaN(cmpNamt)) { cmpNamt = "0"; }
        if (PatBAmt == undefined || PatBAmt == null || PatBAmt == "" || isNaN(PatBAmt)) { PatBAmt = "0"; }
        if (PatCAmt == undefined || PatCAmt == null || PatCAmt == "" || isNaN(PatCAmt)) { PatCAmt = "0"; }
        if (PatPNAmt == undefined || PatPNAmt == null || PatPNAmt == "" || isNaN(PatPNAmt)) { PatPNAmt = "0"; }
        if (taxamt == undefined || taxamt == null || taxamt == "" || isNaN(taxamt)) { taxamt = "0"; }
        if (conamount == undefined || conamount == null || conamount == "" || conamount == "undefined" || isNaN(conamount)) { conamount = "0"; }
        if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
            PatBAmt = '0';
            PatCAmt = '0';
            PatPNAmt = '0';
        }
        if (parseInt(PatTBAmt) > 0) {

        }
        else {
            PatTBAmt = '0';
            PatTCAmt = '0';
            PatTNAmt = '0';
        }

        PatTBAmt = parseFloat(PatTBAmt) + parseFloat(PatBAmt);
        PatTCAmt = parseFloat(PatTCAmt) + parseFloat(PatCAmt);
        PatMgCAmt = parseFloat(PatMgCAmt) + parseFloat(PatMgCAmtInner);
        StMgCAmt = parseFloat(StMgCAmt) + parseFloat(patStCAmtInner);
        HCAmt = parseFloat(HCAmt) + parseFloat(HCAmtInner);
        CncRuleAmt = parseFloat(CncRuleAmt) + parseFloat(CncsnRuleamtInner);
        PatTNAmt = parseFloat(PatTNAmt) + parseFloat(PatPNAmt);
        EventBasedAmt = parseFloat(EventBasedAmt) + parseFloat(EventBasedInner);



        var OrgPrice = $(this).closest('tr').find('[id*=hdnOrgPrice]').val();
        var DoctorPrice = $(this).closest('tr').find("[id*=hdnDoctorPrice]").val();
        var OrgPct = $(this).closest('tr').find("[id*=hdnOrgPct]").val();
        var DoctorPct = $(this).closest('tr').find("[id*=hdnDoctorPct]").val();

        if (OrgPct == undefined || OrgPct == null || OrgPct == "" || isNaN(OrgPct)) { OrgPct = "0"; }
        if (DoctorPct == undefined || DoctorPct == null || DoctorPct == "" || isNaN(DoctorPct)) { DoctorPct = "0"; }

        var orgprice = Math.round((parseFloat(PatPNAmt) + parseFloat(cmpNamt)) * (parseFloat(OrgPct) / 100));
        var doctorprice = Math.round((parseFloat(PatPNAmt) + parseFloat(cmpNamt)) * (parseFloat(DoctorPct) / 100));

        $(this).closest('tr').find('[id*=hdnOrgPrice]').val(orgprice);
        $(this).closest('tr').find("[id*=hdnDoctorPrice]").val(doctorprice);

        var srvtottax = parseFloat(PatPNAmt) + parseFloat(cmpNamt);
        var tax_amt = (parseFloat(srvtottax) * parseFloat(tax_pct) / 100); 
        tax_amt = tax_amt.toFixed(2);
        var pattaxamt = (parseFloat(PatPNAmt) * parseFloat(tax_pct) / 100);
        pattaxamt = pattaxamt.toFixed(2);
        var cmptaxamt = (parseFloat(cmpNamt) * parseFloat(tax_pct) / 100); 
        cmptaxamt = cmptaxamt.toFixed(2);
        if (tax_amt == undefined || tax_amt == null || tax_amt == "" || isNaN(tax_amt)) { tax_amt = "0"; }
        if (pattaxamt == undefined || pattaxamt == null || pattaxamt == "" || isNaN(pattaxamt)) { pattaxamt = "0"; }
        if (cmptaxamt == undefined || cmptaxamt == null || cmptaxamt == "" || isNaN(cmptaxamt)) { cmptaxamt = "0"; }
        $(this).closest('tr').find("[id*=hdntaxamount]").val(tax_amt);
        $(this).closest('tr').find('input[type=text][id*=txtptax]').val(pattaxamt);
        $(this).closest('tr').find('input[type=text][id*=txtcmptax]').val(cmptaxamt);

        var sgst_tax_pct = $(this).closest('tr').find("[id*=hdnsgstpct]").val();
        var cgst_tax_pct = $(this).closest('tr').find("[id*=hdncgstpct]").val();
        var sgsttaxamt = (parseFloat(tax_amt) * parseFloat(sgst_tax_pct) / 100);
        sgsttaxamt = sgsttaxamt.toFixed(2);
        var cgsttaxamt = (parseFloat(tax_amt) * parseFloat(cgst_tax_pct) / 100); 
        cgsttaxamt = cgsttaxamt.toFixed(2);
        if (cgsttaxamt == undefined || cgsttaxamt == null || cgsttaxamt == "" || isNaN(cgsttaxamt)) { cgsttaxamt = "0"; }
        if (sgsttaxamt == undefined || sgsttaxamt == null || sgsttaxamt == "" || isNaN(sgsttaxamt)) { sgsttaxamt = "0"; }
        $(this).closest('tr').find('[id*=hdncgstamount]').val(cgsttaxamt);
        $(this).closest('tr').find('[id*=hdnsgstamount]').val(sgsttaxamt);

        totalsgstamount = (parseFloat(totalsgstamount) + parseFloat(sgsttaxamt));
        totalsgstamount = totalsgstamount.toFixed(2);
        totalcgstamount = (parseFloat(totalcgstamount) + parseFloat(cgsttaxamt));
        totalcgstamount = totalcgstamount.toFixed(2);
        taxamt = (parseFloat(taxamt) + parseFloat(tax_amt));
        taxamt = taxamt.toFixed(2);
        ptaxamt = (parseFloat(ptaxamt) + parseFloat(pattaxamt));
        ptaxamt = ptaxamt.toFixed(2);
        ctaxamt = (parseFloat(ctaxamt) + parseFloat(cmptaxamt)); 
        ctaxamt = ctaxamt.toFixed(2);
        if (taxamt == undefined || taxamt == null || taxamt == "" || isNaN(taxamt)) { taxamt = "0"; }
        if (ptaxamt == undefined || ptaxamt == null || ptaxamt == "" || isNaN(ptaxamt)) { ptaxamt = "0"; }
        if (ctaxamt == undefined || ctaxamt == null || ctaxamt == "" || isNaN(ctaxamt)) { ctaxamt = "0"; }
        if (totalcgstamount == undefined || totalcgstamount == null || totalcgstamount == "" || isNaN(totalcgstamount)) { totalcgstamount = "0"; }
        if (totalsgstamount == undefined || totalsgstamount == null || totalsgstamount == "" || isNaN(totalsgstamount)) { totalsgstamount = "0"; }

        netamount = setProperDecimals(parseFloat(PatTBAmt) - parseFloat(conamount));
        IndivConcession = (parseFloat(Discamt) + parseFloat(mgmtAmt) + parseFloat(StmtAmt) + parseFloat(HCAmtInner) + parseFloat(PatMgCAmtInner) + parseFloat(EventBasedAmt));


        if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons'))
            && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            if (parseInt(CmpTBAmt) > 0) {
            }
            else {
                CmpTBAmt = '0';
                CmpTCAmt = '0';
                CmpTNAmt = '0';
            }
            var CmpBAmt = $(this).closest('tr').find("input[type=text][id*=txtCamt]").val();
            var CmpCAmt = $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").val();
            var CmpCNAmt = $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").val();

            if (CmpBAmt == undefined || CmpBAmt == null || CmpBAmt == "" || isNaN(CmpBAmt)) { CmpBAmt = "0"; }
            if (CmpCAmt == undefined || CmpCAmt == null || CmpCAmt == "" || isNaN(CmpCAmt)) { CmpCAmt = "0"; }
            if (CmpCNAmt == undefined || CmpCNAmt == null || CmpCNAmt == "" || isNaN(CmpCNAmt)) { CmpCNAmt = "0"; }

            if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
                CmpBAmt = '0';
                CmpCAmt = '0';
                CmpCNAmt = '0';
            }
            CmpTBAmt = parseFloat(CmpTBAmt) + parseFloat(CmpBAmt);
            CmpTCAmt = parseFloat(CmpTCAmt) + parseFloat(CmpCAmt);
            CmpTNAmt = parseFloat(CmpTNAmt) + parseFloat(CmpCNAmt);
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
            if (parseInt(CmpTBAmt) > 0) {
            }
            else {
                CmpTBAmt = '0';
                CmpTCAmt = '0';
                CmpTNAmt = '0';
            }
            var CmpBAmt = $(this).closest('tr').find("input[type=text][id*=txtCamt]").val();
            var CmpCAmt = $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").val();
            var CmpCNAmt = $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").val();

            if (CmpBAmt == undefined || CmpBAmt == null || CmpBAmt == "" || isNaN(CmpBAmt)) { CmpBAmt = "0"; }
            if (CmpCAmt == undefined || CmpCAmt == null || CmpCAmt == "" || isNaN(CmpCAmt)) { CmpCAmt = "0"; }
            if (CmpCNAmt == undefined || CmpCNAmt == null || CmpCNAmt == "" || isNaN(CmpCNAmt)) { CmpCNAmt = "0"; }

            CmpTBAmt = parseFloat(CmpTBAmt) + parseFloat(CmpBAmt);
            CmpTCAmt = parseFloat(CmpTCAmt) + parseFloat(CmpCAmt);
            CmpTNAmt = parseFloat(CmpTNAmt) + parseFloat(CmpCNAmt);
        }


    }); 
    if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons'))
    && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
        var company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        $('#' + ctrlcom + '_txtCorpPayAmt').val(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        $('#' + ctrlcom + '_txtCorpDueAmt').val(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        $('#' + ctrlcom + '_txtEmpPayAmt').val(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
    }
    else {
        $('#' + ctrlcom + '_txtCorpPayAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtCorpDueAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtEmpPayAmt').val((parseFloat(GAmount)) - parseFloat(TotConcession));
        $('#' + ctrlcom + '_txtEmpPayAmt').val((PatTNAmt));
    }

    var reg_fee = 0;
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnRegconSetting').value == "Yes") {
    }
    else {
        reg_fee = document.getElementById('' + ctrlcom + '_UCServices_hdnReg_fee').value;
    }
    if (reg_fee == undefined || reg_fee == '' || reg_fee == null) { reg_fee = "0"; }


    GAmount = setProperDecimals(parseFloat(GAmount) + parseFloat(reg_fee));
    PatTBAmt = setProperDecimals(parseFloat(PatTBAmt) + parseFloat(reg_fee));
    PatTNAmt = setProperDecimals(parseFloat(PatTNAmt) + parseFloat(reg_fee));


    if (parseInt(PatTCAmt) > 0 || parseInt(CmpTCAmt) > 0 || PatMgCAmt > 0 || StMgCAmt > 0 || HCAmt > 0 || CncRuleAmt > 0 || EventBasedAmt > 0) {
        ClearTransactionGrid();
        /*Total Gross Amounts*/

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = Math.round(PatTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = Math.round(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = Math.round(parseFloat(PatTBAmt) + parseFloat(CmpTBAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(PatTNAmt);

        /*Total Due Amount */
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(PatTNAmt);

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = 0;

        if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {

            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
        }

        /*Advanced Disc Types */

        var PatDiscPcnt = (parseFloat(100) * (parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt))) / parseFloat(PatTBAmt);

        if ((PatDiscPcnt) > 0)
        { }
        else
        { PatDiscPcnt = '0'; }
        PatDiscPcnt = setProperDecimals(PatDiscPcnt);
        if (parseFloat(CncRuleAmt) > 0) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = Math.round(PatDiscPcnt);
        } else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = PatDiscPcnt;
        }
        var cmpDiscPcnt = (parseFloat(100) * parseFloat(CmpTCAmt)) / parseFloat(CmpTBAmt);
        if (parseInt(cmpDiscPcnt) > 0)
        { }
        else
        { cmpDiscPcnt = '0'; }
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartydis').value = cmpDiscPcnt;
        if (parseFloat(PatTCAmt) > 0)
        { }
        else
        { PatTCAmt = '0'; }
        if (parseFloat(CmpTCAmt) > 0)
        { }
        else
        { CmpTCAmt = '0'; }

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = Math.round(parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartygrossamt').value = Math.round(CmpTCAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = Math.round(parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt) + parseFloat(CmpTCAmt));
        /*Net Amounts */
        if (parseFloat(PatTNAmt) > 0)
        { }
        else
        { PatTNAmt = '0'; }
        if (parseFloat(CmpTNAmt) > 0)
        { }
        else
        { CmpTNAmt = '0'; }
        var concessionamt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value;
        if (concessionamt == undefined || concessionamt == '' || concessionamt == null) { concessionamt = "0"; }
        var PatGAmount = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
        PatGAmount = typeof PatGAmount == 'string' ? (typeof PatGAmount == 'undefined' || PatGAmount.trim() == '' ? 0 : parseFloat(PatGAmount)) : (typeof PatGAmount == 'object' ? 0 : parseFloat(PatGAmount));

        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);


        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(parseFloat(PatTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = Math.round(parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));

        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(PatTNAmt + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt) + parseFloat(taxamt));
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(Math.round(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txttaxamt').value = (taxamt);

        $('#' + ctrlcom + '_ReceiptControl2_txtpatTotTax').val(ptaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_txtcmpTotTax').val(ctaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalSgstAmount').val(totalsgstamount);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalCgstAmount').val(totalcgstamount);


        if (document.getElementById('' + ctrlcom + '_UCServices_hdnisadditinal').value == 'Y')
        { CurrentRowIndexNew = 1; }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '1') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(Math.round(PatTCAmt));
                var PatPer = (parseFloat(100) * parseFloat(PatTCAmt)) / parseFloat(PatTBAmt);
                PatPer = typeof PatPer == "string" ? (PatPer.trim() == "" ? "0" : PatPer) : (typeof PatPer == "number" ? PatPer : "0");
                PatPer = parseFloat(PatPer);
                PatPer = setProperDecimals(PatPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(setProperDecimals(PatPer));
            }
        }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '3') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(Math.round(PatMgCAmt));
                var MgmtPer = (parseFloat(100) * parseFloat(PatMgCAmt)) / parseFloat(PatTBAmt);
                MgmtPer = typeof MgmtPer == "string" ? (MgmtPer.trim() == "" ? "0" : MgmtPer) : (typeof MgmtPer == "number" ? MgmtPer : "0");
                MgmtPer = parseFloat(MgmtPer);
                MgmtPer = setProperDecimals(MgmtPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(setProperDecimals(MgmtPer));

            }
        }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '4') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(Math.round(StMgCAmt));
                var StmtPer = (parseFloat(100) * parseFloat(StMgCAmt)) / parseFloat(PatTBAmt);
                StmtPer = typeof StmtPer == "string" ? (StmtPer.trim() == "" ? "0" : StmtPer) : (typeof StmtPer == "number" ? StmtPer : "0");
                StmtPer = parseFloat(StmtPer);
                StmtPer = setProperDecimals(StmtPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(setProperDecimals(StmtPer));
            }
        }
    }
    else {

        ClearTransactionGrid();
        /*Total Gross Amounts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = Math.round(PatTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = Math.round(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txttaxamt').value = taxamt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = Math.round(parseFloat(PatTBAmt) + parseFloat(CmpTBAmt));
        /*Total NEt Amts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(parseFloat(PatTNAmt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = Math.round(parseFloat(CmpTNAmt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt)); 
        /*Total Due Amount */
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(PatTNAmt + parseFloat(ptaxamt)); 

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(CmpTNAmt) + parseFloat(ctaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt) + parseFloat(taxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = 0;
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(setProperDecimals(parseFloat(PatTNAmt) + parseFloat(ptaxamt)));
        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);
        $('#' + ctrlcom + '_ReceiptControl2_txtpatTotTax').val(ptaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_txtcmpTotTax').val(ctaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalSgstAmount').val(totalsgstamount);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalCgstAmount').val(totalcgstamount);

        /*sitaram*/
        var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
        if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {
            if ($('#' + ctrlcom + '_hdnDefaultDueAuthID').val() != "" && form_name == 'OP') {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').value = $('#' + ctrlcom + '_hdnDefaultDueAuthName').val();
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3__hiddenText').value = $('#' + ctrlcom + '_hdnDefaultDueAuthName').val();
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3__hiddenID').value = $('#' + ctrlcom + '_hdnDefaultDueAuthID').val();
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            } else {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
            }
        }
        else {
            var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
            var assest = '';
            if (form_name == 'OP') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else if (form_name == 'Cons') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else if (form_name == 'OPQUICK') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else {
                assest = false;
            }
            if (assest == true) {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
            }
            else {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
            }
        }

        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '1') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '3') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '4') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
        }
        EnableMulGird();
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value == 0 && parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value) > 0) {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value == 0) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'grey';
        } else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'red';
        }
    }
    else if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value > 0) {
        var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
        var assest = '';
        if (form_name == 'OP') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else if (form_name == 'Cons') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else if (form_name == 'OPQUICK') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else {
            assest = false;
        }
        if (assest == true) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'grey';
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'red';
            if (document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').value == '') {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
            }
        }
    }
    else {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'grey';
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
    }

    if (parseFloat(concessionamt) > 0) {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value > '0') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_ucdueauth_txtSearchControl').disabled = false;
            document.getElementById('lk_txt_options_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = false;

        }
    }
    else {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value == "0") {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_ucdueauth_txtSearchControl').disabled = true;
            document.getElementById('lk_txt_options_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = true;
        }
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OP' || document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            CalculateCreditLimitAmt();
        }
    }
    var dueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
    var exrate = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtExchangeRate').value;
    var totaldue = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value;
    SetCurrencyAmtFields(dueAmt, exrate);
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnRegFeeAutoFill').value == 'True' && $('#lblquick').attr('Class') == 'select' && document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlcrdtype').value == 0 && document.getElementById('' + ctrlcom + '_ReceiptControl2_txtCardAmt').value == 0) {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(totaldue) - parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value);
        CalculateAmount(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'), 'Cash');
        IsEmptyReplaceWithZero(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'));
    }
}
function ChangeSrvToCons() {
    document.getElementById('' + ctrlcom + '_hdnRowIndex').value = '1';
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndex').value = '1';
    if (form_name == 'OP') {
        if (document.getElementById('' + ctrlcom + '_gv_Ind_Services').rows.length > 2) {
            $("table[id$=gv_Ind_Services] tr:has(td)").each(function (e) {
                $(this).closest('tr').remove();
            });
        }
    }
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP') {
        if (document.getElementById('' + ctrlcom + '_hdnView').value != 'VIEW_OP') {
            ServicesAutoContextKey();
        }
    }
    else {
        ServicesAutoContextKey();
    }
    /*emeregency solt setup */
    if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
        if (document.getElementById('' + ctrlcom + '_hdnEmergencySlot').value == "True") {
            SetEmergencySlots();
            CheckEmergencySlotSetup("OC");
        }
    }
    else {
        if (document.getElementById('' + ctrlcom + '_hdnEmergencySlot').value == "True") {
            SetEmergencySlots();
            CheckEmergencySlotSetup("OP");
        }
    }
    /*end*/
    /*added by Swetha Reddy*/
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnOPDState').value == 'N') {
        AccessAddDisableAttributes();
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_0').checked == true) {
            document.getElementById('' + ctrlcom + '_lblreqtext').innerHTML = "Consultation Requisitions";
            document.getElementById('divRequisitions').style.display = 'block';
            document.getElementById('divOrderInvestigations').style.display = 'none';
            document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value = 'Cons';
            document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnDocName').value = "Cons";
            document.getElementById('' + ctrlcom + '_UcOdrPsyn_txtSearchControl').className = 'Gray';
            $('#DivCorpColors')[0].style.display = 'none';
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
            document.getElementById('' + ctrlcom + '_lblreqtext').innerHTML = "Order Investigations";
            document.getElementById('divOrderInvestigations').style.display = 'block';
            document.getElementById('divRequisitions').style.display = 'none';
            if ($('[id*=hdnisalowzeroprice]').val() == "No") {
                document.getElementById('' + ctrlcom + '_UcOdrPsyn_txtSearchControl').className = 'red'; /*added by john ali shaik  */
            }
            document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value = 'OP';
            document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnDocName').value = "OP";
            BindBillingRequisitions();
            if (document.getElementById('' + ctrlcom + '_uccorporate_hdnCorpColors').value == '1') {
                $('#DivCorpColors')[0].style.display = 'block';
            }
        }
        else {
            document.getElementById('divOrderInvestigations').style.display = 'none';
            document.getElementById('divRequisitions').style.display = 'none';
        }
    }
    /*end*/
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OPQUICK' || document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_UCServices_rbtnSrvsAndCons_1').checked == true) {
            $('.su-star-empty').css('display', 'block');
            document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').checked = true;
            document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').disabled = false;
            if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OPQUICK') {
                if (document.getElementById('ctl00_ContentPlaceHolder1_hdndtrmandatary').value == 'NO') {
                    document.getElementById('ctl00_ContentPlaceHolder1_ucConsultant_txtSearchControl').className = 'red';
                }
            }
        }
        else {
            $('.su-star-empty').css('display', 'none');
            document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').checked = false;
            document.getElementById('' + ctrlcom + '_UCServices_chkisservicename').disabled = true;
            if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OPQUICK') {
                if (document.getElementById('ctl00_ContentPlaceHolder1_hdndtrmandatary').value == 'NO') {
                    document.getElementById('ctl00_ContentPlaceHolder1_ucConsultant_txtSearchControl').className = 'grey';
                }
            }
        }
    }
}
function ShowPre_Cus_On_Srvs(ev) {
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var srvId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();

    ctl00_ContentPlaceHolder1_UCServices_pnlPre_Cau_On_Srv.style.display = "block";
    GetAsync(
                 "GridService.asmx/BindPreCausionsOnsrvs",
                { srvId: srvId },
                function (data) {

                    if (data.d != null) {
                        document.getElementById('' + ctrlcom + '_UCServices_lblprereqhistory').innerHTML = 'PreRequisition History For ' + data.d[0].SERVICE_NAME + ' :';
                        document.getElementById('' + ctrlcom + '_UCServices_lblhistorycol').innerHTML = data.d[0]["CLINICAL_HISTORY"];
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
}
function ClosePrerequestPopup() {
    ctl00_ContentPlaceHolder1_UCServices_pnlPre_Cau_On_Srv.style.display = "none";
    return false;
}
function OnLmpChange() {
}
function historytype(ev) {

    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value = CurrentRowIndex;
    var clinical = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnhistorytypeID]').val();
    var dosageqty;
    var clinical = document.getElementById('' + ctrlcom + '_UCServices_ddlclinical').value = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnhistorytypeID]').val();
    GetAsync(
                 "GridService.asmx/MeditationData",
                { clinical: clinical },
                function (data) {

                    ctl00_ContentPlaceHolder1_UCServices_pnlHistype.style.display = "block";
                    if (data.d != null) {
                        var _optionsVal = '';
                        for (var i = 0; i < data.d[0].length; i++) {
                            if (i == 0) {
                                var select = "Select";
                                _optionsVal += "<OPTION selected value='" + 0 + "'>" + select + "</OPTION>";
                            }

                            _optionsVal += "<OPTION value='" + data.d[0][i]["MEDICATION_ID"] + "'>" + data.d[0][i]["MEDICATION_NAME"] + "</OPTION>";

                        }
                        $('[id$=UCServices_ddlmeditation]').empty().html(_optionsVal);
                    }

                    var rowindex = CurrentRowIndex; 
                },
                function (jqXHR, textStatus, errorThrown) {
                });

    ShowHideClinicalHistory(clinical);
    document.getElementById('' + ctrlcom + '_UCServices_ddlclinical').disabled = true;
    return false;
}
function BindMeditation() {

    ClearClinicalSummary();
    var clinical = document.getElementById('' + ctrlcom + '_UCServices_ddlclinical').value;
    ShowHideClinicalHistory(clinical);
    GetAsync(
                 "GridService.asmx/MeditationData",
                { clinical: clinical },
                function (data) {

                    ctl00_ContentPlaceHolder1_UCServices_pnlHistype.style.display = "block";
                    if (data.d != null) {
                        var _optionsVal = '';
                        for (var i = 0; i < data.d[0].length; i++) {
                            if (i == 0) {
                                var select = "Select";
                                _optionsVal += "<OPTION selected value='" + 0 + "'>" + select + "</OPTION>";
                            }

                            _optionsVal += "<OPTION value='" + data.d[0][i]["MEDICATION_ID"] + "'>" + data.d[0][i]["MEDICATION_NAME"] + "</OPTION>";

                        }
                        $('[id$=UCServices_ddlmeditation]').empty().html(_optionsVal);
                    }

                    var rowindex = CurrentRowIndex;
                },
                function (jqXHR, textStatus, errorThrown) {
                });
    return false;
}
function ClearClinicalSummary() {
    $('[id$=ctl00_ContentPlaceHolder1_UCServices_ddlmeditation]').empty();
    document.getElementById('' + ctrlcom + '_UCServices_txtDosage').value = '0';
    document.getElementById('' + ctrlcom + '_UCServices_chkDosgeTaken').checked = false;
    document.getElementById('' + ctrlcom + '_UCServices_txtOthrMedicText').value = '';
}
function closehipopup() {

    ctl00_ContentPlaceHolder1_UCServices_pnlHistype.style.display = "none";
    return false;
}

function ShowHideClinicalHistory(clinical) {
    switch (clinical) {
        case '0':
            divMedications.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'block';
            divDosage.style.display = 'none';
            divChkTaken.style.display = 'none';
            divOtherMedication.style.display = 'none';

            break;
        case '1':
            divMedications.style.display = 'table-row';
            divDosage.style.display = 'none';
            divChkTaken.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'block';
            divOtherMedication.style.display = 'none';
            document.getElementById('' + ctrlcom + '_UCServices_ddlmeditation').style.display = 'block';

            break;
        case '2':
            divMedications.style.display = 'table-row';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'block';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'none';
            divDosage.style.display = 'none';
            divChkTaken.style.display = 'none';
            divOtherMedication.style.display = 'none';

            break;
        case '3':
            divMedications.style.display = 'table-row';
            ctl00_ContentPlaceHolder1_UCServices_ddlmeditation.style.display = 'block';
            divDosage.style.display = 'table-row';
            divChkTaken.style.display = 'table-row';
            divOtherMedication.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'block';


            break;
        case '4':
            divMedications.style.display = 'table-row';
            ctl00_ContentPlaceHolder1_UCServices_ddlmeditation.style.display = 'block';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'block';
            divDosage.style.display = 'table-row';
            divChkTaken.style.display = 'table-row';
            divOtherMedication.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'block';

            break;
        case '5':
            divMedications.style.display = 'table-row';
            ctl00_ContentPlaceHolder1_UCServices_ddlmeditation.style.display = 'block';
            divDosage.style.display = 'table-row';
            divChkTaken.style.display = 'table-row';
            divOtherMedication.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'block';

            break;
        case '6':
            divMedications.style.display = 'table-row';
            ctl00_ContentPlaceHolder1_UCServices_divLmpCal.style.display = 'none';
            ctl00_ContentPlaceHolder1_UCServices_divMedic.style.display = 'none';
            divDosage.style.display = 'none';
            divChkTaken.style.display = 'none';
            divOtherMedication.style.display = 'block';


        default:
            break;
    }
}
function SaveClosehistypePopup() {
    var count = 2
    var dosageqty;
    if (document.getElementById('' + ctrlcom + '_UCServices_chkDosgeTaken').checked == true)
    { dosageqty = 'Y'; }
    else
        dosageqty = 'N';
    var index = document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value;
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnhistorytypeID]').val((document.getElementById('' + ctrlcom + '_UCServices_ddlclinical').value));
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnMedicationType]').val(document.getElementById('' + ctrlcom + '_UCServices_ddlmeditation').value);
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnDosageqty]').val(document.getElementById('' + ctrlcom + '_UCServices_txtDosage').value);
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnIsTakenToday]').val(dosageqty);
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnLmpCal]').val((document.getElementById('' + ctrlcom + '_UCServices_txtLmpCalander').value));
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdnOutherMedic]').val(document.getElementById('' + ctrlcom + '_UCServices_txtOthrMedicText').value);
    $('[id$=UCServices_gvServices] tr').filter(':eq(' + index + ')').find('input[type=hidden][id*=hdncount]').val(count);
    var current_hist_type = document.getElementById('' + ctrlcom + '_UCServices_ddlclinical').value;
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
        var hist_type = $(this).closest('tr').find("input[type=hidden][id*=hdnhistoytypeid]").val();
        if (current_hist_type == hist_type) {
            $(this).closest('tr').find("input[type=hidden][id*=hdnhistorytype]").val((document.getElementById('' + ctrlcom + '_UCServices_ddlclinical').value));
            $(this).closest('tr').find("input[type=hidden][id*=hdnMedicationType]").val((document.getElementById('' + ctrlcom + '_UCServices_ddlmeditation').value));
            $(this).closest('tr').find("input[type=hidden][id*=hdnDosageqty]").val(document.getElementById('' + ctrlcom + '_UCServices_txtDosage').value);
            $(this).closest('tr').find("input[type=hidden][id*=hdnIsTakenToday]").val(dosageqty);
            $(this).closest('tr').find("input[type=hidden][id*=hdnLmpCal]").val((document.getElementById('' + ctrlcom + '_UCServices_txtLmpCalander').value));
            $(this).closest('tr').find("input[type=hidden][id*=hdnOutherMedic]").val(document.getElementById('' + ctrlcom + '_UCServices_txtOthrMedicText').value);
            $(this).closest('tr').find("input[type=hidden][id*=hdncount]").val(count);
        }
    });
    ctl00_ContentPlaceHolder1_UCServices_pnlHistype.style.display = 'none';
    return false;
    return false;
}
function proratecal1() {
    $("#progressshow").show();
    var GvRowscount = 0;
    var count = 0;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _index = grid.rows.length;

    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {

        for (GvRowscount = 0; GvRowscount <= _index; GvRowscount++) {
            var Class_Srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
            var srv_Class_ID = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
            var Service_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            var Amount = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=text][id*=txtAmount]').val();
            if (srv_Class_ID == '3') {
                /* Package Includes Total Amount Caluclation Start */
                $('#' + ctrlcom + '_UCServices_hdnpkg_print_req').val('Y');
                var GvRowscount_tot = 0;
                var grid_tot = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                var _index_tot = grid_tot.rows.length;
                var pkg_amt = 0;
                var count_tot = 0;
                $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {

                    if (count_tot == 0) {
                        for (GvRowscount_tot = 0; GvRowscount_tot <= _index_tot; GvRowscount_tot++) {
                            var Class_Srv_id_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                            var srv_Class_ID_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
                            var Service_id_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                            var rate_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=text][id*=txtRate]').val();
                            var Qty_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=text][id*=txtQty]').val();
                            if (rate_tot == undefined || rate_tot == null || rate_tot == '' || rate_tot == NaN) { rate_tot = 0; }
                            if (Service_id == Class_Srv_id_tot) {
                                pkg_amt = parseFloat(pkg_amt) + (parseFloat(rate_tot) * parseFloat(Qty_tot));
                            }
                        }
                    }
                    count_tot = parseInt(count_tot) + parseInt(1);
                });
                var GvRowscount_Pro = 0;
                var _index_Pro = grid_tot.rows.length;
                var count_pro = 0;
                var totprorate = 0;
                $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {

                    if (count_pro == 0) {
                        for (GvRowscount_Pro = 0; GvRowscount_Pro <= _index_Pro; GvRowscount_Pro++) {
                            var Class_Srv_id_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                            var srv_Class_ID_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
                            var Service_id_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                            var rate_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=text][id*=txtRate]').val();
                            var Qty_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=text][id*=txtQty]').val();
                            var doctorpct = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnDoctorPct]').val();
                            var orgpct = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnOrgPct]').val();
                            if (Service_id == Class_Srv_id_pro) {
                                if (pkg_amt == undefined || pkg_amt == null || pkg_amt == '' || pkg_amt == NaN) { pkg_amt = 0; }
                                if (rate_pro == undefined || rate_pro == null || rate_pro == '' || rate_pro == NaN) { rate_pro = 0; }
                                if (Qty_pro == undefined || Qty_pro == null || Qty_pro == '' || Qty_pro == NaN) { Qty_pro = 0; }
                                if (pkg_amt != '0' && rate_pro != '0') {
                                    var pro_rt = parseFloat((parseFloat(parseFloat(rate_pro) * parseFloat(Qty_pro)) * parseFloat(Amount)) / parseFloat(pkg_amt));
                                    if (pro_rt == undefined || pro_rt == null || pro_rt == '' || pro_rt == NaN) { pro_rt = 0; }

                                    $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnprorate]').val(Math.round(parseFloat(pro_rt) / parseFloat(Qty_pro)));
                                    var doctorprice = parseFloat(parseFloat(parseFloat(parseFloat(pro_rt)) * parseFloat(doctorpct)) / 100);
                                    var orgprice = parseFloat(parseFloat(parseFloat(parseFloat(pro_rt)) * parseFloat(orgpct)) / 100);
                                    if (_index_Pro == parseFloat(parseFloat(GvRowscount_Pro) + parseFloat(1))) {
                                        var finalprorate = parseFloat(parseFloat(Amount) - parseFloat(totprorate));
                                        if (Math.sign(parseFloat(finalprorate)) == -1) { finalprorate = 0; }
                                        $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnprorate]').val(Math.round(parseFloat(finalprorate) / parseFloat(Qty_pro)));
                                        var doctorprice = parseFloat(parseFloat(parseFloat(parseFloat(finalprorate)) * parseFloat(doctorpct)) / 100);
                                        var orgprice = parseFloat(parseFloat(parseFloat(parseFloat(finalprorate)) * parseFloat(orgpct)) / 100);

                                    } else {
                                        var prorate = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find("input[type=hidden][id*=hdnprorate]").val();
                                        if (prorate == '' || prorate == null || prorate == undefined || prorate == 'undefined' || isNaN(prorate)) { prorate = '0'; }
                                        totprorate = parseFloat(totprorate) + parseFloat(prorate);
                                        if (totprorate == '' || totprorate == null || totprorate == undefined || totprorate == 'undefined' || isNaN(totprorate)) { totprorate = '0'; }
                                    }

                                    $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnDoctorPrice]').val(parseFloat(doctorprice));
                                    $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnOrgPrice]').val(parseFloat(orgprice));

                                }
                            }
                        }
                    }
                    count_pro = parseInt(count_pro) + parseInt(1);
                });
                /*Pro Rate Sagrigation Ends */
            }
        }
    });
    $("#progressshow").hide()
}
function proratecal() {
    $("#progressshow").show();
    var GvRowscount = 0;
    var count = 0;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _index = grid.rows.length;

    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {

        for (GvRowscount = 0; GvRowscount <= _index; GvRowscount++) {
            var Class_Srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
            var srv_Class_ID = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
            var Service_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            var Amount = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=text][id*=txtAmount]').val();


            if (srv_Class_ID == '3') {
                /* Package Includes Total Amount Caluclation Start */
                $('#' + ctrlcom + '_UCServices_hdnpkg_print_req').val('Y');
                var GvRowscount_tot = 0;
                var grid_tot = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                var _index_tot = grid_tot.rows.length;
                var pkg_amt = 0;
                var count_tot = 0;
                var pkgchiledcount = 0;
                if (count_tot == 0) {
                    for (GvRowscount_tot = 0; GvRowscount_tot <= _index_tot; GvRowscount_tot++) {
                        var Class_Srv_id_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                        var srv_Class_ID_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
                        var Service_id_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                        var rate_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=text][id*=txtRate]').val();
                        var Qty_tot = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_tot + ')').find('input[type=text][id*=txtQty]').val();
                        if (rate_tot == undefined || rate_tot == null || rate_tot == '' || rate_tot == NaN) { rate_tot = 0; }
                        if (Service_id == Class_Srv_id_tot) {
                            pkgchiledcount++;
                            pkg_amt = parseFloat(pkg_amt) + (parseFloat(rate_tot) * parseFloat(Qty_tot));
                        }
                    }
                    count_tot = parseInt(count_tot) + parseInt(1);
                }
                
                var GvRowscount_Pro = 0;
                var _index_Pro = grid_tot.rows.length;
                var count_pro = 0;
                var totprorate = 0;
                var countpkgchiled = 0;
                var sumpkgchiledamt = 0;
                var doctorshare = 0;
                if (count_pro == 0) {
                    for (GvRowscount_Pro = 0; GvRowscount_Pro <= _index_Pro; GvRowscount_Pro++) {
                        var Class_Srv_id_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                        var srv_Class_ID_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
                        var Service_id_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                        var rate_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=text][id*=txtRate]').val();
                        var Qty_pro = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=text][id*=txtQty]').val();
                        var doctorpct = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnDoctorPct]').val();
                        var orgpct = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnOrgPct]').val();
                        if (Service_id == Class_Srv_id_pro) {
                            countpkgchiled++;
                            if (pkg_amt == undefined || pkg_amt == null || pkg_amt == '' || pkg_amt == NaN) { pkg_amt = 0; }
                            if (rate_pro == undefined || rate_pro == null || rate_pro == '' || rate_pro == NaN) { rate_pro = 0; }
                            if (Qty_pro == undefined || Qty_pro == null || Qty_pro == '' || Qty_pro == NaN) { Qty_pro = 0; }
                            if (pkg_amt != '0' && rate_pro != '0') {
                                var pro_rt = parseFloat((parseFloat(parseFloat(rate_pro) * parseFloat(Qty_pro)) * parseFloat(Amount)) / parseFloat(pkg_amt));
                                if (pro_rt == undefined || pro_rt == null || pro_rt == '' || pro_rt == NaN) { pro_rt = 0; }
                                if (countpkgchiled != pkgchiledcount) {
                                    sumpkgchiledamt += Math.round(parseFloat(pro_rt) / parseFloat(Qty_pro));
                                }
                                doctorshare = Math.round(parseFloat(pro_rt) / parseFloat(Qty_pro));
                                if (countpkgchiled == pkgchiledcount) {
                                    $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnprorate]').val((parseFloat(Amount) - parseFloat(sumpkgchiledamt)));
                                    doctorshare = parseFloat(Amount) - parseFloat(sumpkgchiledamt);
                                } else {
                                    $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnprorate]').val(doctorshare);
                                }
                                var doctorprice = Math.round(parseFloat(parseFloat(parseFloat(doctorshare)) * parseFloat(doctorpct)) / 100);
                                var orgprice = parseFloat(doctorshare) - parseFloat(doctorprice); 
                                $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnDoctorPrice]').val(parseFloat(doctorprice));
                                $('[id$=gvServices] tr').filter(':eq(' + GvRowscount_Pro + ')').find('input[type=hidden][id*=hdnOrgPrice]').val(parseFloat(orgprice));

                            }
                        }
                    }
                    count_pro = parseInt(count_pro) + parseInt(1);
                }
            }
        }
    });
    $("#progressshow").hide()
}
function removesrv_grp_and_type(in_srv_grp_id, in_srv_type_id, in_srv_id, in_doc_id, in_dept_id, in_srv_grp_name, in_srv_type_name) {
    var srv_grp_exists = 'N'; var srv_type_exists = 'N'; var GvRowscount_type = 0;
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
        var srv_grp_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val();
        var srv_type_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceTypID]').val();
        var srv_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        var doc_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        var dept_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
        if (in_srv_grp_id == srv_grp_id && in_srv_id != srv_id && in_srv_grp_id != 0 && srv_grp_id != 0) {
            srv_grp_exists = 'Y';
        }
        if (in_srv_type_id == srv_type_id && in_srv_id != srv_id && srv_type_id != 0 && in_srv_type_id != 0 && srv_type_id != 0) {
            srv_type_exists = 'Y';
        }
    });
    /* Service Group Wise Concession Row Creation Starts*/

    if (srv_grp_exists == 'N') {
        $("table[id$=tbl_SrvGrp] tr:has(td)").each(function (e) {
            var srv_grp_nam = $('[id$=tbl_SrvGrp] tr').filter(':eq(' + e + ')').find('[id*=lblsrvgrpname]').text();
            if (srv_grp_nam == in_srv_grp_name) {
                $('[id$=tbl_SrvGrp] tr').filter(':eq(' + e + ')').remove();
            }
        });
    }
    if (srv_type_exists == 'N') {
        $("table[id$=tbl_srv_type] tr:has(td)").each(function (e) {
            var srv_type_nam = $('[id$=tbl_srv_type] tr').filter(':eq(' + e + ')').find('[id*=lblsrvtypename]').text();
            if (srv_type_nam == in_srv_type_name) {
                $('[id$=tbl_srv_type] tr').filter(':eq(' + e + ')').remove();
            }
        });
    }


}
var DeleteSlotId = 0;
function serviceClearcontactdetails() {
    var con_srv_id = 0;
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnallowconsservice').value.toUpperCase() == "TRUE") {
            con_srv_id = document.getElementById('' + ctrlcom + '_UCServices_hdnconssrvID').value;
        }
    }
    else {
        if (document.getElementById('' + ctrlcom + '_chk_old') != null) {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {

                if (document.getElementById('' + ctrlcom + '_UCServices_hdnallowconsservice').value.toUpperCase() == "TRUE") {
                    con_srv_id = document.getElementById('' + ctrlcom + '_UCServices_hdnconssrvID').value;
                }

            }
        }
    }


    if (con_srv_id == null || con_srv_id == undefined || con_srv_id == '' || con_srv_id == "undefined") { con_srv_id = 0; }
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        var srv_name = $(this).closest('tr').find('input[type=text][id*=txtServiceName]').val();
        var _srvId = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
        var _doctor_id = $(this).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val();
        var _srv_class_id = $(this).closest('tr').find('input[type=hidden][id*=hdnServiceClass]').val();
        var cls_srv_id = $(this).closest('tr').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();

        if (srv_name != "REGISTRATION") {
            if (con_srv_id != _srvId) {
                OnRemoveConfirmation(this);
            }
        }


    });
}
function OnRemoveConfirmation(param) {

    if (param == undefined || param == null || param == '' || param == 'undefined') { param = 0; }
    var CurrentRowIndex = 0;
    var ev = param;
    var _srvId = 0, _doctor_id = 0, _srv_class_id = 0, _indentID = 0, _srv_name = '', slotid = 0; ;
    if (parseInt(ev) > 0 || parseInt(ev) == 0) /* With Row Index Start */
    {
        CurrentRowIndex = ev;
        _srvId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        _doctor_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        if (_doctor_id > 0) {
            slotid = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddlSlotTiming]').val();
            if (slotid != null) {
                slotid = slotid.split(',')[0];
            }
            if (slotid > 0) { DeleteSlotId = slotid; }
        }
        else { }
        _srv_class_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
        _srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
        _indentID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdn_ord_id]').val();

    } /* With Row Index Ends */
    else /* With out Row Index Starts */
    {
        CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
        if (ev.rowIndex != undefined) { CurrentRowIndex = ev.rowIndex; }
        if (CurrentRowIndex == undefined || CurrentRowIndex == null || CurrentRowIndex == '') { CurrentRowIndex = 0; }
        var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
        _doctor_id = $(ev).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val();
        _srv_class_id = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceClass]").val();
        _srv_name = $(ev).closest('tr').find("input[type=text][id*=txtServiceName]").val();
        _indentID = $(ev).closest('tr').find('input[type=hidden][id*=hdn_ord_id]').val();
        if (_doctor_id > 0) {
            slotid = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddlSlotTiming]').val();
            if (slotid != null) {
                slotid = slotid.split(',')[0];
            }
            if (slotid > 0) { DeleteSlotId = slotid; }
        }
    }
    if (_srvId > 0) { /* Deleting Starts */
        if (_indentID != '' && _indentID != undefined && _indentID != null) {
            document.getElementById('' + ctrlcom + '_UCServices_hdnRemoveSrv').value = 'Y';
        }

        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == "Cons") {
            if (parseInt(ev) >= 0) {
                var rowInd = ev;
                RemoveReqDoctor(rowInd);
            }
            else {
                var rowInd = ev.parentElement.parentElement.parentElement.rowIndex;
                RemoveReqDoctor(rowInd);
            }
        }
        if (parseFloat(DeleteSlotId) > 0) {
            RemoveSlotDataSelectionGrid(DeleteSlotId);
        }
        if (CurrentRowIndex == 1 && (_srv_class_id == '3' || _srv_class_id == '4')) {
            var GvRowscount = 0;
            var count = 0;
            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
            var _index = 0;
            var _index = grid.rows.length;

            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (x) {

                for (GvRowscount = 0; GvRowscount <= _index; GvRowscount++) {
                    var pkg_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                    var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                    var srv_grp_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val();
                    var srv_type_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnServiceTypID]').val();
                    var srv_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                    var doc_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
                    var dept_id = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
                    var srv_grp_name = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
                    var srv_type_name = $('[id$=gvServices] tr').filter(':eq(' + x + ')').find('input[type=hidden][id*=hdnSrv_Type_Name]').val();
                    if (doc_id == '' || doc_id == undefined || doc_id == null) { doc_id = 0; }
                    if (srv_grp_id == '' || srv_grp_id == undefined || srv_grp_id == null) { srv_grp_id = 0; }
                    if (srv_type_id == '' || srv_type_id == undefined || srv_type_id == null) { srv_type_id = 0; }
                    if (srv_id == '' || srv_id == undefined || srv_id == null) { srv_id = 0; }
                    if (dept_id == '' || dept_id == undefined || dept_id == null) { dept_id = 0; }
                    if (pkg_id == _srvId) {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + x + ')').remove();
                        removesrv_grp_and_type(srv_grp_id, srv_type_id, srv_id, doc_id, dept_id, srv_grp_name, srv_type_name);
                        arrServiceIds = $.grep(arrServiceIds, function (value) {
                            return value != pkg_srv_id;
                        });
                        GvRowscount = 0;
                    }
                    GvRowscount++;
                }
            });
            RemoveSrvClearAmnts();
        }
        else {
            var GvRowscount = 0;
            var count = 0;
            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
            var _index = 0;
            var _index = grid.rows.length;
            GvRowscount = _index;
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (y) {
                for (GvRowscount; GvRowscount >= 0; GvRowscount--) {
                    var pkg_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                    var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                    var Doc_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
                    var srv_grp_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val();
                    var srv_type_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceTypID]').val();
                    var srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
                    var dept_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
                    var srv_grp_name = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
                    var srv_type_name = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnSrv_Type_Name]').val();
                    if (Doc_id == '' || Doc_id == undefined || Doc_id == null) { Doc_id = 0; }
                    if (srv_grp_id == '' || srv_grp_id == undefined || srv_grp_id == null) { srv_grp_id = 0; }
                    if (srv_type_id == '' || srv_type_id == undefined || srv_type_id == null) { srv_type_id = 0; }
                    if (srv_id == '' || srv_id == undefined || srv_id == null) { srv_id = 0; }
                    if (dept_id == '' || dept_id == undefined || dept_id == null) { dept_id = 0; }
                    if (pkg_id == _srvId) {
                        $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount + ')').remove();
                        removesrv_grp_and_type(srv_grp_id, srv_type_id, srv_id, Doc_id, dept_id, srv_grp_name, srv_type_name);
                        var DisableMultiGrid = false;
                        var Number = 0;
                        if (pkg_srv_id == '2') {
                            pkg_srv_id = Doc_id;
                        }
                        arrServiceIds = $.grep(arrServiceIds, function (value) {
                            return value != pkg_srv_id;
                        });
                    }
                }

            });
        }
        if (parseInt(ev) >= 0) {
            var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            var Doc_id = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
            var srv_grp_id = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val();
            var srv_type_id = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnServiceTypID]').val();
            var srv_id = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            var dept_id = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
            var srv_grp_name = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
            var srv_type_name = $('[id$=gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnSrv_Type_Name]').val();
            if (Doc_id == '' || Doc_id == undefined || Doc_id == null) { Doc_id = 0; }
            if (srv_grp_id == '' || srv_grp_id == undefined || srv_grp_id == null) { srv_grp_id = 0; }
            if (srv_type_id == '' || srv_type_id == undefined || srv_type_id == null) { srv_type_id = 0; }
            if (srv_id == '' || srv_id == undefined || srv_id == null) { srv_id = 0; }
            if (dept_id == '' || dept_id == undefined || dept_id == null) { dept_id = 0; }
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').remove();
            removesrv_grp_and_type(srv_grp_id, srv_type_id, srv_id, Doc_id, dept_id, srv_grp_name, srv_type_name);
            arrServiceIds = $.grep(arrServiceIds, function (value) {
                return value != pkg_srv_id;
            });
        }
        else {

            var ev_index = ev.parentElement.parentElement.parentElement.rowIndex;
            if (ev_index == undefined || ev_index == null || ev_index == '') { ev_index = 0; }
            var Doc_id = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
            var srv_grp_id = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnServiceGrpID]').val();
            var srv_type_id = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnServiceTypID]').val();
            var srv_id = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnServiceID]').val();
            var dept_id = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnDepartment_Id]').val();
            var srv_grp_name = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnSrv_Grp_Name]').val();
            var srv_type_name = $('[id$=gvServices] tr').filter(':eq(' + ev_index + ')').find('input[type=hidden][id*=hdnSrv_Type_Name]').val();
            if (Doc_id == '' || Doc_id == undefined || Doc_id == null) { Doc_id = 0; }
            if (srv_grp_id == '' || srv_grp_id == undefined || srv_grp_id == null) { srv_grp_id = 0; }
            if (srv_type_id == '' || srv_type_id == undefined || srv_type_id == null) { srv_type_id = 0; }
            if (srv_id == '' || srv_id == undefined || srv_id == null) { srv_id = 0; }
            if (dept_id == '' || dept_id == undefined || dept_id == null) { dept_id = 0; }
            removesrv_grp_and_type(srv_grp_id, srv_type_id, srv_id, Doc_id, dept_id, srv_grp_name, srv_type_name);

            $(ev).closest('tr').remove();
            var GvRowscount = 0;
            var count = 0;
            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
            var _index = 0;
            var _index = grid.rows.length;
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
                var pkg_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
                var pkg_srv_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceID]').val();

                var isreginc = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnIsRegInclude]').val();
                if (isreginc == 'Y') {
                    isregfeeinc = 'Y';

                }
            });
            
            if ((isregfeeinc == 'N') && document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
                var regfee = document.getElementById('' + ctrlcom + '_hdnregfee').value;
                PatientRegFeeAmounts(regfee);
            }
        }
        var RowsLength = grid.rows.length;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = false;
        OnMultipleDiscGrid();
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled == true) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = false;

        }
        var hccard = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
        if (hccard == "" || hccard == undefined || hccard == null) { hccard = 0; }
        if (hccard != 0) {
            document.getElementById('ctl00_ContentPlaceHolder1_ReceiptControl2_ddlDiscountType').disabled = true;
        }

        if ($('#' + ctrlcom + '_UCServices_hdnisadditinal').val() == 'Y') {
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {


                $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val(0)
                $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val(setProperDecimals(0));

                $(this).closest('tr').find("input[type=text][id*=txtDiscP]").attr('disabled', true);
                $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").attr('disabled', true);
                CalculateGridAmt(e);
            });

        }
        if (_srvId == '2') {
            arrServiceIds = $.grep(arrServiceIds, function (value) {
                return value != _doctor_id;
            });
        }
        else {
            arrServiceIds = $.grep(arrServiceIds, function (value) {
                return value != _srvId;
            });
        }
        /*This is for under packages */
        if (_srv_class_id > 0 && _srv_class_id == 3) {
            var MainPkgValues = document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value;
            if ((MainPkgValues != NaN) && (MainPkgValues != '') && (MainPkgValues != undefined)) {
                var PkgValue = MainPkgValues.split('$');
                if (PkgValue.length > 0) {
                    var ChildArray = new Array();
                    document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value = '';
                    for (var p = 0; p < PkgValue.length; p++) {
                        var SubArray = PkgValue[p].split('*');
                        if (SubArray[0].length > 0) {
                            var PkgNames = SubArray[0].split(',');
                            if (PkgNames[0] != _srvId) {
                                if (p == PkgValue.length - 1)
                                    document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value += PkgValue[p];
                                else
                                    document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value += PkgValue[p] + "$";
                            }
                        }

                    }
                }
            }
        }
        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
        var credit_limit = '0';
        var FlagLimitTrue = true;
        if (form_name == 'OP' || form_name == 'Cons') {
            credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
        }
        else if (form_name == 'OPQUICK') {
            credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();
        } else { }
        if (parseFloat(credit_limit) > 0) {
            if (parseFloat($('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtCNetAmt]').val()) > 0) {
                $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
                    var ev = $(this)[0].rowIndex;
                    if (ev >= CurrentRowIndex) {

                        var cmpnetamt = $(this).closest('tr').find('input[type=text][id*=txtCNetAmt]').val();
                        if (parseFloat(cmpnetamt) > 0) {
                            ev = ev == undefined || NaN ? 1 : ev;
                            CalculateGridAmtLimits(ev);
                        }
                    }
                });
            }
        }
        else {
            CalculateGridAmt(CurrentRowIndex);
        }

        var hcid = '';
        var hcNo = '';
        var form_name = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
        if (form_name == 'OP' || form_name == 'Cons') {
            hcid = document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnhealthcard_id').value;
            hcNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_HdnHealthcardno').value;
        }
        else if (form_name == 'OPQUICK') {
            hcid = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardid').value;
            hcNo = document.getElementById('' + ctrlcom + '_ReceiptControl2_HdnHealthcardno').value;
        }
        hcid = hcid == '' ? 0 : hcid;
        hcNo = hcNo == '' ? 0 : hcNo;
        if (hcid > 0) {
            BindPatientHealthCrad(hcid, hcNo);
        } else {
            if (hcid == 0) {
                $("table[id*=gvMultipleConcession] tr:has(td)").each(function (e) {
                    hcid = $(this).closest("tr").find("input[id*=hdncardid]").val();
                });
                BindPatientHealthCrad(hcid, hcNo);
            }
        }

        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons') {
            var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        } else {
            if (form_name == 'OPQUICK') {
                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

                } else {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
                }
            }
        }
        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
        { Cmp_id = 0; }

        if (Cmp_id == 0) {
            var con_ruleId = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
            if (con_ruleId == undefined || con_ruleId == null || con_ruleId == '')
            { con_ruleId = 0; }
            if (con_ruleId > 0) {
                ClearAllConcessionControlforconrule();
                con_rule_name = $('#' + ctrlcom + '_UCServices_hdnconrulename').val();
                var RowsLength = grid.rows.length;
                if (RowsLength > 0) {
                    var rcTotAmt = 0, rcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
                    $("table[id*=gvServices] tr:has(td)").each(function (e) {
                        var rcAmt = $(this).closest('tr').find("[id*=txtcncrlAmt]").val();
                        var rcPer = $(this).closest("tr").find("[id*=txtRulePer]").val();
                        var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                        var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                        var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                        var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                        if (chamt == undefined || chamt == null || chamt == '')
                        { chamt = 0; }
                        if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                        { chpcnt = 0; }
                        if (b_amt == undefined || b_amt == null || b_amt == '') { b_amt = 0; }
                        if (n_amt == undefined || n_amt == null || n_amt == '') { n_amt = 0; }

                        if (rcAmt == undefined || rcAmt == null || rcAmt == '') { rcAmt = 0; }
                        if (rcPer == undefined || rcPer == null || rcPer == '') { rcPer = 0; }
                        if (chamt == undefined || chamt == null || chamt == '') { chamt = 0; }
                        if (chpcnt == undefined || chpcnt == null || chpcnt == '') { chpcnt = 0; }

                        typeof rcAmt == 'string' ? (typeof rcAmt == 'undefined' || rcAmt.trim() == '' ? 0 : parseFloat(rcAmt)) : (typeof rcAmt == 'object' ? 0 : parseFloat(rcAmt));
                        typeof rcPer == 'string' ? (typeof rcPer == 'undefined' || rcPer.trim() == '' ? 0 : parseFloat(rcPer)) : (typeof rcPer == 'object' ? 0 : parseFloat(rcPer));
                        rcTotAmt += parseFloat(rcAmt);
                        rcTotPer += parseFloat(rcPer);
                        chtotamt += parseFloat(chamt);
                        chtotpcnt += parseFloat(chpcnt);
                        btot_amt += parseFloat(b_amt);
                        ntot_amt += parseFloat(n_amt);
                    });
                    var chTotalOnPatGrossper = (parseFloat(rcTotAmt) / parseFloat(btot_amt)) * 100;
                    var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
                    chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
                    chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);
                    if (chTotalOnPatGrossamt > 0) {
                        $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                        $("#payitem2,._quick-div").show();
                        $("._mdisc").css('width', '72%');
                        $("#payitem1,#payitem3").hide();
                        $('[id*=ConcessionAmt]')[0].style.display = 'none';
                        $("#lbladvanced").addClass("select");
                        $("#lblquick").removeClass("select");
                        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
                        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = true;
                        document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlDiscountType').disabled = true;
                        $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
                        var x = 1;
                        var disc_grid_length = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length;
                        if (disc_grid_length == 2) {
                            fn_AddRowWithDetais();
                        }


                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[1].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtcardno]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAutherizedPersion]')[0].disabled = true;
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]').val(2);
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtcardno]').val(con_rule_name);
                        $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("input[type=hidden][id*=hdncardid]").val(con_ruleId);
                        $('table[id*=gvMultipleConcession] tr').filter(':eq(' + x + ')').find("[id*=ddlMultiDiscounttype]").val(6);
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtCRemks]').val(con_rule_name);
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtCRemks]').removeClass('red');
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAutherizedPersion]').val(con_rule_name);
                        $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find("input[type=hidden][id*=hdnauthid]").val($('#' + ctrlcom + '_UCServices_hdnconruledefindbyid').val());
                        $('[id*=pnlGridPop]').css("display", "none");
                    }
                    else {
                        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled == true) {
                            document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = false;

                        }
                    }

                } else {
                    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled == true) {
                        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = false;

                    }
                }

            }
            else {

                var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                var _index_net = grid.rows.length;
                if (_index_net == 0) {
                    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled == true) {
                        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = false;

                    }
                }

            }

        }
        if ($('#' + ctrlcom + '_UCServices_hdnisadditinal').val() == 'Y') {
            $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
                var discount_pnt = $(this).closest('tr').find('input[type=hidden][id*=hdntxtDiscP]').val();
                if (discount_pnt == null || discount_pnt == '' || discount_pnt == undefined)
                { discount_pnt = 0; }
                if (parseFloat(discount_pnt) > 0) {

                    var pAmt = 0;

                    pAmt = $(this).closest('tr').find('input[type=text][id*=txtRate]').val();
                    $(this).closest('tr').find('input[type=text][id*=txtDiscP]').val(discount_pnt);
                    var PconAmt = Math.round(parseFloat(pAmt) * parseFloat(discount_pnt) / 100);
                    $(this).closest('tr').find('input[type=text][id*=txtPamt]').val(pAmt);

                    $(this).closest('tr').find('input[type=text][id*=txtDiscAmt]').val(PconAmt);
                    var pNetAmt = parseFloat(pAmt) - parseFloat(PconAmt);
                    pNetAmt = pNetAmt > 0 ? pNetAmt : 0;
                    $(this).closest('tr').find('input[type=text][id*=txtPNAmt]').val(pNetAmt);

                    var x = 1;
                    var disc_grid_length = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length;
                    if (disc_grid_length == 1) {
                        fn_AddRowWithDetais();
                    }
                    $(".col-hide tr:nth-child(3),.col-hide tr:nth-child(4),.col-hide tr:nth-child(5),.col-hide tr:nth-child(6),.col-hide tr:nth-child(7),.col-hide tr:nth-child(8),.col-hide tr:nth-child(10),.col-hide tr:nth-child(13),.col-hide tr:nth-child(14),.col-hide tr:nth-child(15)").show();
                    $("#payitem2,._quick-div").show();
                    $("._mdisc").css('width', '72%');
                    $("#payitem1,#payitem3").hide();
                    $('[id*=ConcessionAmt]')[0].style.display = 'none';
                    $("#lbladvanced").addClass("select");
                    $("#lblquick").removeClass("select");
                    document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
                    $('#' + ctrlcom + '_ReceiptControl2_Div2')[0].style.display = 'block';
                    var hcTotAmt = 0, hcTotPer = 0, EvTotAmt = 0, EvTotPer = 0, CnTotAmt = 0, CnTotPer = 0, chtotamt = 0, chtotpcnt = 0, btot_amt = 0; ntot_amt = 0;
                    $("table[id*=gvServices] tr:has(td)").each(function (e) {
                        var hcAmt = $(this).closest('tr').find("[id*=txtHcAmt]").val();
                        var hcPer = $(this).closest("tr").find("[id*=txthcPer]").val();
                        var chamt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                        var chpcnt = $(this).closest("tr").find("[id*=txtDiscAmt]").val();
                        var b_amt = $(this).closest("tr").find("[id*=txtPamt]").val();
                        var n_amt = $(this).closest("tr").find("[id*=txtPNAmt]").val();
                        if (chamt == undefined || chamt == null || chamt == '')
                        { chamt = 0; }
                        if (chpcnt == undefined || chpcnt == null || chpcnt == '')
                        { chpcnt = 0; }
                        typeof hcPer == 'string' ? (typeof hcPer == 'undefined' || hcPer.trim() == '' ? 0 : parseFloat(hcPer)) : (typeof hcPer == 'object' ? 0 : parseFloat(hcPer));
                        typeof hcAmt == 'string' ? (typeof hcAmt == 'undefined' || hcAmt.trim() == '' ? 0 : parseFloat(hcAmt)) : (typeof hcAmt == 'object' ? 0 : parseFloat(hcAmt));
                        hcTotAmt += parseFloat(hcAmt);
                        hcTotPer += parseFloat(hcPer);
                        chtotamt += parseFloat(chamt);
                        chtotpcnt += parseFloat(chpcnt);
                        btot_amt += parseFloat(b_amt);
                        ntot_amt += parseFloat(n_amt);
                    });
                    var chTotalOnPatGrossper = (parseFloat(chtotamt) / parseFloat(btot_amt)) * 100;
                    var chTotalOnPatGrossamt = (parseFloat(btot_amt) * parseFloat(chTotalOnPatGrossper)) / 100;
                    chTotalOnPatGrossper = setProperDecimals(chTotalOnPatGrossper);
                    chTotalOnPatGrossamt = setProperDecimals(chTotalOnPatGrossamt);

                    $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtPersentage]').val(chTotalOnPatGrossper);
                    $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=txtAmount]').val(chTotalOnPatGrossamt);
                    $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]')[0].disabled = true;
                    $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=BtnSrvSearch]')[0].disabled = true;
                    $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlMultiDiscounttype]').val(1);
                    $("table[id$=gvMultipleConcession] tr").filter(":eq(" + x + ")").find('[id*=ddlModes]').val(2);
                }


            });
        }




        if (FlagLimitTrue == true) {
            CalculateMultiDiscountGridTypeBased(CurrentRowIndex, 'SRV');
        }
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OPQUICK' || document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OP') {
            var MainValues = document.getElementById('' + ctrlcom + '_hdnSelection').value;
            if ((MainValues != NaN) && (MainValues != '') && (MainValues != undefined)) {
                var DollarValue = MainValues.split('$');

                if (DollarValue.length > 0) {
                    var ChildArray = new Array();
                    document.getElementById('' + ctrlcom + '_hdnSelection').value = '';
                    for (var p = 0; p < DollarValue.length; p++) {

                        var SubArray = DollarValue[p].split('*');
                        if (SubArray[0].length > 0) {
                            var TestNames = SubArray[0].split(',');
                            if (TestNames[0] != _srvId) {
                                if (p == DollarValue.length - 1)
                                    document.getElementById('' + ctrlcom + '_hdnSelection').value += DollarValue[p];
                                else
                                    document.getElementById('' + ctrlcom + '_hdnSelection').value += DollarValue[p] + "$";

                            }
                        }

                    }

                }
            }
        }
    } /* Deleting Ends */
    else {
        $(".stoast").toastText("warning", "No Services exists to Delete!", 5, 3);
    }
    AssignSno(0);
    onExtendedGrid();
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value != 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length == 0) {
        }
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length <= 2) {
        }
    }
    var index_data = document.getElementById('' + ctrlcom + '_UCServices_gvServices').rows.length;
    var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
    if (form_name == 'OPQUICK') {
        if (index_data > 1) {
            document.getElementById('ctl00_ContentPlaceHolder1_chkhccrd').disabled = true;
        }
        else {
            document.getElementById('ctl00_ContentPlaceHolder1_chkhccrd').disabled = false;
        }
    }
    return false;
}
function OnRemoveCancelConfirmation() {
    return false;
}

function RemoveGridViewService(ev) {

    $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('N');
    var srv_name;
    var CurrentRowIndex = 0;
    if (parseInt(ev) > 0) {
        CurrentRowIndex = ev;
        var _srvId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
    }
    else if (parseInt(ev) == 0) {
        var _srvId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        srv_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
    }
    else {
        CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
        if (CurrentRowIndex == undefined || CurrentRowIndex == null || CurrentRowIndex == '') { CurrentRowIndex = 0; }
        var _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
        srv_name = $(ev).closest('tr').find('input[type=text][id*=txtServiceName]').val();

    }
    var con_srv_id = 0;
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnallowconsservice').value.toUpperCase() == "TRUE") {
            con_srv_id = document.getElementById('' + ctrlcom + '_UCServices_hdnconssrvID').value;
        }
    }
    else {
        if (document.getElementById('' + ctrlcom + '_chk_old') != null) {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {

                if (document.getElementById('' + ctrlcom + '_UCServices_hdnallowconsservice').value.toUpperCase() == "TRUE") {
                    con_srv_id = document.getElementById('' + ctrlcom + '_UCServices_hdnconssrvID').value;

                }

            }
        }
    }

    if (con_srv_id == null || con_srv_id == undefined || con_srv_id == '' || con_srv_id == "undefined") { con_srv_id = 0; }



    if (_srvId > 0) {
        ConfirmationRequiredForRemoove(ev, 'Do you want to Remove ' + srv_name + ' ?');
        document.getElementById('ctl00_ContentPlaceHolder1_UCServices_txtdaycount').value = "";
        document.getElementById('ctl00_ContentPlaceHolder1_UCServices_txtdeptcount').value = "";
        document.getElementById('ctl00_ContentPlaceHolder1_UCServices_txtconsutacont').value = "";

    }
    else {
        $(".stoast").toastText("warning", "No Services exists to Delete!", 5, 3);
    }


    return false;
}

function CalculateGridAmtLimits(ev) {

    var corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
    var emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
    if (corppcnt == undefined || corppcnt == null || corppcnt == "" || isNaN(corppcnt)) { corppcnt = "0"; }
    if (emppcnt == undefined || emppcnt == null || emppcnt == "" || isNaN(emppcnt)) { emppcnt = "0"; }
    corppcnt = parseFloat(corppcnt);
    emppcnt = parseFloat(emppcnt);
    var RegSrv = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtServiceName]').val();
    var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtQty]').val();
    var rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRate]').val();

    qty = typeof qty == 'string' ? (typeof qty == 'undefined' || qty.trim() == '' ? 0 : parseFloat(qty)) : (typeof qty == 'object' ? 0 : parseFloat(qty));
    rate = typeof rate == 'string' ? (typeof rate == 'undefined' || rate.trim() == '' ? 0 : parseFloat(rate)) : (typeof rate == 'object' ? 0 : parseFloat(rate));

    var amt = parseInt(qty) * parseInt(rate);
    var EmpDiscPT = '0';
    var EmpDiscFT = '0';
    var _netamt = 0;

    $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtAmount]').val(amt);
    var PDiPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val();
    var PDiAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val();
    var StPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val();
    var StAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val();
    var mgmtyPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val();
    var mgmtAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val();
    var HcPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val();
    var HCAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val();
    var ConcesrulePcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val();
    var ConcesruleAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val();
    var EventBasedPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val();
    var EventBaseAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val();
    EventBasedPer = typeof EventBasedPer == 'string' ? (typeof EventBasedPer == 'undefined' || EventBasedPer.trim() == '' ? 0 : parseFloat(EventBasedPer)) : (typeof EventBasedPer == 'object' ? 0 : parseFloat(EventBasedPer));
    EventBaseAmt = typeof EventBaseAmt == 'string' ? (typeof EventBaseAmt == 'undefined' || EventBaseAmt.trim() == '' ? 0 : parseFloat(EventBaseAmt)) : (typeof EventBaseAmt == 'object' ? 0 : parseFloat(EventBaseAmt));
    ConcesrulePcntS = typeof ConcesrulePcntS == 'string' ? (typeof ConcesrulePcntS == 'undefined' || ConcesrulePcntS.trim() == '' ? 0 : parseFloat(ConcesrulePcntS)) : (typeof ConcesrulePcntS == 'object' ? 0 : parseFloat(ConcesrulePcntS));
    ConcesruleAmt = typeof ConcesruleAmt == 'string' ? (typeof ConcesruleAmt == 'undefined' || ConcesruleAmt.trim() == '' ? 0 : parseFloat(ConcesruleAmt)) : (typeof ConcesruleAmt == 'object' ? 0 : parseFloat(ConcesruleAmt));
    HcPcntS = typeof HcPcntS == 'string' ? (typeof HcPcntS == 'undefined' || HcPcntS.trim() == '' ? 0 : parseFloat(HcPcntS)) : (typeof HcPcntS == 'object' ? 0 : parseFloat(HcPcntS));
    HCAmtS = typeof HCAmtS == 'string' ? (typeof HCAmtS == 'undefined' || HCAmtS.trim() == '' ? 0 : parseFloat(HCAmtS)) : (typeof HCAmtS == 'object' ? 0 : parseFloat(HCAmtS));
    mgmtyPcntS = typeof mgmtyPcntS == "string" ? (mgmtyPcntS.trim() == "" ? "0" : mgmtyPcntS) : (typeof mgmtyPcntS == "number" ? mgmtyPcntS : "0");
    mgmtAmtS = typeof mgmtAmtS == "string" ? (mgmtAmtS.trim() == "" ? "0" : mgmtAmtS) : (typeof mgmtAmtS == "number" ? mgmtAmtS : "0");
    StPcntS = typeof StPcntS == "string" ? (StPcntS.trim() == "" ? "0" : StPcntS) : (typeof StPcntS == "number" ? StPcntS : "0");
    StAmtS = typeof StAmtS == "string" ? (StAmtS.trim() == "" ? "0" : StAmtS) : (typeof StAmtS == "number" ? StAmtS : "0");
    var credit_limit = '0';
    if (PDiPcntS == undefined || PDiPcntS == null || isNaN(PDiPcntS) || PDiPcntS == '') { PDiPcntS = '0'; }
    if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    var pat_type = '1';
    if (form_name == 'OP' || form_name == 'Cons') {
        pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
        credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
    }
    else if (form_name == 'OPQUICK') {
        pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
        credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();
    }
    if ((form_name == 'OP' || form_name == 'Cons') && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_chkEmpDue').checked == true) {
            document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = "0";
            document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = "100";
            corppcnt = "0";
            emppcnt = "100";
        }
        else {
            corppcnt = parseFloat(corppcnt);
            emppcnt = parseFloat(emppcnt);
            document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = document.getElementById('' + ctrlcom + '_hdnOrgPer').value;
            document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = document.getElementById('' + ctrlcom + '_hdnEmpPer').value;
        }

        if ((form_name == 'OP' || form_name == 'Cons') && pat_type == '2') {
        }
    }
    var CompanyPayTotalServiceWise = 0;
    var GvRowscount_net1 = 0;
    var grid1 = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _index_net1 = 0;
    var _index_net1 = grid1.rows.length;
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
        for (GvRowscount_net1; GvRowscount_net1 < _index_net1; GvRowscount_net1++) {
            if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net1 + ')').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net1 + ')').find('input[type=text][id*=txtCNetAmt]').val();
                if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                CompanyPayTotalServiceWise = parseFloat(CompanyPayTotalServiceWise) + parseFloat(cmp_n_amt);
            }
        }
    });
    var cmpAmt = "0", empamt = "0";

    if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {
        if (RegSrv != 'REGISTRATION') {
            cmpAmt = ((parseFloat(amt) * parseFloat(corppcnt)) / parseFloat(100));
            empamt = ((parseFloat(amt) * parseFloat(emppcnt)) / parseFloat(100));
        }
    }
    else {
        cmpAmt = ((parseFloat(amt) * parseFloat(corppcnt)) / parseFloat(100));
        empamt = ((parseFloat(amt) * parseFloat(emppcnt)) / parseFloat(100));
    }

    var cmpdiscpcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(); /* Company Master Tariff Wise Discount Pcnt */
    /*Only Op */
    var cmpNAmt = 0;
    var CmpDiscAmt = '0';
    var cmpDiscPcnt = '0';
    if (parseFloat(cmpdiscpcnt) > 0) {
        cmpDiscPcnt = cmpdiscpcnt;
        CmpDiscAmt = (parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100);
        cmpNAmt = parseFloat(cmpAmt) - parseFloat(CmpDiscAmt);
    }
    else {
        cmpNAmt = parseFloat(cmpAmt);
    }
    /*New Changes Begin*/
    if (qty > 1)
    { $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('Y'); } else {
        if (CompanyPayTotalServiceWise == credit_limit) {
            $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('Y');
            corppcnt = 0;
            emppcnt = 100;
        } else
        { }
    }
    /*New Changes End*/


    var GvRowscount_net = 0;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _index_net = 0;
    var _index_net = grid.rows.length;
    if (RegSrv != 'REGISTRATION') {

        var cmp_t_net_amt = cmpNAmt;
    }
    if (parseFloat(qty) > 1) {
        var cmp_t_net_amt = cmpNAmt;
    }
    else if (grid.rows.length == 1) {
        var cmp_t_net_amt = cmpNAmt;
    }
    else {
        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net; GvRowscount_net < _index_net; GvRowscount_net++) {
                if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                    var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtCNetAmt]').val();
                    if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                    cmp_t_net_amt = parseFloat(cmp_t_net_amt) + parseFloat(cmp_n_amt);
                }
            }
        });
    }
    var post = $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val();
    if (cmp_t_net_amt == "" || cmp_t_net_amt == undefined || cmp_t_net_amt == null) { cmp_t_net_amt = 0; }
    if (credit_limit == "" || credit_limit == undefined || credit_limit == null) { credit_limit = 0; }
    var chng_amt = parseFloat(cmp_t_net_amt) - parseFloat(credit_limit);
    chng_amt = chng_amt < 0 ? 0 : chng_amt;
    empamt = (parseFloat(empamt) + parseFloat(chng_amt) + parseFloat(CmpDiscAmt));
    cmpAmt = (parseFloat(cmpAmt) - parseFloat(chng_amt) - parseFloat(CmpDiscAmt));
    empamt = empamt < 0 ? 0 : empamt;
    cmpAmt = cmpAmt < 0 ? 0 : cmpAmt;

    CmpDiscAmt = (parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100);

    if (parseFloat(CmpDiscAmt) > 0) { } else { CmpDiscAmt = 0; }
    cmpNAmt = (parseFloat(cmpAmt) - parseFloat(CmpDiscAmt));
    $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('N');

    if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {/* Company And Patient Sagrigation */
        if (RegSrv != 'REGISTRATION') {
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(empamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(mgmtyPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(StPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(HcPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(ConcesrulePcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(EventBasedPer);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(empamt) - parseFloat(PDiAmtS));
            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val(cmpAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val(CmpDiscAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val(cmpNAmt);
        }
    }
    else {/* Only Patient Amounts */
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(mgmtyPcntS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(StPcntS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(HcPcntS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(ConcesrulePcntS);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(EventBasedPer);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - parseFloat(PDiAmtS));
        /*Company Has To Implement */
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val('0');
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
    }

    var Perconces = 0, concession = 0, txtPayAmt = 0, dec = 2;
    var sGrid = document.getElementById('' + ctrlcom + '_gvServices');
    var TAmount = 0, GAmount = 0, Amount = 0, NetAmount = 0, Qty = 0, Rate = 0, IndivConcession = 0, InitialAmount = 0, TotConcession = 0;
    var CmpTBAmt = 0, CmpTCAmt = 0, CmpTNAmt = 0;
    var PatTBAmt = 0, PatTCAmt = 0, PatMgCAmt = 0, StMgCAmt = 0, PatTNAmt = 0, HCAmt = 0, CncRuleAmt = 0, EventBasedAmt = 0;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        Qty = $(this).closest('tr').find("input[type=text][id*=txtQty]").val();
        Rate = $(this).closest('tr').find("input[type=text][id*=txtRate]").val();
        Amount = parseFloat(Qty) * parseFloat(Rate);
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked == false) {
            var _dscper = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis');
            PatCalculateConcessionTransaction(_dscper, 'Perecent');
        }
        var Class_Srv_id = $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val();
        var Service_Class_id = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceClass]").val();
        var mgmtAmt = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
        var StmtAmt = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
        var Discamt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
        var HcDiscamt = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();
        var CncsnRuleamtInner = $(this).closest('tr').find("input[type=text][id*=txtcncrlAmt]").val();
        var EventBasedInner = $(this).closest('tr').find("input[type=text][id*=txtebAmt]").val();

        EventBasedInner = typeof EventBasedInner == 'string' ? (typeof EventBasedInner == 'undefined' || EventBasedInner.trim() == '' ? 0 : parseFloat(EventBasedInner)) : (typeof EventBasedInner == 'object' ? 0 : parseFloat(EventBasedInner));
        CncsnRuleamtInner = typeof CncsnRuleamtInner == 'string' ? (typeof CncsnRuleamtInner == 'undefined' || CncsnRuleamtInner.trim() == '' ? 0 : parseFloat(CncsnRuleamtInner)) : (typeof CncsnRuleamtInner == 'object' ? 0 : parseFloat(CncsnRuleamtInner));
        Discamt = typeof Discamt == "string" ? (Discamt.trim() == "" ? "0" : Discamt) : (typeof Discamt == "number" ? Discamt : "0");
        mgmtAmt = typeof mgmtAmt == "string" ? (mgmtAmt.trim() == "" ? "0" : mgmtAmt) : (typeof mgmtAmt == "number" ? mgmtAmt : "0");
        StmtAmt = typeof StmtAmt == "string" ? (StmtAmt.trim() == "" ? "0" : StmtAmt) : (typeof StmtAmt == "number" ? StmtAmt : "0");
        HcDiscamt = typeof HcDiscamt == 'string' ? (typeof HcDiscamt == 'undefined' || HcDiscamt.trim() == '' ? 0 : parseFloat(HcDiscamt)) : (typeof HcDiscamt == 'object' ? 0 : parseFloat(HcDiscamt));
        CncRuleAmt = typeof CncRuleAmt == 'string' ? (typeof CncRuleAmt == 'undefined' || CncRuleAmt.trim() == '' ? 0 : parseFloat(CncRuleAmt)) : (typeof CncRuleAmt == 'object' ? 0 : parseFloat(CncRuleAmt));

        if (parseInt(Class_Srv_id) > 0) {
            Amount = '0';
        }
        if (!isNaN(Amount))
            GAmount = parseFloat(GAmount) + parseFloat(Amount);

        if (!isNaN(IndivConcession))
            TotConcession = parseFloat(TotConcession) + parseFloat(IndivConcession); 
        var PatBAmt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
        var PatCAmt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
        var PatMgCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
        var patStCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
        var PatPNAmt = $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val();
        var HCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();


        PatMgCAmtInner = typeof PatMgCAmtInner == "string" ? (PatMgCAmtInner.trim() == "" ? "0" : PatMgCAmtInner) : (typeof PatMgCAmtInner == "number" ? PatMgCAmtInner : "0");
        patStCAmtInner = typeof patStCAmtInner == "string" ? (patStCAmtInner.trim() == "" ? "0" : patStCAmtInner) : (typeof patStCAmtInner == "number" ? patStCAmtInner : "0");
        HCAmtInner = typeof HCAmtInner == 'string' ? (typeof HCAmtInner == 'undefined' || HCAmtInner.trim() == '' ? 0 : parseFloat(HCAmtInner)) : (typeof HCAmtInner == 'object' ? 0 : parseFloat(HCAmtInner));


        if (PatBAmt == undefined || PatBAmt == null || PatBAmt == "" || isNaN(PatBAmt)) { PatBAmt = "0"; }
        if (PatCAmt == undefined || PatCAmt == null || PatCAmt == "" || isNaN(PatCAmt)) { PatCAmt = "0"; }
        if (PatPNAmt == undefined || PatPNAmt == null || PatPNAmt == "" || isNaN(PatPNAmt)) { PatPNAmt = "0"; }

        if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
            PatBAmt = '0';
            PatCAmt = '0';
            PatPNAmt = '0';
        }
        if (parseInt(PatTBAmt) > 0) {

        }
        else {
            PatTBAmt = '0';
            PatTCAmt = '0';
            PatTNAmt = '0';
        }
        PatTBAmt = parseFloat(PatTBAmt) + parseFloat(PatBAmt);
        PatTCAmt = parseFloat(PatTCAmt) + parseFloat(PatCAmt);
        PatMgCAmt = parseFloat(PatMgCAmt) + parseFloat(PatMgCAmtInner);
        StMgCAmt = parseFloat(StMgCAmt) + parseFloat(patStCAmtInner);
        HCAmt = parseFloat(HCAmt) + parseFloat(HCAmtInner);
        CncRuleAmt = parseFloat(CncRuleAmt) + parseFloat(CncsnRuleamtInner);
        PatTNAmt = parseFloat(PatTNAmt) + parseFloat(PatPNAmt);
        EventBasedAmt = parseFloat(EventBasedAmt) + parseFloat(EventBasedInner);

        IndivConcession = (parseFloat(Discamt) + parseFloat(mgmtAmt) + parseFloat(StmtAmt) + parseFloat(HCAmtInner) + parseFloat(PatMgCAmtInner) + parseFloat(EventBasedAmt));

        if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons'))
            && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            if (parseInt(CmpTBAmt) > 0) {
            }
            else {
                CmpTBAmt = '0';
                CmpTCAmt = '0';
                CmpTNAmt = '0';
            }
            var CmpBAmt = $(this).closest('tr').find("input[type=text][id*=txtCamt]").val();
            var CmpCAmt = $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").val();
            var CmpCNAmt = $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").val();

            if (CmpBAmt == undefined || CmpBAmt == null || CmpBAmt == "" || isNaN(CmpBAmt)) { CmpBAmt = "0"; }
            if (CmpCAmt == undefined || CmpCAmt == null || CmpCAmt == "" || isNaN(CmpCAmt)) { CmpCAmt = "0"; }
            if (CmpCNAmt == undefined || CmpCNAmt == null || CmpCNAmt == "" || isNaN(CmpCNAmt)) { CmpCNAmt = "0"; }

            if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
                CmpBAmt = '0';
                CmpCAmt = '0';
                CmpCNAmt = '0';
            }
            CmpTBAmt = parseFloat(CmpTBAmt) + parseFloat(CmpBAmt);
            CmpTCAmt = parseFloat(CmpTCAmt) + parseFloat(CmpCAmt);
            CmpTNAmt = parseFloat(CmpTNAmt) + parseFloat(CmpCNAmt);
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
            if (parseInt(CmpTBAmt) > 0) {
            }
            else {
                CmpTBAmt = '0';
                CmpTCAmt = '0';
                CmpTNAmt = '0';
            }
            var CmpBAmt = $(this).closest('tr').find("input[type=text][id*=txtCamt]").val();
            var CmpCAmt = $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").val();
            var CmpCNAmt = $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").val();

            if (CmpBAmt == undefined || CmpBAmt == null || CmpBAmt == "" || isNaN(CmpBAmt)) { CmpBAmt = "0"; }
            if (CmpCAmt == undefined || CmpCAmt == null || CmpCAmt == "" || isNaN(CmpCAmt)) { CmpCAmt = "0"; }
            if (CmpCNAmt == undefined || CmpCNAmt == null || CmpCNAmt == "" || isNaN(CmpCNAmt)) { CmpCNAmt = "0"; }

            CmpTBAmt = parseFloat(CmpTBAmt) + parseFloat(CmpBAmt);
            CmpTCAmt = parseFloat(CmpTCAmt) + parseFloat(CmpCAmt);
            CmpTNAmt = parseFloat(CmpTNAmt) + parseFloat(CmpCNAmt);
        }
    });
    if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons'))
    && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
        var company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        $('#' + ctrlcom + '_txtCorpPayAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtCorpDueAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtEmpPayAmt').val(parseFloat(GAmount) - parseFloat(TotConcession));
        $('#' + ctrlcom + '_txtEmpPayAmt').val(PatTNAmt);
    }
    else {
        $('#' + ctrlcom + '_txtCorpPayAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtCorpDueAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtEmpPayAmt').val(parseFloat(GAmount) - parseFloat(TotConcession));
        $('#' + ctrlcom + '_txtEmpPayAmt').val(PatTNAmt);
    }
    var reg_fee = 0;
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnRegconSetting').value == "Yes") {
    }
    else {
        reg_fee = document.getElementById('' + ctrlcom + '_UCServices_hdnReg_fee').value;
    }
    if (reg_fee == undefined || reg_fee == '' || reg_fee == null) { reg_fee = "0"; }


    GAmount = setProperDecimals(parseFloat(GAmount) + parseFloat(reg_fee));
    PatTBAmt = setProperDecimals(parseFloat(PatTBAmt) + parseFloat(reg_fee));
    PatTNAmt = setProperDecimals(parseFloat(PatTNAmt) + parseFloat(reg_fee));
    if (parseInt(PatTCAmt) > 0 || parseInt(CmpTCAmt) > 0 || PatMgCAmt > 0 || StMgCAmt > 0 || HCAmt > 0 || CncRuleAmt > 0 || EventBasedAmt > 0) {
        ClearTransactionGrid();
        /*Total Gross Amounts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = PatTBAmt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = CmpTBAmt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTBAmt) + parseFloat(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = PatTNAmt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = PatTNAmt;
        /*Total Due Amount */
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = PatTNAmt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = PatTNAmt;

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = CmpTNAmt
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(PatTNAmt) + parseFloat(CmpTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = 0;

        if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {

            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
        }

        /*Advanced Disc Types */

        var PatDiscPcnt = (parseFloat(100) * (parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt))) / parseFloat(PatTBAmt);

        if (parseInt(PatDiscPcnt) > 0)
        { }
        else
        { PatDiscPcnt = '0'; }
        PatDiscPcnt = setProperDecimals(PatDiscPcnt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = PatDiscPcnt;
        var cmpDiscPcnt = (parseFloat(100) * parseFloat(CmpTCAmt)) / parseFloat(CmpTBAmt);
        if (parseInt(cmpDiscPcnt) > 0)
        { }
        else
        { cmpDiscPcnt = '0'; }
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartydis').value = cmpDiscPcnt;
        if (parseFloat(PatTCAmt) > 0)
        { }
        else
        { PatTCAmt = '0'; }
        if (parseFloat(CmpTCAmt) > 0)
        { }
        else
        { CmpTCAmt = '0'; }

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = setProperDecimals(parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt));
        /*  if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value) > parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value)) {   
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value);
        }*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartygrossamt').value = CmpTCAmt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = setProperDecimals(parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt) + parseFloat(CmpTCAmt));
        /*   if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value) > parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value)) {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value);
        }*/
        /*Net Amounts */
        if (parseFloat(PatTNAmt) > 0)
        { }
        else
        { PatTNAmt = '0'; }
        if (parseFloat(CmpTNAmt) > 0)
        { }
        else
        { CmpTNAmt = '0'; }
        var concessionamt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value;
        if (concessionamt == undefined || concessionamt == '' || concessionamt == null) { concessionamt = "0"; }
        var PatGAmount = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
        PatGAmount = typeof PatGAmount == 'string' ? (typeof PatGAmount == 'undefined' || PatGAmount.trim() == '' ? 0 : parseFloat(PatGAmount)) : (typeof PatGAmount == 'object' ? 0 : parseFloat(PatGAmount));

        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);

        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = setProperDecimals(parseFloat(PatTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = setProperDecimals(parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = setProperDecimals(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = setProperDecimals(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(setProperDecimals(PatTNAmt));

        if (document.getElementById('' + ctrlcom + '_UCServices_hdnisadditinal').value == 'Y')
        { CurrentRowIndexNew = 1; }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '1') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(setProperDecimals(PatTCAmt));
                var PatPer = (parseFloat(100) * parseFloat(PatTCAmt)) / parseFloat(PatTBAmt);
                PatPer = typeof PatPer == "string" ? (PatPer.trim() == "" ? "0" : PatPer) : (typeof PatPer == "number" ? PatPer : "0");
                PatPer = parseFloat(PatPer);
                PatPer = setProperDecimals(PatPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(setProperDecimals(PatPer));
            }
        }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '3') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(setProperDecimals(PatMgCAmt));
                var MgmtPer = (parseFloat(100) * parseFloat(PatMgCAmt)) / parseFloat(PatTBAmt);
                MgmtPer = typeof MgmtPer == "string" ? (MgmtPer.trim() == "" ? "0" : MgmtPer) : (typeof MgmtPer == "number" ? MgmtPer : "0");
                MgmtPer = parseFloat(MgmtPer);
                MgmtPer = setProperDecimals(MgmtPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(setProperDecimals(MgmtPer));

            }
        }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '4') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(setProperDecimals(StMgCAmt));
                var StmtPer = (parseFloat(100) * parseFloat(StMgCAmt)) / parseFloat(PatTBAmt);
                StmtPer = typeof StmtPer == "string" ? (StmtPer.trim() == "" ? "0" : StmtPer) : (typeof StmtPer == "number" ? StmtPer : "0");
                StmtPer = parseFloat(StmtPer);
                StmtPer = setProperDecimals(StmtPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(setProperDecimals(StmtPer));
            }
        }
    }
    else {

        ClearTransactionGrid();
        /*Total Gross Amounts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = setProperDecimals(PatTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = setProperDecimals(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = 0;

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = setProperDecimals(parseFloat(PatTBAmt) + parseFloat(CmpTBAmt));
        /*Total NEt Amts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = setProperDecimals(PatTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = setProperDecimals(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = setProperDecimals(parseFloat(PatTBAmt) + parseFloat(CmpTBAmt));
        /*Total Due Amount */
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = setProperDecimals(PatTNAmt);

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = setProperDecimals(CmpTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = setProperDecimals(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = setProperDecimals(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = 0;
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(setProperDecimals(PatTNAmt));


        if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {

            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
        }

        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '1') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '3') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '4') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
        }
        EnableMulGird();
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value > 0) {
        var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
        var assest = '';
        if (form_name == 'OP') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else if (form_name == 'Cons') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else if (form_name == 'OPQUICK') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else {
            assest = false;
        }
        if (assest == true) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
        }
    } else {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
    }

    if (parseFloat(concessionamt) > 0) {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value > '0') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_ucdueauth_txtSearchControl').disabled = false;
            document.getElementById('lk_txt_options_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = false;
        }
    }
    else {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value == "0") {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_ucdueauth_txtSearchControl').disabled = true;
            document.getElementById('lk_txt_options_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = true;
        }
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OP' || document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            CalculateCreditLimitAmt();
        }
    }
    var dueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
    var exrate = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtExchangeRate').value;
    var totaldue = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value;

    SetCurrencyAmtFields(dueAmt, exrate);
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnRegFeeAutoFill').value == 'True' && $('#lblquick').attr('Class') == 'select' && document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlcrdtype').value == 0 && document.getElementById('' + ctrlcom + '_ReceiptControl2_txtCardAmt').value == 0) {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(totaldue) - parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value);
        CalculateAmount(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'), 'Cash');
        IsEmptyReplaceWithZero(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'));
    }
}
var CreditLimitDelete = 0;
var GlobalRowIndexDelete = 0;
function CalCulateCreditLimitAmtSagrigation() {
    if (document.getElementById('' + ctrlcom + '_txtcreditlimitamt') != null) {
        CreditLimitDelete = document.getElementById('' + ctrlcom + '_txtcreditlimitamt').value;
    }
    else {
        CreditLimitDelete = 0;
    }
    var SumofAmt = 0;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        var ComapnyNetSum = $(this).closest('tr').find("[id*=txtCNetAmt]").val();
        var GridRoWindex = $(this)[0].rowindex;
        SumofAmt = parseFloat(SumofAmt) + parseFloat(ComapnyNetSum);
        if (SumofAmt > CreditLimitDelete)
        { GlobalRowIndexDelete = GridRoWindex; }
    });



}

function AssignSno(rowindex) {
    var gridID = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var index = 1;
    $("table[id*=UCServices_gvServices] tr:has(td)").each(function () {
        $(this).closest('tr').find("[id*=lblSNo]").text(index);
        index++;
    });
}

/* Umr_No Based History */
var gridControl;
function ShowGrid(ev) {
    var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    if (form_name == 'OP' || form_name == 'Cons') {
        var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        if (umr_no == '') {
            $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
            return false;
        }

        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
            $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
            $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
            return false;
        }
        if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
            if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                return false;
            }
        }
    }
    if (form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
            if (umr_no == '') {
                $(".stoast").toastText("warning", "Please select UMR#!.", 5, 3);
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '0' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '' || $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == null) {
                $(".stoast").toastText("warning", "Please Select Payment Type", 5, 3);
                $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').addClass('red');
                return false;
            }
            if ($('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val() == '2') {
                if ($('#' + ctrlcom + '_uccorporate_CmpLookup_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }
            }
        }
        else {
            var pat_type = $('#' + ctrlcom + '_ddlPatientType').val();
            if (pat_type == 2 || pat_type == 5 || pat_type == 7 || pat_type == 10) {
                if ($('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val() == '') {
                    $(".stoast").toastText("warning", "Please Select Company/TPA", 5, 3);
                    return false;
                }

            }

        }
    }

    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
    if (hdnallowtariffslcn == 'true') {

        var pat_type = '';
        if (form_name == 'OP' || form_name == 'Cons') {
            pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
        }
        else if (form_name == 'OPQUICK') {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                pat_type = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
            }
            else {
                pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
            }
        }
        if (pat_type == 1) {
            var PatientCategory = document.getElementById('' + ctrlcom + '_UCServices_ddlpatcat').value;
            if (PatientCategory == undefined || PatientCategory == null || PatientCategory == '' || PatientCategory == '--select--' || PatientCategory == '0') {
                $(".stoast").toastText("warning", "Please Select Patient Category", 5, 3);
                return false;

            }
            var taiff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;
            if (taiff_id == undefined || taiff_id == null || taiff_id == '' || taiff_id == '--select--' || taiff_id == '0') {
                $(".stoast").toastText("warning", "Please Select Tariff", 5, 3);
                $(".stoast").toastText("warning", "Sorry  No Tariff Mapped To This Patient Category", 5, 2);
                return false;
            }
        }
    }


    var umr_no = '';
    var Srv_Bill_id = '0'; var FormName = '';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        if (document.getElementById('' + ctrlcom + '_chkisold').checked == true) {
            umr_no = document.getElementById('' + ctrlcom + '_ucUMRno_txtSearchControl').value;
        }
        if (umr_no == '') {
            umr_no = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnTranUMRNO').value
        }
        FormName = 'ALL';
    }
    else {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP') {
        FormName = 'OP';
    }
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons') {
        FormName = 'CONS';
        if (document.getElementById('' + ctrlcom + '_chk_old') != null) {
            if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                FormName = 'ALL';
            }
        }
    }
    ibltkoen.style.display = 'none';
    var _cname = 'BIIL_NO'; var _prifixtext = ''; var _advnce = '';
    var param = param || {};
    param.dataKey = "BILL_ID";
    param.pageSize = 10;
    param.pageNum = 1;

    param.defaultWSParams = { umr_no: umr_no, FormName: FormName, cname: _cname, prifixtext: _prifixtext, pageSize: 10, pageNum: 1, _advSrch: '' };

    param.wsPath = "GridService.asmx/BindOpBillHistory";
    param.wsFilterPath = "GridService.asmx/BindOpBillHistory";
    param.template = ["BILL_NO*BILL_NO"
                            , "BILL_DT*BILL_DT"
                            , "BILL_TYPE*BILL_TYPE"
                            , "CONSULTANT_NAME*CONSULTENT_NAME"
                            , "STATUS*STATUS"
                            , "CREATE_BY_NAME*CREATED_BY"
                            , "LOCATION_NAME*LOCATION_NAME"]
    param.header = [{ col: "Bill No", sort: false, filter: true }
                        , { col: "Bill Date", sort: false, filter: true }
                        , { col: "Bill Type", sort: false, filter: true }
                        , { col: "Consultant Name", sort: false, filter: true }
                        , { col: "Status", sort: false, filter: true }
                        , { col: "Created By", sort: false, filter: true }
                        , { col: "Location", sort: false, filter: true}]
    param.enablePaging = false;
    param.enableTrace = false;
    param.enableFilter = true;
    param.enableCheckbox = true;
    param.enableSorting = false;
    param.RowNo = true; param.tableTemplate = true;
    param.enableDMS = false;

    param.checkboxClick = getClickedBillServices;
    param.RowDataBinding = function (rowitem, _data) {

        $('.ajaxTablecheckboxalltbl_Hisdetails').css('display', 'none')
        var obj = $(rowitem);
        obj.find("td").each(function (i, j) {
            if (FormName == 'CONS') {

                if (i == 3) {
                    if (_data.BILL_DT != "" && _data.BILL_DT != undefined && _data.BILL_DT != null)
                        $(this).text(new Date(_data.BILL_DT).format('dd-MMM-yyyy') + " " + new Date(_data.BILL_DT).format('HH:mm:ss'));
                }
            }
            else {
                if (i == 4) {
                    if (_data.BILL_DT != "" && _data.BILL_DT != undefined && _data.BILL_DT != null)
                        $(this).text(new Date(_data.BILL_DT).format('dd-MMM-yyyy') + " " + new Date(_data.BILL_DT).format('HH:mm:ss'));
                }
            }
        });
        return obj[0].outerHTML;
    };

    if (FormName == 'CONS') {

        gridControl = $("#tbl_Hisdetails").jtable(param);

    }
    else {
        param.treeCallBack = function (me) {
            var _pk = $(me).data("key");
            Srv_Bill_id = _pk;
            var _tr = $(me);
            var _ajax = "GridService.asmx/BindOpBillidBasedSrvsHistory";
            BuildChildTree_His({ id: _pk }, _tr, "SERVICE_ID", "SERVICE_ID", _ajax, { SERVICE_CD: "Test Code",
                SERVICE_NAME: "Test Name",
                PACKAGE_STATUS: "Package Name",
                SERVICE_STATUS: "Service Status",
                RECORD_STATUS: "Record Status",
                PRESCRIBED_DOCTOR: "Prescribed doctor"

            }, 1, true, function () {
                $(".ajaxlevel_2_click").click(function () {
                    if ($(this).val() == "+") { $(this).val('-'); } else { $(this).val('+'); }

                    var _pk = $(this).data("key"); /* bill_srv_id */
                    var _tr = $(this);
                    var _ajax = "GridService.asmx/BindOpBillSrvidBasedSrvsHistory";
                    BuildChildTree_His({ id: Srv_Bill_id, _srvId: _pk, Pat_CLass: "2" }, _tr, "", "", _ajax, { RESULT_VALUE: "Result Value",
                        NORMAL_VALUE: "Normal Value"
                    }, 2, false);
                });
            });

        };
        gridControl = $("#tbl_Hisdetails").jMtable(param);
    }


    var lblpatname = '';

    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        lblpatname = document.getElementById('' + ctrlcom + '_txtDisplayname').innerHTML;

    }
    else {
        lblpatname = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblPatName').innerHTML;

    }

    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons') {
        pattoken.style.display = 'block';
        ibltkoen.style.display = 'block';
        document.getElementById('' + ctrlcom + '_UCServices_ibltokenno').style.display = 'block';
        document.getElementById('' + ctrlcom + '_UCServices_ibltokenno').innerHTML = $('#' + ctrlcom + '_UCServices_hdnpatienttokenno').val();
    }
    document.getElementById('' + ctrlcom + '_UCServices_lblHPatName').innerHTML = lblpatname;


    document.getElementById('' + ctrlcom + '_UCServices_lblHumrno').innerHTML = umr_no;
    $("#divLogdetails").show();
    tbl_Hisdetails.style.display = 'block';
    return false;


}
function logcancel() {
    $("#divLogdetails").hide();
    return false;
}

function BuildChildTree_His(dataKey, eventObject, targetID, targetID1, AJAXURL, bindColumns, level, Child, callBack) {
    var _tr = "";
    var _colcount = eventObject.parent().parent().find("td").length - 1;
    var _pk = eventObject.data("key");

    if (document.getElementById("tr_" + level + "_" + _pk) != null) {
        $("#tr_" + level + "_" + _pk).slideToggle();
    }
    else {
        ReturnAsync(
                 AJAXURL
                , dataKey
                , function (JData) {

                    _tr += "<tr id=\"tr_" + level + "_" + _pk + "\"><td>&nbsp;</td><td colspan=\"" + _colcount + "\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"grid childtbl\"><thead><tr>";
                    _tr += "<th style=\"width:30px\">S.No.</th>";
                    if (Child)
                        _tr += "<th name='check'>&nbsp;</th>";
                    for (var _j in bindColumns) {
                        _tr += "<th  name='col" + _j + "'>" + bindColumns[_j] + "</th>";
                    }
                    _tr += "</tr></thead><tbody>";
                    if (JData.d != null) {
                        $(JData.d[0]).each(function (i, j) {
                            _tr += "<tr><td>" + (parseInt(i) + 1) + "</td>";

                            if (Child)
                                _tr += "<td name='check'><input type=\"button\" class='ajaxlevel_" + (level + 1) + "_click'  data-key='" + j[targetID] + "' data-key1='" + j[targetID1] + "' value=\"+\" /></td>";
                            else if (level != 2)
                                _tr += "<td>&nbsp;</td>"; /*second child no need comment it */

                            for (var _j in bindColumns) {
                                _tr += "<td name='col" + _j + "'>" + j[_j] + "</td>";
                            }
                            _tr += "</tr>";
                        });
                    }
                    eventObject.parent().parent().after(_tr);
                    if (typeof callBack === "function") {
                        callBack();
                    }

                }
                , function (jqXHR, textStatus, errorThrown) {
                    
                });
    }
}

/* Bar Code Show Based On Company Policy Setting */

function classDisplay() {
    $('.barcdhead ').show();

}
/* Bar Code Hide Based On Company Policy Setting */
function classNone() {
    $('.barcdhead').hide();

}

/* Health Card ,Staff ,Management And Outher Dicount Types Show */
function ShowDiscountTypesInPage() {
    $('.HCPER').show();
    $('.HCAMT').show();
    $('.MGPER').show();
    $('.MGAMT').show();
    $('.STAFPER').show();
    $('.STAMT').show();
    $('.EBPER').show();
    $('.EBAMT').show();
    $('.CNCRLAMT').show();
    $('.CNCRLPER').show();
}
/* Health Card ,Staff ,Management And Outher Dicount Types Hide */
function HideDiscountTypesInPage() {
}

/* Service Wise History */
function ServiceWiseHistory(ev) {
    var hdnDateFormat = $('#' + ctrlcom + '_UCHeaderControl_hdnDateFormat').val();
    var hdnTimeFormat = $('#' + ctrlcom + '_UCHeaderControl_hdnTimeFormat').val();
    if (hdnDateFormat == undefined || hdnDateFormat == null || hdnDateFormat == "") { hdnDateFormat = "dd-MMM-yyyy"; }
    if (hdnTimeFormat == '' || hdnTimeFormat == null || hdnTimeFormat == undefined) { hdnTimeFormat = 'HH:mm:ss tt'; }
    var FormName = document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value;
    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 1 : CurrentRowIndex;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
    var _srv_name = $(ev).closest('tr').find("input[type=text][id*=txtServiceName]").val();
    var umr_no = '';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else {
        umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    tbl_Hisdetails.style.display = 'block';
    var pat_Class_id = '2';
    var param = param || {};
    param.dataKey = "BILL_ID";
    param.defaultWSParams = { umr_no: umr_no, _srvId: _srvId, pat_Class_id: pat_Class_id };
    param.pageSize = 10;
    param.pageNum = 1;
    param.wsPath = "GridService.asmx/BindOpSrvHistory";
    param.wsFilterPath = "GridService.asmx/BindOpSrvHistory";
    param.template = ["BILL_NO*BILL_NO"
                            , "BILL_DT*BILL_DT"
                            , "SERVICE_STATUS*SERVICE_STATUS"
                             , "CREATE_BY_NAME*CREATE_BY"
                            , "REPORT_DISPATCH_TIME*DISPATCH_DT"
                            , "RECORD_STATUS*RECORD_STATUS"]
    param.header = [{ col: "Bill No", sort: true, filter: true }
                        , { col: "Bill Dt", sort: true, filter: true }
                        , { col: "Service Status", sort: true, filter: true }
                        , { col: "Created By", sort: true, filter: true }
                        , { col: "Report Dispatch Dt", sort: true, filter: true }
                          , { col: "Record Status", sort: true, filter: true}]
    param.enablePaging = false;
    param.enableTrace = false;
    param.enableFilter = true;
    param.enableCheckbox = false;
    param.enableSorting = true;
    param.tableTemplate = true;
    param.enableDMS = false;
    param.checkboxClick = getClickedBillServices;
    param.treeCallBack = function (me) {
        var _pk = $(me).data("key");
        var _tr = $(me);
        var _ajax = "GridService.asmx/BindOpBillSrvidBasedSrvsHistory";
        BuildChildTree({ id: _pk, _srvId: _srvId, Pat_CLass: "2" }, _tr, "RESULT_SRV_COMP_ID", _ajax, {
            RESULT_VALUE: "Result Values",
            NORMAL_VALUE: "Normal Values"
        }, 1, true, function () {
            $(".ajaxlevel_2_click").click(function () {
                var _pk = $(this).data("key"); /* bill_srv_id */
                var _tr = $(this);
                var _ajax = "GridService.asmx/BindOpBillidBasedSrvsHistory";
                BuildChildTree({ id: _pk }, _tr, "BILL_ID", _ajax, { SERVICE_NAME: "Service Name",
                    PRICE: "Amount",
                    PROCESSING_LAB: "Processing Lab"
                }, 2, false);
            });
        });

    };
    param.RowDataBinding = function (rowitem, _data) {

        $('.ajaxTablecheckboxalltbl_Hisdetails').css('display', 'none')
        var obj = $(rowitem);
        obj.find("td").each(function (i, j) {
            if (i == 2) {
                if (_data.BILL_DT != "" && _data.BILL_DT != undefined && _data.BILL_DT != null)
                    $(this).text(new Date(_data.BILL_DT).format(hdnDateFormat) + " " + new Date(_data.BILL_DT).format(hdnTimeFormat));
            }

        });
        return obj[0].outerHTML;
    };
    gridControl = $("#tbl_Hisdetails").jMtable(param);
    var lblpatname = '';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
        lblpatname = _srv_name;
    }
    else {
        lblpatname = _srv_name;
    }
    document.getElementById('' + ctrlcom + '_UCServices_lblHPatName').innerHTML = lblpatname;

    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons') {
        ibltkoen.style.display = 'block';
        document.getElementById('' + ctrlcom + '_UCServices_ibltokenno').style.display = 'block';
        document.getElementById('' + ctrlcom + '_UCServices_ibltokenno').innerHTML = $('#' + ctrlcom + '_UCServices_hdnpatienttokenno').val();
    }

    $("#divLogdetails").show();
    return false;


}
/* On Repeat Bill Selection */
function getClickedBillServices(obj) {
    var A_count = 0;
    var bill_id = obj.BILL_ID;
    if (obj.BILL_TYPE != "OP Bill" && obj.BILL_TYPE != "OP Corporate") {
        $(".stoast").toastText("warning", "Bill repeating for only op bills and op corporate bills", 5, 3);
        $("#divLogdetails").hide();
        return false;
    }
    var PAT_CATEGORY_ID = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
    if (PAT_CATEGORY_ID == undefined || PAT_CATEGORY_ID == null || PAT_CATEGORY_ID == '' || PAT_CATEGORY_ID == '--select--') { PAT_CATEGORY_ID = 0; }
    var tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;
    if (tariff_id == undefined || tariff_id == null || tariff_id == '') { tariff_id = "1"; }


    var cmp_id = '0';
    var referal_letter_id = '0';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
        var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        else
            referal_letter_id = 0;
        cmp_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
    }
    if (cmp_id == undefined || cmp_id == null || cmp_id == '') { cmp_id = "0"; }
    else {
        GetAsync(
                 "GridService.asmx/BindRepeatTest",
                { bill_id: bill_id, Cmp_id: cmp_id, PAT_CATEGORY_ID: PAT_CATEGORY_ID, tariff_id: tariff_id },
                function (JData) {
                    if (JData.d != null) {

                        var pkg = 'R';
                        var SRV_NAMES = '';
                        var array_ind = [];
                        var j = 0;
                        var is_assign = 'N';
                        for (var i = 0; i < JData.d.length; i++) {
                            var sno = i + 1;
                            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                            /*Package Start Here     */
                            var PkgCollection = document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value;
                            if ((PkgCollection != NaN) && (PkgCollection != '') && (PkgCollection != undefined)) {
                                var PackValue = PkgCollection.split('$');
                                if (PackValue.length > 0) {
                                    var PkgArray = new Array();
                                    for (var p = 0; p < PackValue.length; p++) {
                                        var ChildPkgArray = PackValue[p].split('*');

                                        if (ChildPkgArray[0].length > 0) {
                                            var PackNames = ChildPkgArray[0].split(',');
                                        }
                                        if (ChildPkgArray[1].length > 0) {
                                            var PackVal = ChildPkgArray[1].split(',');
                                            for (var j = 0; j < PackVal.length; j++) {
                                                PkgArray[pkgCount] = PackVal[j];
                                                pkgCount++;
                                            }
                                        }

                                        if (JData.d[i].VALUE == "2") {
                                            if ($.inArray(parseInt(JData.d[i].DOCTOR_ID), PkgArray) == -1) {
                                            }
                                            else {
                                                $(".stoast").toastText("warning", "Service '" + JData.d[i].TEXT + "' Is already exists In '" + PackNames[1] + "' ", 5, 3);
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();
                                                $("#divLogdetails").hide();
                                            }
                                        }
                                        else {
                                            if ($.inArray(parseInt(JData.d[i].VALUE), PkgArray) == -1) {
                                            }
                                            else {
                                                $(".stoast").toastText("warning", "Service '" + JData.d[i].TEXT + "' Is already exists In'" + PackNames[1] + "' ", 5, 3);
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();
                                                $("#divLogdetails").hide();
                                            }
                                        }
                                    }

                                }
                            }

                            /*Package End  */

                            if (JData.d[i].TEXT != '') {
                                var _value = '0';
                                if (JData.d[i].VALUE == "2") {
                                    _value = JData.d[i].DOCTOR_ID;
                                }
                                else {
                                    _value = JData.d[i].VALUE;
                                }
                                var id = '';

                                if ($.inArray(parseInt(_value), arrServiceIds) == -1) {

                                    if (JData.d[i].IS_POST == 'Y') {
                                        array_ind[j] = JData.d[i];
                                        SRV_NAMES = SRV_NAMES + ',' + JData.d[i].TEXT;
                                        is_assign = 'Y';
                                        j++;

                                    }
                                    else {


                                        fn_AddFilterRow_pkgbillSelection(pkg, JData.d[i].IS_FOREIGN_SERVICE, JData.d[i].CONCERN_FORM_REQ, JData.d[i].IS_CLINICAL_HIST_REQ, JData.d[i].HISTORY_TYPE, JData.d[i].IS_POST, sno, JData.d[i].VALUE, JData.d[i].TEXT, JData.d[i].Service_cd, JData.d[i].Service_group, JData.d[i].Price, JData.d[i].CONCESSION, JData.d[i].Price, JData.d[i].SPECIMEN_NAME, JData.d[i].DOSAGE_QTY, JData.d[i].VACCUTAINER_NAME, JData.d[i].Service_Class_Id, JData.d[i].Service_group_id, JData.d[i].Service_type_id, JData.d[i].DOCTOR_ID, JData.d[i].Tariff_Id, JData.d[i].IS_CLINICAL_HIST_REQ, JData.d[i].IS_FOREIGN_SERVICE, JData.d[i].REPORT_DISPATCH_TIME, JData.d[i].SPECIMEN_NAME, JData.d[i].SPECIMEN_ID, JData.d[i].HISTORY_TYPE, JData.d[i].PKG_SRV_IDS, JData.d[i].HISTORY_TYPE_ID, JData.d[i].EMERGENCY_PRICE, JData.d[i].MIN_PRICE, JData.d[i].MAX_PRICE, JData.d[i].NO_NEED_SRV, JData.d[i].CONCERN_FORM_REQ, JData.d[i].PRIV_SRV_POSTED_DT, JData.d[i].NO_NEED_DAYS, JData.d[i].QYT_EDIT, JData.d[i].RATE_EDIT, JData.d[i].START_DT, JData.d[i].END_DT, JData.d[i].Department_id, JData.d[i].SRV_GENDER_ID, '0', '0', JData.d[i].FROM_DAYS, JData.d[i].TO_DAYS, 0, 0, 0, 0, 0, JData.d[i].REFRL_QTY, JData.d[i].EQUI_SERVICE_NAME, JData.d[i].EQUI_SERVICE_CD, 'N', 'N', 0, '', '', 0, 0, 0, 0, 0, 0, JData[i].BILLING_HEAD_ID, JData[i].IS_DOCTOR_REQUIRED, '', JData[i].TAX_PCT, ptax, '', JData[i].SGST_TAX_PCT, JData[i].CGST_TAX_PCT, JData[i].SAC_CD, JData[i].CONC_RULE_PCT, JData[i].CONC_RULE_ID, JData[i].CONC_RULE_NAME, '0', JData[i].DOCTOR_PCT, '0', JData[i].ORG_PCT, JData[i].SERVICE_PRICE_ID, '', '', '');
                                    }
                                }
                                else {
                                    $(".stoast").toastText("warning", "Service '" + JData.d[i].TEXT + "' Is already exists.", 5, 3);
                                    /*                                  document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                                    document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();*/
                                    $("#divLogdetails").hide();
                                }
                            }

                        }
                        if (is_assign == 'Y') {
                            var param = array_ind;
                            var obj = 'Repeat';
                            ConfirmationRequiredForSaveWithParam_message_services_array(obj, param, 'This Services ' + SRV_NAMES + ' is Already Posted Today. Do You Want To Continue..');

                        }
                        $("#divLogdetails").hide();
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
    }
    return false;
}
function OnsuccesssaveConfirmationwithParam_message_services_array(param) {

    for (var i = 0; i < param.length; i++) {

        var gridid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var l = gridid.rows.length - 1;
        var sno = l + 1;
        var order_ID = '';
        if (param[i].DOCTOR_PRICE == undefined || param[i].DOCTOR_PRICE == null || param[i].DOCTOR_PRICE == '') { param[i].DOCTOR_PRICE = '0' }
        if (param[i].ORG_PRICE == undefined || param[i].ORG_PRICE == null || param[i].ORG_PRICE == '') { param[i].ORG_PRICE = '0' }
        fn_AddFilterRow_pkgbillSelection('I', param[i].IS_FOREIGN_SERVICE, param[i].CONCERN_FORM_REQ, param[i].IS_CLINICAL_HIST_REQ, param[i].HISTORY_TYPE, param[i].IS_POST, sno, param[i].VALUE, param[i].TEXT, param[i].Service_cd, param[i].Service_group, param[i].Price, param[i].CONCESSION, param[i].Price, param[i].SPECIMEN_NAME, param[i].DOSAGE_QTY, param[i].VACCUTAINER_NAME, param[i].Service_Class_Id, param[i].Service_group_id, param[i].Service_type_id, param[i].DOCTOR_ID, param[i].Tariff_Id, param[i].IS_CLINICAL_HIST_REQ, param[i].IS_FOREIGN_SERVICE, param[i].REPORT_DISPATCH_TIME, param[i].SPECIMEN_NAME, param[i].SPECIMEN_ID, param[i].HISTORY_TYPE, param[i].PKG_SRV_IDS, param[i].HISTORY_TYPE_ID, param[i].EMERGENCY_PRICE, param[i].MIN_PRICE, param[i].MAX_PRICE, param[i].NO_NEED_SRV, param[i].CONCERN_FORM_REQ, param[i].PRIV_SRV_POSTED_DT, param[i].NO_NEED_DAYS, param[i].QYT_EDIT, param[i].RATE_EDIT, param[i].START_DT, param[i].END_DT, param[i].Department_id, param[i].SRV_GENDER_ID, order_ID, param[i].ORDER_DET_ID, param[i].FROM_DAYS, param[i].TO_DAYS, 0, 0, 0, 0, 0, 0, param[i].EQUI_SERVICE_NAME, param[i].EQUI_SERVICE_CD, 'N', param[i].IS_ADDITIONAL, param[i].DISCOUNT_PERCENT, '', param[i].SERVICE_UNICODE, '1', param[i].UNI_SERVICE_TYPE_ID, 0, 0, 0, 0, '', '', '', param[i].TAX_PCT, 0, 0, param[i].SGST_TAX_PCT, param[i].CGST_TAX_PCT, param[i].SAC_CD, param[i].CONC_RULE_PCT, param[i].CONC_RULE_ID, param[i].CONC_RULE_NAME, param[i].DOCTOR_PRICE, param[i].DOCTOR_PCT, param[i].ORG_PRICE, param[i].ORG_PCT, param[i].SERVICE_PRICE_ID, '', '', '');
    }
    return false;
}
function OnCancelConfirmation_services_array() {
}


function getClickedIndServices(obj) {
    var A_count = 0;
    var Ind_id = obj.IND_ID;
    var PAT_CATEGORY_ID = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
    if (PAT_CATEGORY_ID == undefined || PAT_CATEGORY_ID == null || PAT_CATEGORY_ID == '' || PAT_CATEGORY_ID == '--select--') { PAT_CATEGORY_ID = 0; }
    var tariff_id = document.getElementById('' + ctrlcom + '_UCServices_ddltariff').value;
    if (tariff_id == undefined || tariff_id == null || tariff_id == '') { tariff_id = "1"; }
    $('#hdnindid').val(obj.IND_ID);
    $('#hdnisselfinv').val(obj.IS_SELF_INVESTIGATION);

    var cmp_id = '0';
    var referal_letter_id = '0';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
        var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        else
            referal_letter_id = 0;
        cmp_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
    }
    if (cmp_id == undefined || cmp_id == null || cmp_id == '') { cmp_id = "0"; }
    if (obj.IS_SELF_INVESTIGATION == 'N') {
        $(".stoast").toastText("warning", "Bill repeating for only op bills and op corporate bills", 5, 3);
        $("#divselfinv").hide();
        return false;
    }
    else {
        GetAsync(
                 "GridService.asmx/GetSelfInv",
                { Ind_ID: Ind_id, PAT_CATEGORY_ID: PAT_CATEGORY_ID, tariff_id: tariff_id, cmp_id: cmp_id },
                function (JData) {
                    if (JData.d != null) {
                        var pkg = 'R';
                        var SRV_NAMES = '';
                        var array_ind = [];
                        var j = 0;
                        var is_assign = 'N';
                        for (var i = 0; i < JData.d.length; i++) {
                            var sno = i + 1;
                            var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                            /*Package Start Here     */
                            var PkgCollection = document.getElementById('' + ctrlcom + '_UCServices_hdnPkgSrvs').value;
                            if ((PkgCollection != NaN) && (PkgCollection != '') && (PkgCollection != undefined)) {
                                var PackValue = PkgCollection.split('$');
                                if (PackValue.length > 0) {
                                    var PkgArray = new Array();
                                    for (var p = 0; p < PackValue.length; p++) {
                                        var ChildPkgArray = PackValue[p].split('*');

                                        if (ChildPkgArray[0].length > 0) {
                                            var PackNames = ChildPkgArray[0].split(',');
                                        }
                                        if (ChildPkgArray[1].length > 0) {
                                            var PackVal = ChildPkgArray[1].split(',');
                                            for (var j = 0; j < PackVal.length; j++) {
                                                PkgArray[pkgCount] = PackVal[j];
                                                pkgCount++;
                                            }
                                        }

                                        if (JData.d[i].VALUE == "2") {
                                            if ($.inArray(parseInt(JData.d[i].DOCTOR_ID), PkgArray) == -1) {
                                            }
                                            else {
                                                $(".stoast").toastText("warning", "Service '" + JData.d[i].TEXT + "' Is already exists In '" + PackNames[1] + "' ", 5, 3);
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();
                                                $("#divselfinv").hide();
                                            }
                                        }
                                        else {
                                            if ($.inArray(parseInt(JData.d[i].VALUE), PkgArray) == -1) {
                                            }
                                            else {
                                                $(".stoast").toastText("warning", "Service '" + JData.d[i].TEXT + "' Is already exists In'" + PackNames[1] + "' ", 5, 3);
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                                                document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();
                                                $("#divselfinv").hide();
                                            }
                                        }
                                    }

                                }
                            }

                            /*Package End  */

                            if (JData.d[i].TEXT != '') {
                                var _value = '0';
                                if (JData.d[i].VALUE == "2") {
                                    _value = JData.d[i].DOCTOR_ID;
                                }
                                else {
                                    _value = JData.d[i].VALUE;
                                }
                                var id = '';

                                if ($.inArray(parseInt(_value), arrServiceIds) == -1) {

                                    if (JData.d[i].IS_POST == 'Y') {
                                        array_ind[j] = JData.d[i];
                                        SRV_NAMES = SRV_NAMES + ',' + JData.d[i].TEXT;
                                        is_assign = 'Y';
                                        j++;

                                    }
                                    else {

                                        fn_AddFilterRow_pkgbillSelection(pkg, JData.d[i].IS_FOREIGN_SERVICE, JData.d[i].CONCERN_FORM_REQ, JData.d[i].IS_CLINICAL_HIST_REQ, JData.d[i].HISTORY_TYPE, JData.d[i].IS_POST, sno, JData.d[i].VALUE, JData.d[i].TEXT, JData.d[i].Service_cd, JData.d[i].Service_group, JData.d[i].Price, JData.d[i].CONCESSION, JData.d[i].Price, JData.d[i].SPECIMEN_NAME, JData.d[i].DOSAGE_QTY, JData.d[i].VACCUTAINER_NAME, JData.d[i].Service_Class_Id, JData.d[i].Service_group_id, JData.d[i].Service_type_id, JData.d[i].DOCTOR_ID, JData.d[i].Tariff_Id, JData.d[i].IS_CLINICAL_HIST_REQ, JData.d[i].IS_FOREIGN_SERVICE, JData.d[i].REPORT_DISPATCH_TIME, JData.d[i].SPECIMEN_NAME, JData.d[i].SPECIMEN_ID, JData.d[i].HISTORY_TYPE, JData.d[i].PKG_SRV_IDS, JData.d[i].HISTORY_TYPE_ID, JData.d[i].EMERGENCY_PRICE, JData.d[i].MIN_PRICE, JData.d[i].MAX_PRICE, JData.d[i].NO_NEED_SRV, JData.d[i].CONCERN_FORM_REQ, JData.d[i].PRIV_SRV_POSTED_DT, JData.d[i].NO_NEED_DAYS, JData.d[i].QYT_EDIT, JData.d[i].RATE_EDIT, JData.d[i].START_DT, JData.d[i].END_DT, JData.d[i].Department_id, JData.d[i].SRV_GENDER_ID, '0', '0', JData.d[i].FROM_DAYS, JData.d[i].TO_DAYS, 0, 0, 0, 0, 0, JData.d[i].REFRL_QTY, JData.d[i].EQUI_SERVICE_NAME, JData.d[i].EQUI_SERVICE_CD, 'N', 'N', 0, '', '', 0, 0, 0, 0, 0, 0, 0, 0, JData.d[i].IS_EMERGENCY, JData.d[i].TAX_PCT, 0, 0, JData.d[i].SGST_TAX_PCT, JData.d[i].CGST_TAX_PCT, JData.d[i].SAC_CD, JData.d[i].CONC_RULE_PCT, JData.d[i].CONC_RULE_ID, JData.d[i].CONC_RULE_NAME, '0', JData.d[i].DOCTOR_PCT, '0', JData.d[i].ORG_PCT, JData.d[i].SERVICE_PRICE_ID, '', '', '');
                                    }
                                }
                                else {
                                    $(".stoast").toastText("warning", "Service '" + JData.d[i].TEXT + "' Is already exists.", 5, 3);
                                    /*                                  document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').value = '';
                                    document.getElementById('' + ctrlcom + '_UCServices_gvServices_ctl02_txtServiceName').focus();*/
                                    $("#divselfinv").hide();
                                }
                            }

                        }
                        if (is_assign == 'Y') {
                            var param = array_ind;
                            var obj = 'Repeat';
                            ConfirmationRequiredForSaveWithParam_message_services_array(obj, param, 'This Services ' + SRV_NAMES + ' is Already Posted Today. Do You Want To Continue..');

                        }
                        $("#divselfinv").hide();
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
    }

    return false;
}





/* Emergency Slot Timings Start !!!!!!!!!!!*/

function SetEmergencySlots() {

    /*var PresentTime = '0';
    GetAsync(
    "GridService.asmx/GetCurrentTime",
    { PresentTime: PresentTime },
    function (data) {
    if (data.d != null) {

    CurrentResult(data.d);
    }
    },
    function (jqXHR, textStatus, errorThrown) {
    });*/
    CurrentResult();
}
function CurrentResult() {

    var CheckFlagBothCompnaymasterAndEmencySlotFlag = 'N';
    var dt1 = new Date();
    var hrs = dt1.getHours();
    var mnt = dt1.getMinutes();
    var CT = (parseInt(hrs) * 60) + parseInt(mnt);
    var ChkEmergency = document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime');
    var Slot1 = document.getElementById('' + ctrlcom + '_UCServices_hdnEmergencySlot1').value;
    var Slot2 = document.getElementById('' + ctrlcom + '_UCServices_hdnEmergencySlot2').value;
    var Slot3 = document.getElementById('' + ctrlcom + '_UCServices_hdnEmergencySlot3').value;
    var FT = '0', TT = '0', FromTime = '0', ToTime = '0', SlotValues = '0';
    var count = 0;
    if (Slot1 != null && Slot1 != '' && count == 0) {
        SlotValues = Slot1.split('-');
        FromTime = SlotValues[0].split(':');
        ToTime = SlotValues[1].split(':');
        FT = (parseInt(FromTime[0]) * 60) + parseInt(FromTime[1]);
        TT = (parseInt(ToTime[0]) * 60) + parseInt(ToTime[1]);
        if ((parseInt(FT) <= parseInt(CT)) && (parseInt(CT) <= parseInt(TT))) {
            document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'Y';
            count = 1;
            CheckEmergencyPrice();
        }
        else {
            document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'N';
        }
    }
    if (Slot2 != null && Slot2 != '' && count == 0) {
        SlotValues = Slot2.split('-');
        FromTime = SlotValues[0].split(':');
        ToTime = SlotValues[1].split(':');
        FT = (parseInt(FromTime[0]) * 60) + parseInt(FromTime[1]);
        TT = (parseInt(ToTime[0]) * 60) + parseInt(ToTime[1]);
        if ((parseInt(FT) <= parseInt(CT)) && (parseInt(CT) <= parseInt(TT))) {
            document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'Y';
            count = 1;
            CheckEmergencyPrice();
        }
        else {
            document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'N';
        }
    }
    if (Slot3 != null && Slot3 != '' && count == 0) {
        SlotValues = Slot3.split('-');
        FromTime = SlotValues[0].split(':');
        ToTime = SlotValues[1].split(':');
        FT = (parseInt(FromTime[0]) * 60) + parseInt(FromTime[1]);
        TT = (parseInt(ToTime[0]) * 60) + parseInt(ToTime[1]);
        if ((parseInt(FT) <= parseInt(CT)) && (parseInt(CT) <= parseInt(TT))) {
            document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'Y';
            count = 1;
            CheckEmergencyPrice();
        }
        else {
            document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'N';
        }
    }
    if (CheckFlagBothCompnaymasterAndEmencySlotFlag == 'Y') {
        document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'Y';
    }
}
var ddlemgslot = 'N';

function CheckEmergencySlotSetup(obj) {

    var CheckFlagBothCompnaymasterAndEmencySlotFlag = 'N';
    if (ddlemgslot == 'N') {
        GetAsync(
                 "GridService.asmx/GetEmgFlagExistORnot",
                { Flag: obj /* "OP"*/ },
              function (JData) {
                  ddlemgslot = 'Y';
                  if (JData.d != null) {

                      if (JData.d[0].EXIST == "Y") {
                          document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'Y';
                          CheckFlagBothCompnaymasterAndEmencySlotFlag = 'Y';
                      }
                      else {
                          document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value = 'N';
                      }
                      CheckEmergencyPrice();
                  }

              },
                function (jqXHR, textStatus, errorThrown) {
                });
    }
}
function CheckEmergencyPrice() {
    var chkVal = document.getElementById('' + ctrlcom + '_UCServices_hdnEmerFlagTime').value;
    GetAsync(
                 "GridService.asmx/CheckEmergencyPrice",
                { chkVal: chkVal },
                function (data) {
                },
                function (jqXHR, textStatus, errorThrown) {
                });
}
/*  Emergency Slot End  @@@@@@@@@@@@@@@@@@@@@@@@@@*/

function CalConcessionAmount(obj) {

    var concpersent = document.getElementById('' + ctrlcom + '_hdnCncnPercent').value;
    var AllowConc = document.getElementById('' + ctrlcom + '_hdnIsAllowCncn').value;
    var totPatConPer = 0;
    var PatTotalgrossamt = 0;
    var cmpTotalGrossAmt = 0;
    var PatNetAmt = 0;
    var cmpNetAmt = 0;
    if (AllowConc == 'True') {
        if (concpersent == '0' || concpersent == '') {/*checking concession permission is there or not.*/
            $(".stoast").toastText("warning", "Sorry..!you do not have permission to give concession!", 5, 3);
            return false;
        }
        else if (obj == 'P') {   /* if concession is percentage wise*/
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                if ($(this).closest('tr').find("input[type=text][id*=txtServiceName]").val() != '') {
                    var Qty = $(this).closest('tr').find("input[type=text][id*=txtQty]").val();
                    var Rate = $(this).closest('tr').find("input[type=text][id*=txtRate]").val();
                    var ConP = $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val();
                    var ConPhc = $(this).closest('tr').find("input[type=text][id*=txthcPer]").val();
                    var ConPma = $(this).closest('tr').find("input[type=text][id*=txtmaPer]").val();
                    var ConPst = $(this).closest('tr').find("input[type=text][id*=txtstPer]").val();
                    var ConPeb = $(this).closest('tr').find("input[type=text][id*=txtebPer]").val();
                    var Pgrossamt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
                    if (Qty == '') { Qty = 0; $(this).closest('tr').find("input[type=text][id*=txtQty]").val('0'); }
                    if (Rate == '') { Rate = 0; $(this).closest('tr').find("input[type=text][id*=txtRate]").val('0'); }
                    if (ConP == '') { ConP = 0; $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val('0'); }
                    if (ConPhc == '') { ConPhc = 0; $(this).closest('tr').find("input[type=text][id*=txthcPer]").val('0'); }
                    if (ConPma == '') { ConPma = 0; $(this).closest('tr').find("input[type=text][id*=txtmaPer]").val('0'); }
                    if (ConPst == '') { ConPst = 0; $(this).closest('tr').find("input[type=text][id*=txtstPer]").val('0'); }
                    if (ConPeb == '') { ConPeb = 0; $(this).closest('tr').find("input[type=text][id*=txtebPer]").val('0'); }
                    if (Pgrossamt == '') { Pgrossamt = 0; $(this).closest('tr').find("input[type=text][id*=txtPamt]").val('0'); }
                    var PconAmt = 0;
                    var PNetAmt = 0;
                    totPatConPer = parseFloat(totPatConPer) + (parseFloat(ConP) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb));
                    if (parseFloat(totPatConPer) > parseFloat(concpersent)) {
                        $(".stoast").toastText("warning", "Sorry..!you can  give concession upto '" + concpersent + "'% only! ", 5, 3);
                        $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val(concpersent);
                        PconAmt = (parseFloat(Pgrossamt) * parseFloat(concpersent) / 100);
                        PNetAmt = (parseFloat(Pgrossamt) - (parseFloat(Pgrossamt) * parseFloat(concpersent) / 100));
                    }
                    else {
                        PconAmt = (parseFloat(Pgrossamt) * (parseFloat(ConP) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb)) / 100);
                        PNetAmt = (parseFloat(Pgrossamt) - (parseFloat(Pgrossamt) * (parseFloat(ConP) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb)) / 100));
                    }

                    $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val(PconAmt);
                    $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(PNetAmt);
                    PatTotalgrossamt = parseFloat(PatTotalgrossamt) + parseFloat(Pgrossamt);
                    PatNetAmt = parseFloat(PatNetAmt) + parseFloat(PNetAmt);
                    cmpTotalGrossAmt = parseFloat(cmpTotalGrossAmt) + parseFloat(0);
                    cmpNetAmt = parseFloat(cmpNetAmt) + parseFloat(0);
                }
            });

            /*Quick Start*/
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = parseFloat(PatTotalgrossamt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = parseFloat(PatTotalgrossamt);

            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
            /*Quick End */
            /* Advanced Start */
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = parseFloat(PatTotalgrossamt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = parseFloat(PatNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = parseFloat(cmpNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = parseFloat(PatNetAmt) + parseFloat(cmpNetAmt)
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = parseFloat(PatNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = parseFloat(cmpNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(PatNetAmt) + parseFloat(cmpNetAmt);
            /* Advanced End */
        }
        else if (obj == 'A') {  /* if concession is amount wise*/
            $("table[id*=gvServices] tr:has(td)").each(function (e) {
                if ($(this).closest('tr').find("input[type=text][id*=txtServiceName]").val() != '') {
                    var Qty = $(this).closest('tr').find("input[type=text][id*=txtQty]").val();
                    var Rate = $(this).closest('tr').find("input[type=text][id*=txtRate]").val();
                    var ConA = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
                    var ConPhc = $(this).closest('tr').find("input[type=text][id*=txthcPer]").val();
                    var ConPma = $(this).closest('tr').find("input[type=text][id*=txtmaPer]").val();
                    var ConPst = $(this).closest('tr').find("input[type=text][id*=txtstPer]").val();
                    var ConPeb = $(this).closest('tr').find("input[type=text][id*=txtebPer]").val();
                    var Pgrossamt = $(this).closest('tr').find("input[type=text][id*=txtPamt]").val();
                    if (Qty == '') { Qty = 0; $(this).closest('tr').find("input[type=text][id*=txtQty]").val('0'); }
                    if (Rate == '') { Rate = 0; $(this).closest('tr').find("input[type=text][id*=txtRate]").val('0'); }
                    if (ConA == '') { ConA = 0; $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val('0'); }
                    if (Pgrossamt == '') { Pgrossamt = 0; $(this).closest('tr').find("input[type=text][id*=txtPamt]").val('0'); }
                    if (ConPhc == '') { ConPhc = 0; $(this).closest('tr').find("input[type=text][id*=txthcPer]").val('0'); }
                    if (ConPma == '') { ConPma = 0; $(this).closest('tr').find("input[type=text][id*=txtmaPer]").val('0'); }
                    if (ConPst == '') { ConPst = 0; $(this).closest('tr').find("input[type=text][id*=txtstPer]").val('0'); }
                    if (ConPeb == '') { ConPeb = 0; $(this).closest('tr').find("input[type=text][id*=txtebPer]").val('0'); }
                    var PconPer = 0;
                    var PconNetAmt = 0;
                    totPatConPer = parseFloat(totPatConPer) + (parseFloat(ConA) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb));
                    if (parseFloat(totPatConPer) > parseFloat(concpersent)) {
                        $(".stoast").toastText("warning", "Sorry..!you can  give concession upto '" + concpersent + "'% only! ", 5, 3);

                        $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val(concpersent);
                        PconPer = ((parseFloat(ConA) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb)) / parseFloat(Pgrossamt) * 100);
                        PconNetAmt = parseFloat(Pgrossamt) - (parseFloat(ConA) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb));
                    }
                    else {

                        PconPer = ((parseFloat(ConA) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb)) / parseFloat(Pgrossamt) * 100);
                        PconNetAmt = parseFloat(Pgrossamt) - (parseFloat(ConA) + parseFloat(ConPhc) + parseFloat(ConPma) + parseFloat(ConPst) + parseFloat(ConPeb));
                    }
                    $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val(setProperDecimals(PconPer));
                    $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val(setProperDecimals(PconNetAmt));
                    PatTotalgrossamt = parseFloat(PatTotalgrossamt) + parseFloat(Pgrossamt);
                    PatNetAmt = parseFloat(PatNetAmt) + parseFloat(PconNetAmt);
                    cmpTotalGrossAmt = parseFloat(cmpTotalGrossAmt) + parseFloat(0);
                    cmpNetAmt = parseFloat(cmpNetAmt) + parseFloat(0);
                }
            });
            /*Quick Start*/
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = parseFloat(PatTotalgrossamt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = parseFloat(PatTotalgrossamt);

            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
            /*Quick End */
            /* Advanced Start */
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = parseFloat(PatTotalgrossamt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = parseFloat(PatNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = parseFloat(cmpNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = parseFloat(PatNetAmt) + parseFloat(cmpNetAmt)
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = parseFloat(PatNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = parseFloat(cmpNetAmt);
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(PatNetAmt) + parseFloat(cmpNetAmt);
            /* Advanced End */
        }
    }
}

/*Services should display on Extended monitor*/
function onExtendedGrid() {
    $("#" + ctrlcom + "_gvExtendedDisplay tbody").html('');
    $("table[id*=gvServices] tr:has(td)").each(function (i, j) {
        var hdnserviceid = $(this).find('input[type=hidden][id*=hdnServiceID]').val();
        var txtServiceName = $(this).find('input[type=text][id*=txtServiceName]').val();
        if (txtServiceName != "" && txtServiceName != undefined && txtServiceName != "--Enter Test Name Here--" && hdnserviceid != '' && hdnserviceid != undefined && hdnserviceid != null && hdnserviceid != "0") {
            var jDataval = checkPropertyValues(this.rowIndex + 1, $(this).closest('tr').find("input[type=text][id*=txtServiceName]").val(), $(this).closest('tr').find("input[type=text][id*=txtAmount]").val());
            renderUI(jDataval);
        }
    });
    OnExtendAmounts();
}
function checkPropertyValues(sno, name, amount) {
    var _params = [];
    var _param = { sno: typeof sno == "number" ? sno : '0',
        name: typeof name == "string" ? name : '',
        amount: typeof amount == "string" ? amount : ''
    };
    _params.push(_param);
    return _params;
}
function DeletePropertyValues(sno, name) {
    var _billingTemplate = _.template($("#tbody").html());
}
var _dataSource = '';
function renderUI(jData) {
    var _html = "";
    var _billingTemplate = _.template($("#tbody").html());
    _dataSource = jData;
    $("#" + ctrlcom + "_gvExtendedDisplay tbody").append(_billingTemplate(_dataSource));

}
function ClearTextbox(ev) {
    var CurrentRowIndex = 0;
    if (ev.value == 0 || ev.value == '0') {
        ev.value = '';
    }
}
function AssignZero(ev) {
    var CurrentRowIndex = 0;
    if (ev.value == '' || ev.value == undefined || ev.value == null || ev.value.trim() == "NaN") {
        ev.value = '0';
    }
}

function ClearTextbox(id) {
    if (parseFloat(document.getElementById(id.id).value) == 0)
        document.getElementById(id.id).value = '';
}
function ClearTextboxOnFocusOut(id) {
    if (isNaN(parseFloat(document.getElementById(id.id).value))) {
        document.getElementById(id.id).value = '0';
    }
}

var GlobalMyData = new Array();
function multiDimArray(dataGrid, cardID, MulitiDimRowIndex1) {
    var myMultiData = new Array();
    var myData = new Array();
    var MultiDimRowIndex = 0;
    for (var i = 0; i < dataGrid.d.length; i++) {
        var data = dataGrid.d[i];
        myData[i] = new Array(4);
        var j = MultiDimRowIndex;
        myMultiData[j] = new Array(4);
        myMultiData[j]["rowIndex"] = j + 1;
        myMultiData[j]["PERCENTAGE"] = data.PERCENTAGE;
        myMultiData[j]["DIS_AMT"] = data.DIS_AMT;
        myMultiData[j]["SERVICE_ID"] = data.SERVICE_ID;
        myMultiData[j]["CARDID"] = cardID;
        myMultiData[j]["DdlRowIndex"] = MulitiDimRowIndex1;
        MultiDimRowIndex++;
    }
    GlobalMyData = myMultiData;
}
function numeralsOnly1(evt) {
    var intKey = (window.Event) ? evt.which : evt.keyCode;
    if (intKey == undefined)/*for InternetExplorer(IE)  */
    {
        var charcode = evt.keyCode;
        if (charcode > 31 && (charcode < 48 || charcode > 57) && charcode != 46) {
            evt.returnValue = false;
            return false;
        }
        return true;
    }
    else/*for Mozilla */
    {
        if (intKey > 31 && (intKey < 48 || intKey > 57) && charcode != 46) {
            evt.returnValue = false;
            return false;
        }
        return true;
    }
}

/*Slots Block Begin*/
var CurrentRowIndexSlots = 0;
function SlotBind(ev) {
    var CurrentRowIndex = 0;
    CurrentRowIndex = ev;
    var DoctorId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=hdnDoctorID]').val();
    var SlotExist = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddlSlotTiming]').val();
    DoctorIdSelectedSlotId = DoctorId;
    CurrentRowIndexSlots = CurrentRowIndex;
    var Date2 = new Date().format('dd-MMM-yyyy');
    CurrentRowIndexSlots = CurrentRowIndex;
    DoctorId = DoctorId == undefined ? 0 : DoctorId;
    id = DoctorId;
    var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
    var umr_no = '';
    if (form_name == 'OP' || form_name == 'Cons') {
        umr_no = document.getElementById('' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').value;
    }
    var slotcall = document.getElementById('ctl00_ContentPlaceHolder1_hdnslotcall').value;
    if (slotcall.toLowerCase() == "yes") {
        PageMethods.SlotData(id, Date2, umr_no, onsucess4, onfailure);
    } else {
        var aptmntUrl = document.getElementById('ctl00_ContentPlaceHolder1_hdnApptUrl').value;
        var megid = document.getElementById('ctl00_ContentPlaceHolder1_hdnMegID').value;
        $.ajax({
            url: aptmntUrl + "apt/api/getAvailableSlots?MIG_ID=" + megid + "&I_RSRC_ID=" + id + "&FROM_DT=" + Date2 + "&TO_DT=" + Date2 + "&UMR_NO=" + umr_no,
            type: "GET",
            dataType: "json",
            success: function (res) {
                onsucess4(res);
            },
            error: function (jqXHR, textStatus, errorThrown) {

                return false;
            }
        });
    }
}
function onsucess4(res) {
    var result = res; 
    var apptHost = $('#ctl00_ContentPlaceHolder1_hdnApptHosting')[0].value;
    var res;
    if (apptHost == "NODE") {
        var slotcall = document.getElementById('ctl00_ContentPlaceHolder1_hdnslotcall').value;
        if (slotcall.toLowerCase() == "yes")
            res = $.parseJSON(result);
        else
            res = result;
    }
    else
        res = $.parseJSON(result);

    BindSlotTiming(res);
}
var _SlotVal = '';
function BindSlotTiming(res) {
    _SlotVal = '';
    if (res != null) {
        SlotTypes = res;
    }
    for (var i = 0; i < res.length; i++) {
        if (i == 0) {
            _SlotVal += "<OPTION selected value='" + 0 + "'>" + 'Select' + "</OPTION>";
        }
        _SlotVal += "<OPTION selected value='" + res[i]["SLOTS_ID"] + ',' + res[i]["SEQ_NO"] + ',' + res[i]["FLAG"] + "'>" + res[i]["TIME"] + "</OPTION>";
    }
    var srv_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    var doc_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
    if (srv_id == '2' || doc_id > 0) {
        var doctor_name = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('input[type=text][id*=txtServiceName]').val();
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').empty().html(_SlotVal);
        $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]')[0].selectedIndex = 0;
        if (res.length == 0) {
            $(".stoast").toastText("warning", "Slots Not Available For  Doctor " + doctor_name + " .", 5, 3);
        }
    }
}
function onfailure() {
}
function CallSlot2(DoctorId) {
    var Date2 = new Date().format('dd-MMM-yyyy');
    id = DoctorId;
    DoctorIdSelectedSlotId = DoctorId;
    var umr_no = '';
    if (form_name == 'OP' || form_name == 'Cons') {
        umr_no = document.getElementById('' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').value;
    }
    var slotcall = document.getElementById('ctl00_ContentPlaceHolder1_hdnslotcall').value;
    if (slotcall.toLowerCase() == "yes") {
        PageMethods.SlotData(id, Date2, umr_no, onsucess3, onfailure);
    } else {
        var aptmntUrl = document.getElementById('ctl00_ContentPlaceHolder1_hdnApptUrl').value;
        var megid = document.getElementById('ctl00_ContentPlaceHolder1_hdnMegID').value;
        $.ajax({
            url: aptmntUrl + "apt/api/getAvailableSlots?MIG_ID=" + megid + "&I_RSRC_ID=" + id + "&FROM_DT=" + Date2 + "&TO_DT=" + Date2 + "&UMR_NO=" + umr_no,
            type: "GET",
            dataType: "json",
            success: function (res) {
                onsucess3(res);
            },
            error: function (jqXHR, textStatus, errorThrown) {

                return false;
            }
        });
    }
}
function onsucess3(res) {
    var result = res; 
    var apptHost = $('#ctl00_ContentPlaceHolder1_hdnApptHosting')[0].value;
    var res;
    if (apptHost == "NODE")
        res = result;
    else
        res = $.parseJSON(result);
    BindSlotTiming(res);
}
function onsucess1(res) {
    
    var result = res; 
    var apptHost = $('#ctl00_ContentPlaceHolder1_hdnApptHosting')[0].value;
    var f;
    if (apptHost == "NODE")
        f = result;
    else
        f = $.parseJSON(result);
    if (f[0].STATUS_NAME != null) {
        if (f[0].STATUS_NAME == 'Hold') {
            var SlotTime = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').find('option:selected').text();
            var SlotId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').val();
            $(".stoast").toastText("Info", "This Slot" + SlotTime + "is Reserved.", 7, 2);
            $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').empty();
            var InnerSlotVal = "<OPTION selected value='" + SlotId + "'>" + SlotTime + "</OPTION>";
            $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').empty().html(InnerSlotVal);
            if (form_name == 'OP' || form_name == 'OPQUICK') {
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=chkPstCons]').attr('disabled', true);
            }
        }
        else if (f[0].STATUS_NAME == 'N') {
            $(".stoast").toastText("Info", "Alredy This Is a Reserved Slot , Please Select Another One", 7, 2);
            CallSlot2(DoctorIdSelectedSlotId);
        } else {
            var SlotTime = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').find('option:selected').text();
            $(".stoast").toastText("Info", "Unable To Reserved This Slot", 7, 2);
            CallSlot2(DoctorIdSelectedSlotId);
        }
    }
}
function onfailure1(res) {

}
var DoctorIdSelectedSlotId = 0;
/* Slot Chaage Drop Down Begin*/
function SlotChnage(ev) {

    var CurrentRowIndexSlots1 = ev.parentElement.parentElement.rowIndex;
    CurrentRowIndexSlots = CurrentRowIndexSlots1;
    var slotvalueid = ev.value;
    var slotvalue = slotvalueid.split(',');
    SlotTimingId = slotvalue[0];
    var slot_token_no = slotvalue[1];
    var Slot_Config = slotvalue[2];
    var MulSlotTime = "";
    var flageistinslottime = true;
    if (Slot_Config == 'Y') {
        ev.value = 0;
        $(".stoast").toastText("Info", "This Patient Already Has A Slot With Doctor,Please Select Another Slot !", 7, 2);
        return false;
    }
    else {/* Slot Config Exists Starts */
        var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        var slot_time = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').find('option:selected').text();
        GetNonAsync(
    "Private/FrontOffice/OpBilling/OPConsultation1.aspx/GetSlotExist",
    { umr_no: umr_no, slot_time: slot_time },
    function (JData) {
        if (JData.d != null) {
            if (JData.d[0].STATUS == 'Y') {
                flageistinslottime = false;
                $(".stoast").toastText("Info", "Slot Time Already Done To Another Doctor", 7, 2);
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]')[0].selectedIndex = 0;
                return false;
            } else {
                flageistinslottime = true;
            }

        }
    },
     function (jqXHR, textStatus, errorThrown) {

     });

        $("table[id*=gvServices] tr:has(td)").each(function (i, j) {
            if ($(this)[0].rowIndex != CurrentRowIndexSlots) {
                var SlotTime = $(this).closest('tr').find('[id*=ddlSlotTiming]').find('option:selected').text();
                MulSlotTime = SlotTime + ',' + MulSlotTime;
            }
        });
        var SlotTime = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]').find('option:selected').text();
        var array1 = MulSlotTime.split(',');
        for (var i = 0; i < array1.length; i++) {
            if (SlotTime == array1[i]) {
                $(".stoast").toastText("Info", "Slot Time Already Exist", 7, 2);
                $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndexSlots + ')').find('[id*=ddlSlotTiming]')[0].selectedIndex = 0;
                return false;
            }
        }
        if (flageistinslottime == true) {
            var slotcall = document.getElementById('ctl00_ContentPlaceHolder1_hdnslotcall').value;
            if (slotcall.toLowerCase() == "yes") {
                PageMethods.SlotDataSelection(SlotTimingId, onsucess1, onfailure1);
            } else {
                var aptmntUrl = document.getElementById('ctl00_ContentPlaceHolder1_hdnApptUrl').value;
                var megid = document.getElementById('ctl00_ContentPlaceHolder1_hdnMegID').value;
                $.ajax({
                    url: aptmntUrl + "apt/api/uprUpdIntgSlotHold?SLOTS_ID=" + SlotTimingId + "&FLAG=H&MIG_ID=" + megid,
                    type: "GET",
                    dataType: "json",
                    success: function (res) {
                        onsucess1(res);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                        return false;
                    }
                });
            }
        }
    } /* Slot Config Exists Ends */
}
/* Slot Chaage Drop Down End*/
/*Slots Block End*/
function RemoveSlotDataSelectionGrid(SlotId) {
    var slotcall = document.getElementById('ctl00_ContentPlaceHolder1_hdnslotcall').value;
    if (slotcall.toLowerCase() == "yes") {
        PageMethods.RemoveSlotDataSelection(SlotId, onsucess5, onfailure5);
    } else {
        var aptmntUrl = document.getElementById('ctl00_ContentPlaceHolder1_hdnApptUrl').value;
        var megid = document.getElementById('ctl00_ContentPlaceHolder1_hdnMegID').value;
        $.ajax({
            url: aptmntUrl + "apt/api/uprUpdIntgSlotHold?SLOTS_ID=" + SlotId + "&FLAG=R&MIG_ID=" + megid,
            type: "GET",
            dataType: "json",
            success: function (res) {
                onsucess5(res);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                return false;
            }
        });
    }
}
function onsucess5() {
    /**add for swipe functionality**/
    VisibleSwipe();
}
function onfailure5() {
}

function CalculateCreditLimitAmt() {
    var PatdueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
    var CmpDueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value;
    var TotalDueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value;
    var PatNetAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value;
    var CmpNetAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value;
    var TotalNetAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value;
    var CreditLimitAmt = 0;
    if (document.getElementById('' + ctrlcom + '_txtcreditlimitamt') != null) {
        CreditLimitAmt = document.getElementById('' + ctrlcom + '_txtcreditlimitamt').value;
    }
    else {
        CreditLimitAmt = 0;
    }
    var TotalCmpDueAmtStatic = document.getElementById('' + ctrlcom + '_txtCorpDueAmt').value;
    PatdueAmt = typeof PatdueAmt == 'string' ? (typeof PatdueAmt == 'undefined' || PatdueAmt.trim() == '' ? 0 : parseFloat(PatdueAmt)) : (typeof PatdueAmt == 'object' ? 0 : parseFloat(PatdueAmt));
    CmpDueAmt = typeof CmpDueAmt == 'string' ? (typeof CmpDueAmt == 'undefined' || CmpDueAmt.trim() == '' ? 0 : parseFloat(CmpDueAmt)) : (typeof CmpDueAmt == 'object' ? 0 : parseFloat(CmpDueAmt));
    TotalDueAmt = typeof TotalDueAmt == 'string' ? (typeof TotalDueAmt == 'undefined' || TotalDueAmt.trim() == '' ? 0 : parseFloat(TotalDueAmt)) : (typeof TotalDueAmt == 'object' ? 0 : parseFloat(TotalDueAmt));
    PatNetAmt = typeof PatNetAmt == 'string' ? (typeof PatNetAmt == 'undefined' || PatNetAmt.trim() == '' ? 0 : parseFloat(PatNetAmt)) : (typeof PatNetAmt == 'object' ? 0 : parseFloat(PatNetAmt));
    CmpNetAmt = typeof CmpNetAmt == 'string' ? (typeof CmpNetAmt == 'undefined' || CmpNetAmt.trim() == '' ? 0 : parseFloat(CmpNetAmt)) : (typeof CmpNetAmt == 'object' ? 0 : parseFloat(CmpNetAmt));
    TotalNetAmt = typeof TotalNetAmt == 'string' ? (typeof TotalNetAmt == 'undefined' || TotalNetAmt.trim() == '' ? 0 : parseFloat(TotalNetAmt)) : (typeof TotalNetAmt == 'object' ? 0 : parseFloat(TotalNetAmt));
    TotalCmpDueAmtStatic = typeof TotalCmpDueAmtStatic == 'string' ? (typeof TotalCmpDueAmtStatic == 'undefined' || TotalCmpDueAmtStatic.trim() == '' ? 0 : parseFloat(TotalCmpDueAmtStatic)) : (typeof TotalCmpDueAmtStatic == 'object' ? 0 : parseFloat(TotalCmpDueAmtStatic));
    CreditLimitAmt = CreditLimitAmt == '' ? 0 : CreditLimitAmt;
    if (parseFloat(CreditLimitAmt) > 0) {
        if (parseFloat(TotalCmpDueAmtStatic) > 0) {
            if (parseFloat(TotalCmpDueAmtStatic) > parseFloat(CreditLimitAmt)) {
                var RemainingPatdueAmt = parseFloat(TotalCmpDueAmtStatic) - parseFloat(CreditLimitAmt);
                RemainingPatdueAmt = typeof RemainingPatdueAmt == 'string' ? (typeof RemainingPatdueAmt == 'undefined' || RemainingPatdueAmt.trim() == '' ? 0 : parseFloat(RemainingPatdueAmt)) : (typeof RemainingPatdueAmt == 'object' ? 0 : parseFloat(RemainingPatdueAmt));
                RemainingPatdueAmt = RemainingPatdueAmt > 0 ? RemainingPatdueAmt : 0;

                document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = parseFloat(RemainingPatdueAmt) + parseFloat(PatdueAmt);
                document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = CreditLimitAmt;
                document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) + parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value);
                document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = parseFloat(RemainingPatdueAmt) + parseFloat(PatdueAmt);
                document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = CreditLimitAmt;
                document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) + parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value);

                document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value);
                document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value);
            }
        }
    }
}
function SaveCheckAppointmentSlot() {
    var SlotId = '';
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        var SlotIds = $(this).closest('tr').find('[id*=ddlSlotTiming]').val();
        if (SlotIds != "") {
            SlotId = SlotId + SlotIds + "^";
        }
    });
    var slotcall = document.getElementById('ctl00_ContentPlaceHolder1_hdnslotcall').value;
    if (slotcall.toLowerCase() == "yes") {
        PageMethods.SaveCheckAppointmentSlot1(SlotId, onsucess6, onfailure6);
    } else {
        var aptmntUrl = document.getElementById('ctl00_ContentPlaceHolder1_hdnApptUrl').value;
        var megid = document.getElementById('ctl00_ContentPlaceHolder1_hdnMegID').value;
        $.ajax({
            url: aptmntUrl + "apt/api/uprUpdIntgSlotHold?SLOTS_ID=" + SlotId + "&FLAG=C&MIG_ID=" + megid,
            type: "GET",
            dataType: "json",
            success: function (res) {
                onsucess6(res);
            },
            error: function (jqXHR, textStatus, errorThrown) {

                return false;
            }
        });
    }
}
function onsucess6(res) {
    var result = res;
    var apptHost = $('#ctl00_ContentPlaceHolder1_hdnApptHosting')[0].value;
    var f;
    if (apptHost == "NODE")
        f = result;
    else
        f = $.parseJSON(result);
    if (f[0].STATUS_NAME != null) {
        for (var i = 0; i < f[0].length; i++) {
            if (f[0].STATUS_NAME == ' FAILURE') {
                $(".stoast").toastText("warning", " Plase Select Valied Slot Fro This Appointment No", 5, 3);
                return false;
            }
        }
    }

}
function onfailure6(error) {

}

function onExtendedDisplayValues() {
    if (localStorage.getItem("ED") != "" && localStorage.getItem("ED") != undefined && localStorage.getItem("ED") != null) {
        var _umr = document.getElementById('' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').value;
        var _name = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblPatName').innerHTML;
        var _mobileNo = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblMobileNo').innerHTML;
        var _gender = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblagedob').innerHTML;
        var _doctorName = document.getElementById('' + ctrlcom + '_umrPatientDetails_lblrefdoc').innerHTML;
        if (_umr == undefined || _umr == null) { _umr = ''; }
        if (_name == undefined || _name == null) { _name = ''; }
        if (_mobileNo == undefined || _mobileNo == null) { _mobileNo = ''; }
        if (_gender == undefined || _gender == null) { _gender = ''; }
        if (_doctorName == undefined || _doctorName == null) { _doctorName = ''; }
        extendedDisplay.setData(0, 'Umr No           :', _umr);
        extendedDisplay.setData(1, 'Patient Name     :', _name);
        extendedDisplay.setData(2, 'Mobile No       :', _mobileNo);
        extendedDisplay.setData(3, 'Age/DOB       :', _gender);
        extendedDisplay.setData(4, 'Consultant Name :', _doctorName);
    }
}



var oindex = 0; var _pkg = ''; var _sno = ''; var _order_id = ''; var _order_det_id = '';
function fn_AddFilterRow_Optional(pkg, foreignsrv, concernforn, pre_Cau_On_Srv, History_Types, Srv_hist, sno, service_id, service_name, service_cd, service_type, amount, concession_amt, net_amt, SPECIMEN_NAME, DOSAGE_QTY, VACCUTAINER_NAME, service_classID, service_groupID, Service_typeID, Doctor_id, tariff_id, clinichistory, IsForeignSrv, report_dispatch_time, SPECIMEN_NAME, SPECIMEN_ID, history_type, pkg_id, HISTORY_TYPE_ID, EMERGENCY_PRICE, MIN_PRICE, MAX_PRICE, NO_NEED_SRV, CONCERN_FORM_REQ, PRIV_SRV_POSTED_DT, NO_NEED_DAYS, QYT_EDIT, RATE_EDIT, START_DT, END_DT, department_id, SRV_GENDER_ID, order_id, order_det_id, FROM_DAYS, TO_DAYS, VisitTypeID, reqid, slottime, slotid, equi_service_name, equi_service_cd) {
    _pkg = pkg; _sno = sno; _order_id = order_id; _order_det_id = order_det_id;

    var gvServices = document.getElementById('tbl_Optional');
    var rowIndex = gvServices.rows.length;
    var checkRowIndex = rowIndex - 1;
    var gridindex = 1;


    var newRow = gvServices.insertRow(rowIndex);
    if (rowColor == 0) {
        newRow.className = 'gridAlternaterow'
        rowColor++;
    }
    else {
        newRow.className = 'gridrow'
        rowColor = 0;
    }

    /* Sno And Colors */
    var newCell = newRow.insertCell(0);

    var chkid = GetEmergecnyCheckBox("chkid"); chkid.id = 'chkid' + oindex;
    var hdnServiceID = document.createElement('input'); hdnServiceID.type = 'hidden'; hdnServiceID.id = 'hdnServiceID' + oindex; hdnServiceID.value = service_id; newCell.appendChild(hdnServiceID);
    var hdnClass_Srv_ID = document.createElement('input'); hdnClass_Srv_ID.type = 'hidden'; hdnClass_Srv_ID.id = 'hdnClass_Srv_ID' + oindex; hdnClass_Srv_ID.value = pkg_id; newCell.appendChild(hdnClass_Srv_ID);
    newCell.appendChild(chkid);

    var newCell = newRow.insertCell(1);
    var divSno = document.createElement('div'); divSno.id = 'divSno';
    divSno.className = "legendinfo";
    var lblSNo = document.createElement('label'); lblSNo.id = 'lblSNo' + oindex; lblSNo.innerHTML = rowIndex;
    divSno.appendChild(lblSNo);
    newCell.className = 'sno';
    newCell.appendChild(divSno);

    var newCell = newRow.insertCell(2);
    var lblSrvName = document.createElement('label'); lblSrvName.id = 'lblSrvName' + oindex; lblSrvName.innerHTML = service_name;
    var hdnDoctorID = document.createElement('input'); hdnDoctorID.type = 'hidden'; hdnDoctorID.id = 'hdnDoctorID' + oindex; hdnDoctorID.value = Doctor_id; newCell.appendChild(hdnDoctorID);

    newCell.appendChild(lblSrvName);


    var newCell = newRow.insertCell(3);

    var lblSrvCode = document.createElement('label'); lblSrvCode.id = 'lblSrvCode' + oindex; lblSrvCode.innerHTML = service_cd;

    newCell.appendChild(lblSrvCode);


    var newCell = newRow.insertCell(4);

    var lblSrvType = document.createElement('label'); lblSrvType.id = 'lblSrvType' + oindex; lblSrvType.innerHTML = service_type;

    newCell.appendChild(lblSrvType);


    var newCell = newRow.insertCell(5);

    var lblSrvPrice = document.createElement('label'); lblSrvPrice.id = 'lblSrvPrice' + oindex; lblSrvPrice.innerHTML = amount;

    newCell.appendChild(lblSrvPrice);


}
function View_fn_AddRowWithDetaiscash(Discounttypeid, cardno, ddlmodeid, percentage, amount, authid, authname, remarks) {
    var gvrecdetails = document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession');
    var Pkgindex = gvrecdetails.rows.length;
    var newrow = gvrecdetails.insertRow(Pkgindex);

    var newCell = newrow.insertCell(0);
    var span = document.createElement('span');
    var newTextBox = document.createElement('label'); newTextBox.id = 'lblSNo' + Pkgindex; newTextBox.innerHTML = Pkgindex; span.appendChild(newTextBox);
    newCell.align = "left";
    newCell.appendChild(span); ;


    newCell = newrow.insertCell(1);
    var imgBtnDelete = document.createElement('IMG');
    imgBtnDelete.style.cursor = 'pointer';
    imgBtnDelete.CssClass = 'gimg';
    imgBtnDelete.style.padding = '2px';
    imgBtnDelete.style.margin = '0 4px';
    imgBtnDelete.style.float = 'left';
    imgBtnDelete.Style = "vertical-align: middle;";
    imgBtnDelete.id = 'imgBtnDelete' + index;
    newCell.style.width = "5%";
    imgBtnDelete.onclick = function () { return RemoveMultipleDiscounts(this); };
    imgBtnDelete.src = _iniUrl + 'Assets/Grid_Icons/delete.png';
    imgBtnDelete.onmouseover = function () { tooltip.show('Remove?'); };
    imgBtnDelete.title = 'Remove';
    imgBtnDelete.onmouseout = function () { tooltip.hide(); };
    if (getParameterByName("MODE") == "VIEW") {
        imgBtnDelete.style.display = 'none';
    }
    else {
        imgBtnDelete.style.display = 'block';
    }
    newCell.appendChild(imgBtnDelete);


    var newcell = newrow.insertCell(2);
    var ddltype = document.createElement('select');
    ddltype.id = 'ddlMultiDiscounttype' + '-' + Pkgindex;
    ddltype = GetDllyears('ddlMultiDiscounttype');
    ddltype.style.border = '1px solid rgb(244,120,94)';
    ddltype.onchange = function () { ShowHideOfGridDiscountSelection(this), DscntValidation(this); return OnNullValue(this); };
    ddltype.value = Discounttypeid;
    newcell.appendChild(ddltype);


    newcell = newrow.insertCell(3);
    var divcard = document.createElement('div'); divcard.id = 'divcard';
    divcard.className = "btntxt opbilllookup";
    var txtcardno = document.createElement('input');
    txtcardno.type = 'text';
    txtcardno.className = 'SampleReg';
    txtcardno.id = 'txtcardno' + Pkgindex;
    txtcardno.disabled = true;
    txtcardno.value = cardno;
    txtcardno.onblur = function () { return OnNullValue(this); };
    var divBtnSrc = document.createElement('div');
    divBtnSrc.id = 'divBtnSrc';
    divBtnSrc.className = "txtbtn";
    var BtnSrvSearch = document.createElement('input');
    BtnSrvSearch.type = 'button';
    BtnSrvSearch.className = 'tb_Btn searchbtn';
    BtnSrvSearch.id = 'BtnSrvSearch' + Pkgindex;
    BtnSrvSearch.align = "right";

    BtnSrvSearch.onclick = function () { BindHealthCard(this) };
    divcard.appendChild(txtcardno);
    divcard.appendChild(divBtnSrc);
    divBtnSrc.appendChild(BtnSrvSearch);
    newcell.style.width = "10%";
    newcell.appendChild(divcard);

    var hdncardid = document.createElement('input'); hdncardid.type = 'hidden'; hdncardid.id = 'hdncardid' + '-' + Pkgindex; newcell.appendChild(hdncardid);
    var hdnauthid = document.createElement('input'); hdnauthid.type = 'hidden'; hdnauthid.id = 'hdnauthid' + '-' + Pkgindex; newcell.appendChild(hdnauthid);
    var hdneventid = document.createElement('input'); hdneventid.type = 'hidden'; hdneventid.id = 'hdneventid' + '-' + Pkgindex; newcell.appendChild(hdneventid);
    var hdnRuleid = document.createElement('input'); hdnRuleid.type = 'hidden'; hdnRuleid.id = 'hdnRuleid' + '-' + Pkgindex; newcell.appendChild(hdnRuleid);

    var newCell = newrow.insertCell(4);
    var ddlModes = document.createElement('select');
    ddlModes.onchange = function () { return DisbaleEnableGridControls(this) };
    ddlModes.id = 'ddlModes' + '-' + Pkgindex;

    var option1 = document.createElement('option');
    option1.value = '1'; option1.innerHTML = 'Overall';
    newCell.style.width = "10%";
    ddlModes.appendChild(option1);
    var option2 = document.createElement('option');
    option2.value = '2'; option2.innerHTML = 'Line';
    ddlModes.appendChild(option2);
    ddlModes.value = ddlmodeid;
    newCell.appendChild(ddlModes);


    var newCell = newrow.insertCell(5);
    var txtper = GetnameTextBox('txtPersentage');
    txtper.onkeyup = function () { return CalculatePerBasedAmount(this, 'Perecent'); };
    txtper.onfocus = function () { return ClearTextboxTest(this); }
    txtper.onkeypress = function () { return numeralsOnlyTest(event, this); };
    txtper.onblur = function () { return AssignZeroTest(this); }
    txtper.maxlength = 10;
    txtper.onpaste = function () { return false; }
    txtper.ondrop = function () { return false; }
    txtper.className = 'Aright';
    txtper.value = percentage;
    newCell.appendChild(txtper);

    var newCell = newrow.insertCell(6);
    var txtamt = GetnameTextBox('txtAmount');
    txtamt.onkeyup = function () { return CalculatePerBasedAmount(this, 'Amount'); };
    txtamt.onfocus = function () { return ClearTextboxTest(this); }
    txtamt.onkeypress = function () { return numeralsOnlyTest(event, this); };
    txtamt.onblur = function () { return AssignZeroTest(this); }
    txtamt.ondrop = function () { return false; }
    txtamt.maxlength = 10;
    txtamt.onpaste = function () { return false; }
    txtamt.className = 'Aright';
    txtamt.value = amount;
    newCell.appendChild(txtamt);

    newcell = newrow.insertCell(7);
    var divAuthorized = document.createElement('div'); divAuthorized.id = 'divAuthorized';
    divAuthorized.className = "btntxt opbilllookup";
    var txtAutherizedPersion = document.createElement('input');
    txtAutherizedPersion.type = 'text';
    txtAutherizedPersion.className = 'SampleReg';
    txtAutherizedPersion.id = 'txtAutherizedPersion' + Pkgindex;
    txtAutherizedPersion.onblur = function () { return OnNullValue(this); }
    txtAutherizedPersion.value = authname;
    var divBtnSrc = document.createElement('div');
    divBtnSrc.id = 'divBtnSrc';
    divBtnSrc.className = "txtbtn";
    var BtnSrvSearch = document.createElement('input');
    BtnSrvSearch.type = 'button';
    BtnSrvSearch.className = 'tb_Btn searchbtn';
    BtnSrvSearch.id = 'BtnSrvSearch' + Pkgindex;
    BtnSrvSearch.align = "right";




    BtnSrvSearch.onclick = function () { onauthbind(this); }
    divAuthorized.appendChild(txtAutherizedPersion);
    divAuthorized.appendChild(divBtnSrc);
    divBtnSrc.appendChild(BtnSrvSearch);
    newcell.appendChild(divAuthorized);

    Sys.Application.add_init(function () {
        $create(AjaxControlToolkit.AutoCompleteBehavior, { "firstRowSelected": true, "completionListCssClass": "autocomplete_completionListElement",
            "completionListItemCssClass": "autocomplete_listItem", "highlightedItemCssClass": "autocomplete_highlightedListItem",
            "id": "autoComplete1" + Pkgindex, "minimumPrefixLength": 1, "serviceMethod": "GetAutoComp_Authorisation", "servicePath": _iniUrl + "authorization.asmx", "useContextKey": true, "contextKey": ""
        }, { "itemSelected": OnItemAuthSelection }, null, $get(txtAutherizedPersion.id));
    });

    var newCell = newrow.insertCell(8);
    var txtCRemks = GetnameTextBox('txtCRemks');
    txtCRemks.value = remarks;
    newCell.appendChild(txtCRemks);

    Pkgindex++;
}
function optionalclose() {
    $("#divOptional").hide();
    return false;
}
var OarrServiceIds = [];
function btnOkOptional() {

    var length = document.getElementById('tbl_Optional').rows.length;
    var Opt_srvs = $('#' + ctrlcom + '_UCServices_hdnopt_srv_cnt').val();
    var count = 0;
    var loop_count = 0;
    $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        for (var j = 1; j <= length; j++) {
            var status = $('[id$=tbl_Optional] tr').filter(':eq(' + j + ')').find('[type=checkbox]').prop('checked');
            var SrvId = $('[id$=tbl_Optional] tr').filter(':eq(' + j + ')').find('[id*=hdnServiceID]').val();
            if (status == undefined || status == null || status == '') { }
            else {
                if (status && loop_count == 0) {
                    count++;
                }
            }
        }
        loop_count++;
    });
    if (parseInt(count) > parseInt(Opt_srvs)) {
        $(".stoast").toastText("warning", "This Package Has Maximum Optinal Services Count As " + Opt_srvs + " ,So Please Contact Administrator", 5, 3);
        return false;
    }
    var is_optinalcount = 0;
    var opt_srvnames = '';
    $("table[id*=UCServices_gvServices] tr:has(td)").each(function (e) {

        var is_optinal = $(this).closest('tr').find('[id*=hdnis_optinal]').val();
        var srvname = $(this).closest('tr').find('[id*=txtServiceName]').val();
        if (is_optinal == undefined || is_optinal == null || is_optinal == '' || is_optinal == "undefined") { is_optinal = 'N' }
        if (is_optinal == 'Y') {
            is_optinalcount++;
            opt_srvnames += ' ,' + srvname;
        }

    });
    if (parseInt(is_optinalcount) >= parseInt(Opt_srvs)) {
        $(".stoast").toastText("warning", "This Package Has Maximum Optinal Services Count As " + Opt_srvs + " ,So Please Contact Administrator", 5, 3);
        $(".stoast").toastText("warning", "This Package Optional services" + opt_srvnames + "", 5, 2);
        $("#divOptional").hide()
        return false;
    }

    $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        var status = $('[id$=tbl_Optional] tr:has(td)').filter(':eq(' + e + ')').find('[type=checkbox]').prop('checked');
        var SrvId = $('[id$=tbl_Optional] tr:has(td)').filter(':eq(' + e + ')').find('[type=hidden][id*=hdnServiceID]').val();
        var DoctorID = $('[id$=tbl_Optional] tr:has(td)').filter(':eq(' + e + ')').find('[type=hidden][id*=hdnDoctorID]').val();
        if (DoctorID == '' || DoctorID == undefined || DoctorID == null) { DoctorID = 0; }
        if (status) {
            var objts = Optional;
            var l = objts.length;
            for (var i = 0; i < l; i++) {
                if (DoctorID > 0 && SrvId == 2) {
                    if (SrvId == objts[i].VALUE && DoctorID == objts[i].Doctor_id) {
                        if ($.inArray(parseInt(objts[i].Doctor_id), arrServiceIds) == -1) {
                            _pkg = 'O';
                            fn_AddFilterRow_pkgbillSelection(_pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, _sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_ID, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].START_DT, objts[i].END_DT, objts[i].DEPARTMENT_ID, objts[i].gender_id, _order_id, _order_det_id, objts[i].FROM_DAYS, objts[i].TO_DAYS, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD, 'N', 'N', 0, '', '', 0, 0, 0, 0, 0, 0, objts[i].BILLING_HEAD_ID, objts[i].IS_DOCTOR_REQUIRED, '', objts[i].TAX_PCT, '0', '', objts[i].SGST_TAX_PCT, objts[i].CGST_TAX_PCT, objts[i].SAC_CD, objts[i].CONC_RULE_PCT, objts[i].CONC_RULE_ID, objts[i].CONC_RULE_NAME, '0', objts[i].DOCTOR_PCT, '0', objts[i].ORG_PCT, objts[i].SERVICE_PRICE_ID, '', '', '', 'Y');
                            var gridid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                            var h = gridid.rows.length - 1;
                            _son = h + 1;

                            var rowIndex = gridid.rows.length;
                            arrServiceIds[rowIndex] = parseInt(DoctorID);
                        }

                    }
                }
                else {
                    if (SrvId == objts[i].SERVICE_ID && SrvId != 2) {
                        if ($.inArray(parseInt(objts[i].SERVICE_ID), arrServiceIds) == -1) {
                            _pkg = 'O';

                            fn_AddFilterRow_pkgbillSelection(_pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, _sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_CD, objts[i].SERVICE_GROUP_ID, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].SERVICE_GROUP_ID, objts[i].SERVICE_TYPE_ID, objts[i].DOCTOR_ID, objts[i].TARIFF_ID, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].SRV_PKG_ID, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].START_DT, objts[i].END_DT, objts[i].DEPARTMENT_ID, objts[i].gender_id, _order_id, _order_det_id, objts[i].FROM_DAYS, objts[i].TO_DAYS, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD, 'N', 'N', 0, '', '', 0, 0, 0, 0, 0, 0, objts[i].BILLING_HEAD_ID, objts[i].IS_DOCTOR_REQUIRED, '', objts[i].TAX_PCT, '0', '', objts[i].SGST_TAX_PCT, objts[i].CGST_TAX_PCT, objts[i].SAC_CD, objts[i].CONC_RULE_PCT, objts[i].CONC_RULE_ID, objts[i].CONC_RULE_NAME, '0', objts[i].DOCTOR_PCT, '0', objts[i].ORG_PCT, objts[i].SERVICE_PRICE_ID, '', '', '', 'Y');

                            var gridid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                            var h = gridid.rows.length - 1;
                            _son = h + 1;

                        }

                    }
                }
            }
        }
        /* else { /* unchecked                   /*commented by sitaram

        var GvRowscount = 0;
        var count = 0;
        var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index = grid.rows.length;
        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
        for (GvRowscount = 0; GvRowscount <= _index; GvRowscount++) {
        var grid_srv_id = $('[id$=gvServices] tr').filter(':eq(' + GvRowscount + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        if (grid_srv_id == SrvId && SrvId != undefined && grid_srv_id != undefined) {
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount + ')').remove();
        arrServiceIds = $.grep(arrServiceIds, function (value) {
        return value != grid_srv_id;
        });
        }
        }
        });

        /*

        var objts = Optional;
        var l = objts.length;
        for (var i = 0; i < l; i++) {
        if ($.inArray(parseInt(objts[i].VALUE), arrServiceIds) == -1) { }
        else {
        $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        var sid = $('[id$=tbl_Optional] tr').find('[id*=hdnServiceID]').val();
        if (sid == objts[i].VALUE)
        { $(this).closest('tr').remove(); }
        arrServiceIds = $.grep(arrServiceIds, function (value) {
        return value != sid;
        });
        });
        }
        }
            
        }*/
    });
    $("#divOptional").hide();
    $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        for (var j = 0; j < length; j++) {
            if (j > 0) {
                $('[id$=tbl_Optional] tr:has(td)').filter(':eq(' + e + ')').remove();
            }
        }
    });

    return false;
}
function RemoveOptionals() {

}
function Show_Srv_ScheduleDtls(ev) {
    var dateformat = $('#' + ctrlcom + '_hdndateformat').val();
    var split = dateformat.split(' ');
    var current_format = split[0];
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value = CurrentRowIndex;
    var clinical = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnhistorytypeID]').val();
    SrvSdul_ServiceId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    var sch_date = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnsrvdates]').val();
    var sch_req = 'N';
    if (sch_date == '' || sch_date == null || sch_date == undefined)
    { sch_req = 'Y'; }
    var sch_date_split = sch_date.split(',');
    var dosageqty; HdnSrSdulIndex = CurrentRowIndex;
    var ServiceName = document.getElementById('' + ctrlcom + '_UCServices_txtSrvShdulServicename').value = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtServiceName]').val();
    var qty = document.getElementById('' + ctrlcom + '_UCServices_txtSrvSdulQty').value = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val();
    if (qty > 1) {
        $("table[id*=tbl_SrvSdul] tr:has(td)").each(function (e) {
            $(this).closest('tr').remove();

        });
        Sindex = 0;
        for (var i = 0; i < qty; i++) {
            if (sch_req == 'N') {
                fn_Add_SrvSdul(sch_date_split[i + 1]);
            }
            else {
                fn_Add_SrvSdul();
            }
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + 0 + ')').find('[id*=txtDate]').val(new Date().format(current_format));
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + 0 + ')').find('[id*=txtDate]').prop('disabled', 'true');
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + 0 + ')').find('[type=button]').prop('disabled', 'true');
        }
        ctl00_ContentPlaceHolder1_UCServices_pnlSrvSdul.style.display = 'block';
    }
    if (getParameterByName('MODE') == 'VIEW_OP' || getParameterByName('MODE') == 'VIEW') {
        var ViewBillSrvId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrvShcedulSave]').val();
        view_Show_Srv_ScheduleDtls(ViewBillSrvId);
    }
}
function SrvSdulclosehipopup() {

    ctl00_ContentPlaceHolder1_UCServices_pnlSrvSdul.style.display = "none";
    return false;
}
function SaveCloseSrvSdul() {
    var SrvShdulRoot = ''; var c = '';
    var hdndate = '';
    $("table[id*=tbl_SrvSdul] tr:has(td)").each(function (e) {
        var _sch_dt = $(this).closest('tr').find('[id*=txtDate]').val();
        var _sch_hr = $(this).closest('tr').find('[id*=txthr]').val();
        var _sch_min = $(this).closest('tr').find('[id*=txtmin]').val();

        if (_sch_dt != '' && _sch_dt != null && _sch_dt != undefined) {
            /*
            c = '';
            SrvShdulRoot = SrvShdulRoot + "<FO_BILL_SRV_SCH BILL_SRV_SCH_ID=$" + 0 + "$ BILL_SRV_ID=$" + 0 + "$ SERVICE_ID=$" + SrvSdul_ServiceId + "$ SCH_DT=$" + SCH_DT + "$ />";
            hdndate = hdndate + ',' + SCH_DT; 
            */
        }
        else {
            c = '1';
            $(this).closest('tr').find('[id*=txtDate]').focus();
            $(".stoast").toastText("warning", "Please select service schedule date !", 5, 3);
            return false;
        }
        /* commented by rama for issue 5412 */
        /*   if (_sch_hr != '' && _sch_hr != null && _sch_hr != undefined) { }
        else {
        c = '1';
        $(this).closest('tr').find('[id*=txthr]').focus();
        $(".stoast").toastText("warning", "Please select service schedule Hour !", 5, 3);
        return false;
        }
        if (_sch_min != '' && _sch_min != null && _sch_min != undefined) { }
        else {
        c = '1';
        $(this).closest('tr').find('[id*=txtmin]').focus();
        $(".stoast").toastText("warning", "Please select service schedule minutes !", 5, 3);
        return false;
        } */



        var SCH_DT = "";
        if (_sch_hr == '' || _sch_hr == null || _sch_hr == undefined) {
            SCH_DT = _sch_dt;
        }
        else {
            SCH_DT = _sch_dt + ' ' + _sch_hr + ':' + _sch_min;
        }

        if (SCH_DT != '' && SCH_DT != null && SCH_DT != undefined) {

            c = '';
            SrvShdulRoot = SrvShdulRoot + "<FO_BILL_SRV_SCH BILL_SRV_SCH_ID=$" + 0 + "$ BILL_SRV_ID=$" + 0 + "$ SERVICE_ID=$" + SrvSdul_ServiceId + "$ SCH_DT=$" + SCH_DT + "$ />";
            hdndate = hdndate + ',' + SCH_DT;

        }
    });
    if (c != '1') {
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + HdnSrSdulIndex + ')').find('[id*=hdnSrvShcedulSave]').val(SrvShdulRoot);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + HdnSrSdulIndex + ')').find('[id*=hdnsrvdates]').val(hdndate);
        ctl00_ContentPlaceHolder1_UCServices_pnlSrvSdul.style.display = "none";
        return false;
    }
    else
    { return false; }
}
var SrowIndex = 0; var Sindex = 0;
function fn_Add_SrvSdul() {
    var dateformat = $('#' + ctrlcom + '_hdndateformat').val();
    var split = dateformat.split(' ');
    var current_format = split[0];
    var gvServices = document.getElementById('tbl_SrvSdul');
    var SrowIndex = gvServices.rows.length;
    var checkRowIndex = SrowIndex;
    var gridindex = 1;
    var newRow = gvServices.insertRow(SrowIndex);
    var newCell = newRow.insertCell(0);
    var divSno = document.createElement('div'); divSno.id = 'divSno';

    divSno.className = "legendinfo";
    var lblSNo = document.createElement('label'); lblSNo.id = 'lblSNo' + Sindex; lblSNo.innerHTML = SrowIndex + 1;
    divSno.appendChild(lblSNo);

    newCell.className = 'sno';
    newCell.appendChild(divSno);

    newCell = newRow.insertCell(1);
    var divtxt = document.createElement('div');
    var divbtn = document.createElement('div');
    divtxt.className = "btntxt";
    divbtn.className = "txtbtn";
    var txtDate = document.createElement('input');
    txtDate.type = 'text';
    txtDate.id = 'txtDate' + Sindex;
    txtDate.value = '';
    txtDate.readOnly = true;
    newCell.className = 'scode';

    divtxt.appendChild(txtDate);
    divtxt.appendChild(divbtn);
    newCell.appendChild(divtxt);

    newCell = newRow.insertCell(2);
    var divtxthr = document.createElement('div');
    divtxthr.className = "divtxthr";
    var txthr = document.createElement('input');
    txthr.type = 'text';
    txthr.id = 'txthr' + Sindex;
    txthr.value = '';
    newCell.className = 'scode';
    divtxthr.appendChild(txthr);
    newCell.appendChild(divtxthr);

    newCell = newRow.insertCell(3);
    var divtxtmin = document.createElement('divtxtmin');
    divtxtmin.className = "btntxt";
    var txtmin = document.createElement('input');
    txtmin.type = 'text';
    txtmin.id = 'txtmin' + Sindex;
    txtmin.value = '';
    newCell.className = 'scode';
    divtxtmin.appendChild(txtmin);
    newCell.appendChild(divtxtmin);

    $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + checkRowIndex + ")").find('input[type=text][id*=txtDate]').datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: current_format,
        minDate: new Date(),
        onSelect: function () {
            SrvDateSelection(this);
        }
    });
    Sindex++;
}

var SrowIndex = 0; var Sindex = 0;
function fn_Add_SrvSdul(schdt) {
    var dateformat = $('#' + ctrlcom + '_hdndateformat').val();
    var split = dateformat.split(' ');
    var current_format = split[0];
    var gvServices = document.getElementById('tbl_SrvSdul');
    var SrowIndex = gvServices.rows.length;
    var checkRowIndex = SrowIndex;
    var gridindex = 1;
    var newRow = gvServices.insertRow(SrowIndex);
    var newCell = newRow.insertCell(0);
    var divSno = document.createElement('div'); divSno.id = 'divSno';

    divSno.className = "legendinfo";
    var lblSNo = document.createElement('label'); lblSNo.id = 'lblSNo' + Sindex; lblSNo.innerHTML = SrowIndex + 1;
    divSno.appendChild(lblSNo);

    newCell.className = 'sno';
    newCell.appendChild(divSno);

    newCell = newRow.insertCell(1);
    var divtxt = document.createElement('div');
    var divbtn = document.createElement('div');
    divtxt.className = "btntxt";
    divbtn.className = "txtbtn";
    var txtDate = document.createElement('input');
    txtDate.type = 'text';
    txtDate.id = 'txtDate' + Sindex;
    if (schdt == undefined || schdt == null || schdt == '') {
        txtDate.value = '';
    }
    else {
        txtDate.value = schdt.split(' ')[0];
    }

    txtDate.readOnly = true;
    newCell.className = 'scode';

    divtxt.appendChild(txtDate);
    divtxt.appendChild(divbtn);
    newCell.appendChild(divtxt);


    newCell = newRow.insertCell(2);
    var divtxthr = document.createElement('div');
    divtxthr.className = "divtxthr";
    var txthr = document.createElement('input');
    txthr.type = 'text';
    txthr.id = 'txthr' + Sindex;
    txthr.placeholder = '24 Hours Format';
    txthr.value = '';
    txthr.maxLength = '2';
    txthr.onkeypress = function () { numeralsOnly1(event); }
    txthr.onkeyup = function () { checkHrs(this); }
    txthr.onblur = function () { SrvDateSelection(this); }
    if (schdt == undefined || schdt == null || schdt == '') {
        txthr.value = '';
    }
    else {
        var hm = schdt.split(' ')[1];
        txthr.value = hm.split(':')[0];
    }
    newCell.className = 'scode';

    divtxthr.appendChild(txthr);
    newCell.appendChild(divtxthr);

    newCell = newRow.insertCell(3);
    var divtxtmin = document.createElement('divtxtmin');
    divtxtmin.className = "btntxt";
    var txtmin = document.createElement('input');
    txtmin.type = 'text';
    txtmin.id = 'txtmin' + Sindex;
    txtmin.placeholder = 'Minutes';
    txtmin.maxLength = '2';
    txtmin.value = '';
    txtmin.onblur = function () { SrvDateSelection(this); }
    newCell.className = 'scode';
    if (schdt == undefined || schdt == null || schdt == '') {
        txtmin.value = '';
    }
    else {
        var hm = schdt.split(' ')[1];
        txtmin.value = hm.split(':')[1];
    }
    txtmin.onkeypress = function () { numeralsOnly1(event); };
    txtmin.onkeyup = function () { checkMins(this); }
    divtxtmin.appendChild(txtmin);
    newCell.appendChild(divtxtmin);

    $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + checkRowIndex + ")").find('input[type=text][id*=txtDate]').datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: current_format,
        minDate: new Date(),
        onSelect: function () {
            SrvDateSelection(this);
        }
    });
    Sindex++;
}


function SrvDateSelection(ev) {
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var len = document.getElementById('tbl_SrvSdul').rows.length;
    $("table[id*=tbl_SrvSdul] tr:has(td)").each(function (e) {
        var SchDt = $(this).closest('tr').find('input[type=text][id*=txtDate]').val();
        var hr = $(this).closest('tr').find('input[type=text][id*=txthr]').val();
        var min = $(this).closest('tr').find('input[type=text][id*=txtmin]').val();
        var PrSchDt = $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=text][id*=txtDate]').val();
        var Prhr = $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=text][id*=txthr]').val();
        var Prmin = $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=text][id*=txtmin]').val();

        if (SchDt == '' || SchDt == null || SchDt == undefined) { SchDt = ''; }
        if (PrSchDt == '' || PrSchDt == null || PrSchDt == undefined) { PrSchDt = ''; }

        if (hr == '' || hr == null || hr == undefined) { hr = ''; }
        if (min == '' || min == null || min == undefined) { min = ''; }

        if (Prhr == '' || Prhr == null || Prhr == undefined) { Prhr = ''; }
        if (Prmin == '' || Prmin == null || Prmin == undefined) { Prmin = ''; }

        var Dt = SchDt + ' ' + hr + ':' + min;
        var PrDt = PrSchDt + ' ' + Prhr + ':' + Prmin;
        if (e != CurrentRowIndex) {
            if (SchDt != '' && PrSchDt != '' && hr != '' && min != '' && Prhr != '' && Prmin != '' && Dt == PrDt) {
                $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=text][id*=txtDate]').val('');
                $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=text][id*=txthr]').val('');
                $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=text][id*=txtmin]').val('');
                $(".stoast").toastText("warning", "System Does Not Allow Duplicate Time", 5, 3);
                return false;
            }

        }
    });

}


function view_Show_Srv_ScheduleDtls(bill_srv_id) {


    if (bill_srv_id > 1) {

        GetAsync(
                        "Private/FrontOffice/OpBilling/OPBillClientSide.aspx/Show_Srv_ScheduleDtls",
                    { _bill_srv_id: parseInt(bill_srv_id) },
                    function (jdata) {
                        var d = jdata.d;
                        myAddress2(d);
                    },
                    function (jqXHR, textStatus, errorThrown) {
                    });
    }
    else {
        return false;
    }
}

function myAddress2(d) {
    var dateformat = $('#' + ctrlcom + '_hdndateformat').val();
    var split = dateformat.split(' ');
    var current_format = split[0];
    var view = document.getElementById('tbl_SrvSdul').rows.length
    for (var i = 0; i < view; i++) {
        if (d[i].SCH_DT != null && d[i].SCH_DT != '' && d[i].SCH_DT != undefined) {
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[id*=txtDate]').val(new Date(d[i].SCH_DT).format(current_format));
            var hm = new Date(d[i].SCH_DT).format(current_format + ' ' + 'HH:mm:ss').split(' ')[1]
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[id*=txthr]').val(hm.split(':')[0]);
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[id*=txtmin]').val(hm.split(':')[1]);
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[id*=txtDate]').prop('disabled', 'true');
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[id*=txthr]').prop('disabled', 'true');
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[id*=txtmin]').prop('disabled', 'true');
            $('[id$=tbl_SrvSdul] tr').filter(':eq(' + i + ')').find('[type=button]').prop('disabled', 'true');
        }
    }
    document.getElementById('btnSrvSdulSubmit').disabled = true;
}

function calculateletterqty() {
    
}
function Show_concernfornDtls(ev) {

    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value = CurrentRowIndex;
    var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    var SrvId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    document.getElementById('' + ctrlcom + '_UCServices_hdnConsentFmdt').value = SrvId;

    GetAsync(
                 "ServiceMasterWebService.asmx/ConsentDtls",
                { serviceID: SrvId, umr_no: umr_no, flag: "C" },
                function (data) {


                    ConsentDtlsColl(data, 'C');

                },
                function (jqXHR, textStatus, errorThrown) {
                });



    $('#divConsentFormDtls').css('display', 'block');
}

function onGuidelinesClick(ev) {

    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value = CurrentRowIndex;
    var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    var SrvId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    document.getElementById('' + ctrlcom + '_UCServices_hdnConsentFmdt').value = SrvId;

    GetAsync(
                 "ServiceMasterWebService.asmx/ConsentDtls",
                { serviceID: SrvId, umr_no: umr_no, flag: "G" },
                function (data) {


                    ConsentDtlsColl(data, 'D');

                },
                function (jqXHR, textStatus, errorThrown) {
                });



    $('#divConsentFormDtls').css('display', 'block');
}
function onCheckListClick(ev) {

    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value = CurrentRowIndex;
    var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    var SrvId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    document.getElementById('' + ctrlcom + '_UCServices_hdnConsentFmdt').value = SrvId;

    GetAsync(
                 "ServiceMasterWebService.asmx/ConsentDtls",
                { serviceID: SrvId, umr_no: umr_no, flag: "CH" },
                function (data) {


                    ConsentDtlsColl(data, 'CH');

                },
                function (jqXHR, textStatus, errorThrown) {
                });



    $('#divConsentFormDtls').css('display', 'block');
}

function onCheckInstructionClick(ev) {
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    document.getElementById('' + ctrlcom + '_UCServices_hdnRowIndexValue').value = CurrentRowIndex;
    var umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    var SrvId = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    document.getElementById('' + ctrlcom + '_UCServices_hdnConsentFmdt').value = SrvId;

    GetAsync(
                 "ServiceMasterWebService.asmx/ConsentDtls",
                { serviceID: SrvId, umr_no: umr_no, flag: "SI" },
                function (data) {
                    ConsentDtlsColl(data, 'SI');
                },
                function (jqXHR, textStatus, errorThrown) {
                });
    $('#divConsentFormDtls').css('display', 'block');
}

function ConsentDtlsColl(data, type) {

    if (data != null) {
        $('#divConsentFormDtls').css('display', 'block');
        if (type == 'C') {
            document.getElementById('' + ctrlcom + '_UCServices_lblcntorguidetxt').innerHTML = 'Consent Form Details';
        }
        else {
            if (type == 'CH') {
                document.getElementById('' + ctrlcom + '_UCServices_lblcntorguidetxt').innerHTML = 'Check List Details ';
            }
            else if (type == 'SI') {
                document.getElementById('' + ctrlcom + '_UCServices_lblcntorguidetxt').innerHTML = 'Instruction Details ';
            }
            else
                document.getElementById('' + ctrlcom + '_UCServices_lblcntorguidetxt').innerHTML = 'Guidelines Details ';
        }
        document.getElementById('' + ctrlcom + '_UCServices_lblCtxt').innerHTML = data.d[0].FORM_META_TEXT;
        $('#ulLang').empty();
        if (data.d[0].LANGUAGE != '') {
            var _li = '';
            var _str = data.d[0].LANGUAGE.split(',');
            for (var i = 0; i < _str.length; i++) {
                var _strLang = _str[i].split('-');
                var _strName = _strLang[0], _strId = _strLang[1];
                _li += "<li id=\"li_" + _strId + "\"><input class=\"button\" type=\"button\" id=" + _strId + " value=" + _strName + " onclick=\"return OnLaguageClick(this);\" /></li>";
            }
            $('#ulLang').append(_li);
        }
    }
}
function OnLaguageClick(ev) {
    var srvID = document.getElementById('' + ctrlcom + '_UCServices_hdnConsentFmdt').value;
    if (srvID == '' || srvID == null || srvID == undefined) { srvID = 0; }
    var langId = ev.id;
    if (langId == '' || langId == null || langId == undefined) { langId = 0; }
    GetAsync(
            "GridService.asmx/GetLanguageInstructions",
            { SrvId: srvID, LangId: langId },
            function (jdata) {
                if (jdata.d != null) {
                    var STR = jdata.d[0].IMAGE;
                    var _baseString = '';
                    GetAsync(
            "Private/FrontOffice/YRegistration.aspx/Get_imagedetails",
            { _str: STR, UMR_NO: '', REFERENCE_ID: 22, REFERENCE_TYPE_ID: "1", formname: 'INSTRUCTION' },
            function (data) {


                _baseString = data.d;
                var str = "data:application/pdf;base64," + _baseString;

                var file = new Blob([_baseString], { type: 'application/pdf' });
                var _url = window.URL.createObjectURL(file);
                window.open(str);
            },
            function (jqXHR, textStatus, errorThrown) {
            });
                }
            },
            function () {
            });

}
var Pkgsrvid = ''; var PkgOptid = [];
function Show_OptionalSrvDtls(ev) {

    var Form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
    var Umr_no = '';
    var cmp_id = '0';
    var referal_letter_id = '0';
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
        var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        else
            referal_letter_id = 0;
        cmp_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
    }
    else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
    }
    if (cmp_id == undefined || cmp_id == null || cmp_id == '') { cmp_id = "0"; }
    if (Form_name == 'OP') {
        if (document.getElementById('' + ctrlcom + '_chkIsOsp').checked == true)
        { }
        else {
            Umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
    }
    else if (Form_name == 'Cons') {
        Umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
    }
    else if (Form_name == 'OPQUICK') {
        if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
            Umr_no = $('#' + ctrlcom + '_umrPatientDetails_Umrlookup_txtSearchControl').val();
        }
    }
    var gridid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var j = gridid.rows.length - 1;
    var sno = j + 1;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex :
        CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var srvid = $("[id*=UCServices_gvServices] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=hidden][id*=hdnServiceID]').val();
    Pkgsrvid = $("[id*=UCServices_gvServices] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=hidden][id*=hdnServiceID]').val();
    var max_opt_srvs = $("[id*=UCServices_gvServices] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=hidden][id*=hdnmax_opt_srvs]').val();
    $('#' + ctrlcom + '_UCServices_hdnopt_srv_cnt').val(max_opt_srvs);
    var tariffid = $("[id*=UCServices_gvServices] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('input[type=hidden][id*=hdnTariffId]').val();
    var PAT_CATEGORY_ID = $('#' + ctrlcom + '_UCServices_ddlpatcat').val();
    if (PAT_CATEGORY_ID == undefined || PAT_CATEGORY_ID == null || PAT_CATEGORY_ID == '' || PAT_CATEGORY_ID == '--select--') { PAT_CATEGORY_ID = 0; }
    GetAsync(
                 "GridService.asmx/pkgincludesubNEW",
                { srvid: srvid, tariffid: tariffid, pkg: 'P', Umr_no: Umr_no, PAT_CATEGORY_ID: PAT_CATEGORY_ID, cmp_id: cmp_id },
                function (data) {
                    if (data.d == null) {
                        $(".stoast").toastText("warning", "This Package Does not Contain Any Includes So, Please Contact Administrator", 5, 3);
                        Removepkgrelated(srvid);
                        return false;
                    }
                    data.d = data.d[0][0];
                    if (data.d != null) {
                        if (data.d.length == 0) {
                            $(".stoast").toastText("warning", "This Package Does not Contain Any Includes So, Please Contact Administrator", 5, 3);
                            Removepkgrelated(srvid);
                            return false;
                        }
                        else {
                            onoptionalpkgsucess(data.d, 'P', '0', '0');
                        }
                    }
                },
                function (jqXHR, textStatus, errorThrown) {
                });
}
var _Optional = []; var _O = 0; var _Optional_clssrv = []; var PkgOptid = [];
function onoptionalpkgsucess(objts, pkg, order_id, order_det_id) {

    $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        $(this).closest('tr').remove();

    });
    for (var i = 0; i < objts.length; i++) {
        if (pkg != 'A') {
            if (objts[i].IS_OPTIONAL == 'Y' && objts[i].IS_ADDITIONAL != 'Y') {
                _Optional[_O] = objts[i];
                _O++;
                var gridid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
                var j = gridid.rows.length - 1;
                var sno = j + 1;
                PkgOptid.push(objts[i].VALUE);
                var not_req = 'N';
                var pat_age = $('#' + ctrlcom + '_UCServices_hdnPat_Age').val();
                if (pat_age == undefined || pat_age == null || pat_age == '') { pat_age = 0; }
                if (parseInt(objts[i].FROM_DAYS) >= 0 && parseInt(objts[i].TO_DAYS) > 0) {
                    if ((parseInt(objts[i].FROM_DAYS) <= parseInt(pat_age)) && (parseInt(pat_age) <= parseInt(objts[i].TO_DAYS))) {

                    }
                    else {
                        not_req = 'Y';
                        $(".stoast").toastText("warning", " '" + objts[i].Text + "' is applicable for patient of age '" + parseInt(objts[i].FROM_DAYS) + "' To '" + parseInt(objts[i].TO_DAYS) + "' ", 5, 3);
                    }
                }
                if (objts[i].SRV_GENDER_ID == "1" || objts[i].SRV_GENDER_ID == "2") {
                    if (document.getElementById('' + ctrlcom + '_UCServices_hdnGender_ID').value != objts[i].SRV_GENDER_ID) {
                        not_req = 'Y';
                        $(".stoast").toastText("warning", "This Service '" + objts[i].TEXT + "'  is not Suitable for this Patient", 5, 3);
                    }
                    else {

                    }
                }
                if (not_req == 'N') {

                    fn_AddFilterRow_Optional(pkg, objts[i].IS_FOREIGN_SERVICE, objts[i].CONCERN_FORM_REQ, objts[i].IS_CLINICAL_HIST_REQ, objts[i].HISTORY_TYPE, objts[i].IS_POST, sno, objts[i].SERVICE_ID, objts[i].SERVICE_NAME, objts[i].SERVICE_NAME, objts[i].SERVICE_GROUP_NAME, objts[i].PRICE, objts[i].CONCESSION, objts[i].PRICE, objts[i].SPECIMEN_NAME, objts[i].DOSAGE_QTY, objts[i].VACCUTAINER_NAME, objts[i].SERVICECLASS_ID, objts[i].Service_group_id, objts[i].Service_type_id, objts[i].DOCTOR_ID, objts[i].Tariff_Id, objts[i].IS_CLINICAL_HIST_REQ, objts[i].IS_FOREIGN_SERVICE, objts[i].REPORT_DISPATCH_TIME, objts[i].SPECIMEN_NAME, objts[i].SPECIMEN_ID, objts[i].HISTORY_TYPE, objts[i].PKG_SRV_IDS, objts[i].HISTORY_TYPE_ID, objts[i].EMERGENCY_PRICE, objts[i].MIN_PRICE, objts[i].MAX_PRICE, objts[i].NO_NEED_SRV, objts[i].CONCERN_FORM_REQ, objts[i].PRIV_SRV_POSTED_DT, objts[i].NO_NEED_DAYS, objts[i].QYT_EDIT, objts[i].RATE_EDIT, objts[i].START_DT, objts[i].END_DT, objts[i].DEPARTMENT_ID, objts[i].SRV_GENDER_ID, order_id, order_det_id, objts[i].FROM_DAYS, objts[i].TO_DAYS, 0, 0, 0, 0, 0, objts[i].REFRL_QTY, objts[i].EQUI_SERVICE_NAME, objts[i].EQUI_SERVICE_CD);
                }
            }

        }
    }
    var optionalsrv = []; var a = 0;
    var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    var len = grid.rows.length;
    var _Olen = PkgOptid.length;
    var tbllen = document.getElementById('tbl_Optional').rows.length;
    $("table[id*=UCServices_gvServices] tr:has(td)").each(function (e) {
        var srvid = $(this).closest('tr').find('[id*=hdnServiceID]').val();
        var clssrvid = $(this).closest('tr').find('[id*=hdnClass_Srv_ID]').val();
        if (Pkgsrvid == clssrvid) {
            if (_Olen > 0) {
                for (var k = 0; k < _Olen; k++) {
                    if (PkgOptid[k] == srvid) {
                        optionalsrv[a] = srvid;
                        _Optional_clssrv[a] = clssrvid;
                    }
                }
            }
        }
    });
    $("table[id*=tbl_Optional] tr:has(td)").each(function (e) {
        if (optionalsrv.length > 0) {
            for (var i = 0; i < optionalsrv.length; i++) {
                for (var j = 0; j < tbllen; j++) {
                    var srvid = $('[id$=tbl_Optional] tr').filter(':eq(' + j + ')').find('[id*=hdnServiceID]').val();
                    var clssrvid = $('[id$=tbl_Optional] tr').filter(':eq(' + j + ')').find('[id*=hdnClass_Srv_ID]').val();
                    if (optionalsrv[i] == srvid && _Optional_clssrv[i] == clssrvid) {
                        $('[id$=tbl_Optional] tr').filter(':eq(' + j + ')').find('[type=checkbox]').prop('checked', true)
                    }
                }
            }
        }
    });
    var length = document.getElementById('tbl_Optional').rows.length;

    if (length > 1) {
        $("#divOptional").show();
    }
}
function showvisits(ev) {
    var CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : ev.parentElement.parentElement.parentElement.rowIndex;
    CurrentRowIndex = CurrentRowIndex == undefined ? 0 : CurrentRowIndex;
    var _selectedDoctorID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
    var _selectedSrvID = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
    if (_selectedDoctorID > 0 && _selectedSrvID == 2) {
        alert('hi');
    }
}


var Reg_Count = 0;
function PatientRegFeeAmounts_New(val) {
    if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnOspRegReq').value == 'Y') {
        $('#' + ctrlcom + '_ReceiptControl2_txtpatgross').val(val);
        $('#' + ctrlcom + '_txtconamt').val('0');
        $('#' + ctrlcom + '_ReceiptControl2_txtnetamt').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_TextBox1').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_TextBox7').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_txtgrosstotal').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_txtpatNet').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_txtTotalNet').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_txtDueamount').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_txtTotalDue').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_hdnNetAmt').val(val);
        $('#' + ctrlcom + '_txtdueamt').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_txtpatdue').val(val);
        $('#ctl00_ContentPlaceHol der1_ReceiptControl2_txtTotalDue').val(val);
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(val);
        $('#' + ctrlcom + '_UCServices_hdnReg_fee').val(val);
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value == '0') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
        }
        else {
            var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
            var assest = '';
            if (form_name == 'OP') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else if (form_name == 'Cons') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else if (form_name == 'OPQUICK') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else {
                assest = false;
            }
            if (assest == true) {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            }
            else {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
            }
        }
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnRegconSetting').value == "Yes") {
            if (document.getElementById('' + ctrlcom + '_umrPatientDetails_hdnOspRegReq').value == 'Y') {
                var ddlregtype = document.getElementById('' + ctrlcom + '_ddlRegType');
                var ddlregtypeIndex = 2;
                var ddl = ddlregtypeIndex;
                var Serv_id = 1; var Srv_cd = 'REG'; var Srv_Name = 'REGISTRATION';
                var Price = val; var service_type_id = 5;
                var _ospregcount = 0;
                $('table[id*=UCServices_gvServices] tr').each(function (e) {
                    var name = $(this).closest('tr').find('input[type=text][id*=txtServiceName]').val();
                    if (name == 'REGISTRATION') {
                        _ospregcount = 1;
                    }
                });

                if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value != '2') {
                    if ($('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtServiceName]').val() != "REGISTRATION" && _ospregcount === 0) {
                        Reg_Count = 0; Reg_Count++;
                        fn_AddFilterRow_pkgbillSelection('G', 'N', 'N', 'N', 'N', 'N', 1, 1, Srv_Name, Srv_cd, '', Price, 0, Price, '', 1, '', 0, 0, service_type_id, 0, 1, '', 'N', '', '', 0, '', 0, 0, Price, Price, Price, '', '', '', '', '', '', '', '', 0, 0, 0, 0, 0, 0, 0, 0);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtServiceName]').attr('disabled', true);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtServiceCode]').attr('disabled', true);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=BtnSrvSearch]').attr('disabled', true);
                        if ($('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtServiceName]').val() == "REGISTRATION")
                        { $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('[id*=ddSType]').val(1); }
                        else {  $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('[id*=ddSType]').val(0); }

                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('[id*=ddSType]').attr('disabled', true);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('[id*=imgBtnDelete]').css('display', 'none');
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('[id*=chkstat]').css('display', 'none');
                        RegSrv = Srv_cd;

                    }
                    else if (Reg_Count == 1) {
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtRate]').val(val);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtAmount]').val(val);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(val);

                        var Damt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtDiscAmt]').val();
                        var Hamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtHcAmt]').val();
                        var Mamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtmgAmt]').val();
                        var Samt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtstAmt]').val();
                        var Eamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtebAmt]').val();
                        var CRamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtcncrlAmt]').val();
                        var PNamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(val) - parseFloat(Damt) - parseFloat(Hamt) - parseFloat(Mamt) - parseFloat(Samt) - parseFloat(Eamt) - parseFloat(CRamt);
                        $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPNAmt]').val(parseFloat(PNamt));
                        CalculateGridAmt(0);
                    }
                }
                else {
                    $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtRate]').val(val);
                    $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtAmount]').val(val);
                    $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(val);

                    var Damt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtDiscAmt]').val();
                    var Hamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtHcAmt]').val();
                    var Mamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtmgAmt]').val();
                    var Samt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtstAmt]').val();
                    var Eamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=text][id*=txtebAmt]').val();
                    var CRamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtcncrlAmt]').val();
                    var PNamt = $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPamt]').val(val) - parseFloat(Damt) - parseFloat(Hamt) - parseFloat(Mamt) - parseFloat(Samt) - parseFloat(Eamt) - parseFloat(CRamt);
                    $('[id$=gvServices] tr').filter(':eq(' + 0 + ')').find('input[type=button][id*=txtPNAmt]').val(parseFloat(PNamt));
                    CalculateGridAmt(0);
                }
            }
        }
    }


}

function checkMins(ev) {
    if (ev.value > 59) {
        var checkRowIndex = ev.parentElement.parentElement.parentElement.rowIndex;
        $(".stoast").toastText("warning", "Please Enter bellow 59 Mints", 5, 3);
        $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + checkRowIndex + ")").find('input[type=text][id*=txtmin]').val('');
        return false;
    }
}

function checkHrs(ev) {
    if (ev.value > 23) {
        var checkRowIndex = ev.parentElement.parentElement.parentElement.rowIndex;
        $(".stoast").toastText("warning", "Please Enter bellow 24 Hours", 5, 3);
        $(" [id*=tbl_SrvSdul] tr:has(td)").filter(":eq(" + checkRowIndex + ")").find('input[type=text][id*=txthr]').val('');
        return false;
    }
}


function ShowServiceGrp() {
    $("#divSrvGrpForm").show();

}
function CheckCurrentQty(obj) {
    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (obj.parentElement.parentElement.parentElement.rowIndex) == 'number' ? obj.parentElement.parentElement.parentElement.rowIndex : obj.parentElement.parentElement.rowIndex;
    var qtyVal = $("[id*=UCServices_gvServices] tr:has(td)").filter(":eq(" + CurrentRowIndex + ")").find('[id*=txtQty]').val();
    document.getElementById('' + ctrlcom + '_UCServices_hdnsrvqtyCompany').value = qtyVal;
}
function barcodevalidate(obj) {

}


function ManageAutoAdjustmentWidth() {
    var maxtaglen = 0;
    $('div[id*=DivGrid_Body] .Manage').each(function () {
        var tagLen = 0;
        var str = $(this).find('i'); 
        $(str).each(function () {
            var tag1 = $(this).css('display');
            if (tag1 == "block") {
                tagLen++;
            }
            if (maxtaglen == 0) {
                maxtaglen = tagLen;
            }
            else if (parseFloat(maxtaglen) < parseFloat(tagLen)) {
                maxtaglen = tagLen;
            }
            else {
                maxtaglen = maxtaglen;
            }
        });

    });
    var iconwidth = 30, colwidth = 0;
    switch (maxtaglen) {
        case 0:
            colwidth = 52;
            break;
        case 1:
            colwidth = iconwidth * maxtaglen;
            if (colwidth < 52) {
                colwidth = 52;
            }
            break;
        case 2:
            colwidth = iconwidth * maxtaglen;
            break;
        case 3:
            colwidth = iconwidth * maxtaglen;
            break;
        case 4:
            colwidth = iconwidth * maxtaglen;
            break;
        case 5:
            colwidth = iconwidth * maxtaglen;
            break;
        case 6:
            colwidth = iconwidth * maxtaglen;
            break;
        case 7:
            colwidth = iconwidth * maxtaglen;
            break;
        case 8:
            colwidth = iconwidth * maxtaglen;
            break;
        case 9:
            colwidth = iconwidth * maxtaglen;
            break;
        case 10:
            colwidth = iconwidth * maxtaglen;
            break;
        case 11:
            colwidth = iconwidth * maxtaglen;
            break;
        default:
            colwidth = iconwidth * maxtaglen;
            /*  colwidth = 200; */
            break;
    }
    colwidth = colwidth + "px";
    $('.Manage').css('min-width', colwidth);
}


function CloseInsConPopUp() {
    $('#divlist')[0].style.display = 'none';
    return false;
}

function ShowInsuranceDtls(ev) {

    var CurrentRowIndex = 0;
    CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
    if (ev.rowIndex != undefined) {
        CurrentRowIndex = ev.rowIndex;
    }
    if (CurrentRowIndex == undefined || CurrentRowIndex == null || CurrentRowIndex == '') {
        CurrentRowIndex = 0;
    }

    var _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
    var _docId = $(ev).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val();
    if (_srvId == '2' || _srvId == '11') {
        _srvId = _docId;
    }
    var _tbl = '<table class="jtblgrid" cellspacing="0" cellpadding="4" id="GvInsServices" style="border-width:0px;width:100%;border-collapse:collapse;">';
    _tbl += document.getElementById('' + ctrlcom + '_ReceiptControl2_GvIns').innerHTML;
    _tbl += "</table>";
    $('#divtagList').empty();
    $('#divlist')[0].style.display = 'block';
    $('#divtagList').append(_tbl);
    $("div[id*=divtagList] tr:has(td)").each(function () {
        var hdnitemid = $(this).closest('tr').find('input[type=hidden][id*=hdnitemid]').val();
        if (_srvId == hdnitemid) {
            $(this).show();
        }
        else {
            $(this).hide();
        }
    });
    AssignInsurenceSno(1);
    PasServiceCodesInfo1(ev);
    return false;
}

function PasServiceCodesInfo1(ev) {
    var CurrentRowIndex = 0; var _srvId, cons_type_id, servicename;
    var hdnSrvUniCode, hdnUniSrvTypeId, hdndoctorpasno, hdnDiagnosiscd, _docId;
    if (parseInt(ev) > 0) {
        CurrentRowIndex = ev;
        _srvId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        _docId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        servicename = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtServiceName]").val();
        cons_type_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddSType]').val();
        hdnSrvUniCode = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrvUniCode]');
        hdnUniSrvTypeId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnUniSrvTypeId]');
        hdndoctorpasno = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdndoctorpasno]');
        hdnDiagnosiscd = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDiagnosiscd]');
    }
    else {
        CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
        if (CurrentRowIndex == undefined || CurrentRowIndex == null || CurrentRowIndex == '') { CurrentRowIndex = 0; }
        _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
        servicename = $(ev).closest('tr').find("input[type=text][id*=txtServiceName]").val();
        _docId = $(ev).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val();
        cons_type_id = $(ev).closest('tr').find('[id*=ddSType]').val();
        hdnSrvUniCode = $(ev).closest('tr').find('input[type=hidden][id*=hdnSrvUniCode]');
        hdnUniSrvTypeId = $(ev).closest('tr').find('input[type=hidden][id*=hdnUniSrvTypeId]');
        hdndoctorpasno = $(ev).closest('tr').find('input[type=hidden][id*=hdndoctorpasno]');
        hdnDiagnosiscd = $(ev).closest('tr').find('input[type=hidden][id*=hdnDiagnosiscd]');
    }
    if (_srvId == '2' || _srvId == '11') {
        cons_type_id = cons_type_id;
        _srvId = "0"; ;
    }
    else {
        cons_type_id = "-1";
    }
    var DOCTOR_ID = 0;
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP') {
        DOCTOR_ID = $('#' + ctrlcom + '_UcOdrPsyn__hiddenID').val();
    }
    else {
        DOCTOR_ID = _docId;
    }
    var doctorname = '', diagnosiscd = '';
    GetNonAsync("Private/FrontOffice/OpBilling/OPBillClientSide.aspx/Bind_Consultation_PAS_Data",
                    { DOCID: DOCTOR_ID, CONSULTATION_TYPE_ID: cons_type_id, serviceID: _srvId },
                    function (jdata) {
                        var _data = jQuery.parseJSON(jdata.d);
                        var service_unicode = _data[0].SERVICE_UNICODE;
                        var uni_srv_type_name = _data[0].UNI_SERVICE_TYPE_NAME;
                        bindcptcode(uni_srv_type_name, service_unicode);
                    },
                    function () {
                    });
    return false;
}
function bindcptcode(servicetype, cptcode) {
    $('[id$=GvInsServices] tr').filter(':eq(' + 1 + ')').find('[id*=lblpasServiceType]').text(servicetype);
    $('[id$=GvInsServices] tr').filter(':eq(' + 1 + ')').find('[id*=lblcptcode]').text(cptcode);
}
function AssignInsurenceSno(rowindex) {
    var index = 1;
    $("table[id*=GvInsServices] tr:has(td)").each(function () {
        if ($(this).closest('tr').css('display') != "none") {
            $(this).closest('tr').find("[id*=lblSNo]").text(index);
            index++;
        }
    });
}

function DisplayCorpBlock() {
    $("table[id*=UCServices_gv_services_header] tr:has(td)").each(function (e) {
        var ev = this.rowIndex;
        $(this).closest('tr').find("input[type=text][id*=txtCamt]").css("display", "table-cell");
        $(this).closest('tr').find("input[type=text][id*=txtCDiscP]").css("display", "table-cell");
        $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").css("display", "table-cell");
        $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").css("display", "table-cell");
        $(this).closest('tr').find("input[type=text][id*=txtEqui_Srv_Name]").css("display", "table-cell");
    });


    var SetBsdBarcd = document.getElementById('' + ctrlcom + '_UCServices_hdnPrePrintedBarcodeReq').value;
    if (SetBsdBarcd == 'Yes') {/* cmp with barcd*/
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "table-cell";
        $(".gcompany").show();
        $('.barcdhead').show();
    }
    else if (SetBsdBarcd != 'Yes') {/* cmp without barcd*/
        document.getElementById('' + ctrlcom + '_UCServices_gv_services_header_ctl02_h_cmp_dtls').style.display = "table-cell";
        $(".gcompany").show();
        $('.barcdhead').hide();
    }
    var cnt = 0;
    $('[id*=GvIns] tr:has(td)').each(function () {
        var insamt = $(this).find('[id*=lblinsamt]').text();
        if (insamt == '' || insamt == undefined || insamt == null || isNaN(insamt)) { insamt = "0"; }
        if (parseFloat(insamt) > 0) { cnt = 1; }
    });
    if (cnt == 0) {
        $('.ghcdisc').hide();
        $('.gmgdisc').hide();
        $('.gstdisc').hide();
        $('.gevdisc').hide();
        $('.gcrdisc').hide();

        $('.patient').hide();
    }
}

function PkgConsBindSlotsCalling(CurrentRowIndex) {
    if (document.getElementById('' + ctrlcom + '_hdnAppsync').value.toLowerCase() == "true") {
        if (document.getElementById('' + ctrlcom + '_hdnisapptslotreq').value.toLowerCase() == "true") {
            SlotBind(CurrentRowIndex);
        }
    }

}


function CloseInspasdtlsPopUp() {
    $('#divpasdetails')[0].style.display = 'none';
    return false;
}


function PasServiceCodesInfo(ev) {
    var CurrentRowIndex = 0; var _srvId, cons_type_id, servicename;
    var hdnSrvUniCode, hdnUniSrvTypeId, hdndoctorpasno, hdnDiagnosiscd, _docId;
    if (parseInt(ev) > 0) {
        CurrentRowIndex = ev;
        _srvId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        _docId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDoctorID]').val();
        servicename = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find("input[type=text][id*=txtServiceName]").val();
        cons_type_id = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('[id*=ddSType]').val();
        hdnSrvUniCode = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnSrvUniCode]');
        hdnUniSrvTypeId = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnUniSrvTypeId]');
        hdndoctorpasno = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdndoctorpasno]');
        hdnDiagnosiscd = $('[id$=gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnDiagnosiscd]');
    }
    else {
        CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
        if (CurrentRowIndex == undefined || CurrentRowIndex == null || CurrentRowIndex == '') { CurrentRowIndex = 0; }
        _srvId = $(ev).closest('tr').find("input[type=hidden][id*=hdnServiceID]").val();
        servicename = $(ev).closest('tr').find("input[type=text][id*=txtServiceName]").val();
        _docId = $(ev).closest('tr').find("input[type=hidden][id*=hdnDoctorID]").val();
        cons_type_id = $(ev).closest('tr').find('[id*=ddSType]').val();
        hdnSrvUniCode = $(ev).closest('tr').find('input[type=hidden][id*=hdnSrvUniCode]');
        hdnUniSrvTypeId = $(ev).closest('tr').find('input[type=hidden][id*=hdnUniSrvTypeId]');
        hdndoctorpasno = $(ev).closest('tr').find('input[type=hidden][id*=hdndoctorpasno]');
        hdnDiagnosiscd = $(ev).closest('tr').find('input[type=hidden][id*=hdnDiagnosiscd]');
    }
    if (_srvId == '2' || _srvId == '11') {
        cons_type_id = cons_type_id;
        _srvId = "0"; ;
    }
    else {
        cons_type_id = "-1";
    }
    var DOCTOR_ID = 0;
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP') {
        DOCTOR_ID = $('#' + ctrlcom + '_UcOdrPsyn__hiddenID').val();
    }
    else {
        DOCTOR_ID = _docId;
    }
    var doctorname = '', diagnosiscd = '';
    GetNonAsync("Private/FrontOffice/OpBilling/OPBillClientSide.aspx/Bind_Consultation_PAS_Data",
                    { DOCID: DOCTOR_ID, CONSULTATION_TYPE_ID: cons_type_id, serviceID: _srvId },
                    function (jdata) {
                        var _data = jQuery.parseJSON(jdata.d);
                        var service_unicode = _data[0].SERVICE_UNICODE;
                        var uni_srv_type_id = _data[0].UNI_SERVICE_TYPE_ID;
                        var doctorPasNo = _data[0].DOCTOR_PAS_NO;
                        if (service_unicode == undefined || service_unicode == null || service_unicode == '') { service_unicode = '0'; }
                        if (uni_srv_type_id == undefined || uni_srv_type_id == null || uni_srv_type_id == '') { uni_srv_type_id = '0'; }
                        if (service_unicode == "0") {
                            _docsrvunicdCnt = 1;
                            $(".stoast").toastText("Info", "CPT Code is not mapped to this Service: " + servicename, 5, 2);
                        }
                        if (uni_srv_type_id == "0") {
                            _docsrvtypeCnt = 1;
                            $(".stoast").toastText("Info", "Service type is not mapped to this Service: " + servicename, 5, 2);
                        }
                        if (doctorPasNo == "0") {
                            _docpasno = 1;
                            $(".stoast").toastText("Info", "Doctor pas no is not mapped to this Doctor: " + doctorname, 5, 2);
                        }

                        hdnSrvUniCode.val(service_unicode);
                        hdnUniSrvTypeId.val(uni_srv_type_id);
                        hdndoctorpasno.val(doctorPasNo);
                        hdnDiagnosiscd.val(diagnosiscd);
                        $('#divpasdetails')[0].style.display = 'block';

                        if (_data[0].SERVICE_NAME == undefined || _data[0].SERVICE_NAME == null) { _data[0].SERVICE_NAME = ''; }
                        if (_data[0].UNI_SERVICE_TYPE_NAME == undefined || _data[0].UNI_SERVICE_TYPE_NAME == null) { _data[0].UNI_SERVICE_TYPE_NAME = ''; }
                        if (_data[0].SERVICE_UNICODE == undefined || _data[0].SERVICE_UNICODE == null) { _data[0].SERVICE_UNICODE = ''; }
                        if (_data[0].DOCTOR_PAS_NO == undefined || _data[0].DOCTOR_PAS_NO == null) { _data[0].DOCTOR_PAS_NO = ''; }

                        var _tbl = '', _div = '';
                        var _tbl = '<table border="0" cellpadding="0" cellspacing="7" width="100%" class="FormsCtrl">';
                        _tbl += '<tr><td>Service Type</td><td> :</td><td><span id="spansertypeID" data-key="' + _data[0].UNI_SERVICE_TYPE_ID + '" style="display:block;">' + _data[0].UNI_SERVICE_TYPE_NAME + '</span><select style="display:none;" id="ddlsertypeid"><option value="0">--select--</option><option value="1">PHARMACY</option><option value="2">INVESTIGATIONS</option><option value="3">HOSPITALS</option><option value="4">MEDICALS</option> </select></td></tr>';
                        _tbl += '<tr><td>CPT Code</td><td> :</td><td><span id="spanserunicode" style="display:block;">' + _data[0].SERVICE_UNICODE + '</span><input type="text" style="display:none;" id="txtserunicode" /></td></tr>';
                        _tbl += '<tr><td>Service Name</td><td> :</td><td><span>' + _data[0].SERVICE_NAME + '</span></td></tr>';
                        _tbl += '<tr><td>Doctor Reg#</td><td> :</td><td>' + _data[0].DOCTOR_PAS_NO + '</td></tr>';
                        _tbl += "<tr><td><input type=\"button\" id=\"btnsrvcodesadd\" onclick=\"OnEditSrvCodes('C');\" value=\"Edit\" class=\"button\" /></td><td><input type=\"button\" id=\"btnsrvcodeupdate\" value=\"Update\" onclick=\"return OnEditSrvCodesSave(" + _srvId + ", " + _docId + " , " + cons_type_id + ");\" style=\"display:none;\" class=\"button\" /></td></tr>";
                        _tbl += '</table>';
                        $('[id*=div4]').empty().html(_tbl);
                    },
                    function () {
                    });
    return false;
}

function OnEditSrvCodes(obj) {
    var _txtcode = $('[id*=spanserunicode]').html() == undefined ? '' : $('[id*=spanserunicode]').html();
    var _ddlid = $('[id*=spansertypeID]').attr('data-key') == undefined ? '' : $('[id*=spansertypeID]').attr('data-key');
    $('[id*=txtserunicode]').css('display', 'block'); $('[id*=spanserunicode]').css('display', 'none'); $('[id*=txtserunicode]').val('').val(_txtcode);
    $('[id*=spansertypeID]').css('display', 'none'); $('[id*=ddlsertypeid]').css('display', 'block'); $('[id*=ddlsertypeid]').val(_ddlid);
    $('[id*=btnsrvcodeupdate]').css('display', 'block'); $('[id*=btnsrvcodesadd]').css('display', 'none');
}
function OnEditSrvCodesSave(_sRVID, docid, cncltypeId) {
    var _txtsrvcode = $('[id*=txtserunicode]').val();
    var _srvtypeid = $('[id*=ddlsertypeid]').val();

    var _docid = docid, _cncl_type_id = cncltypeId;
    if (_sRVID != "2" && _sRVID != "11" && _sRVID != "0") { _docid = "0"; }
    GetAsync("Private/FrontOffice/OPBilling/OPBillClientSide.aspx/SaveSrvUnicodes",
    { UNICode: _txtsrvcode, SrvTypeID: _srvtypeid, sRVID: _sRVID, DocID: _docid, consult_type_ID: _cncl_type_id },
    function (jdata) {
        console.log(jdata.d);
        if (jdata.d == true) {
            $(".stoast").toastText("Info", "Updated Successfully!.", 5, 2);
        }
        else {
        }
        $('#divpasdetails')[0].style.display = 'none';
    },
    function () {
    });
}



function Error_net() {

    var ind_srv_b_amt = 0;
    var ind_srv_c_amt = 0;
    var ind_srv_n_amt = 0;
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {

        var Class_Srv_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnClass_Srv_ID]').val();
        var srv_Class_ID = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceClass]').val();
        var Service_id = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=hidden][id*=hdnServiceID]').val();
        var Amount = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=text][id*=txtAmount]').val();
        var Srv_b_amt = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=text][id*=txtPamt]').val();
        var srv_c_amt = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=text][id*=txtDiscAmt]').val();
        var srv_n_amt = $('[id$=gvServices] tr').filter(':eq(' + e + ')').find('input[type=text][id*=txtPNAmt]').val();
        if (Class_Srv_id > 0) { /* package includes */

        }
        else {
            ind_srv_b_amt = parseFloat(ind_srv_b_amt) + parseFloat(Srv_b_amt);
            ind_srv_c_amt = parseFloat(ind_srv_c_amt) + parseFloat(srv_c_amt);
            ind_srv_n_amt = parseFloat(ind_srv_n_amt) + parseFloat(srv_n_amt);
        }
    });
    var acc_net_amount = $('#' + ctrlcom + '_ReceiptControl2_txtpatNet').val();
    if (ind_srv_n_amt == null || ind_srv_n_amt == undefined || ind_srv_n_amt == '') { ind_srv_n_amt = 0; }
    if (acc_net_amount == null || acc_net_amount == undefined || acc_net_amount == '') { acc_net_amount = 0; }
    var error = 0;
    if (parseFloat(acc_net_amount) > parseFloat(ind_srv_n_amt)) {
        error = -Math.abs(parseFloat(acc_net_amount) - parseFloat(ind_srv_n_amt));
    }
    else {
        error = parseFloat(ind_srv_n_amt) - parseFloat(acc_net_amount);
    }
    return error;
}
function clrpattariffcncpt_hd() {
    $('.allowMTariff').hide();
    document.getElementById('' + ctrlcom + '_UCServices_ddlpatcat').selectedIndex = 0;
    document.getElementById('' + ctrlcom + '_UCServices_ddltariff').selectedIndex = 0;
}
function clrpattariffcncpt_sh() {

    var hdnallowtariffslcn = $('[id*=hdnallowtariffslcn]').val().toLowerCase();
    if (hdnallowtariffslcn == 'true') {

        if (document.getElementById('' + ctrlcom + '_UCServices_hbnisshowpatcatagery').value.toUpperCase() == "YES") {
            $('.allowMTariff').show();
        }
        else {
            $('.allowMTariff').show();
            $('#' + ctrlcom + '_UCServices_ddlpatcat').prop('disabled', true);
            $('#' + ctrlcom + '_UCServices_ddltariff').prop('disabled', true);

        }
    }


    var foreigncatid = $('[id*=hdnforeigncatid]').val();
    if (foreigncatid == undefined || foreigncatid == null || foreigncatid == '') {
        foreigncatid = 0;
    }
    if (foreigncatid != 0) {
        $('#' + ctrlcom + '_UCServices_ddlpatcat').val($('[id*=hdnforeigncatid]').val());
        ChangeTarifByPatcat();
        document.getElementById('' + ctrlcom + '_UCServices_ddltariff').selectedIndex = 1;
    }
}
function DelateAllGridData() {
    var gridID = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
    $("table[id$=UCServices_gvServices] tr:has(td)").each(function () {
        var rowIndex = gridID.rows.length;
        var checkRowIndex = rowIndex - 1;
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + checkRowIndex + ')').remove();
    });
    ClearTransactionUserControl();
    arrServiceIds = [];
}

function ConfirmationRequiredForSaveWithParam_message_Cons(obj, param, message) {
    var SaveAlert = document.getElementById(obj);
    $(".smessagebox").scustommessagebox(1, "Confirmation", message, OnsuccesssaveConfirmationwithParam_message_Cons, param, OnCancelConfirmation_services);
}

function OnsuccesssaveConfirmationwithParam_message_Cons(param) {
    var _srv_tax_amount = 0;
    if (document.getElementById('' + ctrlcom + '_hdnSrvTaxRequired').value == 'True') {
        var contax = document.getElementById('' + ctrlcom + '_hdnOpConsulTax').value;
        if (contax == undefined || contax == '' || contax == NaN)
            contax = 0;
        _srv_tax_amount = (parseFloat(param.PRICE) * parseFloat(contax)) / 100;

        $('[id$=txtTaxAmt]').val(_srv_tax_amount);
        document.getElementById('' + ctrlcom + '_hdnOpConsPayAmt').value = param.PRICE;
    }
    _srv_tax_amount = parseFloat(_srv_tax_amount) + parseFloat(param.PRICE);

    var companyid = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
    if (companyid > 0) {
        _price = param.PRICE;
        _price = _price == '' ? 0 : _price;
        OrgPrice = param.ORG_PRICE;
        OrgPrice = OrgPrice == '' ? 0 : OrgPrice;
    }
    else {
        var status = $("table[id$=tbl_tbl_PatRequisitions] tr:has(td)").find("input[type=checkbox]").is(':checked');
        if (document.getElementById('' + ctrlcom + '_hdnreqtype').value == "PACKAGE") {
            _price = 0;
        } else {
            _price = param.PRICE;
        }
    }
    var is_counter_required = param.IS_COUNTER_REQUIRED;
    if (is_counter_required == undefined || is_counter_required == 'undefined' || is_counter_required == null) is_counter_required = 'N';
    var doctor_exists = param.DOCTOR_EXISTS;
    var _doctor_id = document.getElementById('' + ctrlcom + '_hdnDoctor_ID').value;
    var doctorname = document.getElementById('' + ctrlcom + '_hdnDoctorName').value;
    var doctorcd = document.getElementById('' + ctrlcom + '_hdnDoctorCd').value;
    var deptid = document.getElementById('' + ctrlcom + '_hdnDeptId').value;
    var deptname = document.getElementById('' + ctrlcom + '_hdnDeptName').value;
    var Servicegroupid = 0;
    var Servicetypeid = 0;
    var objectexp = arrayRequest1;
    var flagExist = false;

    _value = _doctor_id;
    Alter = 'Doctor';
    if ($.inArray(parseInt(_value), arrRequisations) != -1) {
        $(".stoast").toastText("Info", "This " + doctorname + " is Already Exists in Consultation Requisitions!", 5, 2);
        return false;
    }

    if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
        if (flagExist == false) {
            if ($.inArray(parseInt(_doctor_id), arrServiceIds) == -1) {
                var paymentby = document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value;
                if (param.LAST_VISITED == null || param.LAST_VISITED == '') {
                    var _lastvisitedDt = '';
                } else {
                    var _lastvisitedDt = new Date(param.LAST_VISITED).format('MM-dd-yyyy');
                }
                if (_lastvisitedDt == undefined || _lastvisitedDt == null || _lastvisitedDt == '') { _lastvisitedDt = ''; }
                var VisitTypeId = param.CONSULTATION_TYPE_ID;
                if (VisitTypeId == undefined || VisitTypeId == null || VisitTypeId == '') { VisitTypeId = '0'; }
                if (is_counter_required.trim() == 'Y' && doctor_exists.trim() == 'N') {
                    return false;
                }
                else {
                    var hdnDoctorPrice = param.DOCTOR_PRICE;

                    var hdnDoctorPct = param.DOCTOR_PCT;
                    var hdnOrgPrice = param.ORG_PRICE;
                    var hdnOrgPct = param.ORG_PCT;
                    var hdnsrvpriceID = param.SERVICE_PRICE_ID;



                    if (hdnDoctorPrice == undefined || hdnDoctorPrice == null || hdnDoctorPrice == '') { hdnDoctorPrice = '0'; }
                    if (hdnDoctorPct == undefined || hdnDoctorPct == null || hdnDoctorPct == '') { hdnDoctorPct = '0'; }
                    if (hdnOrgPrice == undefined || hdnOrgPrice == null || hdnOrgPrice == '') { hdnOrgPrice = '0'; }
                    if (hdnOrgPct == undefined || hdnOrgPct == null || hdnOrgPct == '') { hdnOrgPct = '0'; }
                    var tariff_id = param.TARIFF_ID;
                    if (tariff_id == undefined || tariff_id == null || tariff_id == '') { tariff_id = '1'; }
                    var event_track_id = 0;

                    fn_AddFilterRow_pkgbillSelection('G', 'N', 'N', 'N', 'N', 'N', 1, 2, doctorname, doctorcd, 'Consultation', _price, 0, _price, '', '', '', 0, 0, 1, _doctor_id, tariff_id, '', 'N', '', '', 0, '', 0, 0, _price, 0, 0, '', '', _lastvisitedDt, 0, '', '', '', '', deptid, '4', '', '', '0', '0', VisitTypeId, reqid, SlotTime, SlotId, '', 0, '', '', 'N', 'N', 0, '', '', 0, 0, 0, 0, event_track_id, '', 0, '', '', 0, 0, 0, 0, 0, '', 0, 0, '', hdnDoctorPrice, hdnDoctorPct, hdnOrgPrice, hdnOrgPct, hdnsrvpriceID);
                }
                $("table[id*=UCServices_gvServices] tr:has(td)").each(function () {
                    var RowIndexForGrid = $(this)[0].rowIndex;
                    if (document.getElementById('' + ctrlcom + '_hdnreqtype').value != "PACKAGE") {

                        var class_srv_id = $("table[id$=UCServices_gvServices] tr").filter(":eq(" + RowIndexForGrid + ")").find("input[type=hidden][id*=hdnClass_Srv_ID]").val();
                        var gen_servic_id = $("table[id$=UCServices_gvServices] tr").filter(":eq(" + RowIndexForGrid + ")").find('input[type=hidden][id*=hdnServiceID]').val();
                        if (gen_servic_id == null || gen_servic_id == undefined || gen_servic_id == '') { gen_servic_id = 0; }
                        if (class_srv_id == null || class_srv_id == undefined || class_srv_id == '') { class_srv_id = 0; }
                        if (class_srv_id > 0 && gen_servic_id == 2) {

                        } else {
                            $("table[id$=UCServices_gvServices] tr").filter(":eq(" + RowIndexForGrid + ")").find('[id*=BtnSrvSearch]').attr("disabled", "true");
                        }

                    }
                });
            }
            else {
                $(".stoast").toastText("warning", "Doctor " + doctorname + " Already Exists !", 5, 3);

            }
            objectexp = '';
        }
    }


    var ddlpattypchk = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
    if (ddlpattypchk == '2' || ddlpattypchk == '5' || ddlpattypchk == '7' || ddlpattypchk == '8' || ddlpattypchk == '9' || ddlpattypchk == '10') {
        if ($('#' + ctrlcom + '_chk_old')[0].checked == true) {
            classDisplayCmpAmts();
        } else {
            classDisplayCmpAmts();
        }
    } else {
        classHideCmpAmts();
    }

    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value > 0) {
        var asses = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        if (asses == true) {
            $('#' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').removeClass('red');
        }
        else {
            $('#' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').addClass('red');
        }
    } else {
        $('#' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').removeClass('red');
    }
    AssignSnoIndex();
}


function CalculateempperpatperEmpCorp() {

    var totPatConPer = 0;
    var PatTotalgrossamt = 0;
    var cmpTotalGrossAmt = 0;
    var PatNetAmt = 0;
    var cmpNetAmt = 0;
    var PatCNCAmt = 0;
    var cmpCNCAmt = 0;
    var cmpper = ctl00_ContentPlaceHolder1_txtCorpPercentage.value;
    var Totpattaxamt = 0;
    var Totcmptaxamt = 0;
    var totcmpamt = 0;
    if (cmpper == '' || cmpper == undefined || cmpper == null || isNaN(cmpper)) { cmpper = "0"; }
    if (parseFloat(cmpper) > 100) {
        cmpper = 100;
        document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = cmpper;
    }
    document.getElementById('' + ctrlcom + '_hdnOrgPer').value = cmpper;
    var empper = 100 - parseFloat(cmpper);
    document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = empper;
    document.getElementById('' + ctrlcom + '_hdnEmpPer').value = empper;
    $("table[id*=UCServices_gvServices] tr:has(td)").each(function () {
        var RowIndexForGrid = $(this)[0].rowIndex;
        var Amount = $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('[id*=txtAmount]').val();
        var discper = $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('[id*=hdnCmpDiscPcnt]').val();
        var discperpat = discper;
        var discpercmp = discper;
        var TAX_PCT = $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('[id*=hdntaxpct]').val();
        if (TAX_PCT == '' || TAX_PCT == undefined || TAX_PCT == null || isNaN(TAX_PCT)) { TAX_PCT = "0"; }

        var patamtgrossline = 0;
        var cmpamtgrossline = 0;

        if (Amount == '' || Amount == undefined || Amount == null || isNaN(Amount)) { Amount = "0"; }
        if (discper == '' || discper == undefined || discper == null || isNaN(discper)) { discper = "0"; }
        if (discperpat == '' || discperpat == undefined || discperpat == null || isNaN(discperpat)) { discperpat = "0"; }
        if (discpercmp == '' || discpercmp == undefined || discpercmp == null || isNaN(discpercmp)) { discpercmp = "0"; }

        var credit_limit = '0';
        credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
        totcmpamt += Math.round((parseFloat(Amount) * parseFloat(cmpper)) / 100);
        if (parseFloat(totcmpamt) > parseFloat(credit_limit)) {
            if (parseFloat(totcmpamt) != parseFloat(credit_limit)) {
                if (parseFloat(totcmpamt) != parseFloat(credit_limit)) {
                    var totalcmplineassign = parseFloat(totcmpamt) - parseFloat(credit_limit);
                } else {
                    var totalcmplineassign = parseFloat(totcmpamt)

                }
                var totalcmpamtline = parseFloat(Math.round((parseFloat(Amount) * parseFloat(cmpper)) / 100));
                cmpamtgrossline = totalcmpamtline;
                totcmpamt -= parseFloat(totalcmplineassign);
                patamtgrossline = parseFloat(Amount) - parseFloat(cmpamtgrossline);
                PatTotalgrossamt = parseFloat(PatTotalgrossamt) + parseFloat(patamtgrossline);
                cmpTotalGrossAmt = parseFloat(cmpTotalGrossAmt) + parseFloat(cmpamtgrossline);
            }
            else {
                cmpper = 0;
                cmpamtgrossline = Math.round((parseFloat(Amount) * parseFloat(cmpper)) / 100);
                patamtgrossline = parseFloat(Amount) - parseFloat(cmpamtgrossline);
                PatTotalgrossamt = parseFloat(PatTotalgrossamt) + parseFloat(patamtgrossline);
                cmpTotalGrossAmt = parseFloat(cmpTotalGrossAmt) + parseFloat(cmpamtgrossline);
            }
        } else {
            cmpamtgrossline = Math.round((parseFloat(Amount) * parseFloat(cmpper)) / 100);
            patamtgrossline = parseFloat(Amount) - parseFloat(cmpamtgrossline);
            PatTotalgrossamt = parseFloat(PatTotalgrossamt) + parseFloat(patamtgrossline);
            cmpTotalGrossAmt = parseFloat(cmpTotalGrossAmt) + parseFloat(cmpamtgrossline);
        }
        if (cmpamtgrossline == '' || cmpamtgrossline == undefined || cmpamtgrossline == null || isNaN(cmpamtgrossline)) { cmpamtgrossline = "0"; }
        if (patamtgrossline == '' || patamtgrossline == undefined || patamtgrossline == null || isNaN(patamtgrossline)) { patamtgrossline = "0"; }
        if (PatTotalgrossamt == '' || PatTotalgrossamt == undefined || PatTotalgrossamt == null || isNaN(PatTotalgrossamt)) { PatTotalgrossamt = "0"; }
        if (cmpTotalGrossAmt == '' || cmpTotalGrossAmt == undefined || cmpTotalGrossAmt == null || isNaN(cmpTotalGrossAmt)) { cmpTotalGrossAmt = "0"; }

        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtPamt]').val(patamtgrossline);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtCamt]').val(cmpamtgrossline);
        var patcncamtline = 0;
        var cmpcncamtline = 0;
        patcncamtline = Math.round((parseFloat(patamtgrossline) * parseFloat(discperpat)) / 100);
        cmpcncamtline = Math.round((parseFloat(cmpamtgrossline) * parseFloat(discpercmp)) / 100);
        var tpamt = ((parseFloat(patamtgrossline) * (parseFloat(discperpat))) / parseFloat(100));
        var tcamt = ((parseFloat(cmpamtgrossline) * (parseFloat(discpercmp))) / parseFloat(100));
        var tamt = Math.round(parseFloat(tpamt) + parseFloat(tcamt));
        var tecamt = parseFloat(patcncamtline) + parseFloat(cmpcncamtline);
        if (tamt != tecamt) {
            if (parseFloat(tamt) > tecamt) {
                var dispamt = parseFloat(tamt) - parseFloat(tecamt);
                patcncamtline = parseFloat(patcncamtline) + parseFloat(dispamt);
            }
            else if (tecamt > tamt) {
                var dispamt = parseFloat(tecamt) - parseFloat(tamt);
                patcncamtline = parseFloat(patcncamtline) - parseFloat(dispamt);
            }
        }
        PatCNCAmt = parseFloat(PatCNCAmt) + parseFloat(patcncamtline);
        cmpCNCAmt = parseFloat(cmpCNCAmt) + parseFloat(cmpcncamtline);
        if (patcncamtline == '' || patcncamtline == undefined || patcncamtline == null || isNaN(patcncamtline)) { patcncamtline = "0"; }
        if (cmpcncamtline == '' || cmpcncamtline == undefined || cmpcncamtline == null || isNaN(cmpcncamtline)) { cmpcncamtline = "0"; }
        if (PatCNCAmt == '' || PatCNCAmt == undefined || PatCNCAmt == null || isNaN(PatCNCAmt)) { PatCNCAmt = "0"; }
        if (cmpCNCAmt == '' || cmpCNCAmt == undefined || cmpCNCAmt == null || isNaN(cmpCNCAmt)) { cmpCNCAmt = "0"; }

        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtDiscAmt]').val(patcncamtline);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtCDiscAmt]').val(cmpcncamtline);
        var patnetamtline = 0;
        var cmpnetamtline = 0;
        patnetamtline = patamtgrossline - patcncamtline;
        cmpnetamtline = cmpamtgrossline - cmpcncamtline;
        PatNetAmt = parseFloat(PatNetAmt) + parseFloat(patnetamtline);
        cmpNetAmt = parseFloat(cmpNetAmt) + parseFloat(cmpnetamtline);

        var pattaxamt = ((parseFloat(PatNetAmt) * parseFloat(TAX_PCT)) / 100);
        var cmptaxamt = ((parseFloat(cmpNetAmt) * parseFloat(TAX_PCT)) / 100);

        if (cmptaxamt == '' || cmptaxamt == undefined || cmptaxamt == null || isNaN(cmptaxamt)) { cmptaxamt = "0"; }
        if (pattaxamt == '' || pattaxamt == undefined || pattaxamt == null || isNaN(pattaxamt)) { pattaxamt = "0"; }

        if (patnetamtline == '' || patnetamtline == undefined || patnetamtline == null || isNaN(patnetamtline)) { patnetamtline = "0"; }
        if (cmpnetamtline == '' || cmpnetamtline == undefined || cmpnetamtline == null || isNaN(cmpnetamtline)) { cmpnetamtline = "0"; }
        if (PatNetAmt == '' || PatNetAmt == undefined || PatNetAmt == null || isNaN(PatNetAmt)) { PatNetAmt = "0"; }
        if (cmpNetAmt == '' || cmpNetAmt == undefined || cmpNetAmt == null || isNaN(cmpNetAmt)) { cmpNetAmt = "0"; }

        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtPNAmt]').val(patnetamtline);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtCNetAmt]').val(cmpnetamtline);
        pattaxamt = parseFloat(pattaxamt);
        cmptaxamt = parseFloat(cmptaxamt);
        pattaxamt = pattaxamt.toFixed(2);
        cmptaxamt = cmptaxamt.toFixed(2);
        Totpattaxamt = parseFloat(Totpattaxamt) + parseFloat(pattaxamt);
        Totcmptaxamt = parseFloat(Totcmptaxamt) + parseFloat(cmptaxamt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtptax]').val(pattaxamt);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + RowIndexForGrid + ')').find('input[type=text][id*=txtcmptax]').val(cmptaxamt);
        AddGridPatmuldisc(RowIndexForGrid);
    });

    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = '0';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = '0';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = '0';


    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value = '';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtCardAmt').value = '';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_ddcardType').selectedIndex = 0;
    document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlcrdtype').selectedIndex = 0;
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcardExpiredt').value = '';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcardNoCmp').value = '';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_ddbankName').selectedIndex = 0;
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcardAuther').value = '';
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').value = '';


    /*Quick Start*/
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = parseFloat(PatTotalgrossamt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = parseFloat(cmpTotalGrossAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = parseFloat(PatTotalgrossamt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = parseFloat(cmpTotalGrossAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt));
    /*Quick End */
    /* Advanced Start */
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = parseFloat(PatTotalgrossamt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = parseFloat(cmpTotalGrossAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = parseFloat(PatTotalgrossamt) + parseFloat(cmpTotalGrossAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = Math.round(PatCNCAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartygrossamt').value = Math.round(cmpCNCAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = Math.round(parseFloat(cmpCNCAmt) + parseFloat(PatCNCAmt));
    var cmpDiscPcnt = (parseFloat(100) * parseFloat(cmpCNCAmt)) / parseFloat(cmpTotalGrossAmt);
    if (cmpDiscPcnt == '' || cmpDiscPcnt == undefined || cmpDiscPcnt == null || isNaN(cmpDiscPcnt)) { cmpDiscPcnt = "0"; }
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartydis').value = setProperDecimals(cmpDiscPcnt);

    var patDiscPcnt = (parseFloat(100) * parseFloat(PatCNCAmt)) / parseFloat(PatTotalgrossamt);

    if (patDiscPcnt == '' || patDiscPcnt == undefined || patDiscPcnt == null || isNaN(patDiscPcnt)) { patDiscPcnt = "0"; }
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = setProperDecimals(patDiscPcnt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(PatNetAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = Math.round(PatNetAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = Math.round(parseFloat(PatNetAmt) + parseFloat(Totpattaxamt));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpTotTax').value = parseFloat(Totcmptaxamt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatTotTax').value = parseFloat(Totpattaxamt);
    var taxamt = (parseFloat(Totcmptaxamt) + parseFloat(Totpattaxamt));
    if (taxamt == '' || taxamt == undefined || taxamt == null || isNaN(taxamt)) { taxamt = "0"; }
    taxamt = parseFloat(taxamt);
    taxamt = taxamt.toFixed(2);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txttaxamt').value = taxamt;

    $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(Math.round(parseFloat(PatNetAmt) + parseFloat(Totpattaxamt)));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = Math.round(cmpNetAmt);
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(parseFloat(PatNetAmt) + parseFloat(Totpattaxamt));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(parseFloat(PatNetAmt) + parseFloat(Totpattaxamt));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(parseFloat(PatNetAmt) + parseFloat(cmpNetAmt));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(parseFloat(PatNetAmt) + parseFloat(Totpattaxamt));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(cmpNetAmt) + parseFloat(Totcmptaxamt));
    document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatNetAmt) + parseFloat(cmpNetAmt) + parseFloat(Totcmptaxamt) + parseFloat(Totpattaxamt));

    if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {

        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
        document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;

    }
    if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {

        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
        document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
    }
    else {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
        document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
    }


    $('#' + ctrlcom + '_txtCorpPayAmt').val(Math.round(parseFloat(cmpNetAmt) + parseFloat(Totcmptaxamt)));
    $('#' + ctrlcom + '_txtCorpDueAmt').val(Math.round(parseFloat(cmpNetAmt) + parseFloat(Totcmptaxamt)));
    $('#' + ctrlcom + '_txtEmpPayAmt').val(parseFloat(PatNetAmt) + parseFloat(Totpattaxamt));
    $('#' + ctrlcom + '_txtEmpTaxAmt').val(parseFloat(Totpattaxamt));
    $('#' + ctrlcom + '_txtOrgTaxAmt').val(Math.round(Totcmptaxamt));

    var dueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value;
    var exrate = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtExchangeRate').value;
    var totaldue = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value;
    GetExchangeRate();
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnRegFeeAutoFill').value == 'True' && $('#lblquick').attr('Class') == 'select' && document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlcrdtype').value == 0 && document.getElementById('' + ctrlcom + '_ReceiptControl2_txtCardAmt').value == 0) {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(totaldue) - parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value));
        CalculateAmount(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'), 'Cash');
        IsEmptyReplaceWithZero(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'));
    }
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('input[type=hidden][id*=hdnrecmodeId]').val('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('input[type=hidden][id*=_RECEIPT_MODE_ID]').val('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblrecmode]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblAmount]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblcurrname]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblexchrate]').text('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblconvertedamt]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblbankname]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblcardno]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblauthcode]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblcardexpdt]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lbltendcash]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblchange]').text('');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=hdnbankid]').val('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=_BANK_ID]').val('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=hdncardtypeId]').val('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=hdncurrId]').val('0');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=hdnSNo]').val('1');
    $('table[id$=gvReceiptDetails]').find("tr:eq(1)").find('[id*=lblAmtinwords]').text('');
    $("table[id$=gvReceiptDetails] tr:gt(1)").each(function (i, j) {
        $(this).remove();
    });



    $('table[id*=gvMultipleConcession] tr:has(td)').each(function (e) {
        $(this).remove();
    });
    fn_AddRowWithDetais();

    var company_id = 0;
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons' && (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '5' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '8' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '9' || document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '10')) {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != null || document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID') != undefined) {
            referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
        } else {
            referal_letter_id = 0;
        }
        company_id = document.getElementById('' + ctrlcom + '_uccorporate_EmployerInfo1_uctpa__hiddenID').value;
    }
    company_id = company_id || 0;



    if (parseFloat(company_id) > 0) {
        $("table[id*=UCServices_gvServices] tr:has(td)").each(function () {
            var RowIndexForGrid = $(this)[0].rowIndex;
            AddGridPatmuldisc(RowIndexForGrid);
        });
        Disableservicegridmauldiscgtzero();
    }




}
function AddGridPatmuldisc(gvServicesindex) {

    var discper = $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(); /* Company Master Tariff Wise Discount Pcnt */
    var PatGrossamt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=text][id*=txtPamt]').val();
    var concamtline = Math.round(parseFloat(parseFloat(PatGrossamt) * parseFloat(discper) / 100));
    concamtline = concamtline || 0;
    var empper = document.getElementById('' + ctrlcom + '_txtEmpPercentage').value;
    var compper = document.getElementById('' + ctrlcom + '_txtCorpPercentage').value;

    if (empper == 0) {
        $("table[id*=gvMultipleConcession] tr:has(td)").each(function (i, j) {
            $(this).remove();
        });
        CalculateGridAmtNoLimt(0);
    }
    if (parseFloat(concamtline) > 0 && parseFloat(empper) > 0) {
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=text][id*=txtDiscP]').val(discper);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=text][id*=txtDiscAmt]').val(concamtline);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + gvServicesindex + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(PatGrossamt) - parseFloat(concamtline));
        CalculateGridAmtNoLimt(0);
        var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
        var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
        var chkmultiple = document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple');
        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').disabled = true;
        $('#ctl00_ContentPlaceHolder1_ReceiptControl2_Div2')[0].style.display = 'block';

        $("table[id*=gvMultipleConcession] tr:has(td)").each(function (i, j) {
            $(this).remove();
        });
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_gvMultipleConcession').rows.length == 1) {
            View_fn_AddRowWithDetaiscash(1, '', 1, DisPer, DisAmt, 0, '', '');
        }
        var company_id = '0';
        var referal_letter_id = '0';
        if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK' && (document.getElementById('' + ctrlcom + '_ddlPatientType').value == '2' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '5' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '8' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '9' || document.getElementById('' + ctrlcom + '_ddlPatientType').value == '10')) {
            var ref_leterID = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
            if (ref_leterID != null && ref_leterID != undefined && ref_leterID != "")
                referal_letter_id = document.getElementById('' + ctrlcom + '_uccorporate_ucRefLetterNo__hiddenID').value;
            else
                referal_letter_id = 0;
            company_id = document.getElementById('' + ctrlcom + '_EmployerInfo1_uctpa__hiddenID').value;
        }
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OPQUICK') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtDiscAuthPartyName').value = $('#' + ctrlcom + '_EmployerInfo1_uctpa_txtSearchControl').val();
            document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnPartyDiscAuthId').value = company_id;


        }

    }
}
function UpdateAllDiscountMultiGrid() {
    var SrvCashPerTotal = 0, SrvHealthcardTotal = 0, SrvManageMentTotal = 0, SrvStaffTotal = 0, SrvEventBasedTotal = 0; SrvRulBasedTotal = 0;
    var SrvCashAmtTotal = 0, SrvHealthcardAmtTotal = 0, SrvManageMentAmtTotal = 0, SrvStaffAmtTotal = 0, SrvEventBasedAmtTotal = 0, SrvAmtBasedAmtTotal = 0;
    var TotalSrvPer = 0;
    var TotalSrvAmt = 0;
    var disabledqyrate = false;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        if ($(this).closest('tr').find("input[type=text][id*=txtDiscP]").val() != '' && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0 && $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val() != undefined) {
            var CashPer = $(this).closest('tr').find("input[type=text][id*=txtDiscP]").val();
            var CashAmt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
            CashPer = CashPer == '' ? 0 : CashPer;
            CashAmt = CashAmt == '' ? 0 : CashAmt;
            SrvCashPerTotal += parseFloat(CashPer);
            SrvCashAmtTotal += parseFloat(CashAmt);
        }
        if ($(this).closest('tr').find("input[type=text][id*=txthcPer]").val() != '' && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0 && $(this).closest('tr').find("input[type=text][id*=txthcPer]").val() != undefined) {
            var Healthcard = $(this).closest('tr').find("input[type=text][id*=txthcPer]").val();
            var HealthcardAmt = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();
            Healthcard = Healthcard == '' ? 0 : Healthcard;
            HealthcardAmt = HealthcardAmt == '' ? 0 : HealthcardAmt;
            SrvHealthcardAmtTotal += parseFloat(HealthcardAmt);
        }
        if ($(this).closest('tr').find("input[type=text][id*=txtmaPer]").val() != '' && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0 && $(this).closest('tr').find("input[type=text][id*=txtmaPer]").val() != undefined) {
            var Management = $(this).closest('tr').find("input[type=text][id*=txtmaPer]").val();
            var ManagementAmt = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
            Management = Management == '' ? 0 : Management;
            ManagementAmt = ManagementAmt == '' ? 0 : ManagementAmt;
            SrvManageMentTotal += parseFloat(Management);
            SrvManageMentAmtTotal += parseFloat(ManagementAmt);
        }
        if ($(this).closest('tr').find("input[type=text][id*=txtstPer]").val() != '' && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0 && $(this).closest('tr').find("input[type=text][id*=txtstPer]").val() != undefined) {
            var Staff = $(this).closest('tr').find("input[type=text][id*=txtstPer]").val();
            var StaffAmt = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
            Staff = Staff == '' ? 0 : Staff;
            StaffAmt = StaffAmt == '' ? 0 : StaffAmt;
            SrvStaffTotal += parseFloat(Staff);
            SrvStaffAmtTotal += parseFloat(StaffAmt);
        }
        if ($(this).closest('tr').find("input[type=text][id*=txtebPer]").val() != '' && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0 && $(this).closest('tr').find("input[type=text][id*=txtebPer]").val() != undefined) {
            var EventBased = $(this).closest('tr').find("input[type=text][id*=txtebPer]").val();
            var EventBasedAmt = $(this).closest('tr').find("input[type=text][id*=txtebAmt]").val();
            EventBased = EventBased == '' ? 0 : EventBased;
            EventBasedAmt = EventBasedAmt == '' ? 0 : EventBasedAmt;
            SrvEventBasedTotal += parseFloat(EventBased);
            SrvEventBasedAmtTotal += parseFloat(EventBasedAmt);
        }
        if ($(this).closest('tr').find("input[type=text][id*=txtRulePer]").val() != '' && $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val() == 0 && $(this).closest('tr').find("input[type=text][id*=txtRulePer]").val() != undefined) {
            var RuleBased = $(this).closest('tr').find("input[type=text][id*=txtRulePer]").val();
            var RuleBasedAmt = $(this).closest('tr').find("input[type=text][id*=txtcncrlAmt]").val();
            RuleBased = RuleBased == '' ? 0 : RuleBased;
            RuleBasedAmt = RuleBasedAmt == '' ? 0 : RuleBasedAmt;
            SrvRulBasedTotal += parseFloat(RuleBased);
            SrvAmtBasedAmtTotal += parseFloat(RuleBasedAmt);
        }

    });


    $("table[id*=gvMultipleConcession] tr:has(td)").each(function (i, j) {
        var CurrentRowIndex = $(this)[0].rowIndex;
        var MultiDimVal = $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=ddlMultiDiscounttype]").val();
        if (MultiDimVal == 1) {

            var patgrossamttotal = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
            var per1 = setProperDecimalsCorpPer(parseFloat(SrvCashAmtTotal) * 100 / parseFloat(patgrossamttotal));
            per1 = per1 || 0;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndex + ")").find("[id*=txtPersentage]").val(per1);
            $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=txtAmount]").val(SrvCashAmtTotal);
        }
        if (MultiDimVal == 2) {
            var patgrossamttotal = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
            var per1 = setProperDecimalsCorpPer(parseFloat(SrvHealthcardAmtTotal) * 100 / parseFloat(patgrossamttotal));
            per1 = per1 || 0;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndex + ")").find("[id*=txtPersentage]").val(per1);

            $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=txtAmount]").val(SrvHealthcardAmtTotal);
        }
        if (MultiDimVal == 3) {
            var patgrossamttotal = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
            var per1 = setProperDecimalsCorpPer(parseFloat(SrvManageMentAmtTotal) * 100 / parseFloat(patgrossamttotal));
            per1 = per1 || 0;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndex + ")").find("[id*=txtPersentage]").val(per1);
            $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=txtAmount]").val(SrvManageMentAmtTotal);
        }
        if (MultiDimVal == 4) {
            var patgrossamttotal = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
            var per1 = setProperDecimalsCorpPer(parseFloat(SrvStaffAmtTotal) * 100 / parseFloat(patgrossamttotal));
            per1 = per1 || 0;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndex + ")").find("[id*=txtPersentage]").val(per1);
            $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=txtAmount]").val(SrvStaffAmtTotal);
        }
        if (MultiDimVal == 5) {
            var patgrossamttotal = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
            var per1 = setProperDecimalsCorpPer(parseFloat(SrvEventBasedAmtTotal) * 100 / parseFloat(patgrossamttotal));
            per1 = per1 || 0;
            $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndex + ")").find("[id*=txtPersentage]").val(per1);
            $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=txtAmount]").val(SrvEventBasedAmtTotal);
        }
        if (MultiDimVal == 6) {

            $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndex + ')').find("[id*=txtAmount]").val(SrvAmtBasedAmtTotal);
        }
        if (MultiDimVal == 7) {
        }
    });
}
function CalculateGridAmtNoLimt(ev) {
    if (parseInt(ev) >= 0) { /* This Is With Index */
        var RegSrv = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtServiceName]').val();
        var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtQty]').val();
        var rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[id*=txtRate]').val();
        qty = typeof qty == 'string' ? (typeof qty == 'undefined' || qty.trim() == '' ? 0 : parseFloat(qty)) : (typeof qty == 'object' ? 0 : parseFloat(qty));
        rate = typeof rate == 'string' ? (typeof rate == 'undefined' || rate.trim() == '' ? 0 : parseFloat(rate)) : (typeof rate == 'object' ? 0 : parseFloat(rate));
        var amt = parseInt(qty) * parseInt(rate);
        var EmpDiscPT = '0';
        var EmpDiscFT = '0';
        var _netamt = 0;

        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtAmount]').val(amt);
        var PDiPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val();
        var PDiAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val();

        var StPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val();
        var StAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val();


        var mgmtyPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val();
        var mgmtAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val();


        var HcPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val();
        var HCAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val();

        var ConcesrulePcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val();
        var ConcesruleAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val();


        var EventBasedPer = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val();
        var EventBaseAmt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val();

        EventBasedPer = typeof EventBasedPer == 'string' ? (typeof EventBasedPer == 'undefined' || EventBasedPer.trim() == '' ? 0 : parseFloat(EventBasedPer)) : (typeof EventBasedPer == 'object' ? 0 : parseFloat(EventBasedPer));
        EventBaseAmt = typeof EventBaseAmt == 'string' ? (typeof EventBaseAmt == 'undefined' || EventBaseAmt.trim() == '' ? 0 : parseFloat(EventBaseAmt)) : (typeof EventBaseAmt == 'object' ? 0 : parseFloat(EventBaseAmt));


        ConcesrulePcntS = typeof ConcesrulePcntS == 'string' ? (typeof ConcesrulePcntS == 'undefined' || ConcesrulePcntS.trim() == '' ? 0 : parseFloat(ConcesrulePcntS)) : (typeof ConcesrulePcntS == 'object' ? 0 : parseFloat(ConcesrulePcntS));
        ConcesruleAmt = typeof ConcesruleAmt == 'string' ? (typeof ConcesruleAmt == 'undefined' || ConcesruleAmt.trim() == '' ? 0 : parseFloat(ConcesruleAmt)) : (typeof ConcesruleAmt == 'object' ? 0 : parseFloat(ConcesruleAmt));

        HcPcntS = typeof HcPcntS == 'string' ? (typeof HcPcntS == 'undefined' || HcPcntS.trim() == '' ? 0 : parseFloat(HcPcntS)) : (typeof HcPcntS == 'object' ? 0 : parseFloat(HcPcntS));
        HCAmtS = typeof HCAmtS == 'string' ? (typeof HCAmtS == 'undefined' || HCAmtS.trim() == '' ? 0 : parseFloat(HCAmtS)) : (typeof HCAmtS == 'object' ? 0 : parseFloat(HCAmtS));

        mgmtyPcntS = typeof mgmtyPcntS == "string" ? (mgmtyPcntS.trim() == "" ? "0" : mgmtyPcntS) : (typeof mgmtyPcntS == "number" ? mgmtyPcntS : "0");
        mgmtAmtS = typeof mgmtAmtS == "string" ? (mgmtAmtS.trim() == "" ? "0" : mgmtAmtS) : (typeof mgmtAmtS == "number" ? mgmtAmtS : "0");



        StPcntS = typeof StPcntS == "string" ? (StPcntS.trim() == "" ? "0" : StPcntS) : (typeof StPcntS == "number" ? StPcntS : "0");
        StAmtS = typeof StAmtS == "string" ? (StAmtS.trim() == "" ? "0" : StAmtS) : (typeof StAmtS == "number" ? StAmtS : "0");
        var corppcnt = "0"; var emppcnt = "0";
        var credit_limit = '0';
        if (PDiPcntS == undefined || PDiPcntS == null || isNaN(PDiPcntS) || PDiPcntS == '') { PDiPcntS = '0'; }
        if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }

        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
        var pat_type = '1';
        if (form_name == 'OP' || form_name == 'Cons') {
            pat_type = $('#' + ctrlcom + '_uccorporate_ddlPaymentBy').val();
            credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
        }
        else if (form_name == 'OPQUICK') {
            pat_type = document.getElementById('' + ctrlcom + '_ddlPatientType').value;
            credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();

        }
        if ((form_name == 'OP' || form_name == 'Cons') && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) {
            if (document.getElementById('' + ctrlcom + '_uccorporate_chkEmpDue').checked == true) {
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = "0";
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = "100";
                corppcnt = "0";
                emppcnt = "100";
            }
            else {
                corppcnt = parseFloat(corppcnt);
                emppcnt = parseFloat(emppcnt);
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = document.getElementById('' + ctrlcom + '_hdnOrgPer').value;
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = document.getElementById('' + ctrlcom + '_hdnEmpPer').value;
            }
            corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
            emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
            if (corppcnt == undefined || corppcnt == null || corppcnt == "") { corppcnt = "0"; }
            if (emppcnt == undefined || emppcnt == null || emppcnt == "") { emppcnt = "0"; }
            if ((form_name == 'OP' || form_name == 'Cons') && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10')) {
            }
        }
        if ((form_name == 'OPQUICK' && (pat_type == '2' || pat_type == '5' || pat_type == '8' || pat_type == '9' || pat_type == '10'))) {
            if (document.getElementById('' + ctrlcom + '_EmployerInfo1_chkEmpDue').checked == true) {
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = "0";
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = "100";
                corppcnt = "0";
                emppcnt = "100";
            } else {
                corppcnt = parseFloat(corppcnt);
                emppcnt = parseFloat(emppcnt);
                document.getElementById('' + ctrlcom + '_txtCorpPercentage').value = document.getElementById('' + ctrlcom + '_hdnOrgPer').value;
                document.getElementById('' + ctrlcom + '_txtEmpPercentage').value = document.getElementById('' + ctrlcom + '_hdnEmpPer').value;
            }
            corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
            emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
            if (corppcnt == undefined || corppcnt == null || corppcnt == "") { corppcnt = "0"; }
            if (emppcnt == undefined || emppcnt == null || emppcnt == "") { emppcnt = "0"; }
            if ((form_name == 'OP' && pat_type == '2') || (form_name == 'Cons' && pat_type == '2')) {
            }
        }
        var CompanyPayTotalServiceWise = 0;
        var GvRowscount_net1 = 0;
        var grid1 = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index_net1 = 0;
        var _index_net1 = grid1.rows.length;
        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net1; GvRowscount_net1 < _index_net1; GvRowscount_net1++) {
                if (GvRowscount_net1 != ev) {

                    if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net1 + ')').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                        var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net1 + ')').find('input[type=text][id*=txtCNetAmt]').val();
                        if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                        CompanyPayTotalServiceWise = parseFloat(CompanyPayTotalServiceWise) + parseFloat(cmp_n_amt);

                    }
                }
            }
        });
        var cmpAmt = "0", empamt = "0";
        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {
            if (RegSrv != 'REGISTRATION') {
                cmpAmt = Math.round(((parseFloat(amt) * parseFloat(corppcnt)) / parseFloat(100)));
                empamt = Math.round(parseFloat(amt) - parseFloat(cmpAmt));  
            }
        }
        var cmpdiscpcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(); /* Company Master Tariff Wise Discount Pcnt */
        /*Only Op */
        var cmpNAmt = 0;
        var CmpDiscAmt = '0';
        var cmpDiscPcnt = '0';
        if (parseFloat(cmpdiscpcnt) > 0) {
            cmpDiscPcnt = cmpdiscpcnt;
            CmpDiscAmt = Math.round((parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100));
            cmpNAmt = Math.round(parseFloat(cmpAmt) - parseFloat(CmpDiscAmt));
        }
        else {
            cmpNAmt = parseFloat(cmpAmt);
        }
        /*New Changes Begin*/
        if (credit_limit >= 1) {
            if (CompanyPayTotalServiceWise == credit_limit) {
                $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('Y');
                corppcnt = 0;
                emppcnt = 100;
            } else
            { }
        }
        /*New Changes End*/


        var GvRowscount_net = 0;
        var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index_net = 0;
        var _index_net = grid.rows.length;
        if (RegSrv != 'REGISTRATION') {
            if (grid.rows.length == 1 && qty > 1) {
                var cmp_t_net_amt = 0;
            }
            else if (grid.rows.length == 1) {
                var cmp_t_net_amt = cmpNAmt;
            } else {
                var cmp_t_net_amt = cmpNAmt;
            }
        }

        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net; GvRowscount_net < _index_net; GvRowscount_net++) {
                if (GvRowscount_net != ev) {
                    if ($('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                        var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtCNetAmt]').val();
                        if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                        cmp_t_net_amt = parseFloat(cmp_t_net_amt) + parseFloat(cmp_n_amt);
                    }
                }
            }
        });
        var post = $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val();
        /* if (parseFloat(credit_limit) >= 1) {
        if (parseFloat(cmp_t_net_amt) > parseFloat(credit_limit) && post != 'Y') {

        var obj = ev;
        $('#' + ctrlcom + '_UCServices_hdncrd_ltd_indx').val(ev);
        if (getParameterByName("MODE") != "VIEW") {
        setTimeout(function () {
        $(".smessagebox").scustommessagebox(2, "Credit Limit", "Company Pay Amount Exceeding Credit Limit Amount. Do You Want To Continue..?", DschrgRedirect, obj, ondschrgfail);
        }, 1 * 1000);
        return false;
        } else { DschrgRedirect(obj); }
        }
        }
        if (parseFloat(credit_limit) > 0) {

        if (post == 'Y' && RegSrv != 'REGISTRATION') {

        if (cmp_t_net_amt == "" || cmp_t_net_amt == undefined || cmp_t_net_amt == null) { cmp_t_net_amt = 0; }
        if (credit_limit == "" || credit_limit == undefined || credit_limit == null) { credit_limit = 0; }
        var chng_amt = parseFloat(cmp_t_net_amt) - parseFloat(credit_limit);

        empamt = (parseFloat(empamt) + parseFloat(chng_amt) + parseFloat(CmpDiscAmt));
        cmpAmt = (parseFloat(cmpAmt) - parseFloat(chng_amt) - parseFloat(CmpDiscAmt));

        PDiAmtS = Math.round((parseFloat(empamt) * parseFloat(cmpDiscPcnt)) / parseFloat(100));
        if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }
        CmpDiscAmt = Math.round((parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100));

        if (parseFloat(CmpDiscAmt) > 0) { } else { CmpDiscAmt = 0; }
        cmpNAmt = (parseFloat(cmpAmt) - parseFloat(CmpDiscAmt));

        $('#' + ctrlcom + '_UCServices_hdncrd_ltd_post').val('N');
        }
        }*/

        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {/* Company And Patient Sagrigation */

            if (RegSrv != 'REGISTRATION') {
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(empamt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(setProperDecimalsCorpPer(PDiPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(setProperDecimalsCorpPer(mgmtyPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(setProperDecimalsCorpPer(StPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(setProperDecimalsCorpPer(HcPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(setProperDecimalsCorpPer(ConcesrulePcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(setProperDecimalsCorpPer(EventBasedPer));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(empamt) - parseFloat(PDiAmtS));
                /*Company Has To Implement */

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val(cmpAmt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val(CmpDiscAmt);

                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val(cmpNAmt);


            }
            else {/* Only Patient Amounts */
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(setProperDecimalsCorpPer(PDiPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(setProperDecimalsCorpPer(mgmtyPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(setProperDecimalsCorpPer(StPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(setProperDecimalsCorpPer(HcPcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(setProperDecimalsCorpPer(ConcesrulePcntS));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(setProperDecimalsCorpPer(EventBasedPer));
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);


                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - parseFloat(PDiAmtS));

                /*Company Has To Implement */
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
                $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
            }

        }
        else {/* Only Patient Amounts */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(setProperDecimalsCorpPer(PDiPcntS));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmaPer]').val(setProperDecimalsCorpPer(mgmtyPcntS));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtmgAmt]').val(mgmtAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstPer]').val(setProperDecimalsCorpPer(StPcntS));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtstAmt]').val(StAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txthcPer]').val(setProperDecimalsCorpPer(HcPcntS));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtHcAmt]').val(HCAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtRulePer]').val(setProperDecimalsCorpPer(ConcesrulePcntS));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtcncrlAmt]').val(ConcesruleAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebPer]').val(setProperDecimalsCorpPer(EventBasedPer));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtebAmt]').val(EventBaseAmt);


            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - (parseFloat(PDiAmtS)));

            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(setProperDecimalsCorpPer(cmpDiscPcnt));
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
        }
    }
    else if (ev == 0)
    { }
    else { /* This Is WithOut Index */
        var CurrentRowIndex = 0;
        CurrentRowIndex = typeof (ev.parentElement.parentElement.parentElement.rowIndex) == 'number' ? ev.parentElement.parentElement.parentElement.rowIndex : 0;
        CurrentRowIndex = CurrentRowIndex == 0 || CurrentRowIndex == '' || CurrentRowIndex == undefined ? 1 : CurrentRowIndex;
        var form_name = $('#' + ctrlcom + '_UCServices_hdnSrvFormName').val();
        var credit_limit = '0';
        if (form_name == 'OP' || form_name == 'Cons') {
            credit_limit = $('#' + ctrlcom + '_uccorporate_txtcreditlimitamt').val();
        }
        else if (form_name == 'OPQUICK') {
            credit_limit = $('#' + ctrlcom + '_EmployerInfo1_txtcreditlimitamt').val();
        }
        var qty = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtQty]').val();
        var rate = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtRate]').val();
        var amt = parseInt(qty) * parseInt(rate);
        $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtAmount]').val(amt);
        var PDiPcntS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscP]').val();
        var PDiAmtS = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=text][id*=txtDiscAmt]').val();
        if (PDiPcntS == undefined || PDiPcntS == null || isNaN(PDiPcntS) || PDiPcntS == '') { PDiPcntS = '0'; }
        if (PDiAmtS == undefined || PDiAmtS == null || isNaN(PDiAmtS) || PDiAmtS == '') { PDiAmtS = '0'; }
        var corppcnt = $('#' + ctrlcom + '_txtCorpPercentage').val();
        var emppcnt = $('#' + ctrlcom + '_txtEmpPercentage').val();
        if (corppcnt == undefined || corppcnt == null || corppcnt == "" || isNaN(corppcnt)) { corppcnt = "0"; }
        if (emppcnt == undefined || emppcnt == null || emppcnt == "" || isNaN(emppcnt)) { emppcnt = "0"; }
        corppcnt = parseFloat(corppcnt);
        emppcnt = parseFloat(emppcnt);
        var cmpAmt = "0", empamt = "0";
        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {
            cmpAmt = (parseFloat(amt) * parseFloat(corppcnt)) / parseFloat(100);
            empamt = (parseFloat(amt) * parseFloat(emppcnt)) / parseFloat(100);
        }
        var cmpdiscpcnt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + CurrentRowIndex + ')').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val(); /* Company Master Tariff Wise Discount Pcnt */
        /*Only Op */
        var cmpNAmt = 0;
        var CmpDiscAmt = '0';
        var cmpDiscPcnt = '0';
        if (parseFloat(cmpdiscpcnt) > 0) {
            cmpDiscPcnt = cmpdiscpcnt;
            CmpDiscAmt = (parseFloat(cmpAmt) * parseFloat(cmpDiscPcnt)) / parseFloat(100);
            cmpNAmt = parseFloat(cmpAmt) - parseFloat(CmpDiscAmt);
        }
        else {
            cmpNAmt = parseFloat(cmpAmt);
        }
        var GvRowscount_net = 0;
        var grid = document.getElementById('' + ctrlcom + '_UCServices_gvServices');
        var _index_net = 0;
        var _index_net = grid.rows.length;
        var cmp_t_net_amt = cmpNAmt;
        $("table[id$=UCServices_gvServices] tr:has(td)").each(function (e) {
            for (GvRowscount_net; GvRowscount_net < _index_net; GvRowscount_net++) {
                var cmp_n_amt = $('[id$=UCServices_gvServices] tr').filter(':eq(' + GvRowscount_net + ')').find('input[type=text][id*=txtCNetAmt]').val();
                if (parseFloat(cmp_n_amt) > 0) { } else { cmp_n_amt = 0; }
                cmp_t_net_amt = parseFloat(cmp_t_net_amt) + parseFloat(cmp_n_amt);
            }
        });
        if (parseFloat(credit_limit) >= 1) {
            if (parseFloat(cmp_t_net_amt) > parseFloat(credit_limit)) {
                var obj = 'suvarna';
                var param = CurrentRowIndex;
                $('#' + ctrlcom + '_UCServices_hdncrd_ltd_indx').val(CurrentRowIndex);
                ConfirmationRequiredForSaveWithParam_message_transaction(obj, param, 'Company Pay Amount Exceeding Credit Limit Amount. Do You Want To Continue..');
                return false;
            }
        }
        if (parseFloat(corppcnt) > 0 && parseFloat(amt) > 0) {/* Company And Patient Sagrigation */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(empamt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(empamt) - parseFloat(PDiAmtS));
            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val(cmpAmt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val(CmpDiscAmt);

            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val(cmpNAmt);

        }
        else {/* Only Patient Amounts */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPamt]').val(amt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscP]').val(PDiPcntS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtDiscAmt]').val(PDiAmtS);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtPNAmt]').val(parseFloat(amt) - parseFloat(PDiAmtS));
            /*Company Has To Implement */
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCamt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscP]').val(cmpDiscPcnt);
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCDiscAmt]').val('0');
            $('[id$=UCServices_gvServices] tr').filter(':eq(' + ev + ')').find('input[type=text][id*=txtCNetAmt]').val('0');
        }
    }
    var Perconces = 0, concession = 0, txtPayAmt = 0, dec = 2;
    var sGrid = document.getElementById('' + ctrlcom + '_gvServices');
    var TAmount = 0, GAmount = 0, Amount = 0, NetAmount = 0, Qty = 0, Rate = 0, IndivConcession = 0, InitialAmount = 0, TotConcession = 0;
    var CmpTBAmt = 0, CmpTCAmt = 0, CmpTNAmt = 0;
    var PatTBAmt = 0, PatTCAmt = 0, PatMgCAmt = 0, StMgCAmt = 0, PatTNAmt = 0, HCAmt = 0, CncRuleAmt = 0, EventBasedAmt = 0;
    var TOTALTAXAMOUNT = 0; var netamount = 0;
    var cmptaxamt = 0;
    var taxamt = 0, ptaxamt = 0, ctaxamt = 0; var totalsgstamount = 0; var totalcgstamount = 0;
    $("table[id*=gvServices] tr:has(td)").each(function (e) {
        Qty = $(this).closest('tr').find("input[type=text][id*=txtQty]").val();
        Rate = $(this).closest('tr').find("input[id*=txtRate]").val();
        Amount = parseFloat(Qty) * parseFloat(Rate);
        if ($('#' + ctrlcom + '_UCServices_hdnisadditinal').val() == 'Y') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked = true;
        }
        var CMPCNCSper = $(this).closest('tr').find('input[type=hidden][id*=hdnCmpDiscPcnt]').val();
        if (CMPCNCSper == undefined || CMPCNCSper == null || CMPCNCSper == "" || isNaN(CMPCNCSper)) { CMPCNCSper = "0"; }


        /* up to here */
        var form_name = $('#' + ctrlcom + '_ReceiptControl2_hdnDocName').val();
        if (form_name == 'OP' || form_name == 'Cons') {
            var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        } else {
            if (form_name == 'OPQUICK') {
                if (document.getElementById('' + ctrlcom + '_chk_old').checked == true) {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;

                } else {
                    var Cmp_id = document.getElementById('' + ctrlcom + '_hdnCompanyID').value;
                }
            }
        }
        if (Cmp_id == undefined || Cmp_id == null || Cmp_id == '' || Cmp_id == "0")
        { Cmp_id = 0; }
        if (Cmp_id == 0) {
            if ($(this).closest('tr').find('input[type=text][id*=txtServiceName]').val() != 'REGISTRATION') {
                if (CMPCNCSper == 0) {
                    var con_id = $('#' + ctrlcom + '_UCServices_hdnconruleid').val();
                    if (con_id == undefined || con_id == null || con_id == '' || con_id == "0")
                    { con_id = 0; }
                    if (con_id == 0) {
                        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_chkismultiple').checked == false) {
                            var _dscper = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis');
                        }
                    }
                }
            }
        }
        var Class_Srv_id = $(this).closest('tr').find("input[type=hidden][id*=hdnClass_Srv_ID]").val();
        var Service_Class_id = $(this).closest('tr').find("input[type=hidden][id*=hdnServiceClass]").val();
        var mgmtAmt = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
        var StmtAmt = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
        var Discamt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
        var HcDiscamt = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();
        var CncsnRuleamtInner = $(this).closest('tr').find("input[type=text][id*=txtcncrlAmt]").val();
        var EventBasedInner = $(this).closest('tr').find("input[type=text][id*=txtebAmt]").val();

        EventBasedInner = typeof EventBasedInner == 'string' ? (typeof EventBasedInner == 'undefined' || EventBasedInner.trim() == '' ? 0 : parseFloat(EventBasedInner)) : (typeof EventBasedInner == 'object' ? 0 : parseFloat(EventBasedInner));
        CncsnRuleamtInner = typeof CncsnRuleamtInner == 'string' ? (typeof CncsnRuleamtInner == 'undefined' || CncsnRuleamtInner.trim() == '' ? 0 : parseFloat(CncsnRuleamtInner)) : (typeof CncsnRuleamtInner == 'object' ? 0 : parseFloat(CncsnRuleamtInner));
        Discamt = typeof Discamt == "string" ? (Discamt.trim() == "" ? "0" : Discamt) : (typeof Discamt == "number" ? Discamt : "0");
        mgmtAmt = typeof mgmtAmt == "string" ? (mgmtAmt.trim() == "" ? "0" : mgmtAmt) : (typeof mgmtAmt == "number" ? mgmtAmt : "0");
        StmtAmt = typeof StmtAmt == "string" ? (StmtAmt.trim() == "" ? "0" : StmtAmt) : (typeof StmtAmt == "number" ? StmtAmt : "0");
        HcDiscamt = typeof HcDiscamt == 'string' ? (typeof HcDiscamt == 'undefined' || HcDiscamt.trim() == '' ? 0 : parseFloat(HcDiscamt)) : (typeof HcDiscamt == 'object' ? 0 : parseFloat(HcDiscamt));
        CncRuleAmt = typeof CncRuleAmt == 'string' ? (typeof CncRuleAmt == 'undefined' || CncRuleAmt.trim() == '' ? 0 : parseFloat(CncRuleAmt)) : (typeof CncRuleAmt == 'object' ? 0 : parseFloat(CncRuleAmt));

        if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
            Amount = '0';
        }
        if (!isNaN(Amount))
            GAmount = parseFloat(GAmount) + parseFloat(Amount);

        if (!isNaN(IndivConcession))
            TotConcession = parseFloat(TotConcession) + parseFloat(IndivConcession); 
        var PatBAmt = $(this).closest('tr').find("input[id*=txtPamt]").val();
        var PatCAmt = $(this).closest('tr').find("input[type=text][id*=txtDiscAmt]").val();
        var PatMgCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtmgAmt]").val();
        var patStCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtstAmt]").val();
        var PatPNAmt = $(this).closest('tr').find("input[type=text][id*=txtPNAmt]").val();
        var HCAmtInner = $(this).closest('tr').find("input[type=text][id*=txtHcAmt]").val();
        var tax_pct = $(this).closest('tr').find("input[id*=hdntaxpct]").val();
        var conamount = $(this).closest('tr').find("input[type=text][id*=txtpatgrossamt]").val();
        var seramount = $(this).closest('tr').find('input[type=text][id*=txtPamt]').val();
        var cmpNamt = $(this).closest('tr').find('input[type=text][id*=txtCNetAmt]').val();
        var cmpconamt = $(this).closest('tr').find('input[type=text][id*=txtCDiscAmt]').val();
        PatMgCAmtInner = typeof PatMgCAmtInner == "string" ? (PatMgCAmtInner.trim() == "" ? "0" : PatMgCAmtInner) : (typeof PatMgCAmtInner == "number" ? PatMgCAmtInner : "0");
        patStCAmtInner = typeof patStCAmtInner == "string" ? (patStCAmtInner.trim() == "" ? "0" : patStCAmtInner) : (typeof patStCAmtInner == "number" ? patStCAmtInner : "0");
        HCAmtInner = typeof HCAmtInner == 'string' ? (typeof HCAmtInner == 'undefined' || HCAmtInner.trim() == '' ? 0 : parseFloat(HCAmtInner)) : (typeof HCAmtInner == 'object' ? 0 : parseFloat(HCAmtInner));
        if (cmpconamt == undefined || cmpconamt == null || cmpconamt == "" || isNaN(cmpconamt)) { cmpconamt = "0"; }
        if (cmpNamt == undefined || cmpNamt == null || cmpNamt == "" || isNaN(cmpNamt)) { cmpNamt = "0"; }
        if (PatBAmt == undefined || PatBAmt == null || PatBAmt == "" || isNaN(PatBAmt)) { PatBAmt = "0"; }
        if (PatCAmt == undefined || PatCAmt == null || PatCAmt == "" || isNaN(PatCAmt)) { PatCAmt = "0"; }
        if (PatPNAmt == undefined || PatPNAmt == null || PatPNAmt == "" || isNaN(PatPNAmt)) { PatPNAmt = "0"; }
        if (taxamt == undefined || taxamt == null || taxamt == "" || isNaN(taxamt)) { taxamt = "0"; }
        if (conamount == undefined || conamount == null || conamount == "" || conamount == "undefined" || isNaN(conamount)) { conamount = "0"; }
        if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
            PatBAmt = '0';
            PatCAmt = '0';
            PatPNAmt = '0';
        }
        if (parseInt(PatTBAmt) > 0) {

        }
        else {
            PatTBAmt = '0';
            PatTCAmt = '0';
            PatTNAmt = '0';
        }

        PatTBAmt = parseFloat(PatTBAmt) + parseFloat(PatBAmt);
        PatTCAmt = parseFloat(PatTCAmt) + parseFloat(PatCAmt);
        PatMgCAmt = parseFloat(PatMgCAmt) + parseFloat(PatMgCAmtInner);
        StMgCAmt = parseFloat(StMgCAmt) + parseFloat(patStCAmtInner);
        HCAmt = parseFloat(HCAmt) + parseFloat(HCAmtInner);
        CncRuleAmt = parseFloat(CncRuleAmt) + parseFloat(CncsnRuleamtInner);
        PatTNAmt = parseFloat(PatTNAmt) + parseFloat(PatPNAmt);
        EventBasedAmt = parseFloat(EventBasedAmt) + parseFloat(EventBasedInner);



        var OrgPrice = $(this).closest('tr').find('[id*=hdnOrgPrice]').val();
        var DoctorPrice = $(this).closest('tr').find("[id*=hdnDoctorPrice]").val();
        var OrgPct = $(this).closest('tr').find("[id*=hdnOrgPct]").val();
        var DoctorPct = $(this).closest('tr').find("[id*=hdnDoctorPct]").val();

        if (OrgPct == undefined || OrgPct == null || OrgPct == "" || isNaN(OrgPct)) { OrgPct = "0"; }
        if (DoctorPct == undefined || DoctorPct == null || DoctorPct == "" || isNaN(DoctorPct)) { DoctorPct = "0"; }

        var orgprice = Math.round((parseFloat(PatPNAmt) + parseFloat(cmpNamt)) * (parseFloat(OrgPct) / 100));
        var doctorprice = Math.round((parseFloat(PatPNAmt) + parseFloat(cmpNamt)) * (parseFloat(DoctorPct) / 100));

        $(this).closest('tr').find('[id*=hdnOrgPrice]').val(orgprice);
        $(this).closest('tr').find("[id*=hdnDoctorPrice]").val(doctorprice);

        var srvtottax = parseFloat(PatPNAmt) + parseFloat(cmpNamt);
        var tax_amt = (parseFloat(srvtottax) * parseFloat(tax_pct) / 100); 
        tax_amt = tax_amt.toFixed(2);
        var pattaxamt = (parseFloat(PatPNAmt) * parseFloat(tax_pct) / 100);
        pattaxamt = pattaxamt.toFixed(2);
        var cmptaxamt = (parseFloat(cmpNamt) * parseFloat(tax_pct) / 100); 
        cmptaxamt = cmptaxamt.toFixed(2);
        if (tax_amt == undefined || tax_amt == null || tax_amt == "" || isNaN(tax_amt)) { tax_amt = "0"; }
        if (pattaxamt == undefined || pattaxamt == null || pattaxamt == "" || isNaN(pattaxamt)) { pattaxamt = "0"; }
        if (cmptaxamt == undefined || cmptaxamt == null || cmptaxamt == "" || isNaN(cmptaxamt)) { cmptaxamt = "0"; }
        $(this).closest('tr').find("[id*=hdntaxamount]").val(tax_amt);
        $(this).closest('tr').find('input[type=text][id*=txtptax]').val(pattaxamt);
        $(this).closest('tr').find('input[type=text][id*=txtcmptax]').val(cmptaxamt);

        var sgst_tax_pct = $(this).closest('tr').find("[id*=hdnsgstpct]").val();
        var cgst_tax_pct = $(this).closest('tr').find("[id*=hdncgstpct]").val();
        var sgsttaxamt = (parseFloat(tax_amt) * parseFloat(sgst_tax_pct) / 100);
        sgsttaxamt = sgsttaxamt.toFixed(2);
        var cgsttaxamt = (parseFloat(tax_amt) * parseFloat(cgst_tax_pct) / 100); 
        cgsttaxamt = cgsttaxamt.toFixed(2);
        if (cgsttaxamt == undefined || cgsttaxamt == null || cgsttaxamt == "" || isNaN(cgsttaxamt)) { cgsttaxamt = "0"; }
        if (sgsttaxamt == undefined || sgsttaxamt == null || sgsttaxamt == "" || isNaN(sgsttaxamt)) { sgsttaxamt = "0"; }
        $(this).closest('tr').find('[id*=hdncgstamount]').val(cgsttaxamt);
        $(this).closest('tr').find('[id*=hdnsgstamount]').val(sgsttaxamt);

        totalsgstamount = (parseFloat(totalsgstamount) + parseFloat(sgsttaxamt));
        totalsgstamount = totalsgstamount.toFixed(2);
        totalcgstamount = (parseFloat(totalcgstamount) + parseFloat(cgsttaxamt));
        totalcgstamount = totalcgstamount.toFixed(2);
        taxamt = (parseFloat(taxamt) + parseFloat(tax_amt));
        taxamt = taxamt.toFixed(2);
        ptaxamt = (parseFloat(ptaxamt) + parseFloat(pattaxamt));
        ptaxamt = ptaxamt.toFixed(2);
        ctaxamt = (parseFloat(ctaxamt) + parseFloat(cmptaxamt)); 
        ctaxamt = ctaxamt.toFixed(2);
        if (taxamt == undefined || taxamt == null || taxamt == "" || isNaN(taxamt)) { taxamt = "0"; }
        if (ptaxamt == undefined || ptaxamt == null || ptaxamt == "" || isNaN(ptaxamt)) { ptaxamt = "0"; }
        if (ctaxamt == undefined || ctaxamt == null || ctaxamt == "" || isNaN(ctaxamt)) { ctaxamt = "0"; }
        if (totalcgstamount == undefined || totalcgstamount == null || totalcgstamount == "" || isNaN(totalcgstamount)) { totalcgstamount = "0"; }
        if (totalsgstamount == undefined || totalsgstamount == null || totalsgstamount == "" || isNaN(totalsgstamount)) { totalsgstamount = "0"; }

        netamount = setProperDecimals(parseFloat(PatTBAmt) - parseFloat(conamount));
        IndivConcession = (parseFloat(Discamt) + parseFloat(mgmtAmt) + parseFloat(StmtAmt) + parseFloat(HCAmtInner) + parseFloat(PatMgCAmtInner) + parseFloat(EventBasedAmt));


        if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons'))
            && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            if (parseInt(CmpTBAmt) > 0) {
            }
            else {
                CmpTBAmt = '0';
                CmpTCAmt = '0';
                CmpTNAmt = '0';
            }
            var CmpBAmt = $(this).closest('tr').find("input[type=text][id*=txtCamt]").val();
            var CmpCAmt = $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").val();
            var CmpCNAmt = $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").val();

            if (CmpBAmt == undefined || CmpBAmt == null || CmpBAmt == "" || isNaN(CmpBAmt)) { CmpBAmt = "0"; }
            if (CmpCAmt == undefined || CmpCAmt == null || CmpCAmt == "" || isNaN(CmpCAmt)) { CmpCAmt = "0"; }
            if (CmpCNAmt == undefined || CmpCNAmt == null || CmpCNAmt == "" || isNaN(CmpCNAmt)) { CmpCNAmt = "0"; }

            if (parseInt(Class_Srv_id) > 0) {/* Package Includes Amount Not Consider*/
                CmpBAmt = '0';
                CmpCAmt = '0';
                CmpCNAmt = '0';
            }
            CmpTBAmt = parseFloat(CmpTBAmt) + parseFloat(CmpBAmt);
            CmpTCAmt = parseFloat(CmpTCAmt) + parseFloat(CmpCAmt);
            CmpTNAmt = parseFloat(CmpTNAmt) + parseFloat(CmpCNAmt);
        }
        else if (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OPQUICK') {
            if (parseInt(CmpTBAmt) > 0) {
            }
            else {
                CmpTBAmt = '0';
                CmpTCAmt = '0';
                CmpTNAmt = '0';
            }
            var CmpBAmt = $(this).closest('tr').find("input[type=text][id*=txtCamt]").val();
            var CmpCAmt = $(this).closest('tr').find("input[type=text][id*=txtCDiscAmt]").val();
            var CmpCNAmt = $(this).closest('tr').find("input[type=text][id*=txtCNetAmt]").val();

            if (CmpBAmt == undefined || CmpBAmt == null || CmpBAmt == "" || isNaN(CmpBAmt)) { CmpBAmt = "0"; }
            if (CmpCAmt == undefined || CmpCAmt == null || CmpCAmt == "" || isNaN(CmpCAmt)) { CmpCAmt = "0"; }
            if (CmpCNAmt == undefined || CmpCNAmt == null || CmpCNAmt == "" || isNaN(CmpCNAmt)) { CmpCNAmt = "0"; }

            CmpTBAmt = parseFloat(CmpTBAmt) + parseFloat(CmpBAmt);
            CmpTCAmt = parseFloat(CmpTCAmt) + parseFloat(CmpCAmt);
            CmpTNAmt = parseFloat(CmpTNAmt) + parseFloat(CmpCNAmt);
        }


    }); 
    if ((document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'OP' || (document.getElementById('' + ctrlcom + '_UCServices_hdnSrvFormName').value == 'Cons'))
    && document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
        var company_id = document.getElementById('' + ctrlcom + '_uccorporate_CmpLookup__hiddenID').value;
        $('#' + ctrlcom + '_txtCorpPayAmt').val(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        $('#' + ctrlcom + '_txtCorpDueAmt').val(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        $('#' + ctrlcom + '_txtEmpPayAmt').val(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
    }
    else {
        $('#' + ctrlcom + '_txtCorpPayAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtCorpDueAmt').val(CmpTNAmt);
        $('#' + ctrlcom + '_txtEmpPayAmt').val((parseFloat(GAmount)) - parseFloat(TotConcession));
        $('#' + ctrlcom + '_txtEmpPayAmt').val((PatTNAmt));
    }

    var reg_fee = 0;
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnRegconSetting').value == "Yes") {
    }
    else {
        reg_fee = document.getElementById('' + ctrlcom + '_UCServices_hdnReg_fee').value;
    }
    if (reg_fee == undefined || reg_fee == '' || reg_fee == null) { reg_fee = "0"; }


    GAmount = setProperDecimals(parseFloat(GAmount) + parseFloat(reg_fee));
    PatTBAmt = setProperDecimals(parseFloat(PatTBAmt) + parseFloat(reg_fee));
    PatTNAmt = setProperDecimals(parseFloat(PatTNAmt) + parseFloat(reg_fee));


    if (parseInt(PatTCAmt) > 0 || parseInt(CmpTCAmt) > 0 || PatMgCAmt > 0 || StMgCAmt > 0 || HCAmt > 0 || CncRuleAmt > 0 || EventBasedAmt > 0) {
        ClearTransactionGrid();
        /*Total Gross Amounts*/

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = Math.round(PatTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = Math.round(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = Math.round(parseFloat(PatTBAmt) + parseFloat(CmpTBAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(PatTNAmt);

        /*Total Due Amount */
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(PatTNAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(PatTNAmt);

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = 0;

        if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {

            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
        }

        /*Advanced Disc Types */

        var PatDiscPcnt = (parseFloat(100) * (parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt))) / parseFloat(PatTBAmt);

        if ((PatDiscPcnt) > 0)
        { }
        else
        { PatDiscPcnt = '0'; }
        PatDiscPcnt = setProperDecimalsCorpPer(PatDiscPcnt);
        if (parseFloat(CncRuleAmt) > 0) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = PatDiscPcnt;
        } else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = PatDiscPcnt;
        }
        var cmpDiscPcnt = setProperDecimalsCorpPer((parseFloat(100) * parseFloat(CmpTCAmt)) / parseFloat(CmpTBAmt));
        if (parseInt(cmpDiscPcnt) > 0)
        { }
        else
        { cmpDiscPcnt = '0'; }
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartydis').value = cmpDiscPcnt;
        if (parseFloat(PatTCAmt) > 0)
        { }
        else
        { PatTCAmt = '0'; }
        if (parseFloat(CmpTCAmt) > 0)
        { }
        else
        { CmpTCAmt = '0'; }

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = Math.round(parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpartygrossamt').value = Math.round(CmpTCAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = Math.round(parseFloat(PatTCAmt) + parseFloat(PatMgCAmt) + parseFloat(StMgCAmt) + parseFloat(HCAmt) + parseFloat(CncRuleAmt) + parseFloat(EventBasedAmt) + parseFloat(CmpTCAmt));
        /*Net Amounts */
        if (parseFloat(PatTNAmt) > 0)
        { }
        else
        { PatTNAmt = '0'; }
        if (parseFloat(CmpTNAmt) > 0)
        { }
        else
        { CmpTNAmt = '0'; }
        var concessionamt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value;
        if (concessionamt == undefined || concessionamt == '' || concessionamt == null) { concessionamt = "0"; }
        var PatGAmount = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value;
        PatGAmount = typeof PatGAmount == 'string' ? (typeof PatGAmount == 'undefined' || PatGAmount.trim() == '' ? 0 : parseFloat(PatGAmount)) : (typeof PatGAmount == 'object' ? 0 : parseFloat(PatGAmount));

        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);


        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(parseFloat(PatTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = Math.round(parseFloat(CmpTNAmt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt));

        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(CmpTNAmt) + parseFloat(ctaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(PatTNAmt + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt) + parseFloat(taxamt));
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(Math.round(PatTNAmt) + parseFloat(ptaxamt));
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txttaxamt').value = (taxamt);

        $('#' + ctrlcom + '_ReceiptControl2_txtpatTotTax').val(ptaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_txtcmpTotTax').val(ctaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalSgstAmount').val(totalsgstamount);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalCgstAmount').val(totalcgstamount);


        if (document.getElementById('' + ctrlcom + '_UCServices_hdnisadditinal').value == 'Y')
        { CurrentRowIndexNew = 1; }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '1') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(Math.round(PatTCAmt));
                var PatPer = (parseFloat(100) * parseFloat(PatTCAmt)) / parseFloat(PatTBAmt);
                PatPer = typeof PatPer == "string" ? (PatPer.trim() == "" ? "0" : PatPer) : (typeof PatPer == "number" ? PatPer : "0");
                PatPer = parseFloat(PatPer);
                PatPer = setProperDecimalsCorpPer(PatPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val((PatPer));
            }
        }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '3') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(Math.round(PatMgCAmt));
                var MgmtPer = (parseFloat(100) * parseFloat(PatMgCAmt)) / parseFloat(PatTBAmt);
                MgmtPer = typeof MgmtPer == "string" ? (MgmtPer.trim() == "" ? "0" : MgmtPer) : (typeof MgmtPer == "number" ? MgmtPer : "0");
                MgmtPer = parseFloat(MgmtPer);
                MgmtPer = setProperDecimalsCorpPer(MgmtPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val((MgmtPer));

            }
        }
        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '4') {
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(Math.round(StMgCAmt));
                var StmtPer = (parseFloat(100) * parseFloat(StMgCAmt)) / parseFloat(PatTBAmt);
                StmtPer = typeof StmtPer == "string" ? (StmtPer.trim() == "" ? "0" : StmtPer) : (typeof StmtPer == "number" ? StmtPer : "0");
                StmtPer = parseFloat(StmtPer);
                StmtPer = setProperDecimalsCorpPer(StmtPer);
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val((StmtPer));
            }
        }
    }
    else {

        ClearTransactionGrid();
        /*Total Gross Amounts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgross').value = Math.round(PatTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtparygross').value = Math.round(CmpTBAmt);
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtreceiptAmount').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalReciptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatientReceiptAmt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txttaxamt').value = taxamt;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value = Math.round(parseFloat(PatTBAmt) + parseFloat(CmpTBAmt));
        /*Total NEt Amts*/
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatNet').value = Math.round(parseFloat(PatTNAmt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpNet').value = Math.round(parseFloat(CmpTNAmt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalNet').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt)); 
        /*Total Due Amount */
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtdueamt').value = Math.round(PatTNAmt + parseFloat(ptaxamt)); 

        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value = Math.round(parseFloat(CmpTNAmt) + parseFloat(ctaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = Math.round(parseFloat(PatTNAmt) + parseFloat(CmpTNAmt) + parseFloat(taxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnNetAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDueAmt').value = Math.round(parseFloat(PatTNAmt) + parseFloat(ptaxamt)); 
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdis').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrossamttotal').value = 0;
        $('#' + ctrlcom + '_ReceiptControl2_hdnPayAmt').val(setProperDecimals(parseFloat(PatTNAmt) + parseFloat(ptaxamt)));

        PatTNAmt = parseFloat(PatGAmount) - parseFloat(concessionamt);

        $('#' + ctrlcom + '_ReceiptControl2_txtpatTotTax').val(ptaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_txtcmpTotTax').val(ctaxamt);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalSgstAmount').val(totalsgstamount);
        $('#' + ctrlcom + '_ReceiptControl2_hdnTotalCgstAmount').val(totalcgstamount);

        /*sitaram*/
        var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
        if (parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value) > 0) {
            if ($('#' + ctrlcom + '_hdnDefaultDueAuthID').val() != "" && form_name == 'OP') {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').value = $('#' + ctrlcom + '_hdnDefaultDueAuthName').val();
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3__hiddenText').value = $('#' + ctrlcom + '_hdnDefaultDueAuthName').val();
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3__hiddenID').value = $('#' + ctrlcom + '_hdnDefaultDueAuthID').val();
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            } else {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
            }
        }
        else {
            var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
            var assest = '';
            if (form_name == 'OP') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else if (form_name == 'Cons') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else if (form_name == 'OPQUICK') {
                assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
            }
            else {
                assest = false;
            }
            if (assest == true) {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = false;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = false;
            }
            else {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').disabled = true;
                document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_Search3').disabled = true;
            }
        }

        if (CurrentRowIndexNew > 0) {
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '1') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '3') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
            if ($('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=ddlMultiDiscounttype]").val() == '4') {
                var DisPer = $('#' + ctrlcom + '_ReceiptControl2_txtpatdis').val();
                var DisAmt = $('#' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').val();
                DisPer = typeof DisPer == 'string' ? (typeof DisPer == 'undefined' || DisPer.trim() == '' ? 0 : parseFloat(DisPer)) : (typeof DisPer == 'object' ? 0 : parseFloat(DisPer));
                DisAmt = typeof DisAmt == 'string' ? (typeof DisAmt == 'undefined' || DisAmt.trim() == '' ? 0 : parseFloat(DisAmt)) : (typeof DisAmt == 'object' ? 0 : parseFloat(DisAmt));
                $("table[id$=gvMultipleConcession] tr").filter(":eq(" + CurrentRowIndexNew + ")").find('[id*=txtPersentage]').val(0);
                $('table[id*=gvMultipleConcession] tr').filter(':eq(' + CurrentRowIndexNew + ')').find("[id*=txtAmount]").val(0);
            }
        }
        EnableMulGird();
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value == 0 && parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcmpDue').value) > 0) {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value == 0) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'grey';
        } else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'red';
        }
    }
    else if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtgrosstotal').value > 0) {
        var form_name = document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value;
        var assest = '';
        if (form_name == 'OP') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else if (form_name == 'Cons') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else if (form_name == 'OPQUICK') {
            assest = document.getElementById('' + ctrlcom + '_ChkAssesment').checked;
        }
        else {
            assest = false;
        }
        if (assest == true) {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'grey';
        }
        else {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'red';
            if (document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').value == '') {
                document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'red';
            }
        }
    }
    else {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtquickremarks').className = 'grey';
        document.getElementById('' + ctrlcom + '_ReceiptControl2_Search3_txtSearchControl').className = 'grey';
    }

    if (parseFloat(concessionamt) > 0) {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value > '0') {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_ucdueauth_txtSearchControl').disabled = false;
            document.getElementById('lk_txt_options_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = false;
            document.getElementById('lk_btn_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = false;

        }
    }
    else {
        if (document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatgrossamt').value == "0") {
            document.getElementById('' + ctrlcom + '_ReceiptControl2_ucdueauth_txtSearchControl').disabled = true;
            document.getElementById('lk_txt_options_ctl00_ContentPlaceHolder1_ReceiptControl2_ucdueauth').disabled = true;
        }
    }
    if (document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'OP' || document.getElementById('' + ctrlcom + '_ReceiptControl2_hdnDocName').value == 'Cons') {
        if (document.getElementById('' + ctrlcom + '_uccorporate_ddlPaymentBy').value == '2') {
            CalculateCreditLimitAmt();
        }
    }
    var dueAmt = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
    var exrate = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtExchangeRate').value;
    var totaldue = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value;
    SetCurrencyAmtFields(dueAmt, exrate);
    if (document.getElementById('' + ctrlcom + '_UCServices_hdnRegFeeAutoFill').value == 'True' && $('#lblquick').attr('Class') == 'select' && document.getElementById('' + ctrlcom + '_ReceiptControl2_ddlcrdtype').value == 0 && document.getElementById('' + ctrlcom + '_ReceiptControl2_txtCardAmt').value == 0) {
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value = document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtpatdue').value = 0;
        document.getElementById('' + ctrlcom + '_ReceiptControl2_txtTotalDue').value = parseFloat(totaldue) - parseFloat(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt').value);
        CalculateAmount(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'), 'Cash');
        IsEmptyReplaceWithZero(document.getElementById('' + ctrlcom + '_ReceiptControl2_txtcashAmt'));
    }

}