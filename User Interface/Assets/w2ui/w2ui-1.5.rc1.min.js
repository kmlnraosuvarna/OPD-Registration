var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function($){var tmp={},obj;return{version:"1.5.RC1",settings:{locale:"en-us",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"M",dataType:"HTTPJSON",phrases:{},dateStartYear:1950,dateEndYear:2020},isBin:isBin,isInt:isInt,isFloat:isFloat,isMoney:isMoney,isHex:isHex,isAlphaNumeric:isAlphaNumeric,isEmail:isEmail,isDate:isDate,isTime:isTime,isDateTime:isDateTime,age:age,interval:interval,date:date,formatSize:formatSize,formatNumber:formatNumber,formatDate:formatDate,formatTime:formatTime,formatDateTime:formatDateTime,stripTags:stripTags,encodeTags:encodeTags,decodeTags:decodeTags,escapeId:escapeId,base64encode:base64encode,base64decode:base64decode,md5:md5,transition:transition,lock:lock,unlock:unlock,message:message,lang:lang,locale:locale,getSize:getSize,getStrWidth:getStrWidth,scrollBarSize:scrollBarSize,checkName:checkName,checkUniqueId:checkUniqueId,parseRoute:parseRoute,cssPrefix:cssPrefix,getCursorPosition:getCursorPosition,setCursorPosition:setCursorPosition,testLocalStorage:testLocalStorage,hasLocalStorage:testLocalStorage(),isIOS:-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),isIE:-1!=navigator.userAgent.toLowerCase().indexOf("msie")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")};function isBin(val){var re;return/^[0-1]+$/.test(val)}function isInt(val){var re;return/^[-+]?[0-9]+$/.test(val)}function isFloat(val){return"string"==typeof val&&(val=val.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),("number"==typeof val||"string"==typeof val&&""!==val)&&!isNaN(Number(val))}function isMoney(val){var se=w2utils.settings,re=new RegExp("^"+(se.currencyPrefix?"\\"+se.currencyPrefix+"?":"")+"[-+]?"+(se.currencyPrefix?"\\"+se.currencyPrefix+"?":"")+"[0-9]*[\\"+se.decimalSymbol+"]?[0-9]+"+(se.currencySuffix?"\\"+se.currencySuffix+"?":"")+"$","i");return"string"==typeof val&&(val=val.replace(new RegExp(se.groupSymbol,"g"),"")),"object"!=typeof val&&""!==val&&re.test(val)}function isHex(val){var re;return/^[a-fA-F0-9]+$/.test(val)}function isAlphaNumeric(val){var re;return/^[a-zA-Z0-9_-]+$/.test(val)}function isEmail(val){var email;return/^[a-zA-Z0-9._%-+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(val)}function isDate(val,format,retDate){if(!val)return!1;var dt="Invalid Date",month,day,year;if(null==format&&(format=w2utils.settings.dateFormat),"function"==typeof val.getUTCFullYear)year=val.getUTCFullYear(),month=val.getUTCMonth()+1,day=val.getUTCDate();else if(parseInt(val)==val&&parseInt(val)>0)year=(val=new Date(parseInt(val))).getUTCFullYear(),month=val.getUTCMonth()+1,day=val.getUTCDate();else{if(val=String(val),new RegExp("mon","ig").test(format)){format=format.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),val=val.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var m=0,len=w2utils.settings.fullmonths.length;m<len;m++){var t=w2utils.settings.fullmonths[m];val=val.replace(new RegExp(t,"ig"),parseInt(m)+1).replace(new RegExp(t.substr(0,3),"ig"),parseInt(m)+1)}}var tmp=val.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),tmp2=format.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===tmp2&&(month=tmp[0],day=tmp[1],year=tmp[2]),"m/d/yyyy"===tmp2&&(month=tmp[0],day=tmp[1],year=tmp[2]),"dd/mm/yyyy"===tmp2&&(month=tmp[1],day=tmp[0],year=tmp[2]),"d/m/yyyy"===tmp2&&(month=tmp[1],day=tmp[0],year=tmp[2]),"yyyy/dd/mm"===tmp2&&(month=tmp[2],day=tmp[1],year=tmp[0]),"yyyy/d/m"===tmp2&&(month=tmp[2],day=tmp[1],year=tmp[0]),"yyyy/mm/dd"===tmp2&&(month=tmp[1],day=tmp[2],year=tmp[0]),"yyyy/m/d"===tmp2&&(month=tmp[1],day=tmp[2],year=tmp[0]),"mm/dd/yy"===tmp2&&(month=tmp[0],day=tmp[1],year=tmp[2]),"m/d/yy"===tmp2&&(month=tmp[0],day=tmp[1],year=parseInt(tmp[2])+1900),"dd/mm/yy"===tmp2&&(month=tmp[1],day=tmp[0],year=parseInt(tmp[2])+1900),"d/m/yy"===tmp2&&(month=tmp[1],day=tmp[0],year=parseInt(tmp[2])+1900),"yy/dd/mm"===tmp2&&(month=tmp[2],day=tmp[1],year=parseInt(tmp[0])+1900),"yy/d/m"===tmp2&&(month=tmp[2],day=tmp[1],year=parseInt(tmp[0])+1900),"yy/mm/dd"===tmp2&&(month=tmp[1],day=tmp[2],year=parseInt(tmp[0])+1900),"yy/m/d"===tmp2&&(month=tmp[1],day=tmp[2],year=parseInt(tmp[0])+1900)}return!!isInt(year)&&(!!isInt(month)&&(!!isInt(day)&&(year=+year,month=+month,day=+day,dt=new Date(year,month-1,day),null!=month&&("Invalid Date"!=String(dt)&&(dt.getMonth()+1===month&&dt.getDate()===day&&dt.getFullYear()===year&&(!0!==retDate||dt))))))}function isTime(val,retTime){if(null==val)return!1;var max,am,pm;am=(val=(val=String(val)).toUpperCase()).indexOf("AM")>=0;var ampm=(pm=val.indexOf("PM")>=0)||am;max=ampm?12:24,val=val.replace("AM","").replace("PM","");var tmp=(val=$.trim(val)).split(":"),h=parseInt(tmp[0]||0),m=parseInt(tmp[1]||0),s=parseInt(tmp[2]||0);return!!(ampm&&1===tmp.length||2===tmp.length||3===tmp.length)&&(!(""===tmp[0]||h<0||h>max||!this.isInt(tmp[0])||tmp[0].length>2)&&(!(tmp.length>1&&(""===tmp[1]||m<0||m>59||!this.isInt(tmp[1])||2!==tmp[1].length))&&(!(tmp.length>2&&(""===tmp[2]||s<0||s>59||!this.isInt(tmp[2])||2!==tmp[2].length))&&(!!(ampm||max!==h||0===m&&0===s)&&((!ampm||1!==tmp.length||0!==h)&&(!0!==retTime||(pm&&12!==h&&(h+=12),am&&12===h&&(h+=12),{hours:h,minutes:m,seconds:s})))))))}function isDateTime(val,format,retDate){null==format&&(format=w2utils.settings.datetimeFormat);var formats=format.split("|");if("function"==typeof val.getUTCFullYear)return!0!==retDate||val;if(parseInt(val)==val&&parseInt(val)>0)return val=new Date(parseInt(val)),!0!==retDate||val;var tmp=String(val).indexOf(" "),values=[val.substr(0,tmp),val.substr(tmp).trim()];formats[0]=formats[0].trim(),formats[1]&&(formats[1]=formats[1].trim());var tmp1=w2utils.isDate(values[0],formats[0],!0),tmp2=w2utils.isTime(values[1],!0);return!1!==tmp1&&!1!==tmp2&&(!0!==retDate||(tmp1.setHours(tmp2.hours),tmp1.setMinutes(tmp2.minutes),tmp1.setSeconds(tmp2.seconds),tmp1))}function age(dateStr){var d1;if(""===dateStr||null==dateStr)return"";if(d1="function"==typeof dateStr.getUTCFullYear?dateStr:parseInt(dateStr)==dateStr&&parseInt(dateStr)>0?new Date(parseInt(dateStr)):new Date(dateStr),"Invalid Date"==String(d1))return"";var d2,sec=((new Date).getTime()-d1.getTime())/1e3,amount="",type="";return sec<0?(amount=0,type="sec"):sec<60?(amount=Math.floor(sec),type="sec",sec<0&&(amount=0,type="sec")):sec<3600?(amount=Math.floor(sec/60),type="min"):sec<86400?(amount=Math.floor(sec/60/60),type="hour"):sec<2592e3?(amount=Math.floor(sec/24/60/60),type="day"):sec<31536e3?(amount=Math.floor(sec/30/24/60/60*10)/10,type="month"):sec<126144e3?(amount=Math.floor(sec/365/24/60/60*10)/10,type="year"):sec>=126144e3&&(amount=Math.floor(sec/365.25/24/60/60*10)/10,type="year"),amount+" "+type+(amount>1?"s":"")}function interval(value){var ret="";return ret=value<1e3?"< 1 sec":value<6e4?Math.floor(value/1e3)+" secs":value<36e5?Math.floor(value/6e4)+" mins":value<864e5?Math.floor(value/36e5*10)/10+" hours":value<2628e6?Math.floor(value/864e5*10)/10+" days":value<31536e6?Math.floor(value/2628e6*10)/10+" months":Math.floor(value/31536e5)/10+" years"}function date(dateStr){if(""===dateStr||null==dateStr||"object"==typeof dateStr&&!dateStr.getMonth)return"";var d1=new Date(dateStr);if(w2utils.isInt(dateStr)&&(d1=new Date(Number(dateStr))),"Invalid Date"==String(d1))return"";var months=w2utils.settings.shortmonths,d2=new Date,d3=new Date;d3.setTime(d3.getTime()-864e5);var dd1=months[d1.getMonth()]+" "+d1.getDate()+", "+d1.getFullYear(),dd2=months[d2.getMonth()]+" "+d2.getDate()+", "+d2.getFullYear(),dd3=months[d3.getMonth()]+" "+d3.getDate()+", "+d3.getFullYear(),time=d1.getHours()-(d1.getHours()>12?12:0)+":"+(d1.getMinutes()<10?"0":"")+d1.getMinutes()+" "+(d1.getHours()>=12?"pm":"am"),time2=d1.getHours()-(d1.getHours()>12?12:0)+":"+(d1.getMinutes()<10?"0":"")+d1.getMinutes()+":"+(d1.getSeconds()<10?"0":"")+d1.getSeconds()+" "+(d1.getHours()>=12?"pm":"am"),dsp=dd1;return dd1===dd2&&(dsp=time),dd1===dd3&&(dsp=w2utils.lang("Yesterday")),'<span title="'+dd1+" "+time2+'">'+dsp+"</span>"}function formatSize(sizeStr){if(!w2utils.isFloat(sizeStr)||""===sizeStr)return"";if(0===(sizeStr=parseFloat(sizeStr)))return 0;var sizes=["Bt","KB","MB","GB","TB","PB","EB","ZB"],i=parseInt(Math.floor(Math.log(sizeStr)/Math.log(1024)));return(Math.floor(sizeStr/Math.pow(1024,i)*10)/10).toFixed(0===i?0:1)+" "+(sizes[i]||"??")}function formatNumber(val,fraction,useGrouping){if(null==val||""===val||"object"==typeof val)return"";var options={minimumFractionDigits:fraction,maximumFractionDigits:fraction,useGrouping:useGrouping};return(null==fraction||fraction<0)&&(options.minimumFractionDigits=0,options.maximumFractionDigits=20),parseFloat(val).toLocaleString(w2utils.settings.locale,options)}function formatDate(dateStr,format){if(format||(format=this.settings.dateFormat),""===dateStr||null==dateStr||"object"==typeof dateStr&&!dateStr.getMonth)return"";var dt=new Date(dateStr);if(w2utils.isInt(dateStr)&&(dt=new Date(Number(dateStr))),"Invalid Date"==String(dt))return"";var year=dt.getFullYear(),month=dt.getMonth(),date=dt.getDate();return format.toLowerCase().replace("month",w2utils.settings.fullmonths[month]).replace("mon",w2utils.settings.shortmonths[month]).replace(/yyyy/g,year).replace(/yyy/g,year).replace(/yy/g,year>2e3?100+parseInt(String(year).substr(2)):String(year).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+year).replace(/mm/g,(month+1<10?"0":"")+(month+1)).replace(/dd/g,(date<10?"0":"")+date).replace(/th/g,1==date?"st":"th").replace(/th/g,2==date?"nd":"th").replace(/th/g,3==date?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(month+1)).replace(/(^|[^a-z$])d/g,"$1"+date)}function formatTime(dateStr,format){var months=w2utils.settings.shortmonths,fullMonths=w2utils.settings.fullmonths;if(format||(format=this.settings.timeFormat),""===dateStr||null==dateStr||"object"==typeof dateStr&&!dateStr.getMonth)return"";var dt=new Date(dateStr);if(w2utils.isInt(dateStr)&&(dt=new Date(Number(dateStr))),w2utils.isTime(dateStr)){var tmp=w2utils.isTime(dateStr,!0);(dt=new Date).setHours(tmp.hours),dt.setMinutes(tmp.minutes)}if("Invalid Date"==String(dt))return"";var type="am",hour=dt.getHours(),h24=dt.getHours(),min=dt.getMinutes(),sec=dt.getSeconds();return min<10&&(min="0"+min),sec<10&&(sec="0"+sec),-1===format.indexOf("am")&&-1===format.indexOf("pm")||(hour>=12&&(type="pm"),hour>12&&(hour-=12)),format.toLowerCase().replace("am",type).replace("pm",type).replace("hhh",hour<10?"0"+hour:hour).replace("hh24",h24<10?"0"+h24:h24).replace("h24",h24).replace("hh",hour).replace("mm",min).replace("mi",min).replace("ss",sec).replace(/(^|[^a-z$])h/g,"$1"+hour).replace(/(^|[^a-z$])m/g,"$1"+min).replace(/(^|[^a-z$])s/g,"$1"+sec)}function formatDateTime(dateStr,format){var fmt;return""===dateStr||null==dateStr||"object"==typeof dateStr&&!dateStr.getMonth?"":("string"!=typeof format?fmt=[this.settings.dateFormat,this.settings.timeFormat]:((fmt=format.split("|"))[0]=fmt[0].trim(),fmt[1]=fmt[1].trim()),"h12"==fmt[1]&&(fmt[1]="h:m pm"),"h24"==fmt[1]&&(fmt[1]="h24:m"),this.formatDate(dateStr,fmt[0])+" "+this.formatTime(dateStr,fmt[1]))}function stripTags(html){if(null==html)return html;switch(typeof html){case"number":break;case"string":html=String(html).replace(/(<([^>]+)>)/gi,"");break;case"object":if(Array.isArray(html)){html=$.extend(!0,[],html);for(var i=0;i<html.length;i++)html[i]=this.stripTags(html[i])}else for(var i in html=$.extend(!0,{},html))html[i]=this.stripTags(html[i])}return html}function encodeTags(html){if(null==html)return html;switch(typeof html){case"number":break;case"string":html=String(html).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(html)){html=$.extend(!0,[],html);for(var i=0;i<html.length;i++)html[i]=this.encodeTags(html[i])}else for(var i in html=$.extend(!0,{},html))html[i]=this.encodeTags(html[i])}return html}function decodeTags(html){if(null==html)return html;switch(typeof html){case"number":break;case"string":html=String(html).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":if(Array.isArray(html)){html=$.extend(!0,[],html);for(var i=0;i<html.length;i++)html[i]=this.decodeTags(html[i])}else for(var i in html=$.extend(!0,{},html))html[i]=this.decodeTags(html[i])}return html}function escapeId(id){return""===id||null==id?"":String(id).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")}function base64encode(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0,keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(input=utf8_encode(input);i<input.length;)enc1=(chr1=input.charCodeAt(i++))>>2,enc2=(3&chr1)<<4|(chr2=input.charCodeAt(i++))>>4,enc3=(15&chr2)<<2|(chr3=input.charCodeAt(i++))>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);function utf8_encode(string){string=String(string).replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);c<128?utftext+=String.fromCharCode(c):c>127&&c<2048?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext}return output}function base64decode(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0,keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)chr1=(enc1=keyStr.indexOf(input.charAt(i++)))<<2|(enc2=keyStr.indexOf(input.charAt(i++)))>>4,chr2=(15&enc2)<<4|(enc3=keyStr.indexOf(input.charAt(i++)))>>2,chr3=(3&enc3)<<6|(enc4=keyStr.indexOf(input.charAt(i++))),output+=String.fromCharCode(chr1),64!==enc3&&(output+=String.fromCharCode(chr2)),64!==enc4&&(output+=String.fromCharCode(chr3));function utf8_decode(utftext){for(var string="",i=0,c=0,c2,c3;i<utftext.length;)(c=utftext.charCodeAt(i))<128?(string+=String.fromCharCode(c),i++):c>191&&c<224?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}return output=utf8_decode(output)}function md5(input){var hexcase=0,b64pad="";function __pj_crypt_hex_md5(s){return __pj_crypt_rstr2hex(__pj_crypt_rstr_md5(__pj_crypt_str2rstr_utf8(s)))}function __pj_crypt_b64_md5(s){return __pj_crypt_rstr2b64(__pj_crypt_rstr_md5(__pj_crypt_str2rstr_utf8(s)))}function __pj_crypt_any_md5(s,e){return __pj_crypt_rstr2any(__pj_crypt_rstr_md5(__pj_crypt_str2rstr_utf8(s)),e)}function __pj_crypt_hex_hmac_md5(k,d){return __pj_crypt_rstr2hex(__pj_crypt_rstr_hmac_md5(__pj_crypt_str2rstr_utf8(k),__pj_crypt_str2rstr_utf8(d)))}function __pj_crypt_b64_hmac_md5(k,d){return __pj_crypt_rstr2b64(__pj_crypt_rstr_hmac_md5(__pj_crypt_str2rstr_utf8(k),__pj_crypt_str2rstr_utf8(d)))}function __pj_crypt_any_hmac_md5(k,d,e){return __pj_crypt_rstr2any(__pj_crypt_rstr_hmac_md5(__pj_crypt_str2rstr_utf8(k),__pj_crypt_str2rstr_utf8(d)),e)}function __pj_crypt_rstr_md5(s){return __pj_crypt_binl2rstr(__pj_crypt_binl_md5(__pj_crypt_rstr2binl(s),8*s.length))}function __pj_crypt_rstr_hmac_md5(key,data){var bkey=__pj_crypt_rstr2binl(key);bkey.length>16&&(bkey=__pj_crypt_binl_md5(bkey,8*key.length));for(var ipad=Array(16),opad=Array(16),i=0;i<16;i++)ipad[i]=909522486^bkey[i],opad[i]=1549556828^bkey[i];var hash=__pj_crypt_binl_md5(ipad.concat(__pj_crypt_rstr2binl(data)),512+8*data.length);return __pj_crypt_binl2rstr(__pj_crypt_binl_md5(opad.concat(hash),640))}function __pj_crypt_rstr2hex(input){for(var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef",output="",x,i=0;i<input.length;i++)x=input.charCodeAt(i),output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(15&x);return output}function __pj_crypt_rstr2b64(input){for(var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",output="",len=input.length,i=0;i<len;i+=3)for(var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0),j=0;j<4;j++)8*i+6*j>8*input.length?output+=b64pad:output+=tab.charAt(triplet>>>6*(3-j)&63);return output}function __pj_crypt_rstr2any(input,encoding){var divisor=encoding.length,i,j,q,x,quotient,dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++)dividend[i]=input.charCodeAt(2*i)<<8|input.charCodeAt(2*i+1);var full_length=Math.ceil(8*input.length/(Math.log(encoding.length)/Math.log(2))),remainders=Array(full_length);for(j=0;j<full_length;j++){for(quotient=Array(),x=0,i=0;i<dividend.length;i++)x=(x<<16)+dividend[i],x-=(q=Math.floor(x/divisor))*divisor,(quotient.length>0||q>0)&&(quotient[quotient.length]=q);remainders[j]=x,dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);return output}function __pj_crypt_str2rstr_utf8(input){for(var output="",i=-1,x,y;++i<input.length;)x=input.charCodeAt(i),y=i+1<input.length?input.charCodeAt(i+1):0,55296<=x&&x<=56319&&56320<=y&&y<=57343&&(x=65536+((1023&x)<<10)+(1023&y),i++),x<=127?output+=String.fromCharCode(x):x<=2047?output+=String.fromCharCode(192|x>>>6&31,128|63&x):x<=65535?output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|63&x):x<=2097151&&(output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|63&x));return output}function __pj_crypt_str2rstr_utf16le(input){for(var output="",i=0;i<input.length;i++)output+=String.fromCharCode(255&input.charCodeAt(i),input.charCodeAt(i)>>>8&255);return output}function __pj_crypt_str2rstr_utf16be(input){for(var output="",i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,255&input.charCodeAt(i));return output}function __pj_crypt_rstr2binl(input){for(var output=Array(input.length>>2),i=0;i<output.length;i++)output[i]=0;for(var i=0;i<8*input.length;i+=8)output[i>>5]|=(255&input.charCodeAt(i/8))<<i%32;return output}function __pj_crypt_binl2rstr(input){for(var output="",i=0;i<32*input.length;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}function __pj_crypt_binl_md5(x,len){x[len>>5]|=128<<len%32,x[14+(len+64>>>9<<4)]=len;for(var a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=__pj_crypt_md5_ff(a,b,c,d,x[i+0],7,-680876936),d=__pj_crypt_md5_ff(d,a,b,c,x[i+1],12,-389564586),c=__pj_crypt_md5_ff(c,d,a,b,x[i+2],17,606105819),b=__pj_crypt_md5_ff(b,c,d,a,x[i+3],22,-1044525330),a=__pj_crypt_md5_ff(a,b,c,d,x[i+4],7,-176418897),d=__pj_crypt_md5_ff(d,a,b,c,x[i+5],12,1200080426),c=__pj_crypt_md5_ff(c,d,a,b,x[i+6],17,-1473231341),b=__pj_crypt_md5_ff(b,c,d,a,x[i+7],22,-45705983),a=__pj_crypt_md5_ff(a,b,c,d,x[i+8],7,1770035416),d=__pj_crypt_md5_ff(d,a,b,c,x[i+9],12,-1958414417),c=__pj_crypt_md5_ff(c,d,a,b,x[i+10],17,-42063),b=__pj_crypt_md5_ff(b,c,d,a,x[i+11],22,-1990404162),a=__pj_crypt_md5_ff(a,b,c,d,x[i+12],7,1804603682),d=__pj_crypt_md5_ff(d,a,b,c,x[i+13],12,-40341101),c=__pj_crypt_md5_ff(c,d,a,b,x[i+14],17,-1502002290),a=__pj_crypt_md5_gg(a,b=__pj_crypt_md5_ff(b,c,d,a,x[i+15],22,1236535329),c,d,x[i+1],5,-165796510),d=__pj_crypt_md5_gg(d,a,b,c,x[i+6],9,-1069501632),c=__pj_crypt_md5_gg(c,d,a,b,x[i+11],14,643717713),b=__pj_crypt_md5_gg(b,c,d,a,x[i+0],20,-373897302),a=__pj_crypt_md5_gg(a,b,c,d,x[i+5],5,-701558691),d=__pj_crypt_md5_gg(d,a,b,c,x[i+10],9,38016083),c=__pj_crypt_md5_gg(c,d,a,b,x[i+15],14,-660478335),b=__pj_crypt_md5_gg(b,c,d,a,x[i+4],20,-405537848),a=__pj_crypt_md5_gg(a,b,c,d,x[i+9],5,568446438),d=__pj_crypt_md5_gg(d,a,b,c,x[i+14],9,-1019803690),c=__pj_crypt_md5_gg(c,d,a,b,x[i+3],14,-187363961),b=__pj_crypt_md5_gg(b,c,d,a,x[i+8],20,1163531501),a=__pj_crypt_md5_gg(a,b,c,d,x[i+13],5,-1444681467),d=__pj_crypt_md5_gg(d,a,b,c,x[i+2],9,-51403784),c=__pj_crypt_md5_gg(c,d,a,b,x[i+7],14,1735328473),a=__pj_crypt_md5_hh(a,b=__pj_crypt_md5_gg(b,c,d,a,x[i+12],20,-1926607734),c,d,x[i+5],4,-378558),d=__pj_crypt_md5_hh(d,a,b,c,x[i+8],11,-2022574463),c=__pj_crypt_md5_hh(c,d,a,b,x[i+11],16,1839030562),b=__pj_crypt_md5_hh(b,c,d,a,x[i+14],23,-35309556),a=__pj_crypt_md5_hh(a,b,c,d,x[i+1],4,-1530992060),d=__pj_crypt_md5_hh(d,a,b,c,x[i+4],11,1272893353),c=__pj_crypt_md5_hh(c,d,a,b,x[i+7],16,-155497632),b=__pj_crypt_md5_hh(b,c,d,a,x[i+10],23,-1094730640),a=__pj_crypt_md5_hh(a,b,c,d,x[i+13],4,681279174),d=__pj_crypt_md5_hh(d,a,b,c,x[i+0],11,-358537222),c=__pj_crypt_md5_hh(c,d,a,b,x[i+3],16,-722521979),b=__pj_crypt_md5_hh(b,c,d,a,x[i+6],23,76029189),a=__pj_crypt_md5_hh(a,b,c,d,x[i+9],4,-640364487),d=__pj_crypt_md5_hh(d,a,b,c,x[i+12],11,-421815835),c=__pj_crypt_md5_hh(c,d,a,b,x[i+15],16,530742520),a=__pj_crypt_md5_ii(a,b=__pj_crypt_md5_hh(b,c,d,a,x[i+2],23,-995338651),c,d,x[i+0],6,-198630844),d=__pj_crypt_md5_ii(d,a,b,c,x[i+7],10,1126891415),c=__pj_crypt_md5_ii(c,d,a,b,x[i+14],15,-1416354905),b=__pj_crypt_md5_ii(b,c,d,a,x[i+5],21,-57434055),a=__pj_crypt_md5_ii(a,b,c,d,x[i+12],6,1700485571),d=__pj_crypt_md5_ii(d,a,b,c,x[i+3],10,-1894986606),c=__pj_crypt_md5_ii(c,d,a,b,x[i+10],15,-1051523),b=__pj_crypt_md5_ii(b,c,d,a,x[i+1],21,-2054922799),a=__pj_crypt_md5_ii(a,b,c,d,x[i+8],6,1873313359),d=__pj_crypt_md5_ii(d,a,b,c,x[i+15],10,-30611744),c=__pj_crypt_md5_ii(c,d,a,b,x[i+6],15,-1560198380),b=__pj_crypt_md5_ii(b,c,d,a,x[i+13],21,1309151649),a=__pj_crypt_md5_ii(a,b,c,d,x[i+4],6,-145523070),d=__pj_crypt_md5_ii(d,a,b,c,x[i+11],10,-1120210379),c=__pj_crypt_md5_ii(c,d,a,b,x[i+2],15,718787259),b=__pj_crypt_md5_ii(b,c,d,a,x[i+9],21,-343485551),a=__pj_crypt_safe_add(a,olda),b=__pj_crypt_safe_add(b,oldb),c=__pj_crypt_safe_add(c,oldc),d=__pj_crypt_safe_add(d,oldd)}return Array(a,b,c,d)}function __pj_crypt_md5_cmn(q,a,b,x,s,t){return __pj_crypt_safe_add(__pj_crypt_bit_rol(__pj_crypt_safe_add(__pj_crypt_safe_add(a,q),__pj_crypt_safe_add(x,t)),s),b)}function __pj_crypt_md5_ff(a,b,c,d,x,s,t){return __pj_crypt_md5_cmn(b&c|~b&d,a,b,x,s,t)}function __pj_crypt_md5_gg(a,b,c,d,x,s,t){return __pj_crypt_md5_cmn(b&d|c&~d,a,b,x,s,t)}function __pj_crypt_md5_hh(a,b,c,d,x,s,t){return __pj_crypt_md5_cmn(b^c^d,a,b,x,s,t)}function __pj_crypt_md5_ii(a,b,c,d,x,s,t){return __pj_crypt_md5_cmn(c^(b|~d),a,b,x,s,t)}function __pj_crypt_safe_add(x,y){var lsw=(65535&x)+(65535&y),msw;return(x>>16)+(y>>16)+(lsw>>16)<<16|65535&lsw}function __pj_crypt_bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}return __pj_crypt_hex_md5(input)}function transition(div_old,div_new,type,callBack){var width=$(div_old).width(),height=$(div_old).height(),time=.5;if(div_old&&div_new){switch(div_old.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",div_old.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",div_new.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",type){case"slide-left":div_old.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",div_new.style.cssText+="overflow: hidden; transform: translate3d("+width+"px, 0, 0)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",div_old.style.cssText+="transition: 0.5s; transform: translate3d(-"+width+"px, 0, 0)"},1);break;case"slide-right":div_old.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",div_new.style.cssText+="overflow: hidden; transform: translate3d(-"+width+"px, 0, 0)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",div_old.style.cssText+="transition: 0.5s; transform: translate3d("+width+"px, 0, 0)"},1);break;case"slide-down":div_old.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",div_new.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",div_old.style.cssText+="transition: 0.5s; transform: translate3d(0, "+height+"px, 0)"},1);break;case"slide-up":div_old.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",div_new.style.cssText+="overflow: hidden; transform: translate3d(0, "+height+"px, 0)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",div_old.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":div_old.style.cssText+="overflow: hidden; transform: rotateY(0deg)",div_new.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",div_old.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case"flip-right":div_old.style.cssText+="overflow: hidden; transform: rotateY(0deg)",div_new.style.cssText+="overflow: hidden; transform: rotateY(180deg)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",div_old.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"},1);break;case"flip-down":div_old.style.cssText+="overflow: hidden; transform: rotateX(0deg)",div_new.style.cssText+="overflow: hidden; transform: rotateX(180deg)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",div_old.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case"flip-up":div_old.style.cssText+="overflow: hidden; transform: rotateX(0deg)",div_new.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",div_old.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case"pop-in":div_old.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",div_new.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",div_old.style.cssText+="transition: 0.5s;"},1);break;case"pop-out":div_old.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",div_new.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; opacity: 1;",div_old.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:div_old.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",div_new.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",$(div_new).show(),window.setTimeout(function(){div_new.style.cssText+="transition: 0.5s; opacity: 1;",div_old.style.cssText+="transition: 0.5s"},1)}setTimeout(function(){"slide-down"===type&&($(div_old).css("z-index","1019"),$(div_new).css("z-index","1020")),div_new&&$(div_new).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),div_old&&$(div_old).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof callBack&&callBack()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")}function lock(box,msg,spinner){var options={};"object"==typeof msg?options=msg:(options.msg=msg,options.spinner=spinner),options.msg||0===options.msg||(options.msg=""),w2utils.unlock(box),$(box).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var $lock=$(box).find(".w2ui-lock"),mess=$(box).find(".w2ui-lock-msg");options.msg||mess.css({"background-color":"transparent",border:"0px"}),!0===options.spinner&&(options.msg='<div class="w2ui-spinner" '+(options.msg?"":'style="width: 35px; height: 35px"')+"></div>"+options.msg),null!=options.opacity&&$lock.css("opacity",options.opacity),"function"==typeof $lock.fadeIn?($lock.fadeIn(200),mess.html(options.msg).fadeIn(200)):($lock.show(),mess.html(options.msg).show(0))}function unlock(box,speed){isInt(speed)?($(box).find(".w2ui-lock").fadeOut(speed),setTimeout(function(){$(box).find(".w2ui-lock").remove(),$(box).find(".w2ui-lock-msg").remove()},speed)):($(box).find(".w2ui-lock").remove(),$(box).find(".w2ui-lock-msg").remove())}function message(where,options){var obj=this,closeTimer,edata;$().w2tag(),options||(options={width:200,height:100}),null==options.on&&$.extend(options,w2utils.event),null==options.width&&(options.width=200),null==options.height&&(options.height=100);var pWidth=parseInt($(where.box).width()),pHeight=parseInt($(where.box).height()),titleHeight=parseInt($(where.box).find(where.title).css("height")||0);options.width>pWidth&&(options.width=pWidth-10),options.height>pHeight-titleHeight&&(options.height=pHeight-10-titleHeight),options.originalWidth=options.width,options.originalHeight=options.height,parseInt(options.width)<0&&(options.width=pWidth+options.width),parseInt(options.width)<10&&(options.width=10),parseInt(options.height)<0&&(options.height=pHeight+options.height-titleHeight),parseInt(options.height)<10&&(options.height=10),null==options.hideOnClick&&(options.hideOnClick=!1);var poptions=$(where.box).data("options")||{};(null==options.width||options.width>poptions.width-10)&&(options.width=poptions.width-10),(null==options.height||options.height>poptions.height-titleHeight-5)&&(options.height=poptions.height-titleHeight-5),options.originalHeight<0&&(options.height=pHeight+options.originalHeight-titleHeight),options.originalWidth<0&&(options.width=pWidth+2*options.originalWidth);var head=$(where.box).find(where.title),$tmp=$(where.box).find(".w2ui-message.w2ui-closing");$(where.box).find(".w2ui-message.w2ui-closing").length>0&&(clearTimeout(closeTimer),closeCB($tmp,$tmp.data("options")||{}));var msgCount=$(where.box).find(".w2ui-message").length;if(""===$.trim(options.html)&&""===$.trim(options.body)&&""===$.trim(options.buttons)){if(0===msgCount)return;var $msg=$(where.box).find("#w2ui-message"+(msgCount-1)),options=$msg.data("options")||{};if(!0===(edata=options.trigger({phase:"before",type:"close",target:"self"})).isCancelled)return;$msg.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+options.height+"px)"})).addClass("w2ui-closing"),1==msgCount?this.unlock&&(where.param?this.unlock(where.param,150):this.unlock(150)):$(where.box).find("#w2ui-message"+(msgCount-2)).css("z-index",1500),closeTimer=setTimeout(function(){closeCB($msg,options)},150)}else{""===$.trim(options.body)&&""===$.trim(options.buttons)||(options.html='<div class="w2ui-message-body">'+(options.body||"")+'</div><div class="w2ui-message-buttons">'+(options.buttons||"")+"</div>"),$(where.box).find(".w2ui-message").css("z-index",1390),head.data("old-z-index",head.css("z-index")),head.css("z-index",1501),$(where.box).find(where.body).before('<div id="w2ui-message'+msgCount+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===head.length?"top: 0px;":"top: "+w2utils.getSize(head,"height")+"px;")+(null!=options.width?"width: "+options.width+"px; left: "+(pWidth-options.width)/2+"px;":"left: 10px; right: 10px;")+(null!=options.height?"height: "+options.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===options.hideOnClick?where.param?'onclick="'+where.path+".message('"+where.param+"');\"":'onclick="'+where.path+'.message();"':"")+"></div>"),$(where.box).find("#w2ui-message"+msgCount).data("options",options).data("prev_focus",$(":focus"));var display=$(where.box).find("#w2ui-message"+msgCount).css("display");if($(where.box).find("#w2ui-message"+msgCount).css(w2utils.cssPrefix({transform:"none"==display?"translateY(-"+options.height+"px)":"translateY(0px)"})),"none"==display){if($(where.box).find("#w2ui-message"+msgCount).show().html(options.html),options.box=$(where.box).find("#w2ui-message"+msgCount),!0===(edata=options.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return head.css("z-index",head.data("old-z-index")),void $(where.box).find("#w2ui-message"+msgCount).remove();setTimeout(function(){$(where.box).find("#w2ui-message"+msgCount).css(w2utils.cssPrefix({transform:"none"==display?"translateY(0px)":"translateY(-"+options.height+"px)"}))},1),0===msgCount&&this.lock&&(where.param?this.lock(where.param):this.lock()),setTimeout(function(){$(where.box).find("#w2ui-message"+msgCount).css(w2utils.cssPrefix({transition:"0s"})),options.trigger($.extend(edata,{phase:"after"}))},350)}}function closeCB($msg,options){if(null==edata&&!0===(edata=options.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return head.css("z-index",head.data("old-z-index")),void $(where.box).find("#w2ui-message"+msgCount).remove();var $focus=$msg.data("prev_focus");$msg.remove(),$focus&&$focus.length>0?$focus.focus():obj&&obj.focus&&obj.focus(),head.css("z-index",head.data("old-z-index")),options.trigger($.extend(edata,{phase:"after"}))}}function getSize(el,type){var $el=$(el),bwidth_left=parseInt($el.css("border-left-width"))||0,bwidth_right=parseInt($el.css("border-right-width"))||0,bwidth_top=parseInt($el.css("border-top-width"))||0,bwidth_bottom=parseInt($el.css("border-bottom-width"))||0,mwidth_left=parseInt($el.css("margin-left"))||0,mwidth_right=parseInt($el.css("margin-right"))||0,mwidth_top=parseInt($el.css("margin-top"))||0,mwidth_bottom=parseInt($el.css("margin-bottom"))||0,pwidth_left=parseInt($el.css("padding-left"))||0,pwidth_right=parseInt($el.css("padding-right"))||0,pwidth_top=parseInt($el.css("padding-top"))||0,pwidth_bottom=parseInt($el.css("padding-bottom"))||0;switch(type){case"top":return bwidth_top+mwidth_top+pwidth_top;case"bottom":return bwidth_bottom+mwidth_bottom+pwidth_bottom;case"left":return bwidth_left+mwidth_left+pwidth_left;case"right":return bwidth_right+mwidth_right+pwidth_right;case"width":return bwidth_left+bwidth_right+mwidth_left+mwidth_right+pwidth_left+pwidth_right+parseInt($el.width());case"height":return bwidth_top+bwidth_bottom+mwidth_top+mwidth_bottom+pwidth_top+pwidth_bottom+parseInt($el.height());case"+width":return bwidth_left+bwidth_right+mwidth_left+mwidth_right+pwidth_left+pwidth_right;case"+height":return bwidth_top+bwidth_bottom+mwidth_top+mwidth_bottom+pwidth_top+pwidth_bottom}return 0}function getStrWidth(str,styles){var w,html='<div id="_tmp_width" style="position: absolute; top: -900px;'+(styles||"")+'">'+encodeTags(str)+"</div>";return $("body").append(html),w=$("#_tmp_width").width(),$("#_tmp_width").remove(),w}function lang(phrase){var translation=this.settings.phrases[phrase];return null==translation?phrase:translation}function locale(locale){locale||(locale="en-us"),"string"==typeof locale?(5===locale.length&&(locale="locale/"+locale+".json"),w2utils.settings.phrases={},$.ajax({url:locale,type:"GET",dataType:"JSON",async:!1,success:function(data,status,xhr){w2utils.settings=$.extend(!0,w2utils.settings,data)},error:function(xhr,status,msg){console.log("ERROR: Cannot load locale "+locale)}})):w2utils.settings=$.extend(!0,w2utils.settings,locale)}function scrollBarSize(){if(tmp.scrollBarSize)return tmp.scrollBarSize;var html='<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>';return $("body").append(html),tmp.scrollBarSize=100-$("#_scrollbar_width > div").width(),$("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(tmp.scrollBarSize=tmp.scrollBarSize/2),tmp.scrollBarSize}function checkName(params,component){return params&&null!=params.name?null!=w2ui[params.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+params.name+")."),!1):!!w2utils.isAlphaNumeric(params.name)||(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+component+"()."),!1)}function checkUniqueId(id,items,itemsDecription,objName){$.isArray(items)||(items=[items]);for(var i=0;i<items.length;i++)if(items[i].id===id)return console.log('ERROR: The parameter "id='+id+'" is not unique within the current '+itemsDecription+". (obj: "+objName+")"),!1;return!0}function parseRoute(route){var keys=[],path=route.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(_,slash,format,key,capture,optional){return keys.push({name:key,optional:!!optional}),slash=slash||"",(optional?"":slash)+"(?:"+(optional?slash:"")+(format||"")+(capture||(format?"([^/.]+?)":"([^/]+?)"))+")"+(optional||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+path+"$","i"),keys:keys}}function cssPrefix(field,value,returnString){var css={},newCSS={},ret="";for(var c in $.isPlainObject(field)?(css=field,!0===value&&(returnString=!0)):css[field]=value,css)newCSS[c]=css[c],newCSS["-webkit-"+c]=css[c],newCSS["-moz-"+c]=css[c].replace("-webkit-","-moz-"),newCSS["-ms-"+c]=css[c].replace("-webkit-","-ms-"),newCSS["-o-"+c]=css[c].replace("-webkit-","-o-");if(!0===returnString)for(var c in newCSS)ret+=c+": "+newCSS[c]+"; ";else ret=newCSS;return ret}function getCursorPosition(input){if(null==input)return null;var caretOffset=0,doc=input.ownerDocument||input.document,win=doc.defaultView||doc.parentWindow,sel;if(input.tagName&&"INPUT"==input.tagName.toUpperCase()&&input.selectionStart)caretOffset=input.selectionStart;else if(win.getSelection){if((sel=win.getSelection()).rangeCount>0){var range=sel.getRangeAt(0),preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(input),preCaretRange.setEnd(range.endContainer,range.endOffset),caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&"Control"!=sel.type){var textRange=sel.createRange(),preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(input),preCaretTextRange.setEndPoint("EndToEnd",textRange),caretOffset=preCaretTextRange.text.length}return caretOffset}function setCursorPosition(input,pos,posEnd){var range=document.createRange(),el,sel=window.getSelection();if(null!=input){for(var i=0;i<input.childNodes.length;i++){var tmp=$(input.childNodes[i]).text();if(input.childNodes[i].tagName&&(tmp=(tmp=$(input.childNodes[i]).html()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),pos<=tmp.length){(el=input.childNodes[i]).childNodes&&el.childNodes.length>0&&(el=el.childNodes[0]),el.childNodes&&el.childNodes.length>0&&(el=el.childNodes[0]);break}pos-=tmp.length}null!=el&&(pos>el.length&&(pos=el.length),range.setStart(el,pos),posEnd?range.setEnd(el,posEnd):range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}function testLocalStorage(){var str="w2ui_test";try{return localStorage.setItem(str,str),localStorage.removeItem(str),!0}catch(e){return!1}}}(jQuery);w2utils.formatters={number:function(value,params){return parseInt(params)>20&&(params=20),parseInt(params)<0&&(params=0),null==value||""===value?"":w2utils.formatNumber(parseFloat(value),params,!0)},float:function(value,params){return w2utils.formatters.number(value,params)},int:function(value,params){return w2utils.formatters.number(value,0)},money:function(value,params){if(null==value||""===value)return"";var data=w2utils.formatNumber(Number(value),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+data+(w2utils.settings.currencySuffix||"")},currency:function(value,params){return w2utils.formatters.money(value,params)},percent:function(value,params){return null==value||""===value?"":w2utils.formatNumber(value,params||1)+"%"},size:function(value,params){return null==value||""===value?"":w2utils.formatSize(parseInt(value))},date:function(value,params){if(""===params&&(params=w2utils.settings.dateFormat),null==value||0===value||""===value)return"";var dt=w2utils.isDateTime(value,params,!0);return!1===dt&&(dt=w2utils.isDate(value,params,!0)),'<span title="'+dt+'">'+w2utils.formatDate(dt,params)+"</span>"},datetime:function(value,params){if(""===params&&(params=w2utils.settings.datetimeFormat),null==value||0===value||""===value)return"";var dt=w2utils.isDateTime(value,params,!0);return!1===dt&&(dt=w2utils.isDate(value,params,!0)),'<span title="'+dt+'">'+w2utils.formatDateTime(dt,params)+"</span>"},time:function(value,params){if(""===params&&(params=w2utils.settings.timeFormat),"h12"===params&&(params="hh:mi pm"),"h24"===params&&(params="h24:mi"),null==value||0===value||""===value)return"";var dt=w2utils.isDateTime(value,params,!0);return!1===dt&&(dt=w2utils.isDate(value,params,!0)),'<span title="'+dt+'">'+w2utils.formatTime(value,params)+"</span>"},timestamp:function(value,params){if(""===params&&(params=w2utils.settings.datetimeFormat),null==value||0===value||""===value)return"";var dt=w2utils.isDateTime(value,params,!0);return!1===dt&&(dt=w2utils.isDate(value,params,!0)),dt.toString?dt.toString():""},gmt:function(value,params){if(""===params&&(params=w2utils.settings.datetimeFormat),null==value||0===value||""===value)return"";var dt=w2utils.isDateTime(value,params,!0);return!1===dt&&(dt=w2utils.isDate(value,params,!0)),dt.toUTCString?dt.toUTCString():""},age:function(value,params){if(null==value||0===value||""===value)return"";var dt=w2utils.isDateTime(value,null,!0);return!1===dt&&(dt=w2utils.isDate(value,null,!0)),'<span title="'+dt+'">'+w2utils.age(value)+(params?" "+params:"")+"</span>"},interval:function(value,params){return null==value||0===value||""===value?"":w2utils.interval(value)+(params?" "+params:"")},toggle:function(value,params){return value?"Yes":""},password:function(value,params){for(var ret="",i=0;i<value.length;i++)ret+="*";return ret}},w2utils.event={on:function(edata,handler){var $=jQuery,scope;if("string"==typeof edata&&-1!=edata.indexOf(".")){var tmp=edata.split(".");edata=tmp[0],scope=tmp[1]}if("string"==typeof edata&&-1!=edata.indexOf(":")){var tmp=edata.split(":");-1!=["complete","done"].indexOf(edata[1])&&(edata[1]="after"),edata={type:tmp[0],execute:tmp[1]}}$.isPlainObject(edata)||(edata={type:edata,scope:scope}),(edata=$.extend({type:null,execute:"before",target:null,onComplete:null},edata)).type?handler?($.isArray(this.handlers)||(this.handlers=[]),console.log("add",edata),this.handlers.push({edata:edata,handler:handler})):console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(edata,handler){var $=jQuery,scope;if("string"==typeof edata&&-1!=edata.indexOf(".")){var tmp=edata.split(".");edata=tmp[0],scope=tmp[1]}if("string"==typeof edata&&-1!=edata.indexOf(":")){var tmp=edata.split(":");-1!=["complete","done"].indexOf(edata[1])&&(edata[1]="after"),edata={type:tmp[0],execute:tmp[1]}}if($.isPlainObject(edata)||(edata={type:edata}),(edata=$.extend({},{type:null,execute:"before",target:null,onComplete:null},edata)).type||scope){handler||(handler=null);for(var newHandlers=[],h=0,len=this.handlers.length;h<len;h++){var t=this.handlers[h];(t.edata.type!==edata.type&&"*"!==edata.type&&(null==t.edata.scope||""!=edata.type)||t.edata.target!==edata.target&&null!=edata.target||t.edata.execute!==edata.execute&&null!=edata.execute||t.handler!==handler&&null!=handler&&(null==scope||t.edata.scope!=scope))&&newHandlers.push(t)}this.handlers=newHandlers}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(edata){var $=jQuery,edata,args,fun,tmp;"before"===(edata=$.extend({type:null,phase:"before",target:null,doneHandlers:[]},edata,{isStopped:!1,isCancelled:!1,done:function(handler){this.doneHandlers.push(handler)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}})).phase&&(edata.onComplete=null),null==edata.target&&(edata.target=null),$.isArray(this.handlers)||(this.handlers=[]);for(var h=this.handlers.length-1;h>=0;h--){var item=this.handlers[h];if(!(item.edata.type!==edata.type&&"*"!==item.edata.type||item.edata.target!==edata.target&&null!=item.edata.target||item.edata.execute!==edata.phase&&"*"!==item.edata.execute&&"*"!==item.edata.phase)&&(edata=$.extend({},item.edata,edata),args=[],(tmp=new RegExp(/\((.*?)\)/).exec(item.handler))&&(args=tmp[1].split(/\s*,\s*/)),2===args.length?item.handler.call(this,edata.target,edata):item.handler.call(this,edata),!0===edata.isStopped||!0===edata.stop))return edata}var funName="on"+edata.type.substr(0,1).toUpperCase()+edata.type.substr(1);if("before"===edata.phase&&"function"==typeof this[funName]&&(fun=this[funName],args=[],(tmp=new RegExp(/\((.*?)\)/).exec(fun))&&(args=tmp[1].split(/\s*,\s*/)),2===args.length?fun.call(this,edata.target,edata):fun.call(this,edata),!0===edata.isStopped||!0===edata.stop))return edata;if(null!=edata.object&&"before"===edata.phase&&"function"==typeof edata.object[funName]&&(fun=edata.object[funName],args=[],(tmp=new RegExp(/\((.*?)\)/).exec(fun))&&(args=tmp[1].split(/\s*,\s*/)),2===args.length?fun.call(this,edata.target,edata):fun.call(this,edata),!0===edata.isStopped||!0===edata.stop))return edata;if("after"===edata.phase){"function"==typeof edata.onComplete&&edata.onComplete.call(this,edata);for(var i=0;i<edata.doneHandlers.length;i++)"function"==typeof edata.doneHandlers[i]&&edata.doneHandlers[i].call(this,edata)}return edata}},function($){$.fn.w2render=function(name){$(this).length>0&&("string"==typeof name&&w2ui[name]&&w2ui[name].render($(this)[0]),"object"==typeof name&&name.render($(this)[0]))},$.fn.w2destroy=function(name){!name&&this.length>0&&(name=this.attr("name")),"string"==typeof name&&w2ui[name]&&w2ui[name].destroy(),"object"==typeof name&&name.destroy()},$.fn.w2marker=function(){var str=Array.prototype.slice.call(arguments,0);return Array.isArray(str[0])&&(str=str[0]),0!==str.length&&str[0]?$(this).each(function(index,el){clearMarkedText(index,el);for(var s=0;s<str.length;s++){var tmp=str[s];"string"!=typeof tmp&&(tmp=String(tmp)),tmp=tmp.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var regex=new RegExp(tmp+"(?!([^<]+)?>)","gi");el.innerHTML=el.innerHTML.replace(regex,replaceValue)}function replaceValue(matched){return'<span class="w2ui-marker">'+matched+"</span>"}}):$(this).each(clearMarkedText);function clearMarkedText(index,el){for(;-1!=el.innerHTML.indexOf('<span class="w2ui-marker">');)el.innerHTML=el.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}},$.fn.w2tag=function(text,options){if(1==arguments.length&&"object"==typeof text&&null!=(options=text).html&&(text=options.html),null!=(options=$.extend({id:null,html:text,position:"right|top",align:"none",left:0,top:0,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnBlur:!1,hideOnClick:!1},options)).name&&null==options.id&&(options.id=options.name),""!==options.class&&""===options.inputClass&&(options.inputClass=options.class),0!==$(this).length)return $(this).each(function(index,el){var origID=options.id?options.id:el.id,tagID=w2utils.escapeId(origID),$tags=$("#w2ui-tag-"+tagID);if(""===text||null==text)return $tags.css("opacity",0),clearInterval($tags.data("timer")),void $tags.remove();if(0!==$tags.length)options=$.extend($tags.data("options"),options),$tags.data("options",options),$tags.find(".w2ui-tag-body").attr("style",options.style).addClass(options.className).html(options.html),checkIfMoved(!0);else{var originalCSS="";$(el).length>0&&(originalCSS=$(el)[0].style.cssText),$("body").append('<div onclick="event.stopPropagation()" style="display:none;" id="w2ui-tag-'+origID+'"        class="w2ui-tag '+($(el).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; white-space: nowrap;">      <div class="w2ui-tag-body '+options.className+'" style="'+(options.style||"")+'">'+text+"</div>   </div></div>"),$tags=$("#w2ui-tag-"+tagID),$(el).data("w2tag",$tags.get(0)).data("checkIfMoved",checkIfMoved)}function hideTag(){($tags=$("#w2ui-tag-"+tagID)).length<=0||(clearInterval($tags.data("timer")),$tags.remove(),$(document).off(".w2tag"),$(el).off(".w2tag",hideTag).removeClass(options.inputClass).removeData("w2tag").removeData("checkIfMoved"),$(el).length>0&&($(el)[0].style.cssText=originalCSS),"function"==typeof options.onHide&&options.onHide())}function checkIfMoved(checkOnly,instant){var offset=$(el).offset();if(0===$(el).length||0===offset.left&&0===offset.top||0===$tags.find(".w2ui-tag-body").length)return clearInterval($tags.data("timer")),void hideTag();instant||setTimeout(checkIfMoved,100);var posClass="w2ui-tag-right",posLeft=parseInt(offset.left+el.offsetWidth+(options.left?options.left:0)),posTop=parseInt(offset.top+(options.top?options.top:0)),tagBody=$tags.find(".w2ui-tag-body"),width=tagBody[0].offsetWidth,height=tagBody[0].offsetHeight;if("string"==typeof options.position&&-1!=options.position.indexOf("|")&&(options.position=options.position.split("|")),"top"==options.position)posClass="w2ui-tag-top",posLeft=parseInt(offset.left+(options.left?options.left:0))-14,posTop=parseInt(offset.top+(options.top?options.top:0))-height-10;else if("bottom"==options.position)posClass="w2ui-tag-bottom",posLeft=parseInt(offset.left+(options.left?options.left:0))-14,posTop=parseInt(offset.top+el.offsetHeight+(options.top?options.top:0))+10;else if("left"==options.position)posClass="w2ui-tag-left",posLeft=parseInt(offset.left+(options.left?options.left:0))-width-20,posTop=parseInt(offset.top+(options.top?options.top:0));else if(Array.isArray(options.position)){for(var maxWidth=window.innerWidth,maxHeight=window.innerHeight,i=0;i<options.position.length;i++){var pos=options.position[i];if("right"==pos){if(posClass="w2ui-tag-right",posLeft=parseInt(offset.left+el.offsetWidth+(options.left?options.left:0)),posTop=parseInt(offset.top+(options.top?options.top:0)),posLeft+width<=maxWidth)break}else if("left"==pos){if(posClass="w2ui-tag-left",posLeft=parseInt(offset.left+(options.left?options.left:0))-width-20,posTop=parseInt(offset.top+(options.top?options.top:0)),posLeft>=0)break}else if("top"==pos){if(posClass="w2ui-tag-top",posLeft=parseInt(offset.left+(options.left?options.left:0))-14,posTop=parseInt(offset.top+(options.top?options.top:0))-height-10,posLeft+width<=maxWidth&&posTop>=0)break}else if("bottom"==pos&&(posClass="w2ui-tag-bottom",posLeft=parseInt(offset.left+(options.left?options.left:0))-14,posTop=parseInt(offset.top+el.offsetHeight+(options.top?options.top:0))+10,posLeft+width<=maxWidth&&posTop+height<=maxHeight))break}tagBody.data("posClass")!==posClass&&tagBody.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(posClass).data("posClass",posClass)}return $tags.data("position")!==posLeft+"x"+posTop&&!0!==checkOnly&&$tags.css(w2utils.cssPrefix({transition:instant?"0s":".2s"})).css({left:posLeft+"px",top:posTop+"px"}).data("position",posLeft+"x"+posTop),{left:posLeft,top:posTop,posClass:posClass}}setTimeout(function(){if($tags.css("display","block"),$(el).offset()){var pos=checkIfMoved(!0);null!=pos&&($tags.css({opacity:"1",left:pos.left+"px",top:pos.top+"px"}).data("options",options).data("taged-el",el).data("position",pos.left+"x"+pos.top).data("timer",setTimeout(checkIfMoved,100)).find(".w2ui-tag-body").addClass(pos.posClass),$(el).css(options.css).off(".w2tag").addClass(options.inputClass),options.hideOnKeyPress&&$(el).on("keypress.w2tag",hideTag),options.hideOnBlur&&$(el).on("blur.w2tag",hideTag),options.hideOnClick&&$(document).on("click.w2tag",hideTag),"function"==typeof options.onShow&&options.onShow())}},1)});$(".w2ui-tag").each(function(index,el){var opt=$(el).data("options");null==opt&&(opt={}),$($(el).data("taged-el")).removeClass(opt.inputClass).removeData("w2tag").removeData("checkIfMoved"),clearInterval($(el).data("timer")),$(el).remove()})},$.fn.w2overlay=function(html,options){var obj=this,name="",defaults={name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}},tmp_hide;if(1==arguments.length&&(options="object"==typeof html?html:{html:html}),2==arguments.length&&(options.html=html),$.isPlainObject(options)||(options={}),(options=$.extend({},defaults,options)).name&&(name="-"+options.name),0===this.length||""===options.html||null==options.html)return $("#w2ui-overlay"+name).length>0?"function"==typeof(tmp_hide=$("#w2ui-overlay"+name)[0].hide)&&tmp_hide():$("#w2ui-overlay"+name).remove(),$(this);$("#w2ui-overlay"+name).length>0&&(tmp_hide=$("#w2ui-overlay"+name)[0].hide,$(document).off(".w2overlayHide"),"function"==typeof tmp_hide&&tmp_hide()),obj.length>0&&(null==obj[0].tagName||"BODY"==obj[0].tagName.toUpperCase())&&(options.contextMenu=!0),options.contextMenu&&options.originalEvent&&(options.pageX=options.originalEvent.pageX,options.pageY=options.originalEvent.pageY),!options.contextMenu||null!=options.pageX&&null!=options.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY."),$("body").append('<div id="w2ui-overlay'+name+'" style="display: none; left: 0px; top: 0px; '+options.overlayStyle+'"        class="w2ui-reset w2ui-overlay '+($(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+options.style+'" class="'+options.class+'"></div></div>');var div1=$("#w2ui-overlay"+name),div2=div1.find(" > div");div2.html(options.html);var bc=div2.css("background-color");null!=bc&&"rgba(0, 0, 0, 0)"!==bc&&"transparent"!==bc&&div1.css({"background-color":bc,"border-color":bc});var offset=$(obj).offset()||{};return div1.data("element",obj.length>0?obj[0]:null).data("options",options).data("position",offset.left+"x"+offset.top).fadeIn("fast").on("click",function(event){"LABEL"==event.target.tagName.toUpperCase()&&event.stopPropagation()}).on("mousedown",function(event){$("#w2ui-overlay"+name).data("keepOpen",!0),-1!=["INPUT","TEXTAREA","SELECT"].indexOf(event.target.tagName.toUpperCase())||options.selectable||event.preventDefault()}),div1[0].hide=hide,div1[0].resize=resize,setTimeout(function(){resize(),$(document).off(".w2overlayHide").on("click.w2overlayHide",hide),"function"==typeof options.onShow&&options.onShow()},10),monitor(),$(this);function monitor(){var tmp=$("#w2ui-overlay"+name);if(tmp.data("element")===obj[0]&&0!==tmp.length){var offset=$(obj).offset()||{},pos=offset.left+"x"+offset.top;tmp.data("position")!==pos?hide():setTimeout(monitor,250)}}function hide(event){if(!event||0===event.button){var div1=$("#w2ui-overlay"+name),result;if(!0!==div1.data("keepOpen"))"function"==typeof options.onHide&&(result=options.onHide()),!1!==result&&(div1.remove(),$(document).off("click",hide),clearInterval(div1.data("timer")));else div1.removeData("keepOpen")}}function resize(){var div1=$("#w2ui-overlay"+name),div2=div1.find(" > div"),menu=$("#w2ui-overlay"+name+" div.menu");if(menu.css("overflow-y","hidden"),div1.length>0){div2.height("auto").width("auto");var overflowX=!1,overflowY=!1,h=div2.height(),w=div2.width();options.width&&options.width<w&&(w=options.width),w<30&&(w=30),options.tmp.contentHeight&&(h=parseInt(options.tmp.contentHeight),div2.height(h),setTimeout(function(){var $div=div2.find("div.menu");h>$div.height()&&div2.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){var $div=div2.find("div.menu");"auto"!=$div.css("overflow-y")&&$div.css("overflow-y","auto")},10)),options.tmp.contentWidth&&"both"!=options.align&&(w=parseInt(options.tmp.contentWidth),div2.width(w),setTimeout(function(){w>div2.find("div.menu > table").width()&&div2.find("div.menu > table").css("overflow-x","hidden")},1),setTimeout(function(){div2.find("div.menu > table").css("overflow-x","auto")},10));var boxLeft=options.left,boxWidth=options.width,tipLeft=options.tipLeft;switch(options.align){case"both":boxLeft=17,0===options.width&&(options.width=w2utils.getSize($(obj),"width")),options.maxWidth&&options.width>options.maxWidth&&(options.width=options.maxWidth);break;case"left":boxLeft=17;break;case"right":boxLeft=w2utils.getSize($(obj),"width")-w+10,tipLeft=w-40}boxWidth=30!==w||boxWidth?options.width?options.width:"auto":30;var tmp=(w-17)/2,X,Y,offsetTop,offset;if("auto"!=boxWidth&&(tmp=(boxWidth-17)/2),tmp<25&&(boxLeft=25-tmp,tipLeft=Math.floor(tmp)),options.contextMenu)X=options.pageX+8,Y=options.pageY-0,offsetTop=options.pageY;else X=((offset=obj.offset()||{}).left>25?offset.left:25)+boxLeft,Y=offset.top+w2utils.getSize(obj,"height")+options.top+7,offsetTop=offset.top;div1.css({left:X+"px",top:Y+"px","min-width":boxWidth,"min-height":options.height?options.height:"auto"});var offset=div2.offset()||{},maxHeight=window.innerHeight+$(document).scrollTop()-offset.top-7,maxWidth=window.innerWidth+$(document).scrollLeft()-offset.left-7,tipOffset;if(options.contextMenu&&(maxHeight=window.innerHeight+$(document).scrollTop()-options.pageY-15,maxWidth=window.innerWidth+$(document).scrollLeft()-options.pageX),maxHeight>-50&&maxHeight<210||!0===options.openAbove)options.contextMenu?(maxHeight=options.pageY-7,tipOffset=5):(maxHeight=offset.top-$(document).scrollTop()-7,tipOffset=24),options.maxHeight&&maxHeight>options.maxHeight&&(maxHeight=options.maxHeight),h>maxHeight&&(overflowY=!0,div2.height(maxHeight).width(w).css({"overflow-y":"auto"}),h=maxHeight),div1.addClass("bottom-arrow"),div1.css("top",offsetTop-h-tipOffset+options.top+"px"),div1.find(">style").html("#w2ui-overlay"+name+":before { margin-left: "+parseInt(tipLeft)+"px; }#w2ui-overlay"+name+":after { margin-left: "+parseInt(tipLeft)+"px; }");else options.maxHeight&&maxHeight>options.maxHeight&&(maxHeight=options.maxHeight),h>maxHeight&&(overflowY=!0,div2.height(maxHeight).width(w).css({"overflow-y":"auto"})),div1.addClass("top-arrow"),div1.find(">style").html("#w2ui-overlay"+name+":before { margin-left: "+parseInt(tipLeft)+"px; }#w2ui-overlay"+name+":after { margin-left: "+parseInt(tipLeft)+"px; }");w=div2.width(),maxWidth=window.innerWidth+$(document).scrollLeft()-offset.left-7,options.maxWidth&&maxWidth>options.maxWidth&&(maxWidth=options.maxWidth),w>maxWidth&&"both"!==options.align&&(options.align="right",setTimeout(function(){resize()},1)),(options.contextMenu||options.noTip)&&div1.find(">style").html("#w2ui-overlay"+name+":before { display: none; }#w2ui-overlay"+name+":after { display: none; }"),overflowY&&"both"!=options.align&&div2.width(w+w2utils.scrollBarSize()+2)}menu.css("overflow-y","auto")}},$.fn.w2menu=function(menu,options){options&&"function"==typeof options.items&&(options.items=options.items());var defaults={type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},obj=this,name="";if("refresh"===menu)if($("#w2ui-overlay"+name).length>0){options=$.extend($.fn.w2menuOptions,options);var scrTop=$("#w2ui-overlay"+name+" div.menu").scrollTop();$("#w2ui-overlay"+name+" div.menu").html(getMenuHTML()),$("#w2ui-overlay"+name+" div.menu").scrollTop(scrTop),mresize()}else $(this).w2menu(options);else{if("refresh-index"!==menu){1===arguments.length?options=menu:options.items=menu,"object"!=typeof options&&(options={}),options=$.extend({},defaults,options),$.fn.w2menuOptions=options,options.name&&(name="-"+options.name),"function"==typeof options.select&&"function"!=typeof options.onSelect&&(options.onSelect=options.select),"function"==typeof options.onRender&&"function"!=typeof options.render&&(options.render=options.onRender),$.fn.w2menuClick=function(event,index){var keepOpen=!1;-1!=["radio","check"].indexOf(options.type)&&(event.shiftKey||event.metaKey||event.ctrlKey)&&(keepOpen=!0),"function"==typeof options.onSelect&&setTimeout(function(){options.onSelect({index:index,item:options.items[index],keepOpen:keepOpen,originalEvent:event})},10);var div=$("#w2ui-overlay"+name);div.removeData("keepOpen"),"function"!=typeof div[0].hide||keepOpen||div[0].hide()},$.fn.w2menuDown=function(event,index){var $el=$(event.target).parents("tr"),tmp=$el.find(".w2ui-icon");if("check"==options.type||"radio"==options.type){var item=options.items[index];item.checked=!item.checked,item.checked?("radio"==options.type&&tmp.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),tmp.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"==options.type&&tmp.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")}$el.parent().find("tr").removeClass("w2ui-selected"),$el.addClass("w2ui-selected")};var html="";if(options.search){html+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',options.style+=";background-color: #ECECEC",options.index=0;for(var i=0;i<options.items.length;i++)options.items[i].hidden=!1}html+='<div class="menu" style="position: absolute; top: '+(options.search?40:0)+'px; bottom: 0px; width: 100%;">'+getMenuHTML()+"</div>";var ret=$(this).w2overlay(html,options);return setTimeout(function(){if($("#w2ui-overlay"+name+" #menu-search").on("keyup",change).on("keydown",function(event){9===event.keyCode&&(event.stopPropagation(),event.preventDefault())}),options.search){if(-1!=["text","password"].indexOf($(obj)[0].type)||"TEXTAREA"==$(obj)[0].tagName.toUpperCase())return;$("#w2ui-overlay"+name+" #menu-search").focus()}mresize()},200),mresize(),ret}var $menu=$("#w2ui-overlay"+name+" div.menu"),cur=$menu.find("tr[index="+options.index+"]"),scrTop=$menu.scrollTop();if($menu.find("tr.w2ui-selected").removeClass("w2ui-selected"),cur.addClass("w2ui-selected"),cur.length>0){var top=cur[0].offsetTop-5,height=$menu.height();$menu.scrollTop(scrTop),(top<scrTop||top+cur.height()>scrTop+height)&&$menu.animate({scrollTop:top-(height-2*cur.height())/2},200,"linear")}mresize()}return;function mresize(){setTimeout(function(){$("#w2ui-overlay"+name+" tr.w2ui-selected").removeClass("w2ui-selected");var cur=$("#w2ui-overlay"+name+" tr[index="+options.index+"]"),scrTop=$("#w2ui-overlay"+name+" div.menu").scrollTop();if(cur.addClass("w2ui-selected"),options.tmp&&(options.tmp.contentHeight=$("#w2ui-overlay"+name+" table").height()+(options.search?50:10)),options.tmp&&(options.tmp.contentWidth=$("#w2ui-overlay"+name+" table").width()),$("#w2ui-overlay"+name).length>0&&$("#w2ui-overlay"+name)[0].resize(),cur.length>0){var top=cur[0].offsetTop-5,el,height=$("#w2ui-overlay"+name+" div.menu").height();$("#w2ui-overlay"+name+" div.menu").scrollTop(scrTop),(top<scrTop||top+cur.height()>scrTop+height)&&$("#w2ui-overlay"+name+" div.menu").animate({scrollTop:top-(height-2*cur.height())/2},200,"linear")}},1)}function change(event){var search=this.value,key,cancel=!1;switch(event.keyCode){case 13:$("#w2ui-overlay"+name).remove(),$.fn.w2menuClick(event,options.index);break;case 9:case 27:$("#w2ui-overlay"+name).remove(),$.fn.w2menuClick(event,-1);break;case 38:for(options.index=w2utils.isInt(options.index)?parseInt(options.index):0,options.index--;options.index>0&&options.items[options.index].hidden;)options.index--;if(0===options.index&&options.items[options.index].hidden)for(;options.items[options.index]&&options.items[options.index].hidden;)options.index++;options.index<0&&(options.index=0),cancel=!0;break;case 40:for(options.index=w2utils.isInt(options.index)?parseInt(options.index):0,options.index++;options.index<options.items.length-1&&options.items[options.index].hidden;)options.index++;if(options.index===options.items.length-1&&options.items[options.index].hidden)for(;options.items[options.index]&&options.items[options.index].hidden;)options.index--;options.index>=options.items.length&&(options.index=options.items.length-1),cancel=!0}if(!cancel){for(var shown=0,i=0;i<options.items.length;i++){var item=options.items[i],prefix="",suffix="";-1!==["is","begins with"].indexOf(options.match)&&(prefix="^"),-1!==["is","ends with"].indexOf(options.match)&&(suffix="$");try{var re;new RegExp(prefix+search+suffix,"i").test(item.text)||"..."===item.text?item.hidden=!1:item.hidden=!0}catch(e){}"enum"===obj.type&&-1!==$.inArray(item.id,ids)&&(item.hidden=!0),!0!==item.hidden&&shown++}for(options.index=0;options.index<options.items.length-1&&options.items[options.index].hidden;)options.index++;shown<=0&&(options.index=-1)}$(obj).w2menu("refresh",options),mresize()}function getMenuHTML(){if(options.spinner)return'<table class="w2ui-drop-menu"><tbody><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";for(var count=0,menu_html='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu"><tbody>',img=null,icon=null,f=0;f<options.items.length;f++){var mitem=options.items[f];if("string"==typeof mitem?mitem={id:mitem,text:mitem}:(null!=mitem.text&&null==mitem.id&&(mitem.id=mitem.text),null==mitem.text&&null!=mitem.id&&(mitem.text=mitem.id),null!=mitem.caption&&(mitem.text=mitem.caption),null==(img=mitem.img)&&(img=null),null==(icon=mitem.icon)&&(icon=null)),-1!=["radio","check"].indexOf(options.type)&&(icon=!0===mitem.checked?"w2ui-icon-check":"w2ui-icon-empty"),!0!==mitem.hidden){var imgd="",txt=mitem.text;if("function"==typeof options.render&&(txt=options.render(mitem,options)),img&&(imgd='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+img+'"></div></td>'),icon&&(imgd='<td class="menu-icon" align="center"><span class="w2ui-icon '+icon+'"></span></td>'),null==txt||""===txt||/^-+$/.test(txt))menu_html+='<tr><td colspan="3" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var bg=count%2==0?"w2ui-item-even":"w2ui-item-odd";!0!==options.altRows&&(bg="");var colspan=1;""===imgd&&colspan++,null==mitem.count&&null==mitem.hotkey&&colspan++,null==mitem.tooltip&&null!=mitem.hint&&(mitem.tooltip=mitem.hint),menu_html+='<tr index="'+f+'" style="'+(mitem.style?mitem.style:"")+'" '+(mitem.tooltip?'title="'+w2utils.lang(mitem.tooltip)+'"':"")+'        class="'+bg+" "+(options.index===f?"w2ui-selected":"")+" "+(!0===mitem.disabled?"w2ui-disabled":"")+'"        onmousedown="if ('+(!0===mitem.disabled?"true":"false")+") return;               jQuery.fn.w2menuDown(event, '"+f+'\');"        onclick="event.stopPropagation();                if ('+(!0===mitem.disabled?"true":"false")+") return;               jQuery.fn.w2menuClick(event, '"+f+"');\">"+imgd+'   <td class="menu-text" colspan="'+colspan+'">'+w2utils.lang(txt)+'</td>   <td class="menu-count">'+(null!=mitem.count?"<span>"+mitem.count+"</span>":"")+(null!=mitem.hotkey?'<span class="hotkey">'+mitem.hotkey+"</span>":"")+"</td></tr>",count++}}options.items[f]=mitem}return 0===count&&(menu_html+='<tr><td style="padding: 13px; color: #999; text-align: center">'+options.msgNoItems+"</div></td></tr>"),menu_html+="</tbody></table>"}},$.fn.w2color=function(options,callBack){var obj=this,el=$(this)[0],index=[-1,-1];null==$.fn.w2colorPalette&&($.fn.w2colorPalette=[["000000","555555","888888","BBBBBB","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFFD59","01FD55","00FFFE","006CE7","9B24F4","FF21F5"],["FFEAEA","FCEFE1","FCF5E1","EBF7E7","E9F3F5","ECF4FC","EAE6F4","F5E7ED"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D1E9","EAD1DC"],["EA9899","F9CB9C","FEE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD"],["E06666","F6B26B","FED966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BA0"],["CC0814","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A54D79"],["99050C","B45F17","BF901F","37761D","124F5C","0A5394","351C75","741B47"],["F2F2F2","F2F2F2","F2F2F2","F2F2F2","F2F2F2"]]);var pal=$.fn.w2colorPalette;function getColorHTML(options){for(var color=options.color,html='<div class="w2ui-color" onmousedown="event.stopPropagation(); event.preventDefault()"><table cellspacing="5"><tbody>',i=0;i<pal.length-1;i++){html+="<tr>";for(var j=0;j<pal[i].length;j++)html+='<td>    <div class="color '+(""===pal[i][j]?"no-color":"")+'" style="background-color: #'+pal[i][j]+';"        name="'+pal[i][j]+'" index="'+i+":"+j+'">'+(options.color==pal[i][j]?"&#149;":"&#160;")+"    </div></td>",options.color==pal[i][j]&&(index=[i,j]);html+="</tr>",i<2&&(html+='<tr><td style="height: 8px" colspan="8"></td></tr>')}var tmp=pal[pal.length-1];return html+='<tr><td style="height: 8px" colspan="8"></td></tr><tr>   <td colspan="4" style="text-align: left"><input placeholder="#FFF000" style="margin-left: 1px; width: 74px" maxlength="7"/></td>   <td><div class="color" style="background-color: #'+tmp[0]+';" name="'+tmp[0]+'" index="8:0">'+(options.color==tmp[0]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+tmp[1]+';" name="'+tmp[1]+'" index="8:0">'+(options.color==tmp[1]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+tmp[2]+';" name="'+tmp[2]+'" index="8:0">'+(options.color==tmp[2]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+tmp[3]+';" name="'+tmp[3]+'" index="8:0">'+(options.color==tmp[3]?"&#149;":"&#160;")+'</div></td></tr><tr><td style="height: 4px" colspan="8"></td></tr>',html+="</tbody></table></div>"}"string"==typeof options&&(options={color:options,transparent:!0}),options.transparent&&"555555"==pal[0][1]&&(pal[0].splice(1,1),pal[0].push("")),options.transparent||"555555"==pal[0][1]||(pal[0].splice(1,0,"555555"),pal[0].pop()),options.color&&(options.color=String(options.color).toUpperCase()),0===$("#w2ui-overlay").length?$(el).w2overlay(getColorHTML(options),{onHide:function(){"function"==typeof callBack&&callBack($(el).data("_color")),$(el).removeData("_color")}}):$("#w2ui-overlay .w2ui-color").parent().html(getColorHTML(options)),$("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(event){var color=$(event.originalEvent.target).attr("name");index=$(event.originalEvent.target).attr("index").split(":"),$(el).data("_color",color)}).on("mouseup.w2color",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),$("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(event){$("#w2ui-overlay").data("keepOpen",!0),setTimeout(function(){$("#w2ui-overlay").data("keepOpen",!0)},10),event.stopPropagation()}).on("keyup.w2color",function(event){""!==this.value&&"#"!==this.value[0]&&(this.value="#"+this.value)}).on("change.w2color",function(event){var tmp=this.value;"#"==tmp.substr(0,1)&&(tmp=tmp.substr(1)),6==tmp.length?($.fn.w2colorPalette[pal.length-1].unshift(tmp.toUpperCase()),$(el).w2color(options,callBack),setTimeout(function(){$("#w2ui-overlay input")[0].focus()},100)):$(this).w2tag("Invalid color.")}).w2field("hex"),el.nav=function(direction){switch(direction){case"up":index[0]--;break;case"down":index[0]++;break;case"right":index[1]++;break;case"left":index[1]--}return index[0]<0&&(index[0]=0),index[0]>pal.length-2&&(index[0]=pal.length-2),index[1]<0&&(index[1]=0),index[1]>pal[0].length-1&&(index[1]=pal[0].length-1),color=pal[index[0]][index[1]],$(el).data("_color",color),color}}}(jQuery),function($){var w2grid=function(options){this.name=null,this.box=null,this.header="",this.url="",this.routeData={},this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.httpHeaders={},this.toolbar={},this.stateId=null,this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.lineNumberWidth=null,this.vs_start=150,this.vs_extra=15,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.markSearch=!0,this.columnTooltip="normal",this.disableCVS=!1,this.textSearch="contains",this.total=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.menu=[],this.method=null,this.recid=null,this.parser=null,this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},$.extend(!0,this,w2obj.grid,options)};$.fn.w2grid=function(method){if($.isPlainObject(method)){if(!w2utils.checkName(method,"w2grid"))return;var columns=method.columns,columnGroups=method.columnGroups,records=method.records,searches=method.searches,searchData=method.searchData,sortData=method.sortData,postData=method.postData,httpHeaders=method.httpHeaders,toolbar=method.toolbar,object=new w2grid(method),p;if($.extend(object,{postData:{},httpHeaders:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),null!=object.onExpand&&(object.show.expandColumn=!0),$.extend(!0,object.toolbar,toolbar),columns)for(p=0;p<columns.length;p++)object.columns[p]=$.extend(!0,{},columns[p]);if(columnGroups)for(p=0;p<columnGroups.length;p++)object.columnGroups[p]=$.extend(!0,{},columnGroups[p]);if(searches)for(p=0;p<searches.length;p++)object.searches[p]=$.extend(!0,{},searches[p]);if(searchData)for(p=0;p<searchData.length;p++)object.searchData[p]=$.extend(!0,{},searchData[p]);if(sortData)for(p=0;p<sortData.length;p++)object.sortData[p]=$.extend(!0,{},sortData[p]);if(object.postData=$.extend(!0,{},postData),object.httpHeaders=$.extend(!0,{},httpHeaders),records)for(var r=0;r<records.length;r++){if(null==records[r].recid&&null==records[r][object.recid])return void console.log("ERROR: Cannot add records without recid. (obj: "+object.name+")");object.records[r]=$.extend(!0,{},records[r])}for(var i=0;i<object.columns.length;i++){var col=object.columns[i],search=col.searchable;if(null!=search&&!1!==search&&null==object.getSearch(col.field))if($.isPlainObject(search))object.addSearch($.extend({field:col.field,caption:col.caption,type:"text"},search));else{var stype=col.searchable,attr="";!0===col.searchable&&(stype="text",attr='size="20"'),object.addSearch({field:col.field,caption:col.caption,type:stype,attr:attr})}}return object.initToolbar(),0!==$(this).length&&object.render($(this)[0]),w2ui[object.name]=object,object}var obj=w2ui[$(this).attr("name")];return obj?arguments.length>0?(obj[method]&&obj[method].apply(obj,Array.prototype.slice.call(arguments,1)),this):obj:null},w2grid.prototype={msgDelete:"Are you sure you want to delete selected records?",msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var obj = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields();\"></div>"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["is","between",{oper:"less",text:"less than"},{oper:"more",text:"more than"}],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},operatorsMap:{text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(record,first){$.isArray(record)||(record=[record]);for(var added=0,i=0;i<record.length;i++){var rec=record[i];null!=rec.recid||null!=rec[this.recid]?(rec.w2ui&&!0===rec.w2ui.summary?first?this.summary.unshift(rec):this.summary.push(rec):first?this.records.unshift(rec):this.records.push(rec),added++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}var url;return("object"!=typeof this.url?this.url:this.url.get)?(this.refresh(),added):(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords(),added)},find:function(obj,returnIndex){null==obj&&(obj={});var recs=[],hasDots=!1;for(var o in obj)-1!=String(o).indexOf(".")&&(hasDots=!0);for(var i=0;i<this.records.length;i++){var match=!0;for(var o in obj){var val=this.records[i][o];hasDots&&-1!=String(o).indexOf(".")&&(val=this.parseField(this.records[i],o)),"not-null"==obj[o]?null!=val&&""!==val||(match=!1):obj[o]!=val&&(match=!1)}match&&!0!==returnIndex&&recs.push(this.records[i].recid),match&&!0===returnIndex&&recs.push(i)}return recs},set:function(recid,record,noRefresh){if("object"==typeof recid&&(noRefresh=record,record=recid,recid=null),null==recid){for(var i=0;i<this.records.length;i++)$.extend(!0,this.records[i],record);!0!==noRefresh&&this.refresh()}else{var ind=this.get(recid,!0),isSummary;if(null==ind)return!1;!this.records[ind]||this.records[ind].recid!=recid?$.extend(!0,this.summary[ind],record):$.extend(!0,this.records[ind],record),!0!==noRefresh&&this.refreshRow(recid,ind)}return!0},get:function(recid,returnIndex){if($.isArray(recid)){for(var recs=[],i=0;i<this.records.length;i++)-1!=$.inArray(this.records[i].recid,recid)&&(!0===returnIndex?recs.push(i):recs.push(this.records[i]));for(var i=0;i<this.summary.length;i++)-1!=$.inArray(this.summary[i].recid,recid)&&(!0===returnIndex?recs.push(i):recs.push(this.summary[i]));return recs}for(var i=0;i<this.records.length;i++)if(this.records[i].recid==recid)return!0===returnIndex?i:this.records[i];for(var i=0;i<this.summary.length;i++)if(this.summary[i].recid==recid)return!0===returnIndex?i:this.summary[i];return null},remove:function(){for(var removed=0,a=0;a<arguments.length;a++){for(var r=this.records.length-1;r>=0;r--)this.records[r].recid==arguments[a]&&(this.records.splice(r,1),removed++);for(var r=this.summary.length-1;r>=0;r--)this.summary[r].recid==arguments[a]&&(this.summary.splice(r,1),removed++)}var url;return("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!1,!0),this.localSearch()),this.refresh(),removed},addColumn:function(before,columns){var added=0;1==arguments.length?(columns=before,before=this.columns.length):("string"==typeof before&&(before=this.getColumn(before,!0)),null==before&&(before=this.columns.length)),$.isArray(columns)||(columns=[columns]);for(var i=0;i<columns.length;i++){if(this.columns.splice(before,0,columns[i]),columns[i].searchable){var stype=columns[i].searchable,attr="";!0===columns[i].searchable&&(stype="text",attr='size="20"'),this.addSearch({field:columns[i].field,caption:columns[i].caption,type:stype,attr:attr})}before++,added++}return this.refresh(),added},removeColumn:function(){for(var removed=0,a=0;a<arguments.length;a++)for(var r=this.columns.length-1;r>=0;r--)this.columns[r].field==arguments[a]&&(this.columns[r].searchable&&this.removeSearch(arguments[a]),this.columns.splice(r,1),removed++);return this.refresh(),removed},getColumn:function(field,returnIndex){if(0===arguments.length){for(var ret=[],i=0;i<this.columns.length;i++)ret.push(this.columns[i].field);return ret}for(var i=0;i<this.columns.length;i++)if(this.columns[i].field==field)return!0===returnIndex?i:this.columns[i];return null},toggleColumn:function(){for(var effected=0,a=0;a<arguments.length;a++)for(var r=this.columns.length-1;r>=0;r--){var col=this.columns[r];col.field==arguments[a]&&(col.hidden=!col.hidden,effected++)}return this.refreshBody(),this.resizeRecords(),effected},showColumn:function(){for(var shown=0,a=0;a<arguments.length;a++)for(var r=this.columns.length-1;r>=0;r--){var col=this.columns[r];col.gridMinWidth&&delete col.gridMinWidth,col.field==arguments[a]&&!1!==col.hidden&&(col.hidden=!1,shown++)}return this.refreshBody(),this.resizeRecords(),shown},hideColumn:function(){for(var hidden=0,a=0;a<arguments.length;a++)for(var r=this.columns.length-1;r>=0;r--){var col=this.columns[r];col.field==arguments[a]&&!0!==col.hidden&&(col.hidden=!0,hidden++)}return this.refreshBody(),this.resizeRecords(),hidden},addSearch:function(before,search){var added=0;1==arguments.length?(search=before,before=this.searches.length):("string"==typeof before&&(before=this.getSearch(before,!0)),null==before&&(before=this.searches.length)),$.isArray(search)||(search=[search]);for(var i=0;i<search.length;i++)this.searches.splice(before,0,search[i]),before++,added++;return this.searchClose(),added},removeSearch:function(){for(var removed=0,a=0;a<arguments.length;a++)for(var r=this.searches.length-1;r>=0;r--)this.searches[r].field==arguments[a]&&(this.searches.splice(r,1),removed++);return this.searchClose(),removed},getSearch:function(field,returnIndex){if(0===arguments.length){for(var ret=[],i=0;i<this.searches.length;i++)ret.push(this.searches[i].field);return ret}for(var i=0;i<this.searches.length;i++)if(this.searches[i].field==field)return!0===returnIndex?i:this.searches[i];return null},toggleSearch:function(){for(var effected=0,a=0;a<arguments.length;a++)for(var r=this.searches.length-1;r>=0;r--)this.searches[r].field==arguments[a]&&(this.searches[r].hidden=!this.searches[r].hidden,effected++);return this.searchClose(),effected},showSearch:function(){for(var shown=0,a=0;a<arguments.length;a++)for(var r=this.searches.length-1;r>=0;r--)this.searches[r].field==arguments[a]&&!1!==this.searches[r].hidden&&(this.searches[r].hidden=!1,shown++);return this.searchClose(),shown},hideSearch:function(){for(var hidden=0,a=0;a<arguments.length;a++)for(var r=this.searches.length-1;r>=0;r--)this.searches[r].field==arguments[a]&&!0!==this.searches[r].hidden&&(this.searches[r].hidden=!0,hidden++);return this.searchClose(),hidden},getSearchData:function(field){for(var i=0;i<this.searchData.length;i++)if(this.searchData[i].field==field)return this.searchData[i];return null},localSort:function(silent,noResetRefresh){var url;if("object"!=typeof this.url?this.url:this.url.get)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(!$.isEmptyObject(this.sortData)){var time=(new Date).getTime(),obj=this;obj.selectionSave(),obj.prepareData(),noResetRefresh||obj.reset();for(var i=0;i<this.sortData.length;i++){var column=this.getColumn(this.sortData[i].field);if(!column)return;"string"==typeof column.render&&(-1!=["date","age"].indexOf(column.render.split(":")[0])&&(this.sortData[i].field_=column.field+"_"),-1!=["time"].indexOf(column.render.split(":")[0])&&(this.sortData[i].field_=column.field+"_"))}return preparePaths(),this.records.sort(function(a,b){return compareRecordPaths(a,b)}),cleanupPaths(),obj.selectionRestore(noResetRefresh),time=(new Date).getTime()-time,!0!==silent&&obj.show.statusSort&&setTimeout(function(){obj.status(w2utils.lang("Sorting took")+" "+time/1e3+" "+w2utils.lang("sec"))},10),time}function preparePaths(){for(var i=0;i<obj.records.length;i++){var rec=obj.records[i];rec.w2ui&&null!=rec.w2ui.parent_recid&&(rec.w2ui._path=getRecordPath(rec))}}function cleanupPaths(){for(var i=0;i<obj.records.length;i++){var rec=obj.records[i];rec.w2ui&&null!=rec.w2ui.parent_recid&&(rec.w2ui._path=null)}}function compareRecordPaths(a,b){if(!(a.w2ui&&null!=a.w2ui.parent_recid||b.w2ui&&null!=b.w2ui.parent_recid))return compareRecords(a,b);for(var pa=getRecordPath(a),pb=getRecordPath(b),i=0;i<Math.min(pa.length,pb.length);i++){var diff=compareRecords(pa[i],pb[i]);if(0!==diff)return diff}return pa.length>pb.length?1:pa.length<pb.length?-1:(console.log("ERROR: two paths should not be equal."),0)}function getRecordPath(rec){if(!rec.w2ui||null==rec.w2ui.parent_recid)return[rec];if(rec.w2ui._path)return rec.w2ui._path;var subrec=obj.get(rec.w2ui.parent_recid);return subrec?getRecordPath(subrec).concat(rec):(console.log("ERROR: no parent record: "+rec.w2ui.parent_recid),[rec])}function compareRecords(a,b){if(a===b)return 0;for(var i=0;i<obj.sortData.length;i++){var fld=obj.sortData[i].field;obj.sortData[i].field_&&(fld=obj.sortData[i].field_);var aa=a[fld],bb=b[fld];-1!=String(fld).indexOf(".")&&(aa=obj.parseField(a,fld),bb=obj.parseField(b,fld));var col=obj.getColumn(fld),ret;if(col&&null!=col.editable&&($.isPlainObject(aa)&&aa.text&&(aa=aa.text),$.isPlainObject(bb)&&bb.text&&(bb=bb.text)),0!==(ret=compareCells(aa,bb,i,obj.sortData[i].direction)))return ret}var ret;return 0!==(ret=compareCells(a.recid,b.recid,-1,"asc"))?ret:0}function compareCells(aa,bb,i,direction){if(aa===bb)return 0;if((null==aa||""===aa)&&null!=bb&&""!==bb)return 1;if(null!=aa&&""!==aa&&(null==bb||""===bb))return-1;var dir="asc"==direction?1:-1;if(typeof aa!=typeof bb)return typeof aa>typeof bb?dir:-dir;if(aa.constructor.name!=bb.constructor.name)return aa.constructor.name>bb.constructor.name?dir:-dir;aa&&"object"==typeof aa&&(aa=aa.valueOf()),bb&&"object"==typeof bb&&(bb=bb.valueOf());var defaultToString={}.toString;return aa&&"object"==typeof aa&&aa.toString!=defaultToString&&(aa=String(aa)),bb&&"object"==typeof bb&&bb.toString!=defaultToString&&(bb=String(bb)),"string"==typeof aa&&(aa=$.trim(aa.toLowerCase())),"string"==typeof bb&&(bb=$.trim(bb.toLowerCase())),aa>bb?dir:aa<bb?-dir:0}},localSearch:function(silent){var url="object"!=typeof this.url?this.url:this.url.get;if(!url){var time=(new Date).getTime(),obj=this,defaultToString={}.toString,duplicateMap={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!url){this.total=0;for(var i=0;i<this.records.length;i++){var rec=this.records[i],match;searchRecord(rec)&&(rec&&rec.w2ui&&addParent(rec.w2ui.parent_recid),this.last.searchIds.push(i))}this.total=this.last.searchIds.length}return time=(new Date).getTime()-time,!0!==silent&&obj.show.statusSearch&&setTimeout(function(){obj.status(w2utils.lang("Search took")+" "+time/1e3+" "+w2utils.lang("sec"))},10),time}function searchRecord(rec){for(var fl=0,j=0;j<obj.searchData.length;j++){var sdata=obj.searchData[j],search=obj.getSearch(sdata.field);if(null!=sdata){null==search&&(search={field:sdata.field,type:sdata.type});var val1b=obj.parseField(rec,search.field),val1=null==val1b||"object"==typeof val1b&&val1b.toString==defaultToString?"":String(val1b).toLowerCase();if(null!=sdata.value)if($.isArray(sdata.value))var val2=sdata.value[0],val3=sdata.value[1];else var val2=String(sdata.value).toLowerCase();switch(sdata.operator){case"is":if(obj.parseField(rec,search.field)==sdata.value)fl++;else if("date"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatDate(tmp,"yyyy-mm-dd"))==(val2=w2utils.formatDate(w2utils.isDate(val2,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&fl++}else if("time"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatTime(tmp,"hh24:mi"))==(val2=w2utils.formatTime(val2,"hh24:mi"))&&fl++}else if("datetime"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatDateTime(tmp,"yyyy-mm-dd|hh24:mm:ss"))==(val2=w2utils.formatDateTime(w2utils.isDateTime(val2,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"))&&fl++}break;case"between":if(-1!=["int","float","money","currency","percent"].indexOf(search.type))parseFloat(obj.parseField(rec,search.field))>=parseFloat(val2)&&parseFloat(obj.parseField(rec,search.field))<=parseFloat(val3)&&fl++;else if("date"==search.type){var val1=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val2=w2utils.isDate(val2,w2utils.settings.dateFormat,!0),val3;null!=(val3=w2utils.isDate(val3,w2utils.settings.dateFormat,!0))&&(val3=new Date(val3.getTime()+864e5)),val1>=val2&&val1<val3&&fl++}else if("time"==search.type){var val1=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val2=w2utils.isTime(val2,!0),val3=w2utils.isTime(val3,!0);val2=(new Date).setHours(val2.hours,val2.minutes,val2.seconds?val2.seconds:0,0),val3=(new Date).setHours(val3.hours,val3.minutes,val3.seconds?val3.seconds:0,0),val1>=val2&&val1<val3&&fl++}else if("datetime"==search.type){var val1=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val2=w2utils.isDateTime(val2,w2utils.settings.datetimeFormat,!0),val3;(val3=w2utils.isDateTime(val3,w2utils.settings.datetimeFormat,!0))&&(val3=new Date(val3.getTime()+864e5)),val1>=val2&&val1<val3&&fl++}break;case"less":if(-1!=["int","float","money","currency","percent"].indexOf(search.type))parseFloat(obj.parseField(rec,search.field))<=parseFloat(sdata.value)&&fl++;else if("date"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatDate(tmp,"yyyy-mm-dd"))<=(val2=w2utils.formatDate(w2utils.isDate(val2,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&fl++}else if("time"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatTime(tmp,"hh24:mi"))<=(val2=w2utils.formatTime(val2,"hh24:mi"))&&fl++}else if("datetime"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1=w2utils.formatDateTime(tmp,"yyyy-mm-dd|hh24:mm:ss"),val2=w2utils.formatDateTime(w2utils.isDateTime(val2,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");val1.length==val2.length&&val1<=val2&&fl++}break;case"more":if(-1!=["int","float","money","currency","percent"].indexOf(search.type))parseFloat(obj.parseField(rec,search.field))>=parseFloat(sdata.value)&&fl++;else if("date"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatDate(tmp,"yyyy-mm-dd"))>=(val2=w2utils.formatDate(w2utils.isDate(val2,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&fl++}else if("time"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1,val2;(val1=w2utils.formatTime(tmp,"hh24:mi"))>=(val2=w2utils.formatTime(val2,"hh24:mi"))&&fl++}else if("datetime"==search.type){var tmp=obj.parseField(rec,search.field+"_")instanceof Date?obj.parseField(rec,search.field+"_"):obj.parseField(rec,search.field),val1=w2utils.formatDateTime(tmp,"yyyy-mm-dd|hh24:mm:ss"),val2=w2utils.formatDateTime(w2utils.isDateTime(val2,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");val1.length==val2.length&&val1>=val2&&fl++}break;case"in":var tmp=sdata.value;sdata.svalue&&(tmp=sdata.svalue),-1!==tmp.indexOf(w2utils.isFloat(val1)?parseFloat(val1):val1)&&fl++,-1!==tmp.indexOf(w2utils.isFloat(val1b)?parseFloat(val1b):val1b)&&fl++;break;case"not in":var tmp=sdata.value;sdata.svalue&&(tmp=sdata.svalue),-1==tmp.indexOf(w2utils.isFloat(val1)?parseFloat(val1):val1)&&fl++,-1==tmp.indexOf(w2utils.isFloat(val1b)?parseFloat(val1b):val1b)&&fl++;break;case"begins":case"begins with":0===val1.indexOf(val2)&&fl++;break;case"contains":val1.indexOf(val2)>=0&&fl++;break;case"null":null==obj.parseField(rec,search.field)&&fl++;break;case"not null":null!=obj.parseField(rec,search.field)&&fl++;break;case"ends":case"ends with":var lastIndex=val1.lastIndexOf(val2);-1!==lastIndex&&lastIndex==val1.length-val2.length&&fl++}}}if("OR"==obj.last.logic&&0!==fl||"AND"==obj.last.logic&&fl==obj.searchData.length)return!0;if(rec.w2ui&&rec.w2ui.children&&!0!==rec.w2ui.expanded)for(var r=0;r<rec.w2ui.children.length;r++){var subRec;if(searchRecord(rec.w2ui.children[r]))return!0}return!1}function addParent(recid){if(void 0!==recid&&!duplicateMap[recid]){duplicateMap[recid]=!0;var i=obj.get(recid,!0);if(null!=i&&-1==$.inArray(i,obj.last.searchIds)){var rec=obj.records[i];rec&&rec.w2ui&&addParent(rec.w2ui.parent_recid),obj.last.searchIds.push(i)}}}console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.")},getRangeData:function(range,extra){var rec1=this.get(range[0].recid,!0),rec2=this.get(range[1].recid,!0),col1=range[0].column,col2=range[1].column,res=[];if(col1==col2)for(var r=rec1;r<=rec2;r++){var record,dt=(record=this.records[r])[this.columns[col1].field]||null;!0!==extra?res.push(dt):res.push({data:dt,column:col1,index:r,record:record})}else if(rec1==rec2)for(var record=this.records[rec1],i=col1;i<=col2;i++){var dt=record[this.columns[i].field]||null;!0!==extra?res.push(dt):res.push({data:dt,column:i,index:rec1,record:record})}else for(var r=rec1;r<=rec2;r++){var record=this.records[r];res.push([]);for(var i=col1;i<=col2;i++){var dt=record[this.columns[i].field];!0!==extra?res[res.length-1].push(dt):res[res.length-1].push({data:dt,column:i,index:r,record:record})}}return res},addRange:function(ranges){var added=0;if("row"==this.selectType)return added;$.isArray(ranges)||(ranges=[ranges]);for(var i=0;i<ranges.length;i++){if("object"!=typeof ranges[i]&&(ranges[i]={name:"selection"}),"selection"==ranges[i].name){if(!1===this.show.selectionBorder)continue;var sel=this.getSelection();if(0===sel.length){this.removeRange("selection");continue}var first=sel[0],last=sel[sel.length-1]}else var first=ranges[i].range[0],last=ranges[i].range[1];if(first){for(var rg={name:ranges[i].name,range:[{recid:first.recid,column:first.column},{recid:last.recid,column:last.column}],style:ranges[i].style||""},ind=!1,j=0;j<this.ranges.length;j++)if(this.ranges[j].name==ranges[i].name){ind=j;break}!1!==ind?this.ranges[ind]=rg:this.ranges.push(rg),added++}}return this.refreshRanges(),added},removeRange:function(){for(var removed=0,a=0;a<arguments.length;a++){var name=arguments[a];$("#grid_"+this.name+"_"+name).remove(),$("#grid_"+this.name+"_f"+name).remove();for(var r=this.ranges.length-1;r>=0;r--)this.ranges[r].name==name&&(this.ranges.splice(r,1),removed++)}return removed},refreshRanges:function(){if(0!==this.ranges.length){for(var obj=this,time=(new Date).getTime(),rec1=$("#grid_"+this.name+"_frecords"),rec2=$("#grid_"+this.name+"_records"),i=0;i<this.ranges.length;i++){var rg=this.ranges[i],first=rg.range[0],last=rg.range[1];null==first.index&&(first.index=this.get(first.recid,!0)),null==last.index&&(last.index=this.get(last.recid,!0));var td1=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(first.recid)+' td[col="'+first.column+'"]'),td2=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(last.recid)+' td[col="'+last.column+'"]'),td1f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(first.recid)+' td[col="'+first.column+'"]'),td2f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(last.recid)+' td[col="'+last.column+'"]'),_lastColumn=last.column;first.column<this.last.colStart&&last.column>this.last.colStart&&(td1=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(first.recid)+' td[col="start"]')),first.column<this.last.colEnd&&last.column>this.last.colEnd&&(_lastColumn='"end"',td2=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(last.recid)+' td[col="end"]'));var index_top=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),index_bottom=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),index_ftop=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),index_fbottom=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===td1.length&&first.index<index_top&&last.index>index_top&&(td1=$("#grid_"+this.name+"_rec_top").next().find("td[col="+first.column+"]")),0===td2.length&&last.index>index_bottom&&first.index<index_bottom&&(td2=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+_lastColumn+"]")),0===td1f.length&&first.index<index_ftop&&last.index>index_ftop&&(td1f=$("#grid_"+this.name+"_frec_top").next().find("td[col="+first.column+"]")),0===td2f.length&&last.index>index_fbottom&&first.index<index_fbottom&&(td2f=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+last.column+"]"));var edit,tmp=$(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input"),tmp1=tmp.attr("recid"),tmp2=tmp.attr("column");if("selection"!=rg.name||rg.range[0].recid!=tmp1||rg.range[0].column!=tmp2){var $range=$("#grid_"+this.name+"_f"+rg.name);if(td1f.length>0||td2f.length>0)if(0===$range.length?(rec1.append('<div id="grid_'+this.name+"_f"+rg.name+'" class="w2ui-selection" style="'+rg.style+'">'+("selection"==rg.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),$range=$("#grid_"+this.name+"_f"+rg.name)):($range.attr("style",rg.style),$range.find(".w2ui-selection-resizer").show()),0===td2f.length&&(0===(td2f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(last.recid)+" td:last-child")).length&&(td2f=$("#grid_"+this.name+"_frec_bottom td:first-child")),$range.css("border-right","0px"),$range.find(".w2ui-selection-resizer").hide()),null!=first.recid&&null!=last.recid&&td1f.length>0&&td2f.length>0){var _left=td1f.position().left-1+rec1.scrollLeft(),_top=td1f.position().top-1+rec1.scrollTop();$range.show().css({left:(_left>0?_left:0)+"px",top:(_top>0?_top:0)+"px",width:td2f.position().left-td1f.position().left+td2f.width()+3+"px",height:td2f.position().top-td1f.position().top+td2f.height()+3+"px"})}else $range.hide();else $range.hide();var $range=$("#grid_"+this.name+"_"+rg.name);if(td1.length>0||td2.length>0)if(0===$range.length?(rec2.append('<div id="grid_'+this.name+"_"+rg.name+'" class="w2ui-selection" style="'+rg.style+'">'+("selection"==rg.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),$range=$("#grid_"+this.name+"_"+rg.name)):$range.attr("style",rg.style),0===td1.length&&0===(td1=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(first.recid)+" td:first-child")).length&&(td1=$("#grid_"+this.name+"_rec_top td:first-child")),0!==td2f.length&&$range.css("border-left","0px"),null!=first.recid&&null!=last.recid&&td1.length>0&&td2.length>0){var _left=td1.position().left-1+rec2.scrollLeft(),_top=td1.position().top-1+rec2.scrollTop();$range.show().css({left:(_left>0?_left:0)+"px",top:(_top>0?_top:0)+"px",width:td2.position().left-td1.position().left+td2.width()+3+"px",height:td2.position().top-td1.position().top+td2.height()+3+"px"})}else $range.hide();else $range.hide()}}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",mouseStart).off("dblclick").on("dblclick",function(event){var edata=obj.trigger({phase:"before",type:"resizerDblClick",target:obj.name,originalEvent:event});!0!==edata.isCancelled&&obj.trigger($.extend(edata,{phase:"after"}))});var edata={phase:"before",type:"selectionExtend",target:obj.name,originalRange:null,newRange:null};return(new Date).getTime()-time}function mouseStart(event){var sel=obj.getSelection();obj.last.move={type:"expand",x:event.screenX,y:event.screenY,divX:0,divY:0,recid:sel[0].recid,column:sel[0].column,originalRange:[{recid:sel[0].recid,column:sel[0].column},{recid:sel[sel.length-1].recid,column:sel[sel.length-1].column}],newRange:[{recid:sel[0].recid,column:sel[0].column},{recid:sel[sel.length-1].recid,column:sel[sel.length-1].column}]},$(document).off("mousemove",mouseMove).on("mousemove",mouseMove),$(document).off("mouseup",mouseStop).on("mouseup",mouseStop),event.preventDefault()}function mouseMove(event){var mv=obj.last.move;if(mv&&"expand"==mv.type){var recid,column;mv.divX=event.screenX-mv.x,mv.divY=event.screenY-mv.y;var tmp=event.originalEvent.target;if("TD"!=tmp.tagName.toUpperCase()&&(tmp=$(tmp).parents("td")[0]),null!=$(tmp).attr("col")&&(column=parseInt($(tmp).attr("col"))),tmp=$(tmp).parents("tr")[0],recid=$(tmp).attr("recid"),mv.newRange[1].recid!=recid||mv.newRange[1].column!=column){var prevNewRange=$.extend({},mv.newRange);if(mv.newRange=[{recid:mv.recid,column:mv.column},{recid:recid,column:column}],!0===(edata=obj.trigger($.extend(edata,{originalRange:mv.originalRange,newRange:mv.newRange}))).isCancelled)return mv.newRange=prevNewRange,void(edata.newRange=prevNewRange);obj.removeRange("grid-selection-expand"),obj.addRange({name:"grid-selection-expand",range:edata.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"})}}}function mouseStop(event){obj.removeRange("grid-selection-expand"),delete obj.last.move,$(document).off("mousemove",mouseMove),$(document).off("mouseup",mouseStop),obj.trigger($.extend(edata,{phase:"after"}))}},select:function(){if(0===arguments.length)return 0;var time=(new Date).getTime(),selected=0,sel=this.last.selection;this.multiSelect||this.selectNone();var tmp={phase:"before",type:"select",target:this.name};1==arguments.length?(tmp.multiple=!1,$.isPlainObject(arguments[0])?(tmp.recid=arguments[0].recid,tmp.column=arguments[0].column):tmp.recid=arguments[0]):(tmp.multiple=!0,tmp.recids=Array.prototype.slice.call(arguments,0));var edata=this.trigger(tmp);if(!0===edata.isCancelled)return 0;if("row"==this.selectType)for(var a=0;a<arguments.length;a++){var recid="object"==typeof arguments[a]?arguments[a].recid:arguments[a],index;if(null!=(index=this.get(recid,!0))){var recEl1=null,recEl2=null;if((0!==this.searchData.length||index+1>=this.last.range_start&&index+1<=this.last.range_end)&&(recEl1=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)),recEl2=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(recid))),"row"==this.selectType){if(-1!=sel.indexes.indexOf(index))continue;sel.indexes.push(index),recEl1&&recEl2&&(recEl1.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),recEl2.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),recEl1.find(".w2ui-grid-select-check").prop("checked",!0)),selected++}}}else{for(var new_sel={},a=0;a<arguments.length;a++){var recid="object"==typeof arguments[a]?arguments[a].recid:arguments[a],column="object"==typeof arguments[a]?arguments[a].column:null;if(new_sel[recid]=new_sel[recid]||[],$.isArray(column))new_sel[recid]=column;else if(w2utils.isInt(column))new_sel[recid].push(column);else for(var i=0;i<this.columns.length;i++)this.columns[i].hidden||new_sel[recid].push(parseInt(i))}var col_sel=[];for(var recid in new_sel){var index;if(null!=(index=this.get(recid,!0))){var recEl1=null,recEl2=null;index+1>=this.last.range_start&&index+1<=this.last.range_end&&(recEl1=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(recid)),recEl2=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)));var s=sel.columns[index]||[];-1==sel.indexes.indexOf(index)&&sel.indexes.push(index);for(var t=0;t<new_sel[recid].length;t++)-1==s.indexOf(new_sel[recid][t])&&s.push(new_sel[recid][t]);s.sort(function(a,b){return a-b});for(var t=0;t<new_sel[recid].length;t++){var col=new_sel[recid][t];-1==col_sel.indexOf(col)&&col_sel.push(col),recEl1&&(recEl1.find("#grid_"+this.name+"_data_"+index+"_"+col).addClass("w2ui-selected"),recEl1.find(".w2ui-col-number").addClass("w2ui-row-selected"),recEl1.data("selected","yes"),recEl1.find(".w2ui-grid-select-check").prop("checked",!0)),recEl2&&(recEl2.find("#grid_"+this.name+"_data_"+index+"_"+col).addClass("w2ui-selected"),recEl2.find(".w2ui-col-number").addClass("w2ui-row-selected"),recEl2.data("selected","yes"),recEl2.find(".w2ui-grid-select-check").prop("checked",!0)),selected++}sel.columns[index]=s}}for(var c=0;c<col_sel.length;c++)$(this.box).find("#grid_"+this.name+"_column_"+col_sel[c]+" .w2ui-col-header").addClass("w2ui-col-selected")}sel.indexes.sort(function(a,b){return a-b});var areAllSelected=this.records.length>0&&sel.indexes.length==this.records.length,areAllSearchedSelected=sel.indexes.length>0&&0!==this.searchData.length&&sel.indexes.length==this.last.searchIds.length;return areAllSelected||areAllSearchedSelected?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.trigger($.extend(edata,{phase:"after"})),selected},unselect:function(){for(var unselected=0,sel=this.last.selection,a=0;a<arguments.length;a++){var recid="object"==typeof arguments[a]?arguments[a].recid:arguments[a],record=this.get(recid);if(null!=record){var index=this.get(record.recid,!0),recEl1=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)),recEl2=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(recid));if("row"==this.selectType){if(-1==sel.indexes.indexOf(index))continue;var edata;if(!0===(edata=this.trigger({phase:"before",type:"unselect",target:this.name,recid:recid,index:index})).isCancelled)continue;sel.indexes.splice(sel.indexes.indexOf(index),1),recEl1.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),recEl2.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=recEl1.length&&(recEl1[0].style.cssText="height: "+this.recordHeight+"px; "+recEl1.attr("custom_style"),recEl2[0].style.cssText="height: "+this.recordHeight+"px; "+recEl2.attr("custom_style")),recEl1.find(".w2ui-grid-select-check").prop("checked",!1),unselected++}else{var col=arguments[a].column;if(!w2utils.isInt(col)){for(var cols=[],i=0;i<this.columns.length;i++)this.columns[i].hidden||cols.push({recid:recid,column:i});return this.unselect.apply(this,cols)}var s=sel.columns[index],edata;if(!$.isArray(s)||-1==s.indexOf(col))continue;if(!0===(edata=this.trigger({phase:"before",type:"unselect",target:this.name,recid:recid,column:col})).isCancelled)continue;s.splice(s.indexOf(col),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(recid)).find(" > td[col="+col+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)).find(" > td[col="+col+"]").removeClass("w2ui-selected w2ui-inactive");for(var isColSelected=!1,isRowSelected=!1,tmp=this.getSelection(),i=0;i<tmp.length;i++)tmp[i].column==col&&(isColSelected=!0),tmp[i].recid==recid&&(isRowSelected=!0);isColSelected||$(this.box).find(".w2ui-grid-columns td[col="+col+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+col+"] .w2ui-col-header").removeClass("w2ui-col-selected"),isRowSelected||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),unselected++,0===s.length&&(delete sel.columns[index],sel.indexes.splice(sel.indexes.indexOf(index),1),recEl1.removeData("selected"),recEl1.find(".w2ui-grid-select-check").prop("checked",!1),recEl2.removeData("selected"))}this.trigger($.extend(edata,{phase:"after"}))}}var areAllSelected=this.records.length>0&&sel.indexes.length==this.records.length,areAllSearchedSelected=sel.indexes.length>0&&0!==this.searchData.length&&sel.indexes.length==this.last.searchIds.length;return areAllSelected||areAllSearchedSelected?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),unselected},selectAll:function(){var time=(new Date).getTime();if(!1!==this.multiSelect){var edata=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0!==edata.isCancelled){for(var url="object"!=typeof this.url?this.url:this.url.get,sel=this.last.selection,cols=[],i=0;i<this.columns.length;i++)cols.push(i);if(sel.indexes=[],url||0===this.searchData.length){var buffered=this.records.length;0==this.searchData.length||url||(buffered=this.last.searchIds.length);for(var i=0;i<buffered;i++)sel.indexes.push(i),"row"!=this.selectType&&(sel.columns[i]=cols.slice())}else for(var i=0;i<this.last.searchIds.length;i++)sel.indexes.push(this.last.searchIds[i]),"row"!=this.selectType&&(sel.columns[this.last.searchIds[i]]=cols.slice());var sel;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)),1==(sel=this.getSelection()).length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),sel.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}}},selectNone:function(){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==edata.isCancelled){var sel=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)),sel.indexes=[],sel.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},getSelection:function(returnIndex){var ret=[],sel=this.last.selection;if("row"==this.selectType){for(var i=0;i<sel.indexes.length;i++)this.records[sel.indexes[i]]&&(!0===returnIndex?ret.push(sel.indexes[i]):ret.push(this.records[sel.indexes[i]].recid));return ret}for(var i=0;i<sel.indexes.length;i++){var cols=sel.columns[sel.indexes[i]];if(this.records[sel.indexes[i]])for(var j=0;j<cols.length;j++)ret.push({recid:this.records[sel.indexes[i]].recid,index:parseInt(sel.indexes[i]),column:cols[j]})}return ret},search:function(field,value){for(var obj=this,url="object"!=typeof this.url?this.url:this.url.get,searchData=[],last_multi=this.last.multi,last_logic=this.last.logic,last_field=this.last.field,last_search=this.last.search,hasHiddenSearches=!1,i=0;i<this.searches.length;i++)this.searches[i].hidden&&(searchData.push({field:this.searches[i].field,operator:this.searches[i].operator||"is",type:this.searches[i].type,value:this.searches[i].value||""}),hasHiddenSearches=!0);if(0===arguments.length){last_search="";for(var i=0;i<this.searches.length;i++){var search=this.searches[i],operator=$("#grid_"+this.name+"_operator_"+i).val(),field1=$("#grid_"+this.name+"_field_"+i),field2=$("#grid_"+this.name+"_field2_"+i),value1=field1.val(),value2=field2.val(),svalue=null,text=null;if(-1!=["int","float","money","currency","percent"].indexOf(search.type)){var fld1=field1.data("w2field"),fld2=field2.data("w2field");fld1&&(value1=fld1.clean(value1)),fld2&&(value2=fld2.clean(value2))}if(-1!=["list","enum"].indexOf(search.type))if(value1=field1.data("selected")||{},$.isArray(value1)){svalue=[];for(var j=0;j<value1.length;j++)svalue.push(w2utils.isFloat(value1[j].id)?parseFloat(value1[j].id):String(value1[j].id).toLowerCase()),delete value1[j].hidden;$.isEmptyObject(value1)&&(value1="")}else text=value1.text||"",value1=value1.id||"";if(""!==value1&&null!=value1||null!=value2&&""!==value2){var tmp={field:search.field,type:search.type,operator:operator};"between"==operator?$.extend(tmp,{value:[value1,value2]}):"in"==operator&&"string"==typeof value1?$.extend(tmp,{value:value1.split(",")}):"not in"==operator&&"string"==typeof value1?$.extend(tmp,{value:value1.split(",")}):$.extend(tmp,{value:value1}),svalue&&$.extend(tmp,{svalue:svalue}),text&&$.extend(tmp,{text:text});try{"date"==search.type&&"between"==operator&&(tmp.value[0]=value1,tmp.value[1]=value2),"date"==search.type&&"is"==operator&&(tmp.value=value1)}catch(e){}searchData.push(tmp)}}last_multi=!0,last_logic="AND"}if("string"==typeof field&&(1==arguments.length&&(value=field,field="all"),last_field=field,last_search=value,last_multi=!1,last_logic=hasHiddenSearches?"AND":"OR",null!=value))if("all"==field.toLowerCase())if(this.searches.length>0)for(var i=0;i<this.searches.length;i++){var search;if("text"==(search=this.searches[i]).type||"alphanumeric"==search.type&&w2utils.isAlphaNumeric(value)||"int"==search.type&&w2utils.isInt(value)||"float"==search.type&&w2utils.isFloat(value)||"percent"==search.type&&w2utils.isFloat(value)||("hex"==search.type||"color"==search.type)&&w2utils.isHex(value)||"currency"==search.type&&w2utils.isMoney(value)||"money"==search.type&&w2utils.isMoney(value)||"date"==search.type&&w2utils.isDate(value)||"time"==search.type&&w2utils.isTime(value)||"datetime"==search.type&&w2utils.isDateTime(value)||"enum"==search.type&&w2utils.isAlphaNumeric(value)||"list"==search.type&&w2utils.isAlphaNumeric(value)){var tmp={field:search.field,type:search.type,operator:null!=search.operator?search.operator:"text"==search.type?this.textSearch:"is",value:value};""!=$.trim(value)&&searchData.push(tmp)}if(-1!=["int","float","money","currency","percent"].indexOf(search.type)&&2==$.trim(String(value)).split("-").length){var t=$.trim(String(value)).split("-"),tmp={field:search.field,type:search.type,operator:null!=search.operator?search.operator:"between",value:[t[0],t[1]]};searchData.push(tmp)}if(-1!=["list","enum"].indexOf(search.type)){for(var new_values=[],j=0;j<search.options.items;j++){var tmp=search.options.items[j];try{var re=new RegExp(value,"i");re.test(tmp)&&new_values.push(j),tmp.text&&re.test(tmp.text)&&new_values.push(tmp.id)}catch(e){}}if(new_values.length>0){var tmp={field:search.field,type:search.type,operator:null!=search.operator?search.operator:"in",value:new_values};searchData.push(tmp)}}}else for(var i=0;i<this.columns.length;i++){var tmp={field:this.columns[i].field,type:"text",operator:this.textSearch,value:value};searchData.push(tmp)}else{var el=$("#grid_"+this.name+"_search_all"),search;if(null==(search=this.getSearch(field))&&(search={field:field,type:"text"}),search.field==field&&(this.last.caption=search.caption),""!==value){var op=this.textSearch,val=value,tmp;if(-1!=["date","time","datetime"].indexOf(search.type)&&(op="is"),-1!=["list","enum"].indexOf(search.type))op="is",val=(tmp=el.data("selected"))&&!$.isEmptyObject(tmp)?tmp.id:"";if("int"==search.type&&""!==value){var tmp;if(op="is",-1!=String(value).indexOf("-"))2==(tmp=value.split("-")).length&&(op="between",val=[parseInt(tmp[0]),parseInt(tmp[1])]);if(-1!=String(value).indexOf(",")){var tmp=value.split(",");op="in",val=[];for(var i=0;i<tmp.length;i++)val.push(tmp[i])}}null!=search.operator&&(op=search.operator);var tmp={field:search.field,type:search.type,operator:op,value:val};searchData.push(tmp)}}if($.isArray(field)){var logic="AND";"string"==typeof value&&"OR"!=(logic=value.toUpperCase())&&"AND"!=logic&&(logic="AND"),last_search="",last_multi=!0,last_logic=logic;for(var i=0;i<field.length;i++){var data=field[i],search;if(null==(search=this.getSearch(data.field))&&(search={type:"text",operator:"contains"}),$.isArray(data.value))for(var j=0;j<data.value.length;j++)"string"==typeof data.value[j]&&(data.value[j]=data.value[j].toLowerCase());searchData.push($.extend(!0,{},search,data))}}var edata=this.trigger({phase:"before",type:"search",multi:0===arguments.length,target:this.name,searchData:searchData,searchField:field||"multi",searchValue:field?value:"multi"});!0!==edata.isCancelled&&(this.searchData=edata.searchData,this.last.field=last_field,this.last.search=last_search,this.last.multi=last_multi,this.last.logic=last_logic,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),url?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(edata,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var obj=this,edata=this.trigger({phase:"before",type:"searchOpen",target:this.name});!0!==edata.isCancelled?$("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,class:"w2ui-grid-searches",onShow:function(){obj.initSearches(),$("#w2ui-overlay-"+obj.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",obj.name);var sfields=$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");sfields.length>0&&sfields[0].focus(),obj.trigger($.extend(edata,{phase:"after"}))}}):setTimeout(function(){obj.toolbar.uncheck("w2ui-search-advanced")},1)}},searchClose:function(){var obj=this;this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),$().w2overlay({name:this.name+"-searchOverlay"}),$().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(noRefresh){for(var searchData=[],hasHiddenSearches=!1,i=0;i<this.searches.length;i++)this.searches[i].hidden&&(searchData.push({field:this.searches[i].field,operator:this.searches[i].operator||"is",type:this.searches[i].type,value:this.searches[i].value||""}),hasHiddenSearches=!0);var edata=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:searchData});if(!0!==edata.isCancelled){if(this.searchData=edata.searchData,this.last.search="",this.last.logic=hasHiddenSearches?"AND":"OR",this.searches.length>0)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var tmp=0;tmp<this.searches.length&&(this.searches[tmp].hidden||!1===this.searches[tmp].simple);)tmp++;tmp>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[tmp].field,this.last.caption=this.searches[tmp].caption)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),noRefresh||this.reload(),this.trigger($.extend(edata,{phase:"after"}))}},searchShowFields:function(){for(var obj=this,el=$("#grid_"+this.name+"_search_all"),html='<div class="w2ui-select-field"><table><tbody>',s=-1;s<this.searches.length;s++){var search=this.searches[s];if(-1==s){if(!this.multiSearch||!this.show.searchAll)continue;search={field:"all",caption:w2utils.lang("All Fields")}}else if(!0===this.searches[s].hidden||!1===this.searches[s].simple)continue;html+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+search.field+"');      event.stopPropagation(); jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });">   <td>       <span class="w2ui-column-check w2ui-icon-'+(search.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+search.caption+"</td></tr>"}html+="</tbody></table></div>",setTimeout(function(){$(el).w2overlay({html:html,name:obj.name+"-searchFields",left:-10})},1)},initAllField:function(field,value){var el=$("#grid_"+this.name+"_search_all");if("all"==field){var search={field:"all",caption:w2utils.lang("All Fields")};el.w2field("clear"),el.change()}else{var search;if(null==(search=this.getSearch(field)))return;var st=search.type;-1!=["enum","select"].indexOf(st)&&(st="list"),el.w2field(st,$.extend({},search.options,{suffix:"",autoFormat:!1,selected:value})),-1!=["list","enum","date","time","datetime"].indexOf(search.type)&&(this.last.search="",this.last.item="",el.val(""))}""!=this.last.search?(this.last.caption=search.caption,this.search(search.field,this.last.search)):(this.last.field=search.field,this.last.caption=search.caption),el.attr("placeholder",w2utils.lang(search.caption)),$().w2overlay({name:this.name+"-searchFields"})},clear:function(noRefresh){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.reset(!0),noRefresh||this.refresh()},reset:function(noRefresh){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),noRefresh||this.refresh()},skip:function(offset,callBack){var url;("object"!=typeof this.url?this.url:this.url.get)?(this.offset=parseInt(offset),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(callBack)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(url,callBack){null!=url?(this.clear(!0),this.request("get",{},url,callBack)):console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.')},reload:function(callBack){var grid=this,url="object"!=typeof this.url?this.url:this.url.get;grid.selectionSave(),url?this.load(url,function(){grid.selectionRestore(),"function"==typeof callBack&&callBack()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof callBack&&callBack({status:"success"}))},request:function(cmd,add_params,url,callBack){if(null==add_params&&(add_params={}),""!=url&&null!=url||(url=this.url),""!=url&&null!=url){var params={},edata;if(w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),params.cmd=cmd,params.selected=this.getSelection(),params.limit=this.limit,params.offset=parseInt(this.offset)+parseInt(this.last.xhr_offset),params.search=this.searchData,params.searchLogic=this.last.logic,params.sort=this.sortData,0===this.searchData.length&&(delete params.search,delete params.searchLogic),0===this.sortData.length&&delete params.sort,$.extend(params,this.postData),$.extend(params,add_params),"get"==cmd){if(!0===(edata=this.trigger({phase:"before",type:"request",target:this.name,url:url,postData:params,httpHeaders:this.httpHeaders})).isCancelled)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}))}else var edata={url:url,postData:params,httpHeaders:this.httpHeaders};var obj=this;if(0===this.last.xhr_offset)obj.lock(w2utils.lang(obj.msgRefresh),!0);else{var more=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");!0===this.autoLoad?more.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):more.find("td").html("<div>"+w2utils.lang("Load")+" "+obj.limit+" "+w2utils.lang("More")+"...</div>")}if(this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(url="object"!=typeof edata.url?edata.url:edata.url.get,"save"==params.cmd&&"object"==typeof edata.url&&(url=edata.url.save),"delete"==params.cmd&&"object"==typeof edata.url&&(url=edata.url.remove),!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(ajaxOptions.data="object"==typeof ajaxOptions.data?String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):ajaxOptions.data),"HTTPJSON"==w2utils.settings.dataType&&(ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)}),"RESTFULL"==w2utils.settings.dataType&&(ajaxOptions.type="GET","save"==params.cmd&&(ajaxOptions.type="PUT"),"delete"==params.cmd&&(ajaxOptions.type="DELETE"),ajaxOptions.data="object"==typeof ajaxOptions.data?String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):ajaxOptions.data),"RESTFULLJSON"==w2utils.settings.dataType&&(ajaxOptions.type="GET","save"==params.cmd&&(ajaxOptions.type="PUT"),"delete"==params.cmd&&(ajaxOptions.type="DELETE"),ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"),"JSON"==w2utils.settings.dataType&&(ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"),this.method&&(ajaxOptions.type=this.method),this.last.xhr_cmd=params.cmd,this.last.xhr_start=(new Date).getTime(),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.requestComplete(status,cmd,callBack)}).fail(function(xhr,status,error){var errorObj={status:status,error:error,rawResponseText:xhr.responseText},edata2=obj.trigger({phase:"before",type:"error",error:errorObj,xhr:xhr});if(!0!==edata2.isCancelled){if("abort"!=status){var data;try{data=$.parseJSON(xhr.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof data?data:xhr.responseText),obj.requestComplete("error",cmd,callBack)}obj.trigger($.extend(edata2,{phase:"after"}))}}),"get"==cmd&&this.trigger($.extend(edata,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this;this.unlock(),setTimeout(function(){obj.show.statusResponse&&obj.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;var event_name="load";"save"==this.last.xhr_cmd&&(event_name="save"),"delete"==this.last.xhr_cmd&&(event_name="delete");var edata=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status});if(!0!==edata.isCancelled){var data,responseText=this.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else if("function"==typeof obj.parser)data=obj.parser(responseText),"object"!=typeof data&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+responseText)}catch(e){}if(null==data?data={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:responseText}:Array.isArray(data)&&(data={status:"success",records:data}),obj.recid&&data.records)for(var i=0;i<data.records.length;i++)data.records[i].recid=data.records[i][obj.recid];if("error"==data.status)obj.error(data.message);else{if("get"==cmd){if(null==data.total&&(data.total=-1),data.records.length==this.limit?this.last.xhr_hasMore=!0:(this.last.xhr_hasMore=!1,this.total=this.last.xhr_offset+data.records.length),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(data.total)&&(this.total=parseInt(data.total));else if(-1!=data.total&&parseInt(data.total)!=parseInt(this.total))return void this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset,this.reload()}.bind(this));if(data.records)for(var r=0;r<data.records.length;r++)this.records.push(data.records[r]);if(data.summary){this.summary=[];for(var r=0;r<data.summary.length;r++)this.summary.push(data.summary[r])}}if("delete"==cmd)return this.reset(),void this.reload()}}}else data={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:responseText},obj.error(w2utils.lang(this.msgAJAXerror));var url="object"!=typeof this.url?this.url:this.url.get;url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof callBack&&callBack(data),this.trigger($.extend(edata,{phase:"after"}))}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},error:function(msg){var obj=this,edata=this.trigger({target:this.name,type:"error",message:msg,xhr:this.last.xhr});!0!==edata.isCancelled?(this.message(msg),this.trigger($.extend(edata,{phase:"after"}))):"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},getChanges:function(){for(var changes=[],r=0;r<this.records.length;r++){var rec=this.records[r];rec.w2ui&&null!=rec.w2ui.changes&&changes.push($.extend(!0,{recid:rec.recid},rec.w2ui.changes))}return changes},mergeChanges:function(){for(var changes=this.getChanges(),c=0;c<changes.length;c++){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){"object"==typeof changes[c][s]&&(changes[c][s]=changes[c][s].text);try{-1!=s.indexOf(".")?eval("record['"+s.replace(/\./g,"']['")+"'] = changes[c][s]"):record[s]=changes[c][s]}catch(e){console.log("ERROR: Cannot merge. ",e.message||"",e)}record.w2ui&&delete record.w2ui.changes}}this.refresh()},save:function(){var obj=this,changes=this.getChanges(),edata=this.trigger({phase:"before",target:this.name,type:"save",changes:changes}),url;!0!==edata.isCancelled&&(("object"!=typeof this.url?this.url:this.url.save)?this.request("save",{changes:edata.changes},null,function(data){"error"!==data.status&&obj.mergeChanges(),obj.trigger($.extend(edata,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(edata,{phase:"after"}))))},editField:function(recid,column,value,event){var obj=this,index=obj.get(recid,!0),edit=obj.getCellEditable(index,column);if(edit){var rec=obj.records[index],col=obj.columns[column],prefix=!0===col.frozen?"_f":"_";if(-1==["enum","file"].indexOf(edit.type)){var edata=obj.trigger({phase:"before",type:"editField",target:obj.name,recid:recid,column:column,value:value,index:index,originalEvent:event});if(!0!==edata.isCancelled&&(value=edata.value,this.selectNone(),this.select({recid:recid,column:column}),this.last.edit_col=column,-1==["checkbox","check"].indexOf(edit.type))){var tr=$("#grid_"+obj.name+prefix+"rec_"+w2utils.escapeId(recid)),el=tr.find("[col="+column+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+prefix+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),el=$("#grid_"+this.name+"_editable >div:first-child")),null==edit.inTag&&(edit.inTag=""),null==edit.outTag&&(edit.outTag=""),null==edit.style&&(edit.style=""),null==edit.items&&(edit.items=[]);var val=rec.w2ui&&rec.w2ui.changes&&null!=rec.w2ui.changes[col.field]?w2utils.stripTags(rec.w2ui.changes[col.field]):w2utils.stripTags(rec[col.field]);null==val&&(val="");var old_value="object"!=typeof val?val:"";null!=edata.old_value&&(old_value=edata.old_value),null!=value&&(val=value);var addStyle=null!=col.style?col.style+";":"";switch("string"==typeof col.render&&-1!=["number","int","float","money","percent","size"].indexOf(col.render.split(":")[0])&&(addStyle+="text-align: right;"),edit.items.length>0&&!$.isPlainObject(edit.items[0])&&(edit.items=w2obj.field.prototype.normMenu(edit.items)),edit.type){case"select":for(var html="",i=0;i<edit.items.length;i++)html+='<option value="'+edit.items[i].id+'"'+(edit.items[i].id==val?' selected="selected"':"")+">"+edit.items[i].text+"</option>";el.addClass("w2ui-editable").html('<select id="grid_'+obj.name+"_edit_"+recid+"_"+column+'" column="'+column+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+addStyle+edit.style+'"     field="'+col.field+'" recid="'+recid+'"     '+edit.inTag+">"+html+"</select>"+edit.outTag),setTimeout(function(){el.find("select").on("change",function(event){delete obj.last.move}).on("blur",function(event){1!=$(this).data("keep-open")&&obj.editChange.call(obj,this,index,column,event)})},10);break;case"div":var $tmp,font="font-family: "+($tmp=tr.find("[col="+column+"] > div")).css("font-family")+"; font-size: "+$tmp.css("font-size")+";";el.addClass("w2ui-editable").html('<div id="grid_'+obj.name+"_edit_"+recid+"_"+column+'" class="w2ui-input"    contenteditable style="'+font+addStyle+edit.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+col.field+'" recid="'+recid+'" column="'+column+'" '+edit.inTag+"></div>"+edit.outTag),null==value&&el.find("div.w2ui-input").text("object"!=typeof val?val:"");var input=el.find("div.w2ui-input").get(0);setTimeout(function(){var tmp=input;$(tmp).on("blur",function(event){1!=$(this).data("keep-open")&&obj.editChange.call(obj,tmp,index,column,event)})},10),null!=value&&$(input).text("object"!=typeof val?val:"");break;default:var $tmp,font="font-family: "+($tmp=tr.find("[col="+column+"] > div")).css("font-family")+"; font-size: "+$tmp.css("font-size");el.addClass("w2ui-editable").html('<input id="grid_'+obj.name+"_edit_"+recid+"_"+column+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+font+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+addStyle+edit.style+'"     field="'+col.field+'" recid="'+recid+'" column="'+column+'" class="w2ui-input"'+edit.inTag+"/>"+edit.outTag),"number"==edit.type&&(val=w2utils.formatNumber(val)),"date"==edit.type&&(val=w2utils.formatDate(w2utils.isDate(val,edit.format,!0),edit.format)),null==value&&el.find("input").val("object"!=typeof val?val:"");var input=el.find("input").get(0);$(input).w2field(edit.type,$.extend(edit,{selected:val})),setTimeout(function(){var tmp=input;"list"==edit.type&&(tmp=$($(input).data("w2field").helpers.focus).find("input"),"object"!=typeof val&&""!=val&&tmp.val(val).css({opacity:1}).prev().css({opacity:1}),el.find("input").on("change",function(event){obj.editChange.call(obj,input,index,column,event)})),$(tmp).on("blur",function(event){1!=$(this).data("keep-open")&&obj.editChange.call(obj,input,index,column,event)})},10),null!=value&&$(input).val("object"!=typeof val?val:"")}return void setTimeout(function(){el.find("input, select, div.w2ui-input").data("old_value",old_value).on("mousedown",function(event){event.stopPropagation()}).on("click",function(event){"div"==edit.type?expand.call(el.find("div.w2ui-input")[0],null):expand.call(el.find("input, select")[0],null)}).on("paste",function(event){var e=event.originalEvent;event.preventDefault();var text=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,text)}).on("keydown",function(event){var el=this,val="DIV"==el.tagName.toUpperCase()?$(el).text():$(el).val();switch(event.keyCode){case 8:"list"!=edit.type||$(input).data("w2field")||event.preventDefault();break;case 9:case 13:event.preventDefault();break;case 37:0===w2utils.getCursorPosition(el)&&event.preventDefault();break;case 39:w2utils.getCursorPosition(el)==val.length&&(w2utils.setCursorPosition(el,val.length),event.preventDefault())}setTimeout(function(){switch(event.keyCode){case 9:var next_rec=recid,next_col=event.shiftKey?obj.prevCell(index,column,!0):obj.nextCell(index,column,!0);if(null==next_col){var tmp=event.shiftKey?obj.prevRow(index,column):obj.nextRow(index,column);if(null!=tmp&&tmp!=index){next_rec=obj.records[tmp].recid;for(var c=0;c<obj.columns.length;c++){var edit=obj.getCellEditable(index,c);if(null!=edit&&-1==["checkbox","check"].indexOf(edit.type)&&(next_col=parseInt(c),!event.shiftKey))break}}}!1===next_rec&&(next_rec=recid),null==next_col&&(next_col=column),el.blur(),setTimeout(function(){"row"!=obj.selectType?(obj.selectNone(),obj.select({recid:next_rec,column:next_col})):obj.editField(next_rec,next_col,null,event)},1),event.preventDefault&&event.preventDefault();break;case 13:el.blur();var next=event.shiftKey?obj.prevRow(index,column):obj.nextRow(index,column);null!=next&&next!=index&&setTimeout(function(){"row"!=obj.selectType?(obj.selectNone(),obj.select({recid:obj.records[next].recid,column:column})):obj.editField(obj.records[next].recid,column,null,event)},1),"DIV"==el.tagName.toUpperCase()&&event.preventDefault();break;case 27:var old=obj.parseField(rec,col.field);rec.w2ui&&rec.w2ui.changes&&null!=rec.w2ui.changes[col.field]&&(old=rec.w2ui.changes[col.field]),null!=$(el).data("old_value")&&(old=$(el).data("old_value")),"DIV"==el.tagName.toUpperCase()?$(el).text(null!=old?old:""):el.value=null!=old?old:"",el.blur(),setTimeout(function(){obj.select({recid:recid,column:column})},1)}expand.call(el,event)},1)}).on("keyup",function(event){expand.call(this,event)}),setTimeout(function(){var tmp=el.find(".w2ui-input"),len=$(tmp).val().length;"div"==edit.type&&(len=$(tmp).text().length),tmp.length>0&&(tmp.focus(),clearTimeout(obj.last.kbd_timer),"SELECT"!=tmp[0].tagName&&w2utils.setCursorPosition(tmp[0],len),tmp[0].resize=expand,expand.call(tmp[0],null))},50),el.children().select(),obj.trigger($.extend(edata,{phase:"after",input:el.find("input, select, div.w2ui-input")}))},5)}}else console.log('ERROR: input types "enum" and "file" are not supported in inline editing.')}function expand(event){try{var val="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,$sel=$("#grid_"+obj.name+"_editable"),style="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",width=w2utils.getStrWidth(val,style);width+20>$sel.width()&&$sel.width(width+20)}catch(e){}}},editChange:function(el,index,column,event){var obj=this;setTimeout(function(){var $input=$(obj.box).find("#grid_"+obj.name+"_focus");$input.is(":focus")||$input.focus()},10);var summary=index<0;index=index<0?-index-1:index;var records,rec=(summary?this.summary:this.records)[index],col=this.columns[column],tr=$("#grid_"+this.name+(!0===col.frozen?"_frec_":"_rec_")+w2utils.escapeId(rec.recid)),new_val=el.tagName&&"DIV"==el.tagName.toUpperCase()?$(el).text():el.value,old_val=this.parseField(rec,col.field),tmp=$(el).data("w2field");tmp&&("list"==tmp.type&&(new_val=$(el).data("selected")),($.isEmptyObject(new_val)||null==new_val)&&(new_val=""),$.isPlainObject(new_val)||(new_val=tmp.clean(new_val))),"checkbox"==el.type&&(rec.w2ui&&!1===rec.w2ui.editable&&(el.checked=!el.checked),new_val=el.checked);var edata={phase:"before",type:"change",target:this.name,input_id:el.id,recid:rec.recid,index:index,column:column,originalEvent:event.originalEvent?event.originalEvent:event,value_new:new_val,value_previous:rec.w2ui&&rec.w2ui.changes&&rec.w2ui.changes.hasOwnProperty(col.field)?rec.w2ui.changes[col.field]:old_val,value_original:old_val};for(null!=$(event.target).data("old_value")&&(edata.value_previous=$(event.target).data("old_value"));;){if("object"!=typeof(new_val=edata.value_new)&&String(old_val)!=String(new_val)||"object"==typeof new_val&&new_val.id!=old_val&&("object"!=typeof old_val||null==old_val||new_val.id!=old_val.id)){if(!0!==(edata=this.trigger($.extend(edata,{type:"change",phase:"before"}))).isCancelled){if(new_val!==edata.value_new)continue;rec.w2ui=rec.w2ui||{},rec.w2ui.changes=rec.w2ui.changes||{},rec.w2ui.changes[col.field]=edata.value_new,this.trigger($.extend(edata,{phase:"after"}))}}else if(!0!==(edata=this.trigger($.extend(edata,{type:"restore",phase:"before"}))).isCancelled){if(new_val!==edata.value_new)continue;rec.w2ui&&rec.w2ui.changes&&delete rec.w2ui.changes[col.field],rec.w2ui&&$.isEmptyObject(rec.w2ui.changes)&&delete rec.w2ui.changes,this.trigger($.extend(edata,{phase:"after"}))}break}var cell=$(tr).find("[col="+column+"]");summary||(rec.w2ui&&rec.w2ui.changes&&null!=rec.w2ui.changes[col.field]?cell.addClass("w2ui-changed"):cell.removeClass("w2ui-changed"),cell.replaceWith(this.getCellHTML(index,column,summary))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))},delete:function(force){var time=(new Date).getTime(),obj=this,edata=this.trigger({phase:"before",target:this.name,type:"delete",force:force});if(!0!==edata.isCancelled){force=edata.force,setTimeout(function(){$().w2tag()},20);var recs=this.getSelection();if(0!==recs.length)if(""==this.msgDelete||force){var url;if(this.message(),"object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof recs[0])this.selectNone(),this.remove.apply(this,recs);else{for(var r=0;r<recs.length;r++){var fld=this.columns[recs[r].column].field,ind=this.get(recs[r].recid,!0),rec=this.records[ind];null!=ind&&"recid"!=fld&&(this.records[ind][fld]="",rec.w2ui&&rec.w2ui.changes&&delete rec.w2ui.changes[fld])}this.update()}this.trigger($.extend(edata,{phase:"after"}))}else this.message({width:350,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(obj.msgDelete)+"</div>",buttons:'<button class="w2ui-btn w2ui-btn-red" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang("Yes")+'</button><button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("No")+"</button>",onOpen:function(event){var inputs=$(this.box).find("input, textarea, select, button");inputs.off(".message").on("blur.message",function(evt){inputs.index(evt.target)+1===inputs.length&&(inputs.get(0).focus(),evt.preventDefault())}).on("keydown.message",function(evt){27==evt.keyCode&&obj.message()}),setTimeout(function(){$(this.box).find(".w2ui-btn:last-child").focus(),clearTimeout(obj.last.kbd_timer)},25)}})}},click:function(recid,event){var time=(new Date).getTime(),column=null,obj=this;if(!(1==this.last.cancelClick||event&&event.altKey))if("object"==typeof recid&&(column=recid.column,recid=recid.recid),null==event&&(event={}),time-parseInt(this.last.click_time)<350&&this.last.click_recid==recid&&"click"==event.type)this.dblClick(recid,event);else{this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=time;var last_recid=this.last.click_recid,tmp;if(this.last.click_recid=recid,null==column&&event.target)"TD"!=(tmp=event.target).tagName.toUpperCase()&&(tmp=$(tmp).parents("td")[0]),null!=$(tmp).attr("col")&&(column=parseInt($(tmp).attr("col")));var edata=this.trigger({phase:"before",target:this.name,type:"click",recid:recid,column:column,originalEvent:event});if(!0!==edata.isCancelled){var obj=this,sel=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var ind=this.get(recid,!0),record=this.records[ind],selectColumns=[];if(obj.last.sel_ind=ind,obj.last.sel_col=column,obj.last.sel_recid=recid,obj.last.sel_type="click",event.shiftKey&&sel.length>0&&obj.multiSelect){if(sel[0].recid){var start=this.get(sel[0].recid,!0),end=this.get(recid,!0);if(column>sel[0].column)var t1=sel[0].column,t2=column;else var t1=column,t2=sel[0].column;for(var c=t1;c<=t2;c++)selectColumns.push(c)}else var start=this.get(last_recid,!0),end=this.get(recid,!0);var sel_add=[];if(start>end){var tmp=start;start=end,end=tmp}for(var url="object"!=typeof this.url?this.url:this.url.get,i=start;i<=end;i++)if(!(this.searchData.length>0)||url||-1!=$.inArray(i,this.last.searchIds))if("row"==this.selectType)sel_add.push(this.records[i].recid);else for(var sc=0;sc<selectColumns.length;sc++)sel_add.push({recid:this.records[i].recid,column:selectColumns[sc]});this.select.apply(this,sel_add)}else{var last=this.last.selection,flag=-1!=last.indexes.indexOf(ind),fselect=!1;$(event.target).parents("td").hasClass("w2ui-col-select")&&(fselect=!0),(event.ctrlKey||event.shiftKey||event.metaKey||fselect)&&this.multiSelect||this.showSelectColumn?("row"!=this.selectType&&-1==$.inArray(column,last.columns[ind])&&(flag=!1),!0===flag?this.unselect({recid:recid,column:column}):this.select({recid:recid,column:column})):("row"!=this.selectType&&-1==$.inArray(column,last.columns[ind])&&(flag=!1),sel.length>300?this.selectNone():this.unselect.apply(this,sel),!0===flag&&1==sel.length?this.unselect({recid:recid,column:column}):this.select({recid:recid,column:column}))}this.status(),obj.initResize(),this.trigger($.extend(edata,{phase:"after"}))}}},columnClick:function(field,event){var edata;if(!0!==(edata=this.trigger({phase:"before",type:"columnClick",target:this.name,field:field,originalEvent:event})).isCancelled){var column;if("row"==this.selectType)(column=this.getColumn(field))&&column.sortable&&this.sort(field,null,!(!event||!event.ctrlKey&&!event.metaKey)),"line-number"==edata.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll());else if("line-number"==edata.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{event.shiftKey||event.metaKey||event.ctrlKey||this.selectNone();var tmp=this.getSelection(),column=this.getColumn(edata.field,!0),sel=[],cols=[],edata;if(0!=tmp.length&&event.shiftKey){var start=column,end=tmp[0].column;start>end&&(start=tmp[0].column,end=column);for(var i=start;i<=end;i++)cols.push(i)}else cols.push(column);if(!0!==(edata=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:cols})).isCancelled){for(var i=0;i<this.records.length;i++)sel.push({recid:this.records[i].recid,column:cols});this.select.apply(this,sel)}this.trigger($.extend(edata,{phase:"after"}))}this.trigger($.extend(edata,{phase:"after"}))}},columnDblClick:function(field,event){var edata=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:field,originalEvent:event});!0!==edata.isCancelled&&this.trigger($.extend(edata,{phase:"after"}))},focus:function(event){var obj=this,edata=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:event});if(!0===edata.isCancelled)return!1;this.hasFocus=!0,$(this.box).find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(function(){var $input=$(obj.box).find("#grid_"+obj.name+"_focus");$input.is(":focus")||$input.focus()},10),this.trigger($.extend(edata,{phase:"after"}))},blur:function(event){var edata=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:event});if(!0===edata.isCancelled)return!1;this.hasFocus=!1,$(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),this.trigger($.extend(edata,{phase:"after"}))},keydown:function(event){var obj=this,url="object"!=typeof this.url?this.url:this.url.get;if(!0===obj.keyboard){var edata=obj.trigger({phase:"before",type:"keydown",target:obj.name,originalEvent:event});if(!0!==edata.isCancelled)if($(this.box).find(">.w2ui-message").length>0)27==event.keyCode&&this.message();else{var empty=!1,records=$("#grid_"+obj.name+"_records"),sel=obj.getSelection();0===sel.length&&(empty=!0);var recid=sel[0]||null,columns=[],recid2=sel[sel.length-1];if("object"==typeof recid&&null!=recid){recid=sel[0].recid,columns=[];for(var ii=0;sel[ii]&&sel[ii].recid==recid;)columns.push(sel[ii].column),ii++;recid2=sel[sel.length-1].recid}var ind=obj.get(recid,!0),ind2=obj.get(recid2,!0),rec=obj.get(recid),recEL=$("#grid_"+obj.name+"_rec_"+(null!=ind?w2utils.escapeId(obj.records[ind].recid):"none")),cancel=!1,key=event.keyCode,shiftKey=event.shiftKey;switch(key){case 8:case 46:(this.show.toolbarDelete||this.onDelete)&&obj.delete(),cancel=!0,event.stopPropagation();break;case 27:obj.selectNone(),cancel=!0;break;case 65:if(!event.metaKey&&!event.ctrlKey)break;obj.selectAll(),cancel=!0;break;case 13:if("row"==this.selectType&&!0===obj.show.expandColumn){if(recEL.length<=0)break;obj.toggle(recid,event),cancel=!0}else{for(var c=0;c<this.columns.length;c++){var edit;if(this.getCellEditable(ind,c)){columns.push(parseInt(c));break}}"row"==this.selectType&&this.last.edit_col&&(columns=[this.last.edit_col]),columns.length>0&&(obj.editField(recid,columns[0],null,event),cancel=!0)}break;case 37:if(empty){selectTopRecord();break}if("row"==this.selectType){if(recEL.length<=0)break;var tmp;!(tmp=this.records[ind].w2ui||{})||null==tmp.parent_recid||Array.isArray(tmp.children)&&0!==tmp.children.length&&tmp.expanded?obj.collapse(recid,event):(obj.unselect(recid),obj.collapse(tmp.parent_recid,event),obj.select(tmp.parent_recid))}else{var prev=obj.prevCell(ind,columns[0]);if(shiftKey||null!=prev||(this.selectNone(),prev=0),null!=prev)if(shiftKey&&obj.multiSelect){if(tmpUnselect())return;var tmp=[],newSel=[],unSel=[];if(0===columns.indexOf(this.last.sel_col)&&columns.length>1){for(var i=0;i<sel.length;i++)-1==tmp.indexOf(sel[i].recid)&&tmp.push(sel[i].recid),unSel.push({recid:sel[i].recid,column:columns[columns.length-1]});obj.unselect.apply(obj,unSel),obj.scrollIntoView(ind,columns[columns.length-1],!0)}else{for(var i=0;i<sel.length;i++)-1==tmp.indexOf(sel[i].recid)&&tmp.push(sel[i].recid),newSel.push({recid:sel[i].recid,column:prev});obj.select.apply(obj,newSel),obj.scrollIntoView(ind,prev,!0)}}else event.metaKey=!1,obj.click({recid:recid,column:prev},event),obj.scrollIntoView(ind,prev,!0);else if(!shiftKey)if(sel.length>1)obj.selectNone();else for(var s=1;s<sel.length;s++)obj.unselect(sel[s])}cancel=!0;break;case 39:if(empty){selectTopRecord();break}if("row"==this.selectType){if(recEL.length<=0)break;obj.expand(recid,event)}else{var next=obj.nextCell(ind,columns[columns.length-1]);if(shiftKey||null!=next||(this.selectNone(),next=this.columns.length-1),null!=next)if(shiftKey&&39==key&&obj.multiSelect){if(tmpUnselect())return;var tmp=[],newSel=[],unSel=[];if(columns.indexOf(this.last.sel_col)==columns.length-1&&columns.length>1){for(var i=0;i<sel.length;i++)-1==tmp.indexOf(sel[i].recid)&&tmp.push(sel[i].recid),unSel.push({recid:sel[i].recid,column:columns[0]});obj.unselect.apply(obj,unSel),obj.scrollIntoView(ind,columns[0],!0)}else{for(var i=0;i<sel.length;i++)-1==tmp.indexOf(sel[i].recid)&&tmp.push(sel[i].recid),newSel.push({recid:sel[i].recid,column:next});obj.select.apply(obj,newSel),obj.scrollIntoView(ind,next,!0)}}else event.metaKey=!1,obj.click({recid:recid,column:next},event),obj.scrollIntoView(ind,next,!0);else if(!shiftKey)if(sel.length>1)obj.selectNone();else for(var s=0;s<sel.length-1;s++)obj.unselect(sel[s])}cancel=!0;break;case 38:if(empty&&selectTopRecord(),recEL.length<=0)break;var prev=obj.prevRow(ind,columns[0]);if(shiftKey||null!=prev||(prev=0==this.searchData.length||url?0:this.last.searchIds[0]),null!=prev){if(shiftKey&&obj.multiSelect){if(tmpUnselect())return;if("row"==obj.selectType)obj.last.sel_ind>prev&&obj.last.sel_ind!=ind2?obj.unselect(obj.records[ind2].recid):obj.select(obj.records[prev].recid);else if(obj.last.sel_ind>prev&&obj.last.sel_ind!=ind2){prev=ind2;for(var tmp=[],c=0;c<columns.length;c++)tmp.push({recid:obj.records[prev].recid,column:columns[c]});obj.unselect.apply(obj,tmp)}else{for(var tmp=[],c=0;c<columns.length;c++)tmp.push({recid:obj.records[prev].recid,column:columns[c]});obj.select.apply(obj,tmp)}}else sel.length>300?this.selectNone():this.unselect.apply(this,sel),obj.click({recid:obj.records[prev].recid,column:columns[0]},event);obj.scrollIntoView(prev),event.preventDefault&&event.preventDefault()}else if(!shiftKey)if(sel.length>1)obj.selectNone();else for(var s=1;s<sel.length;s++)obj.unselect(sel[s]);break;case 40:if(empty&&selectTopRecord(),recEL.length<=0)break;var next=obj.nextRow(ind2,columns[0]);if(shiftKey||null!=next||(next=0==this.searchData.length||url?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]),null!=next){if(shiftKey&&obj.multiSelect){if(tmpUnselect())return;if("row"==obj.selectType)this.last.sel_ind<next&&this.last.sel_ind!=ind?obj.unselect(obj.records[ind].recid):obj.select(obj.records[next].recid);else if(this.last.sel_ind<next&&this.last.sel_ind!=ind){next=ind;for(var tmp=[],c=0;c<columns.length;c++)tmp.push({recid:obj.records[next].recid,column:columns[c]});obj.unselect.apply(obj,tmp)}else{for(var tmp=[],c=0;c<columns.length;c++)tmp.push({recid:obj.records[next].recid,column:columns[c]});obj.select.apply(obj,tmp)}}else sel.length>300?this.selectNone():this.unselect.apply(this,sel),obj.click({recid:obj.records[next].recid,column:columns[0]},event);obj.scrollIntoView(next),cancel=!0}else if(!shiftKey)if(sel.length>1)obj.selectNone();else for(var s=0;s<sel.length-1;s++)obj.unselect(sel[s]);break;case 17:case 91:if(empty)break;obj.last.isSafari&&(obj.last.copy_event=obj.copy(!1,event),$("#grid_"+obj.name+"_focus").val(obj.last.copy_event.text).select());break;case 67:(event.metaKey||event.ctrlKey)&&(obj.last.isSafari?obj.copy(obj.last.copy_event,event):(obj.last.copy_event=obj.copy(!1,event),$("#grid_"+obj.name+"_focus").val(obj.last.copy_event.text).select(),obj.copy(obj.last.copy_event,event)));break;case 88:if(empty)break;(event.ctrlKey||event.metaKey)&&(obj.last.isSafari?obj.copy(obj.last.copy_event,event):(obj.last.copy_event=obj.copy(!1,event),$("#grid_"+obj.name+"_focus").val(obj.last.copy_event.text).select(),obj.copy(obj.last.copy_event,event)),setTimeout(function(){obj.delete(!0)},100))}for(var tmp=[32,187,189,192,219,220,221,186,222,188,190,191],i=48;i<=111;i++)tmp.push(i);-1==tmp.indexOf(key)||event.ctrlKey||event.metaKey||cancel||(0===columns.length&&columns.push(0),cancel=!1,setTimeout(function(){var focus=$("#grid_"+obj.name+"_focus"),key=focus.val();focus.val(""),obj.editField(recid,columns[0],key,event)},1)),cancel&&event.preventDefault&&event.preventDefault(),obj.trigger($.extend(edata,{phase:"after"}))}}function selectTopRecord(){var ind=Math.floor(records[0].scrollTop/obj.recordHeight)+1;(!obj.records[ind]||ind<2)&&(ind=0),obj.select({recid:obj.records[ind].recid,column:0})}function tmpUnselect(){if("click"!=obj.last.sel_type)return!1;if("row"!=obj.selectType){if(obj.last.sel_type="key",sel.length>1){for(var s=0;s<sel.length;s++)if(sel[s].recid==obj.last.sel_recid&&sel[s].column==obj.last.sel_col){sel.splice(s,1);break}return obj.unselect.apply(obj,sel),!0}return!1}return obj.last.sel_type="key",sel.length>1&&(sel.splice(sel.indexOf(obj.records[obj.last.sel_ind].recid),1),obj.unselect.apply(obj,sel),!0)}},scrollIntoView:function(ind,column,instant){var buffered=this.records.length;if(0==this.searchData.length||this.url||(buffered=this.last.searchIds.length),0!==buffered){if(null==ind){var sel=this.getSelection();if(0===sel.length)return;$.isPlainObject(sel[0])?(ind=sel[0].index,column=sel[0].column):ind=this.get(sel[0],!0)}var records=$("#grid_"+this.name+"_records"),len=this.last.searchIds.length;if(len>0&&(ind=this.last.searchIds.indexOf(ind)),records.height()<this.recordHeight*(len>0?len:buffered)&&records.length>0){var t1=Math.floor(records[0].scrollTop/this.recordHeight),t2=t1+Math.floor(records.height()/this.recordHeight);ind==t1&&(!0===instant?records.prop({scrollTop:records.scrollTop()-records.height()/1.3}):(records.stop(),records.animate({scrollTop:records.scrollTop()-records.height()/1.3},250,"linear"))),ind==t2&&(!0===instant?records.prop({scrollTop:records.scrollTop()+records.height()/1.3}):(records.stop(),records.animate({scrollTop:records.scrollTop()+records.height()/1.3},250,"linear"))),(ind<t1||ind>t2)&&(!0===instant?records.prop({scrollTop:(ind-1)*this.recordHeight}):(records.stop(),records.animate({scrollTop:(ind-1)*this.recordHeight},250,"linear")))}if(null!=column){for(var x1=0,x2=0,sb=w2utils.scrollBarSize(),i=0;i<=column;i++){var col=this.columns[i];col.frozen||col.hidden||(x1=x2,x2+=parseInt(col.sizeCalculated))}records.width()<x2-records.scrollLeft()?!0===instant?records.prop({scrollLeft:x1-sb}):records.animate({scrollLeft:x1-sb},250,"linear"):x1<records.scrollLeft()&&(!0===instant?records.prop({scrollLeft:x2-records.width()+2*sb}):records.animate({scrollLeft:x2-records.width()+2*sb},250,"linear"))}}},dblClick:function(recid,event){var column=null;if("object"==typeof recid&&(column=recid.column,recid=recid.recid),null==event&&(event={}),null==column&&event.target){var tmp=event.target;"TD"!=tmp.tagName.toUpperCase()&&(tmp=$(tmp).parents("td")[0]),column=parseInt($(tmp).attr("col"))}var index=this.get(recid,!0),rec=this.records[index],edata=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:recid,column:column,originalEvent:event}),edit;!0!==edata.isCancelled&&(this.selectNone(),this.getCellEditable(index,column)?this.editField(recid,column,null,event):(this.select({recid:recid,column:column}),(this.show.expandColumn||rec.w2ui&&Array.isArray(rec.w2ui.children))&&this.toggle(recid)),this.trigger($.extend(edata,{phase:"after"})))},contextMenu:function(recid,column,event){var obj=this;if("text"!=obj.last.userSelect){null==event&&(event={offsetX:0,offsetY:0,target:$("#grid_"+obj.name+"_rec_"+recid)[0]}),null==event.offsetX&&(event.offsetX=event.layerX-event.target.offsetLeft,event.offsetY=event.layerY-event.target.offsetTop),w2utils.isFloat(recid)&&(recid=parseFloat(recid));var sel=this.getSelection();if("row"==this.selectType)-1==sel.indexOf(recid)&&obj.click(recid);else{var $tmp=$(event.target);"TD"!=$tmp[0].tagName.toUpperCase()&&($tmp=$(event.target).parents("td"));var selected=!1;column=$tmp.attr("col");for(var i=0;i<sel.length;i++)sel[i].recid!=recid&&sel[i].column!=column||(selected=!0);selected||null==recid||obj.click({recid:recid,column:column}),selected||null==column||obj.columnClick(this.columns[column].field,event)}var edata=obj.trigger({phase:"before",type:"contextMenu",target:obj.name,originalEvent:event,recid:recid,column:column});!0!==edata.isCancelled&&(obj.menu.length>0&&$(obj.box).find(event.target).w2menu(obj.menu,{originalEvent:event,contextMenu:!0,onSelect:function(event){obj.menuClick(recid,parseInt(event.index),event.originalEvent)}}),event.preventDefault&&event.preventDefault(),obj.trigger($.extend(edata,{phase:"after"})))}},menuClick:function(recid,index,event){var obj=this,edata=obj.trigger({phase:"before",type:"menuClick",target:obj.name,originalEvent:event,recid:recid,menuIndex:index,menuItem:obj.menu[index]});!0!==edata.isCancelled&&obj.trigger($.extend(edata,{phase:"after"}))},toggle:function(recid){var rec=this.get(recid);return rec.w2ui=rec.w2ui||{},!0===rec.w2ui.expanded?this.collapse(recid):this.expand(recid)},expand:function(recid){var obj=this,ind=this.get(recid,!0),rec=this.records[ind];rec.w2ui=rec.w2ui||{};var id=w2utils.escapeId(recid),children=rec.w2ui.children;if(Array.isArray(children)){if(!0===rec.w2ui.expanded||0===children.length)return!1;var edata,url;if(!0===(edata=this.trigger({phase:"before",type:"expand",target:this.name,recid:recid})).isCancelled)return!1;rec.w2ui.expanded=!0,children.forEach(function(child){child.w2ui=child.w2ui||{},child.w2ui.parent_recid=rec.recid,null==child.w2ui.children&&(child.w2ui.children=[])}),this.records.splice.apply(this.records,[ind+1,0].concat(children)),this.total+=children.length,("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(edata,{phase:"after"}))}else{if($("#grid_"+this.name+"_rec_"+id+"_expanded_row").length>0||!0!==this.show.expandColumn)return!1;if("none"==rec.w2ui.expanded)return!1;var edata;if($("#grid_"+this.name+"_rec_"+id).after('<tr id="grid_'+this.name+"_rec_"+recid+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+recid+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),$("#grid_"+this.name+"_frec_"+id).after('<tr id="grid_'+this.name+"_frec_"+recid+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+recid+'_expanded"></div>   </td></tr>'),!0===(edata=this.trigger({phase:"before",type:"expand",target:this.name,recid:recid,box_id:"grid_"+this.name+"_rec_"+recid+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+id+"_expanded"})).isCancelled)return $("#grid_"+this.name+"_rec_"+id+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+id+"_expanded_row").remove(),!1;var row1=$(this.box).find("#grid_"+this.name+"_rec_"+recid+"_expanded"),row2=$(this.box).find("#grid_"+this.name+"_frec_"+recid+"_expanded"),innerHeight=row1.find("> div:first-child").height();row1.height()<innerHeight&&row1.css({height:innerHeight+"px"}),row2.height()<innerHeight&&row2.css({height:innerHeight+"px"}),$("#grid_"+this.name+"_rec_"+id).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+id).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(recid,!0)+"_expand div").html("-"),rec.w2ui.expanded=!0,this.trigger($.extend(edata,{phase:"after"})),this.resizeRecords()}return!0},collapse:function(recid){var obj=this,ind=this.get(recid,!0),rec=this.records[ind];rec.w2ui=rec.w2ui||{};var id=w2utils.escapeId(recid),children=rec.w2ui.children;if(Array.isArray(children)){if(!0!==rec.w2ui.expanded)return!1;var edata,url;if(!0===(edata=this.trigger({phase:"before",type:"collapse",target:this.name,recid:recid})).isCancelled)return!1;clearExpanded(rec);for(var stops=[],r=rec;null!=r;r=this.get(r.w2ui.parent_recid))stops.push(r.w2ui.parent_recid);for(var start=ind+1,end=start;!(this.records.length<=end+1||null==this.records[end+1].w2ui||stops.indexOf(this.records[end+1].w2ui.parent_recid)>=0);)end++;this.records.splice(start,end-start+1),this.total-=end-start+1,("object"!=typeof this.url?this.url:this.url.get)||this.searchData.length>0&&this.localSearch(!0),this.refresh(),obj.trigger($.extend(edata,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+id+"_expanded_row").length||!0!==this.show.expandColumn)return!1;var edata;if(!0===(edata=this.trigger({phase:"before",type:"collapse",target:this.name,recid:recid,box_id:"grid_"+this.name+"_rec_"+id+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+id+"_expanded"})).isCancelled)return!1;$("#grid_"+this.name+"_rec_"+id).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+id).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(recid,!0)+"_expand div").html("+"),$("#grid_"+obj.name+"_rec_"+id+"_expanded").css("height","0px"),$("#grid_"+obj.name+"_frec_"+id+"_expanded").css("height","0px"),setTimeout(function(){$("#grid_"+obj.name+"_rec_"+id+"_expanded_row").remove(),$("#grid_"+obj.name+"_frec_"+id+"_expanded_row").remove(),rec.w2ui.expanded=!1,obj.trigger($.extend(edata,{phase:"after"})),obj.resizeRecords()},300)}return!0;function clearExpanded(rec){rec.w2ui.expanded=!1;for(var i=0;i<rec.w2ui.children.length;i++){var subRec=rec.w2ui.children[i];subRec.w2ui.expanded&&clearExpanded(subRec)}}},sort:function(field,direction,multiField){var edata=this.trigger({phase:"before",type:"sort",target:this.name,field:field,direction:direction,multiField:multiField});if(!0!==edata.isCancelled){if(null!=field){for(var sortIndex=this.sortData.length,s=0;s<this.sortData.length;s++)if(this.sortData[s].field==field){sortIndex=s;break}if(null==direction)if(null==this.sortData[sortIndex])direction="asc";else switch(String(this.sortData[sortIndex].direction)){case"asc":direction="desc";break;case"desc":default:direction="asc"}!1===this.multiSort&&(this.sortData=[],sortIndex=0),1!=multiField&&(this.sortData=[],sortIndex=0),null==this.sortData[sortIndex]&&(this.sortData[sortIndex]={}),this.sortData[sortIndex].field=field,this.sortData[sortIndex].direction=direction}else this.sortData=[];var url;("object"!=typeof this.url?this.url:this.url.get)?(this.trigger($.extend(edata,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(edata,{phase:"after"})),this.refresh())}},copy:function(flag,oEvent){if($.isPlainObject(flag))return this.trigger($.extend(flag,{phase:"after"})),flag.text;var sel=this.getSelection();if(0===sel.length)return"";var text="",edata,edata;if("object"==typeof sel[0]){for(var minCol=sel[0].column,maxCol=sel[0].column,recs=[],s=0;s<sel.length;s++)sel[s].column<minCol&&(minCol=sel[s].column),sel[s].column>maxCol&&(maxCol=sel[s].column),-1==recs.indexOf(sel[s].index)&&recs.push(sel[s].index);recs.sort(function(a,b){return a-b});for(var r=0;r<recs.length;r++){for(var ind=recs[r],c=minCol;c<=maxCol;c++){var col;!0!==(col=this.columns[c]).hidden&&(text+=w2utils.stripTags(this.getCellHTML(ind,c))+"\t")}text=text.substr(0,text.length-1),text+="\n"}}else{for(var c=0;c<this.columns.length;c++){var col;if(!0!==(col=this.columns[c]).hidden){var colName=col.caption?col.caption:col.field;col.caption&&col.caption.length<3&&col.tooltip&&(colName=col.tooltip),text+='"'+w2utils.stripTags(colName)+'"\t'}}text=text.substr(0,text.length-1),text+="\n";for(var s=0;s<sel.length;s++){for(var ind=this.get(sel[s],!0),c=0;c<this.columns.length;c++){var col;!0!==(col=this.columns[c]).hidden&&(text+='"'+w2utils.stripTags(this.getCellHTML(ind,c))+'"\t')}text=text.substr(0,text.length-1),text+="\n"}}return text=text.substr(0,text.length-1),null==flag?!0===(edata=this.trigger({phase:"before",type:"copy",target:this.name,text:text,originalEvent:oEvent})).isCancelled?"":(text=edata.text,this.trigger($.extend(edata,{phase:"after"})),text):!1===flag?!0===(edata=this.trigger({phase:"before",type:"copy",target:this.name,text:text,originalEvent:oEvent})).isCancelled?"":(text=edata.text,edata):void 0},paste:function(text){var sel=this.getSelection(),ind=this.get(sel[0].recid,!0),col=sel[0].column,edata=this.trigger({phase:"before",type:"paste",target:this.name,text:text,index:ind,column:col});if(!0!==edata.isCancelled){if(text=edata.text,"row"==this.selectType||0===sel.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(edata,{phase:"after"}));for(var newSel=[],text=text.split("\n"),t=0;t<text.length;t++){var tmp=text[t].split("\t"),cnt=0,rec=this.records[ind],cols=[];if(null!=rec){for(var dt=0;dt<tmp.length;dt++)if(this.columns[col+cnt]){var field=this.columns[col+cnt].field;rec.w2ui=rec.w2ui||{},rec.w2ui.changes=rec.w2ui.changes||{},rec.w2ui.changes[field]=tmp[dt],cols.push(col+cnt),cnt++}for(var c=0;c<cols.length;c++)newSel.push({recid:rec.recid,column:cols[c]});ind++}}this.selectNone(),this.select.apply(this,newSel),this.refresh(),this.trigger($.extend(edata,{phase:"after"}))}},resize:function(){var obj=this,time=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());var edata=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==edata.isCancelled)return obj.resizeBoxes(),obj.resizeRecords(),obj.toolbar&&obj.toolbar.resize&&obj.toolbar.resize(),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},update:function(cells){var time=(new Date).getTime();if(null==this.box)return 0;if(null==cells){for(var index=this.last.range_start-1;index<=this.last.range_end-1;index++)if(!(index<0)){var rec;(rec=this.records[index]||{}).w2ui||(rec.w2ui={});for(var column=0;column<this.columns.length;column++){var row=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(rec.recid)),cell;(cell=$(this.box).find("#grid_"+this.name+"_data_"+index+"_"+column)).replaceWith(this.getCellHTML(index,column,!1)),cell=$(this.box).find("#grid_"+this.name+"_data_"+index+"_"+column),null==rec.w2ui.style||$.isEmptyObject(rec.w2ui.style)?cell.attr("style",""):("string"==typeof rec.w2ui.style&&row.attr("style",rec.w2ui.style),$.isPlainObject(rec.w2ui.style)&&"string"==typeof rec.w2ui.style[column]&&cell.attr("style",rec.w2ui.style[column])),null==rec.w2ui.class||$.isEmptyObject(rec.w2ui.class)||("string"==typeof rec.w2ui.class&&row.addClass(rec.w2ui.class),$.isPlainObject(rec.w2ui.class)&&"string"==typeof rec.w2ui.class[column]&&cell.addClass(rec.w2ui.class[column]))}}}else for(var i=0;i<cells.length;i++){var index=cells[i].index,column=cells[i].column;if(!(index<0))if(null!=index&&null!=column){var rec=this.records[index]||{},row=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(rec.recid)),cell=$(this.box).find("#grid_"+this.name+"_data_"+index+"_"+column);rec.w2ui||(rec.w2ui={}),cell.replaceWith(this.getCellHTML(index,column,!1)),cell=$(this.box).find("#grid_"+this.name+"_data_"+index+"_"+column),null==rec.w2ui.style||$.isEmptyObject(rec.w2ui.style)?cell.attr("style",""):("string"==typeof rec.w2ui.style&&row.attr("style",rec.w2ui.style),$.isPlainObject(rec.w2ui.style)&&"string"==typeof rec.w2ui.style[column]&&cell.attr("style",rec.w2ui.style[column])),null==rec.w2ui.class||$.isEmptyObject(rec.w2ui.class)||("string"==typeof rec.w2ui.class&&row.addClass(rec.w2ui.class),$.isPlainObject(rec.w2ui.class)&&"string"==typeof rec.w2ui.class[column]&&cell.addClass(rec.w2ui.class[column]))}else console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]")}return(new Date).getTime()-time},refreshCell:function(recid,field){var index=this.get(recid,!0),isSummary=!this.records[index]||this.records[index].recid!=recid,col_ind=this.getColumn(field,!0),rec=isSummary?this.summary[index]:this.records[index],col=this.columns[col_ind],cell=$(this.box).find("#grid_"+this.name+"_data_"+index+"_"+col_ind);if(null==rec)return!1;cell.replaceWith(this.getCellHTML(index,col_ind,isSummary)),cell=$(this.box).find("#grid_"+this.name+"_data_"+index+"_"+col_ind),rec.w2ui&&rec.w2ui.changes&&null!=rec.w2ui.changes[col.field]?cell.addClass("w2ui-changed"):cell.removeClass("w2ui-changed"),rec.w2ui&&null!=rec.w2ui.style&&!$.isEmptyObject(rec.w2ui.style)?("string"==typeof rec.w2ui.style&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(rec.recid)).attr("style",rec.w2ui.style),$.isPlainObject(rec.w2ui.style)&&"string"==typeof rec.w2ui.style[col_ind]&&cell.attr("style",rec.w2ui.style[col_ind])):cell.attr("style",""),rec.w2ui&&null!=rec.w2ui.class&&!$.isEmptyObject(rec.w2ui.class)&&("string"==typeof rec.w2ui.class&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(rec.recid)).addClass(rec.w2ui.class),$.isPlainObject(rec.w2ui.class)&&"string"==typeof rec.w2ui.class[col_ind]&&cell.addClass(rec.w2ui.class[col_ind]))},refreshRow:function(recid,ind){var tr1=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)),tr2=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(recid));if(tr1.length>0){null==ind&&(ind=this.get(recid,!0));var line=tr1.attr("line"),isSummary=!this.records[ind]||this.records[ind].recid!=recid,url="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!url)for(var s=0;s<this.last.searchIds.length;s++)this.last.searchIds[s]==ind&&(ind=s);var rec_html=this.getRecordHTML(ind,line,isSummary);$(tr1).replaceWith(rec_html[0]),$(tr2).replaceWith(rec_html[1]);var st=this.records[ind].w2ui?this.records[ind].w2ui.style:"";if("string"==typeof st){var tr1=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(recid)),tr2=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(recid));tr1.attr("custom_style",st),tr2.attr("custom_style",st),tr1.hasClass("w2ui-selected")&&(st=st.replace("background-color","none")),tr1[0].style.cssText="height: "+this.recordHeight+"px;"+st,tr2[0].style.cssText="height: "+this.recordHeight+"px;"+st}isSummary&&this.resize()}},refresh:function(){var obj=this,time=(new Date).getTime(),url="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!url&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),this.box){var edata=this.trigger({phase:"before",target:this.name,type:"refresh"});if(!0!==edata.isCancelled){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&#160;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)for(var tmp=this.toolbar.items,t=0;t<tmp.length;t++)"w2ui-search"!=tmp[t].id&&"break"!=tmp[t].type&&this.toolbar.refresh(tmp[t].id)}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var el=$("#grid_"+obj.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var s=0;s<this.searches.length;s++)this.searches[s].field==this.last.field&&(this.last.caption=this.searches[s].caption);if(this.last.multi?(el.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),el.w2field("clear")):el.attr("placeholder",w2utils.lang(this.last.caption)),el.val()!=this.last.search){var val=this.last.search,tmp;(tmp=el.data("w2field"))&&(val=tmp.format(val)),el.val(val)}obj.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();var $clear=$("#grid_"+this.name+"_searchClear");$clear.hide(),this.searchData.some(function(item){var tmp=obj.getSearch(item.field);if(obj.last.multi||tmp&&!tmp.hidden&&"list"!=tmp.type)return $clear.show(),!0});var sel=this.last.selection,areAllSelected=this.records.length>0&&sel.indexes.length==this.records.length,areAllSearchedSelected=sel.indexes.length>0&&0!==this.searchData.length&&sel.indexes.length==this.last.searchIds.length;areAllSelected||areAllSearchedSelected?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();for(var rows=obj.find({"w2ui.expanded":!0},!0),r=0;r<rows.length;r++){var tmp;(tmp=obj.records[rows[r]].w2ui)&&!Array.isArray(tmp.children)&&(tmp.expanded=!1)}return obj.markSearch&&setTimeout(function(){for(var str=[],s=0;s<obj.searchData.length;s++){var sdata=obj.searchData[s],fld=obj.getSearch(sdata.field);fld&&!fld.hidden&&(-1==str.indexOf(sdata.value)&&str.push(sdata.value))}str.length>0&&$(obj.box).find(".w2ui-grid-data > div").w2marker(str)},50),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(edata,{phase:"after"})),obj.resize(),obj.addRange("selection"),setTimeout(function(){obj.resize(),obj.scroll()},1),obj.reorderColumns&&!obj.last.columnDrag?obj.last.columnDrag=obj.initColumnDrag():!obj.reorderColumns&&obj.last.columnDrag&&obj.last.columnDrag.remove(),(new Date).getTime()-time}}},refreshBody:function(){var tmp=this.find({"w2ui.summary":!0},!0);if(tmp.length>0){for(var t=0;t<tmp.length;t++)this.summary.push(this.records[tmp[t]]);for(var t=tmp.length-1;t>=0;t--)this.records.splice(tmp[t],1)}this.scroll();var recHTML=this.getRecordsHTML(),colHTML=this.getColumnsHTML(),bodyHTML='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+recHTML[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+recHTML[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+colHTML[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+colHTML[1]+"</tbody></table></div>";if($("#grid_"+this.name+"_body").html(bodyHTML),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):$("#grid_"+this.name+"_empty_msg").length>0&&$("#grid_"+this.name+"_empty_msg").remove(),this.summary.length>0){var sumHTML=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(sumHTML[0]).show(),$("#grid_"+this.name+"_summary").html(sumHTML[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()},render:function(box){var obj=this,time=(new Date).getTime();if(null!=box&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=box),this.box){var url="object"!=typeof this.url?this.url:this.url.get,edata=this.trigger({phase:"before",target:this.name,type:"render",box:box});if(!0!==edata.isCancelled){if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var tmp=0;tmp<this.searches.length&&(this.searches[tmp].hidden||!1===this.searches[tmp].simple);)tmp++;tmp>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[tmp].field,this.last.caption=this.searches[tmp].caption)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input"></textarea></div>'),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var sd=this.searchData;setTimeout(function(){obj.initAllField(obj.last.field,1==sd.length?sd[0].value:null)},1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),url&&this.refresh();for(var hasHiddenSearches=!1,i=0,edataCol;i<this.searches.length;i++)if(this.searches[i].hidden){hasHiddenSearches=!0;break}return hasHiddenSearches?(this.searchReset(!1),url||setTimeout(function(){obj.searchReset()},1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",function(event){clearTimeout(obj.last.kbd_timer),obj.hasFocus||obj.focus()}).on("blur",function(event){clearTimeout(obj.last.kbd_timer),obj.last.kbd_timer=setTimeout(function(){obj.hasFocus&&obj.blur()},100)}).on("paste",function(event){var el=this;setTimeout(function(){w2ui[obj.name].paste(el.value),el.value=""},1)}).on("keydown",function(event){w2ui[obj.name].keydown.call(w2ui[obj.name],event)}),$(this.box).on("mousedown",mouseStart),this.trigger($.extend(edata,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+this.name).on("resize.w2ui-"+this.name,function(event){w2ui[obj.name].resize()}),(new Date).getTime()-time}}function mouseStart(event){if(1==event.which&&("text"==obj.last.userSelect&&(delete obj.last.userSelect,$(obj.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),!("row"==obj.selectType&&($(event.target).parents().hasClass("w2ui-head")||$(event.target).hasClass("w2ui-head"))||obj.last.move&&"expand"==obj.last.move.type))){if(event.altKey)$(obj.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),obj.selectNone(),obj.last.move={type:"text-select"},obj.last.userSelect="text";else if(obj.multiSelect||obj.reorderRows){for(var tmp=event.target,pos={x:event.offsetX-10,y:event.offsetY-10},tmps=!1;tmp&&(!tmp.classList||!tmp.classList.contains("w2ui-grid"));)tmp.tagName&&"TD"==tmp.tagName.toUpperCase()&&(tmps=!0),tmp.tagName&&"TR"!=tmp.tagName.toUpperCase()&&1==tmps&&(pos.x+=tmp.offsetLeft,pos.y+=tmp.offsetTop),tmp=tmp.parentNode;obj.last.move={x:event.screenX,y:event.screenY,divX:0,divY:0,focusX:pos.x,focusY:pos.y,recid:$(event.target).parents("tr").attr("recid"),column:parseInt("TD"==event.target.tagName.toUpperCase()?$(event.target).attr("col"):$(event.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==obj.last.move.recid&&(obj.last.move.type="select-column");var target=event.target,$input=$(obj.box).find("#grid_"+obj.name+"_focus");if(obj.last.move){var sLeft=obj.last.move.focusX,sTop=obj.last.move.focusY,$owner=$(target).parents("table").parent();($owner.hasClass("w2ui-grid-records")||$owner.hasClass("w2ui-grid-frecords")||$owner.hasClass("w2ui-grid-columns")||$owner.hasClass("w2ui-grid-fcolumns")||$owner.hasClass("w2ui-grid-summary"))&&(sLeft=obj.last.move.focusX-$(obj.box).find("#grid_"+obj.name+"_records").scrollLeft(),sTop=obj.last.move.focusY-$(obj.box).find("#grid_"+obj.name+"_records").scrollTop()),($(target).hasClass("w2ui-grid-footer")||$(target).parents("div.w2ui-grid-footer").length>0)&&(sTop=$(obj.box).find("#grid_"+obj.name+"_footer").position().top),$input.css({left:sLeft-10,top:sTop})}setTimeout(function(){-1!=["INPUT","TEXTAREA","SELECT"].indexOf(target.tagName.toUpperCase())?$(target).focus():$input.is(":focus")||$input.focus()},50)}if(1==obj.reorderRows){var el=event.target;if("TD"!=el.tagName.toUpperCase()&&(el=$(el).parents("td")[0]),$(el).hasClass("w2ui-col-number")){obj.selectNone(),obj.last.move.reorder=!0;var eColor=$(obj.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),oColor=$(obj.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(obj.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",eColor),$(obj.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",oColor);var mv=obj.last.move;if(!mv.ghost){var row=$("#grid_"+obj.name+"_rec_"+mv.recid),tmp=row.parents("table").find("tr:first-child").clone(),recs;mv.offsetY=event.offsetY,mv.from=mv.recid,mv.pos=row.position(),mv.ghost=$(row).clone(!0),mv.ghost.removeAttr("id"),row.find("td").remove(),row.append('<td colspan="1000" style="height: '+obj.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></td>'),(recs=$(obj.box).find(".w2ui-grid-records")).append('<table id="grid_'+obj.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.7; pointer-events: none;"></table>'),$("#grid_"+obj.name+"_ghost").append(tmp).append(mv.ghost)}var ghost=$("#grid_"+obj.name+"_ghost"),recs=$(obj.box).find(".w2ui-grid-records");ghost.css({top:mv.pos.top+recs.scrollTop(),left:mv.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else obj.last.move.reorder=!1}$(document).on("mousemove",mouseMove),$(document).on("mouseup",mouseStop),event.stopPropagation()}}function mouseMove(event){var mv=obj.last.move;if(mv&&-1!=["select","select-column"].indexOf(mv.type)&&(mv.divX=event.screenX-mv.x,mv.divY=event.screenY-mv.y,!(Math.abs(mv.divX)<=1&&Math.abs(mv.divY)<=1)))if(obj.last.cancelClick=!0,1==obj.reorderRows&&obj.last.move.reorder){var tmp,recid;if((recid=(tmp=$(event.target).parents("tr")).attr("recid"))!=mv.from){var row1=$("#grid_"+obj.name+"_rec_"+mv.recid),row2=$("#grid_"+obj.name+"_rec_"+recid);$(obj.box).find(".tmp-ghost").css("border-top","0px"),row2.addClass("tmp-ghost").css("border-top","2px solid #769EFC"),mv.lastY=event.screenY,mv.to=recid}var ghost=$("#grid_"+obj.name+"_ghost"),recs=$(obj.box).find(".w2ui-grid-records");ghost.css({top:mv.pos.top+mv.divY+recs.scrollTop(),left:mv.pos.left})}else{mv.start&&mv.recid&&(obj.selectNone(),mv.start=!1);var newSel=[],recid;if(null==(recid="TR"==event.target.tagName.toUpperCase()?$(event.target).attr("recid"):$(event.target).parents("tr").attr("recid"))){if("row"==obj.selectType)return;if(obj.last.move&&"select"==obj.last.move.type)return;var col=parseInt($(event.target).parents("td").attr("col"));if(isNaN(col))obj.removeRange("column-selection"),$(obj.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(obj.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete mv.colRange;else{var newRange=col+"-"+col;mv.column<col&&(newRange=mv.column+"-"+col),mv.column>col&&(newRange=col+"-"+mv.column);for(var cols=[],tmp=newRange.split("-"),ii=parseInt(tmp[0]);ii<=parseInt(tmp[1]);ii++)cols.push(ii);if(mv.colRange!=newRange&&!0!==(edataCol=obj.trigger({phase:"before",type:"columnSelect",target:obj.name,columns:cols,isCancelled:!1})).isCancelled){null==mv.colRange&&obj.selectNone();var tmp=newRange.split("-");$(obj.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(var j=parseInt(tmp[0]);j<=parseInt(tmp[1]);j++)$(obj.box).find("#grid_"+obj.name+"_column_"+j+" .w2ui-col-header").addClass("w2ui-col-selected");$(obj.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),mv.colRange=newRange,obj.removeRange("column-selection"),obj.addRange({name:"column-selection",range:[{recid:obj.records[0].recid,column:tmp[0]},{recid:obj.records[obj.records.length-1].recid,column:tmp[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var ind1=obj.get(mv.recid,!0);if(null==ind1||obj.records[ind1]&&obj.records[ind1].recid!=mv.recid)return;var ind2=obj.get(recid,!0);if(null==ind2)return;var col1=parseInt(mv.column),col2=parseInt("TD"==event.target.tagName.toUpperCase()?$(event.target).attr("col"):$(event.target).parents("td").attr("col"));if(isNaN(col1)&&isNaN(col2)&&(col1=0,col2=obj.columns.length-1),ind1>ind2){var tmp=ind1;ind1=ind2,ind2=tmp}var tmp="ind1:"+ind1+",ind2;"+ind2+",col1:"+col1+",col2:"+col2;if(mv.range==tmp)return;mv.range=tmp;for(var i=ind1;i<=ind2;i++)if(!(obj.last.searchIds.length>0&&-1==obj.last.searchIds.indexOf(i)))if("row"!=obj.selectType){if(col1>col2){var tmp=col1;col1=col2,col2=tmp}for(var tmp=[],c=col1;c<=col2;c++)obj.columns[c].hidden||newSel.push({recid:obj.records[i].recid,column:parseInt(c)})}else newSel.push(obj.records[i].recid);if("row"!=obj.selectType){for(var sel=obj.getSelection(),tmp=[],ns=0;ns<newSel.length;ns++){for(var flag=!1,s=0;s<sel.length;s++)newSel[ns].recid==sel[s].recid&&newSel[ns].column==sel[s].column&&(flag=!0);flag||tmp.push({recid:newSel[ns].recid,column:newSel[ns].column})}obj.select.apply(obj,tmp);for(var tmp=[],s=0;s<sel.length;s++){for(var flag=!1,ns=0;ns<newSel.length;ns++)newSel[ns].recid==sel[s].recid&&newSel[ns].column==sel[s].column&&(flag=!0);flag||tmp.push({recid:sel[s].recid,column:sel[s].column})}obj.unselect.apply(obj,tmp)}else if(obj.multiSelect){for(var sel=obj.getSelection(),ns=0;ns<newSel.length;ns++)-1==sel.indexOf(newSel[ns])&&obj.select(newSel[ns]);for(var s=0;s<sel.length;s++)-1==newSel.indexOf(sel[s])&&obj.unselect(sel[s])}}}}function mouseStop(event){var mv=obj.last.move;if(setTimeout(function(){delete obj.last.cancelClick},1),!$(event.target).parents().hasClass(".w2ui-head")&&!$(event.target).hasClass(".w2ui-head")){if(mv&&-1!=["select","select-column"].indexOf(mv.type)){if(null!=mv.colRange&&!0!==edataCol.isCancelled){for(var tmp=mv.colRange.split("-"),sel=[],i=0;i<obj.records.length;i++){for(var cols=[],j=parseInt(tmp[0]);j<=parseInt(tmp[1]);j++)cols.push(j);sel.push({recid:obj.records[i].recid,column:cols})}obj.removeRange("column-selection"),obj.trigger($.extend(edataCol,{phase:"after"})),obj.select.apply(obj,sel)}if(1==obj.reorderRows&&obj.last.move.reorder){var edata=obj.trigger({phase:"before",target:obj.name,type:"reorderRow",recid:mv.from,moveAfter:mv.to});if(!0===edata.isCancelled)return $("#grid_"+obj.name+"_ghost").remove(),void obj.refresh();var ind1=obj.get(mv.from,!0),ind2=obj.get(mv.to,!0),tmp=obj.records[ind1];null!=ind1&&null!=ind2&&(obj.records.splice(ind1,1),ind1>ind2?obj.records.splice(ind2,0,tmp):obj.records.splice(ind2-1,0,tmp)),$("#grid_"+obj.name+"_ghost").remove(),obj.refresh(),obj.trigger($.extend(edata,{phase:"after"}))}}delete obj.last.move,$(document).off("mousemove",mouseMove),$(document).off("mouseup",mouseStop)}}},destroy:function(){var edata=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==edata.isCancelled&&($(window).off("resize.w2ui-"+this.name),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(edata,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var obj=this,col_html='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+obj.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(obj.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>",c=0;c<this.columns.length;c++){var col=this.columns[c],tmp=this.columns[c].caption;!1!==col.hideable&&(!tmp&&this.columns[c].tooltip&&(tmp=this.columns[c].tooltip),tmp||(tmp="- column "+(parseInt(c)+1)+" -"),col_html+='<tr id="grid_'+this.name+"_column_"+c+'_check"        onclick="w2ui[\''+obj.name+"'].columnOnOff(event, '"+col.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(col.hidden?"empty":"check")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">       <label>'+w2utils.stripTags(tmp)+"</label>   </td></tr>")}var url="object"!=typeof this.url?this.url:this.url.get;(url&&obj.show.skipRecords||obj.show.saveRestoreState)&&(col_html+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),url&&obj.show.skipRecords&&(col_html+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+obj.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>"),obj.show.saveRestoreState&&(col_html+='<tr><td colspan="2" onclick="var obj = w2ui[\''+obj.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+obj.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),col_html+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=col_html}},initColumnDrag:function(box){if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var obj=this,_dragData={};function catchMouseup(){_dragData.pressed=!1,clearTimeout(_dragData.timeout)}function dragColStart(event){_dragData.timeout&&clearTimeout(_dragData.timeout);var self=this;_dragData.pressed=!0,_dragData.timeout=setTimeout(function(){if(_dragData.pressed){var edata,columns,selectedCol,origColumn,origColumnNumber,invalidPreColumns,invalidPostColumns,invalidColumns=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]),preColumnsSelector=".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select",preColHeadersSelector=".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select";if($(event.originalEvent.target).parents().hasClass("w2ui-head")){for(var i=0,l=invalidColumns.length;i<l;i++)if($(event.originalEvent.target).parents().hasClass(invalidColumns[i]))return;if(_dragData.numberPreColumnsPresent=$(obj.box).find(preColHeadersSelector).length,_dragData.columnHead=origColumn=$(event.originalEvent.target).parents(".w2ui-head"),origColumnNumber=parseInt(origColumn.attr("col"),10),!0===(edata=obj.trigger({type:"columnDragStart",phase:"before",originalEvent:event,origColumnNumber:origColumnNumber,target:origColumn[0]})).isCancelled)return!1;columns=_dragData.columns=$(obj.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",dragColEnd),$(document).on("mousemove",dragColOver),_dragData.originalPos=parseInt($(event.originalEvent.target).parent(".w2ui-head").attr("col"),10),_dragData.ghost=$(self).clone(!0),$(_dragData.ghost).find('[col]:not([col="'+_dragData.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(_dragData.ghost).find(preColumnsSelector).remove(),$(_dragData.ghost).find(".w2ui-grid-body").css({top:0}),selectedCol=$(_dragData.ghost).find('[col="'+_dragData.originalPos+'"]'),$(document.body).append(_dragData.ghost),$(_dragData.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:selectedCol.width(),height:$(obj.box).find(".w2ui-grid-body:first").height(),left:event.pageX,top:event.pageY,opacity:.8},0),_dragData.offsets=[];for(var i=0,l=columns.length;i<l;i++)_dragData.offsets.push($(columns[i]).offset().left);obj.trigger($.extend(edata,{phase:"after"}))}}},150)}function dragColOver(event){if(_dragData.pressed){var cursorX=event.originalEvent.pageX,cursorY=event.originalEvent.pageY,offsets=_dragData.offsets,lastWidth=$(".w2ui-head:not(.w2ui-head-last)").width();_dragData.targetInt=Math.max(_dragData.numberPreColumnsPresent,targetIntersection(cursorX,offsets,lastWidth)),markIntersection(_dragData.targetInt),trackGhost(cursorX,cursorY)}}function dragColEnd(event){_dragData.pressed=!1;var edata,target,selected,columnConfig,targetColumn,ghosts=$(".w2ui-grid-ghost");if(!0===(edata=obj.trigger({type:"columnDragEnd",phase:"before",originalEvent:event,target:_dragData.columnHead[0]})).isCancelled)return!1;selected=obj.columns[_dragData.originalPos],columnConfig=obj.columns,targetColumn=$(_dragData.columns[Math.min(_dragData.lastInt,_dragData.columns.length-1)]),(target=_dragData.lastInt<_dragData.columns.length?parseInt(targetColumn.attr("col")):columnConfig.length)!==_dragData.originalPos+1&&target!==_dragData.originalPos&&targetColumn&&targetColumn.length?($(_dragData.ghost).animate({top:$(obj.box).offset().top,left:targetColumn.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),ghosts.remove()}),columnConfig.splice(target,0,$.extend({},selected)),columnConfig.splice(columnConfig.indexOf(selected),1)):($(_dragData.ghost).remove(),ghosts.remove()),$(document).off("mouseup",dragColEnd),$(document).off("mousemove",dragColOver),_dragData.marker&&_dragData.marker.remove(),_dragData={},obj.refresh(),obj.trigger($.extend(edata,{phase:"after",targetColumnNumber:target-1}))}function markIntersection(intersection){_dragData.marker||_dragData.markerLeft||(_dragData.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),_dragData.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),_dragData.lastInt&&_dragData.lastInt===intersection||(_dragData.lastInt=intersection,_dragData.marker.remove(),_dragData.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),intersection>=_dragData.columns.length?($(_dragData.columns[_dragData.columns.length-1]).children("div:last").append(_dragData.marker.addClass("right").removeClass("left")),$(_dragData.columns[_dragData.columns.length-1]).addClass("w2ui-col-intersection")):intersection<=_dragData.numberPreColumnsPresent?($(_dragData.columns[_dragData.numberPreColumnsPresent]).prepend(_dragData.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(_dragData.columns[_dragData.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(_dragData.columns[intersection]).children("div:last").prepend(_dragData.marker.addClass("left").removeClass("right")),$(_dragData.columns[intersection]).prev().children("div:last").append(_dragData.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(_dragData.columns[intersection-1]).addClass("w2ui-col-intersection")))}function targetIntersection(cursorX,offsets,lastWidth){if(cursorX<=offsets[0])return 0;if(cursorX>=offsets[offsets.length-1]+lastWidth)return offsets.length;for(var i=0,l=offsets.length;i<l;i++){var thisOffset=offsets[i],nextOffset=offsets[i+1]||offsets[i]+lastWidth,midpoint=(nextOffset-offsets[i])/2+offsets[i];if(cursorX>thisOffset&&cursorX<=midpoint)return i;if(cursorX>midpoint&&cursorX<=nextOffset)return i+1}return intersection}function trackGhost(cursorX,cursorY){$(_dragData.ghost).css({left:cursorX-10,top:cursorY-10})}return _dragData.lastInt=null,_dragData.pressed=!1,_dragData.timeout=null,_dragData.columnHead=null,$(obj.box).on("mousedown",dragColStart),$(obj.box).on("mouseup",catchMouseup),{remove:function(){$(obj.box).off("mousedown",dragColStart),$(obj.box).off("mouseup",catchMouseup),$(obj.box).find(".w2ui-head").removeAttr("draggable"),obj.last.columnDrag=!1}}},columnOnOff:function(event,field){var $el=$(event.target).parents("tr").find(".w2ui-column-check"),edata=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:field,originalEvent:event});if(!0!==edata.isCancelled){for(var obj=this,rows=obj.find({"w2ui.expanded":!0},!0),r=0;r<rows.length;r++){var tmp=this.records[r].w2ui;tmp&&!Array.isArray(tmp.children)&&(this.records[r].w2ui.expanded=!1)}if("line-numbers"==field)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?$el.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):$el.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var col=this.getColumn(field);col.hidden?($el.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),this.showColumn(col.field)):($el.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.hideColumn(col.field))}event.shiftKey||event.metaKey||event.ctrlKey||setTimeout(function(){$().w2overlay({name:obj.name+"_toolbar"})},150),this.trigger($.extend(edata,{phase:"after"}))}},scrollToColumn:function(field){if(null!=field){for(var sWidth=0,found=!1,i=0;i<this.columns.length;i++){var col=this.columns[i],cSize;if(col.field==field){found=!0;break}if(!col.frozen&&!col.hidden)sWidth+=parseInt(col.sizeCalculated?col.sizeCalculated:col.size)}found&&(this.last.scrollLeft=sWidth+1,this.scroll())}},initToolbar:function(){var obj=this;if(null==this.toolbar.render){var tmp_items=this.toolbar.items;if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarInput){var html='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             placeholder="'+w2utils.lang(this.last.caption)+'" value="'+this.last.search+'"            onfocus="clearTimeout(w2ui[\''+this.name+'\'].last.kbd_timer);"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:html})}if(this.show.toolbarSearch&&this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"])),(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),tmp_items)for(var i=0;i<tmp_items.length;i++)this.toolbar.items.push(tmp_items[i]);var obj=this;this.toolbar.on("click",function(event){var edata;if(!0!==(edata=obj.trigger({phase:"before",type:"toolbar",target:event.target,originalEvent:event})).isCancelled){var id=event.target;switch(id){case"w2ui-reload":var edata2=obj.trigger({phase:"before",type:"reload",target:obj.name});if(!0===edata2.isCancelled)return!1;obj.reload(),obj.trigger($.extend(edata2,{phase:"after"}));break;case"w2ui-column-on-off":obj.initColumnOnOff(),obj.initResize(),obj.resize();break;case"w2ui-search-advanced":var tb=this,it;if(this.get(id).checked)obj.searchClose(),setTimeout(function(){tb.uncheck(id)},1);else{function tmp_close(){!0!==$("#w2ui-overlay-"+obj.name+"-searchOverlay").data("keepOpen")&&(tb.uncheck(id),$(document).off("click","body",tmp_close))}obj.searchOpen(),event.originalEvent.stopPropagation(),$(document).on("click","body",tmp_close)}break;case"w2ui-add":var edata=obj.trigger({phase:"before",target:obj.name,type:"add",recid:null});obj.trigger($.extend(edata,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-edit":var sel=obj.getSelection(),recid=null;1==sel.length&&(recid=sel[0]);var edata=obj.trigger({phase:"before",target:obj.name,type:"edit",recid:recid});obj.trigger($.extend(edata,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-delete":obj.delete();break;case"w2ui-save":obj.save()}obj.trigger($.extend(edata,{phase:"after"}))}})}},initResize:function(){var obj=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(event){event.stopPropagation?event.stopPropagation():event.cancelBubble=!0,event.preventDefault&&event.preventDefault()}).off("mousedown").on("mousedown",function(event){event||(event=window.event),obj.resizing=!0,obj.last.tmp={x:event.screenX,y:event.screenY,gx:event.screenX,gy:event.screenY,col:parseInt($(this).attr("name"))},event.stopPropagation?event.stopPropagation():event.cancelBubble=!0,event.preventDefault&&event.preventDefault();for(var c=0;c<obj.columns.length;c++)obj.columns[c].hidden||(null==obj.columns[c].sizeOriginal&&(obj.columns[c].sizeOriginal=obj.columns[c].size),obj.columns[c].size=obj.columns[c].sizeCalculated);var edata={phase:"before",type:"columnResize",target:obj.name,column:obj.last.tmp.col,field:obj.columns[obj.last.tmp.col].field};edata=obj.trigger($.extend(edata,{resizeBy:0,originalEvent:event}));var mouseMove=function(event){1==obj.resizing&&(event||(event=window.event),!0!==(edata=obj.trigger($.extend(edata,{resizeBy:event.screenX-obj.last.tmp.gx,originalEvent:event}))).isCancelled?(obj.last.tmp.x=event.screenX-obj.last.tmp.x,obj.last.tmp.y=event.screenY-obj.last.tmp.y,obj.columns[obj.last.tmp.col].size=parseInt(obj.columns[obj.last.tmp.col].size)+obj.last.tmp.x+"px",obj.resizeRecords(),obj.scroll(),obj.last.tmp.x=event.screenX,obj.last.tmp.y=event.screenY):edata.isCancelled=!1)},mouseUp=function(event){delete obj.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),obj.resizeRecords(),obj.scroll(),obj.trigger($.extend(edata,{phase:"after",originalEvent:event}))};$(document).on("mousemove","body",mouseMove),$(document).on("mouseup","body",mouseUp)}).each(function(index,el){var td=$(el).parent();$(el).css({height:"25px","margin-left":td.width()-3+"px"})})},resizeBoxes:function(){var header=$("#grid_"+this.name+"_header"),toolbar=$("#grid_"+this.name+"_toolbar"),fsummary=$("#grid_"+this.name+"_fsummary"),summary=$("#grid_"+this.name+"_summary"),footer=$("#grid_"+this.name+"_footer"),body=$("#grid_"+this.name+"_body");this.show.header&&header.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&toolbar.css({top:0+(this.show.header?w2utils.getSize(header,"height"):0)+"px",left:"0px",right:"0px"}),this.summary.length>0&&(fsummary.css({bottom:0+(this.show.footer?w2utils.getSize(footer,"height"):0)+"px"}),summary.css({bottom:0+(this.show.footer?w2utils.getSize(footer,"height"):0)+"px",right:"0px"})),this.show.footer&&footer.css({bottom:"0px",left:"0px",right:"0px"}),body.css({top:0+(this.show.header?w2utils.getSize(header,"height"):0)+(this.show.toolbar?w2utils.getSize(toolbar,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(footer,"height"):0)+(this.summary.length>0?w2utils.getSize(summary,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){var obj=this;$(this.box).find(".w2ui-empty-record").remove();var box=$(this.box),grid=$(this.box).find("> div.w2ui-grid-box"),header=$("#grid_"+this.name+"_header"),toolbar=$("#grid_"+this.name+"_toolbar"),summary=$("#grid_"+this.name+"_summary"),fsummary=$("#grid_"+this.name+"_fsummary"),footer=$("#grid_"+this.name+"_footer"),body=$("#grid_"+this.name+"_body"),columns=$("#grid_"+this.name+"_columns"),fcolumns=$("#grid_"+this.name+"_fcolumns"),records=$("#grid_"+this.name+"_records"),frecords=$("#grid_"+this.name+"_frecords"),scroll1=$("#grid_"+this.name+"_scroll1"),lineNumberWidth=8*String(this.total).length+10;lineNumberWidth<34&&(lineNumberWidth=34),null!=this.lineNumberWidth&&(lineNumberWidth=this.lineNumberWidth);for(var bodyOverflowX=!1,bodyOverflowY=!1,sWidth=0,i=0;i<obj.columns.length;i++){var cSize;if(!obj.columns[i].frozen&&!obj.columns[i].hidden)sWidth+=parseInt(obj.columns[i].sizeCalculated?obj.columns[i].sizeCalculated:obj.columns[i].size)}if(records.width()<sWidth&&(bodyOverflowX=!0),body.height()-columns.height()<$(records).find(">table").height()+(bodyOverflowX?w2utils.scrollBarSize():0)&&(bodyOverflowY=!0),this.fixedBody){var calculatedHeight=grid.height()-(this.show.header?w2utils.getSize(header,"height"):0)-(this.show.toolbar?w2utils.getSize(toolbar,"height"):0)-("none"!=summary.css("display")?w2utils.getSize(summary,"height"):0)-(this.show.footer?w2utils.getSize(footer,"height"):0);body.css("height",calculatedHeight)}else{var calculatedHeight=w2utils.getSize(columns,"height")+w2utils.getSize($("#grid_"+obj.name+"_records table"),"height")+(bodyOverflowX?w2utils.scrollBarSize():0);obj.height=calculatedHeight+w2utils.getSize(grid,"+height")+(obj.show.header?w2utils.getSize(header,"height"):0)+(obj.show.toolbar?w2utils.getSize(toolbar,"height"):0)+("none"!=summary.css("display")?w2utils.getSize(summary,"height"):0)+(obj.show.footer?w2utils.getSize(footer,"height"):0),grid.css("height",obj.height),body.css("height",calculatedHeight),box.css("height",w2utils.getSize(grid,"height")+w2utils.getSize(box,"+height"))}var buffered=this.records.length,url="object"!=typeof this.url?this.url:this.url.get;if(0==this.searchData.length||url||(buffered=this.last.searchIds.length),this.fixedBody||(bodyOverflowY=!1),bodyOverflowX||bodyOverflowY?(columns.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),records.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(columns,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":bodyOverflowX?"auto":"hidden","overflow-y":bodyOverflowY?"auto":"hidden"})):(columns.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),records.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(columns,"height")+"px",overflow:"hidden"}),records.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),bodyOverflowX?(frecords.css("margin-bottom",w2utils.scrollBarSize()),scroll1.show()):(frecords.css("margin-bottom",0),scroll1.hide()),frecords.css({overflow:"hidden",top:records.css("top")}),this.show.emptyRecords&&!bodyOverflowY){var max=Math.floor(records.height()/this.recordHeight)-1,leftover=0;if(records[0]&&(leftover=records[0].scrollHeight-max*this.recordHeight),leftover>=this.recordHeight&&(leftover-=this.recordHeight,max++),this.fixedBody){for(var di=buffered;di<max;di++)addEmptyRow(di,this.recordHeight,this);addEmptyRow(max,leftover,this)}}function addEmptyRow(row,height,grid){var html1="",html2="",htmlp="";html1+='<tr class="'+(row%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+height+'px">',html2+='<tr class="'+(row%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+height+'px">',grid.show.lineNumbers&&(html1+='<td class="w2ui-col-number"></td>'),grid.show.selectColumn&&(html1+='<td class="w2ui-grid-data w2ui-col-select"></td>'),grid.show.expandColumn&&(html1+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),html2+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var j=0;j<grid.columns.length;j++){var col=grid.columns[j];(col.hidden||j<grid.last.colStart||j>grid.last.colEnd)&&!col.frozen||(htmlp='<td class="w2ui-grid-data" '+(null!=col.attr?col.attr:"")+' col="'+j+'"></td>',col.frozen?html1+=htmlp:html2+=htmlp)}html1+='<td class="w2ui-grid-data-last"></td> </tr>',html2+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+grid.name+"_frecords > table").append(html1),$("#grid_"+grid.name+"_records > table").append(html2)}if(body.length>0){for(var width_max=parseInt(body.width())-(bodyOverflowY?w2utils.scrollBarSize():0)-(this.show.lineNumbers?lineNumberWidth:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,width_box=width_max,percent=0,restart=!1,i=0;i<this.columns.length;i++){var col;(col=this.columns[i]).gridMinWidth>0&&(col.gridMinWidth>width_box&&!0!==col.hidden&&(col.hidden=!0,restart=!0),col.gridMinWidth<width_box&&!0===col.hidden&&(col.hidden=!1,restart=!0))}if(!0===restart)return void this.refresh();for(var i=0;i<this.columns.length;i++){var col;(col=this.columns[i]).hidden||("px"==String(col.size).substr(String(col.size).length-2).toLowerCase()?(width_max-=parseFloat(col.size),this.columns[i].sizeCalculated=col.size,this.columns[i].sizeType="px"):(percent+=parseFloat(col.size),this.columns[i].sizeType="%",delete col.sizeCorrected))}if(100!=percent&&percent>0)for(var i=0;i<this.columns.length;i++){var col;(col=this.columns[i]).hidden||"%"==col.sizeType&&(col.sizeCorrected=Math.round(100*parseFloat(col.size)*100/percent)/100+"%")}for(var i=0;i<this.columns.length;i++){var col;(col=this.columns[i]).hidden||"%"==col.sizeType&&(null!=this.columns[i].sizeCorrected?this.columns[i].sizeCalculated=Math.floor(width_max*parseFloat(col.sizeCorrected)/100)-1+"px":this.columns[i].sizeCalculated=Math.floor(width_max*parseFloat(col.size)/100)-1+"px")}}for(var width_cols=0,i=0;i<this.columns.length;i++){var col;(col=this.columns[i]).hidden||(null==col.min&&(col.min=20),parseInt(col.sizeCalculated)<parseInt(col.min)&&(col.sizeCalculated=col.min+"px"),parseInt(col.sizeCalculated)>parseInt(col.max)&&(col.sizeCalculated=col.max+"px"),width_cols+=parseInt(col.sizeCalculated))}var width_diff=parseInt(width_box)-parseInt(width_cols);if(width_diff>0&&percent>0)for(var i=0;;){var col;if(null!=(col=this.columns[i]))if(col.hidden||"px"==col.sizeType)i++;else{if(col.sizeCalculated=parseInt(col.sizeCalculated)+1+"px",0===--width_diff)break;i++}else i=0}else width_diff>0&&columns.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();var fwidth=1;this.show.lineNumbers&&(fwidth+=lineNumberWidth),this.show.selectColumn&&(fwidth+=26),this.show.expandColumn&&(fwidth+=26);for(var i=0;i<this.columns.length;i++)this.columns[i].hidden||this.columns[i].frozen&&(fwidth+=parseInt(this.columns[i].sizeCalculated));fcolumns.css("width",fwidth),frecords.css("width",fwidth),fsummary.css("width",fwidth),scroll1.css("width",fwidth),columns.css("left",fwidth),records.css("left",fwidth),summary.css("left",fwidth),columns.find("> table > tbody > tr:nth-child(1) td").add(fcolumns.find("> table > tbody > tr:nth-child(1) td")).each(function(index,el){$(el).hasClass("w2ui-col-number")&&$(el).css("width",lineNumberWidth);var ind=$(el).attr("col");if(null!=ind){if("start"==ind){for(var width=0,i=0;i<obj.last.colStart;i++)!obj.columns[i]||obj.columns[i].frozen||obj.columns[i].hidden||(width+=parseInt(obj.columns[i].sizeCalculated));$(el).css("width",width+"px")}obj.columns[ind]&&$(el).css("width",obj.columns[ind].sizeCalculated)}if($(el).hasClass("w2ui-head-last"))if(obj.last.colEnd+1<obj.columns.length){for(var width=0,i=obj.last.colEnd+1;i<obj.columns.length;i++)!obj.columns[i]||obj.columns[i].frozen||obj.columns[i].hidden||(width+=parseInt(obj.columns[i].sizeCalculated));$(el).css("width",width+"px")}else $(el).css("width",w2utils.scrollBarSize()+(width_diff>0&&0===percent?width_diff:0)+"px")}),3==columns.find("> table > tbody > tr").length&&columns.find("> table > tbody > tr:nth-child(1) td").add(fcolumns.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),records.find("> table > tbody > tr:nth-child(1) td").add(frecords.find("> table > tbody > tr:nth-child(1) td")).each(function(index,el){$(el).hasClass("w2ui-col-number")&&$(el).css("width",lineNumberWidth);var ind=$(el).attr("col");if(null!=ind){if("start"==ind){for(var width=0,i=0;i<obj.last.colStart;i++)!obj.columns[i]||obj.columns[i].frozen||obj.columns[i].hidden||(width+=parseInt(obj.columns[i].sizeCalculated));$(el).css("width",width+"px")}obj.columns[ind]&&$(el).css("width",obj.columns[ind].sizeCalculated)}if($(el).hasClass("w2ui-grid-data-last")&&0===$(el).parents(".w2ui-grid-frecords").length)if(obj.last.colEnd+1<obj.columns.length){for(var width=0,i=obj.last.colEnd+1;i<obj.columns.length;i++)!obj.columns[i]||obj.columns[i].frozen||obj.columns[i].hidden||(width+=parseInt(obj.columns[i].sizeCalculated));$(el).css("width",width+"px")}else $(el).css("width",(width_diff>0&&0===percent?width_diff:0)+"px")}),summary.find("> table > tbody > tr:nth-child(1) td").add(fsummary.find("> table > tbody > tr:nth-child(1) td")).each(function(index,el){$(el).hasClass("w2ui-col-number")&&$(el).css("width",lineNumberWidth);var ind=$(el).attr("col");if(null!=ind){if("start"==ind){for(var width=0,i=0;i<obj.last.colStart;i++)!obj.columns[i]||obj.columns[i].frozen||obj.columns[i].hidden||(width+=parseInt(obj.columns[i].sizeCalculated));$(el).css("width",width+"px")}obj.columns[ind]&&$(el).css("width",obj.columns[ind].sizeCalculated)}$(el).hasClass("w2ui-grid-data-last")&&0===$(el).parents(".w2ui-grid-frecords").length&&$(el).css("width",w2utils.scrollBarSize()+(width_diff>0&&0===percent?width_diff:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&records.length>0&&(columns.prop("scrollLeft",this.last.scrollLeft),records.prop("scrollTop",this.last.scrollTop),records.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var obj=this,html='<table cellspacing="0" onclick="event.stopPropagation()"><tbody>',showBtn=!1,i=0;i<this.searches.length;i++){var s=this.searches[i];if(s.type=String(s.type).toLowerCase(),!s.hidden){var btn="";0==showBtn&&(btn='<button class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",showBtn=!0),null==s.inTag&&(s.inTag=""),null==s.outTag&&(s.outTag=""),null==s.style&&(s.style=""),null==s.type&&(s.type="text");var operator='<select id="grid_'+this.name+"_operator_"+i+'" class="w2ui-input" onclick="event.stopPropagation();"   onchange="w2ui[\''+this.name+"'].initOperator(this, "+i+')">'+getOperators(s.type,s.operators)+"</select>";switch(html+='<tr>    <td class="close-btn">'+btn+'</td>    <td class="caption">'+(s.caption||"")+'</td>    <td class="operator">'+operator+'</td>    <td class="value">',s.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":var tmpStyle="width: 250px;";-1!=["hex","color"].indexOf(s.type)&&(tmpStyle="width: 90px;"),html+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'"    class="w2ui-input" style="'+tmpStyle+s.style+'" '+s.inTag+"/>";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":var tmpStyle="width: 90px";"datetime"==s.type&&(tmpStyle="width: 140px;"),html+='<input rel="search" type="text" class="w2ui-input" style="'+tmpStyle+s.style+'" id="grid_'+this.name+"_field_"+i+'" name="'+s.field+'" '+s.inTag+'/><span id="grid_'+this.name+"_range_"+i+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+tmpStyle+s.style+'" id="grid_'+this.name+"_field2_"+i+'" name="'+s.field+'" '+s.inTag+"/></span>";break;case"select":html+='<select rel="search" class="w2ui-input" style="'+s.style+'" id="grid_'+this.name+"_field_"+i+'"  name="'+s.field+'" '+s.inTag+'  onclick="event.stopPropagation();"></select>'}html+=s.outTag+"    </td></tr>"}}return html+='<tr>    <td colspan="4" class="actions">        <div>        <button class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>";function getOperators(type,fieldOperators){var html="",operators=obj.operators[obj.operatorsMap[type]];null!=fieldOperators&&(operators=fieldOperators);for(var i=0;i<operators.length;i++){var oper=operators[i],text=oper;Array.isArray(oper)?(text=oper[1],oper=oper[0],null==text&&(text=oper)):$.isPlainObject(oper)&&(text=oper.text,oper=oper.oper),html+='<option value="'+oper+'">'+w2utils.lang(text)+"</option>\n"}return html}},initOperator:function(el,search_ind){var obj=this,search=obj.searches[search_ind],range=$("#grid_"+obj.name+"_range_"+search_ind),fld1=$("#grid_"+obj.name+"_field_"+search_ind),fld2=fld1.parent().find("span input");switch(fld1.show(),range.hide(),$(el).val()){case"between":range.show(),fld2.w2field(search.type,search.options);break;case"not null":case"null":fld1.hide(),fld1.val("1"),fld1.change()}},initSearches:function(){for(var obj=this,s=0;s<this.searches.length;s++){var search=this.searches[s],sdata=this.getSearchData(search.field);search.type=String(search.type).toLowerCase();var operators=obj.operators[obj.operatorsMap[search.type]];search.operators&&(operators=search.operators);var operator=operators[0];$.isPlainObject(operator)&&(operator=operator.oper),"object"!=typeof search.options&&(search.options={}),"text"==search.type&&(operator="contains");for(var i=0;i<operators.length;i++){var oper=operators[i];if($.isPlainObject(oper)&&(oper=oper.oper),search.operator==oper){operator=search.operator;break}}switch(search.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_field_"+s).w2field(search.type,search.options);break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":$("#grid_"+this.name+"_field_"+s).w2field(search.type,search.options),$("#grid_"+this.name+"_field2_"+s).w2field(search.type,search.options),setTimeout(function(){$("#grid_"+obj.name+"_field_"+s).keydown(),$("#grid_"+obj.name+"_field2_"+s).keydown()},1);break;case"list":case"combo":case"enum":var options=search.options;"list"==search.type&&(options.selected={}),"enum"==search.type&&(options.selected=[]),sdata&&(options.selected=sdata.value),$("#grid_"+this.name+"_field_"+s).w2field(search.type,$.extend({openOnFocus:!0},options)),sdata&&null!=sdata.text&&$("#grid_"+this.name+"_field_"+s).data("selected",{id:sdata.value,text:sdata.text});break;case"select":for(var options='<option value="">--</option>',i=0;i<search.options.items.length;i++){var si=search.options.items[i];if($.isPlainObject(search.options.items[i])){var val=si.id,txt=si.text;null==val&&null!=si.value&&(val=si.value),null==txt&&null!=si.caption&&(txt=si.caption),null==val&&(val=""),options+='<option value="'+val+'">'+txt+"</option>"}else options+='<option value="'+si+'">'+si+"</option>"}$("#grid_"+this.name+"_field_"+s).html(options)}null!=sdata?("int"==sdata.type&&-1!=["in","not in"].indexOf(sdata.operator)&&$("#grid_"+this.name+"_field_"+s).w2field("clear").val(sdata.value),$("#grid_"+this.name+"_operator_"+s).val(sdata.operator).trigger("change"),$.isArray(sdata.value)?-1!=["in","not in"].indexOf(sdata.operator)?$("#grid_"+this.name+"_field_"+s).val(sdata.value).trigger("change"):($("#grid_"+this.name+"_field_"+s).val(sdata.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+s).val(sdata.value[1]).trigger("change")):null!=sdata.value&&$("#grid_"+this.name+"_field_"+s).val(sdata.value).trigger("change")):$("#grid_"+this.name+"_operator_"+s).val(operator).trigger("change")}$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",function(evnt){13==evnt.keyCode&&(obj.search(),$().w2overlay({name:obj.name+"-searchOverlay"}))})},getColumnsHTML:function(){var obj=this,html1="",html2="";if(this.show.columnHeaders)if(this.columnGroups.length>0){var tmp1=getColumns(!0),tmp2=getGroups(),tmp3=getColumns(!1);html1=tmp1[0]+tmp2[0]+tmp3[0],html2=tmp1[1]+tmp2[1]+tmp3[1]}else{var tmp=getColumns(!0);html1=tmp[0],html2=tmp[1]}return[html1,html2];function getGroups(){var html1="<tr>",html2="<tr>",tmpf="";""!=obj.columnGroups[obj.columnGroups.length-1].caption&&obj.columnGroups.push({caption:""}),obj.show.lineNumbers&&(html1+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(obj.recordHeight+1)+'px">&#160;</div></td>'),obj.show.selectColumn&&(html1+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>'),obj.show.expandColumn&&(html1+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');var ii=0;html2+='<td id="grid_'+obj.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var i=0;i<obj.columnGroups.length;i++){var colg=obj.columnGroups[i],col=obj.columns[ii];null!=colg.colspan&&(colg.span=colg.colspan),null!=colg.span&&colg.span==parseInt(colg.span)||(colg.span=1);for(var colspan=0,jj=ii;jj<ii+colg.span;jj++)obj.columns[jj]&&!obj.columns[jj].hidden&&colspan++;if(i==obj.columnGroups.length-1&&colspan++,colspan<=0);else if(!0===colg.master){for(var sortStyle="",si=0;si<obj.sortData.length;si++)obj.sortData[si].field==col.field&&(new RegExp("asc","i").test(obj.sortData[si].direction)&&(sortStyle="w2ui-sort-up"),new RegExp("desc","i").test(obj.sortData[si].direction)&&(sortStyle="w2ui-sort-down"));var resizer="";!1!==col.resizable&&(resizer='<div class="w2ui-resizer" name="'+ii+'"></div>'),tmpf='<td id="grid_'+obj.name+"_column_"+ii+'" class="w2ui-head '+sortStyle+'" col="'+ii+'"     rowspan="2" colspan="'+colspan+'"     oncontextmenu = "w2ui[\''+obj.name+"'].contextMenu(null, "+ii+', event);"    onclick="w2ui[\''+obj.name+"'].columnClick('"+col.field+"', event);\"    ondblclick=\"w2ui['"+obj.name+"'].columnDblClick('"+col.field+"', event);\">"+resizer+'    <div class="w2ui-col-group w2ui-col-header '+(sortStyle?"w2ui-col-sorted":"")+'">        <div class="'+sortStyle+'"></div>'+(col.caption?col.caption:"&#160;")+"    </div></td>",col&&col.frozen?html1+=tmpf:html2+=tmpf}else tmpf='<td id="grid_'+obj.name+"_column_"+ii+'" class="w2ui-head" col="'+ii+'"         colspan="'+colspan+'">    <div class="w2ui-col-group">'+(colg.caption?colg.caption:"&#160;")+"    </div></td>",col&&col.frozen?html1+=tmpf:html2+=tmpf;ii+=colg.span}return[html1+="<td></td></tr>",html2+='<td id="grid_'+obj.name+'_column_end" class="w2ui-head" col="end"></td></tr>']}function getColumns(master){var html1="<tr>",html2="<tr>";obj.show.lineNumbers&&(html1+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+obj.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+obj.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),obj.show.selectColumn&&(html1+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+obj.name+'_check_all" tabindex="-1"            style="'+(0==obj.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+obj.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),obj.show.expandColumn&&(html1+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var ii=0,id=0,colg;html2+='<td id="grid_'+obj.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var i=0;i<obj.columns.length;i++){var col=obj.columns[i];if(i==id&&(id+=(colg=obj.columnGroups[ii++]||{}).span),(!(i<obj.last.colStart||i>obj.last.colEnd)||col.frozen)&&!col.hidden&&(!0!==colg.master||master)){var colCellHTML=obj.getColumnCellHTML(i);col&&col.frozen?html1+=colCellHTML:html2+=colCellHTML}}return html1+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',html2+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',[html1+="</tr>",html2+="</tr>"]}},getColumnCellHTML:function(i){var col=this.columns[i];if(null==col)return"";for(var reorderCols=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",sortStyle="",si=0;si<this.sortData.length;si++)this.sortData[si].field==col.field&&(new RegExp("asc","i").test(this.sortData[si].direction)&&(sortStyle="w2ui-sort-up"),new RegExp("desc","i").test(this.sortData[si].direction)&&(sortStyle="w2ui-sort-down"));var tmp=this.last.selection.columns,selected=!1,html;for(var t in tmp)for(var si=0;si<tmp[t].length;si++)tmp[t][si]==i&&(selected=!0);return'<td id="grid_'+this.name+"_column_"+i+'" col="'+i+'" class="w2ui-head '+sortStyle+reorderCols+'" '+("normal"==this.columnTooltip&&col.tooltip?'title="'+col.tooltip+'" ':"")+"    onmouseover = \"w2ui['"+this.name+"'].columnTooltipShow('"+i+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].columnTooltipHide('"+i+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+i+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+col.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+col.field+"', event);\">"+(!1!==col.resizable?'<div class="w2ui-resizer" name="'+i+'"></div>':"")+'    <div class="w2ui-col-header '+(sortStyle?"w2ui-col-sorted":"")+" "+(selected?"w2ui-col-selected":"")+'">        <div class="'+sortStyle+'"></div>'+(col.caption?col.caption:"&#160;")+"    </div></td>"},columnTooltipShow:function(ind){if("normal"!=this.columnTooltip){var $el=$(this.box).find("#grid_"+this.name+"_column_"+ind),item=this.columns[ind],pos=this.columnTooltip;$el.prop("_mouse_over",!0),setTimeout(function(){!0===$el.prop("_mouse_over")&&!0!==$el.prop("_mouse_tooltip")&&($el.prop("_mouse_tooltip",!0),$el.w2tag(item.tooltip,{position:pos}))},1)}},columnTooltipHide:function(ind){if("normal"!=this.columnTooltip){var $el=$(this.box).find("#grid_"+this.name+"_column_"+ind),item=this.columns[ind];$el.removeProp("_mouse_over"),setTimeout(function(){!0!==$el.prop("_mouse_over")&&!0===$el.prop("_mouse_tooltip")&&($el.removeProp("_mouse_tooltip"),$el.w2tag())},1)}},getRecordsHTML:function(){var buffered=this.records.length,url="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||url||(buffered=this.last.searchIds.length),buffered>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var records=$("#grid_"+this.name+"_records"),limit=Math.floor(records.height()/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||limit>buffered)&&(limit=buffered);var rec_html=this.getRecordHTML(-1,0),html1="<table><tbody>"+rec_html[0],html2="<table><tbody>"+rec_html[1];html1+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',html2+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var i=0;i<limit;i++)html1+=(rec_html=this.getRecordHTML(i,i+1))[0],html2+=rec_html[1];return html1+='<tr id="grid_'+this.name+'_frec_bottom" line="bottom" style="height: '+(buffered-limit)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; visibility: hidden">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',html2+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(buffered-limit)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=limit,[html1,html2]},getSummaryHTML:function(){if(0!==this.summary.length){for(var rec_html=this.getRecordHTML(-1,0),html1="<table><tbody>"+rec_html[0],html2="<table><tbody>"+rec_html[1],i=0;i<this.summary.length;i++)html1+=(rec_html=this.getRecordHTML(i,i+1,!0))[0],html2+=rec_html[1];return[html1+="</tbody></table>",html2+="</tbody></table>"]}},scroll:function(event){var time=(new Date).getTime(),obj=this,url="object"!=typeof this.url?this.url:this.url.get,records=$("#grid_"+this.name+"_records"),frecords=$("#grid_"+this.name+"_frecords");if(event){var sTop=event.target.scrollTop,sLeft=event.target.scrollLeft;obj.last.scrollTop=sTop,obj.last.scrollLeft=sLeft,$("#grid_"+obj.name+"_columns")[0].scrollLeft=sLeft,$("#grid_"+obj.name+"_summary")[0].scrollLeft=sLeft,frecords[0].scrollTop=sTop}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var colStart=null,colEnd=null;if(obj.disableCVS||obj.columnGroups.length>0)colStart=0,colEnd=obj.columns.length-1;else{for(var sWidth=records.width(),cLeft=0,i=0;i<obj.columns.length;i++)if(!obj.columns[i].frozen&&!obj.columns[i].hidden){var cSize=parseInt(obj.columns[i].sizeCalculated?obj.columns[i].sizeCalculated:obj.columns[i].size);cLeft+cSize+30>obj.last.scrollLeft&&null==colStart&&(colStart=i),cLeft+cSize-30>obj.last.scrollLeft+sWidth&&null==colEnd&&(colEnd=i),cLeft+=cSize}null==colEnd&&(colEnd=obj.columns.length-1)}if(null!=colStart&&(colStart<0&&(colStart=0),colEnd<0&&(colEnd=0),colStart==colEnd&&(colStart>0?colStart--:colEnd++),colStart!=obj.last.colStart||colEnd!=obj.last.colEnd)){var $box=$(obj.box),deltaStart=Math.abs(colStart-obj.last.colStart),deltaEnd=Math.abs(colEnd-obj.last.colEnd);if(deltaStart<5&&deltaEnd<5){var $cfirst=$box.find(".w2ui-grid-columns #grid_"+obj.name+"_column_start"),$clast=$box.find(".w2ui-grid-columns .w2ui-head-last"),$rfirst=$box.find("#grid_"+obj.name+"_records .w2ui-grid-data-spacer"),$rlast=$box.find("#grid_"+obj.name+"_records .w2ui-grid-data-last"),$sfirst=$box.find("#grid_"+obj.name+"_summary .w2ui-grid-data-spacer"),$slast=$box.find("#grid_"+obj.name+"_summary .w2ui-grid-data-last");if(colStart>obj.last.colStart)for(var i=obj.last.colStart;i<colStart;i++)$box.find("#grid_"+obj.name+"_columns #grid_"+obj.name+"_column_"+i).remove(),$box.find("#grid_"+obj.name+'_records td[col="'+i+'"]').remove(),$box.find("#grid_"+obj.name+'_summary td[col="'+i+'"]').remove();if(colEnd<obj.last.colEnd)for(var i=obj.last.colEnd;i>colEnd;i--)$box.find("#grid_"+obj.name+"_columns #grid_"+obj.name+"_column_"+i).remove(),$box.find("#grid_"+obj.name+'_records td[col="'+i+'"]').remove(),$box.find("#grid_"+obj.name+'_summary td[col="'+i+'"]').remove();if(colStart<obj.last.colStart)for(var i=obj.last.colStart-1;i>=colStart;i--)obj.columns[i]&&(obj.columns[i].frozen||obj.columns[i].hidden)||($cfirst.after(obj.getColumnCellHTML(i)),$rfirst.each(function(ind,el){var index=$(el).parent().attr("index"),td='<td class="w2ui-grid-data" col="'+i+'" style="height: 0px"></td>';null!=index&&(td=obj.getCellHTML(parseInt(index),i,!1)),$(el).after(td)}),$sfirst.each(function(ind,el){var index=$(el).parent().attr("index"),td='<td class="w2ui-grid-data" col="'+i+'" style="height: 0px"></td>';null!=index&&(td=obj.getCellHTML(parseInt(index),i,!0)),$(el).after(td)}));if(colEnd>obj.last.colEnd)for(var i=obj.last.colEnd+1;i<=colEnd;i++)obj.columns[i]&&(obj.columns[i].frozen||obj.columns[i].hidden)||($clast.before(obj.getColumnCellHTML(i)),$rlast.each(function(ind,el){var index=$(el).parent().attr("index"),td='<td class="w2ui-grid-data" col="'+i+'" style="height: 0px"></td>';null!=index&&(td=obj.getCellHTML(parseInt(index),i,!1)),$(el).before(td)}),$slast.each(function(ind,el){var index=$(el).parent().attr("index"),td=obj.getCellHTML(parseInt(index),i,!0);$(el).before(td)}));obj.last.colStart=colStart,obj.last.colEnd=colEnd,obj.resizeRecords()}else{obj.last.colStart=colStart,obj.last.colEnd=colEnd;var colHTML=this.getColumnsHTML(),recHTML=this.getRecordsHTML(),sumHTML=this.getSummaryHTML(),$columns=$box.find("#grid_"+this.name+"_columns"),$records=$box.find("#grid_"+this.name+"_records"),$frecords=$box.find("#grid_"+this.name+"_frecords"),$summary=$box.find("#grid_"+this.name+"_summary");$columns.find("tbody").html(colHTML[1]),$frecords.html(recHTML[0]),$records.prepend(recHTML[1]),null!=sumHTML&&$summary.html(sumHTML[1]),setTimeout(function(){$records.find("> table").not("table:first-child").remove(),$summary[0]&&($summary[0].scrollLeft=obj.last.scrollLeft)},1),obj.resizeRecords()}}var buffered=this.records.length;if(0==this.searchData.length||url||(buffered=this.last.searchIds.length),0!==buffered&&0!==records.length&&0!==records.height()&&(buffered>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start,!(records.height()<buffered*this.recordHeight&&"hidden"==records.css("overflow-y")))){var t1=Math.round(records[0].scrollTop/this.recordHeight+1),t2=t1+(Math.round(records.height()/this.recordHeight)-1);if(t1>buffered&&(t1=buffered),t2>=buffered-1&&(t2=buffered),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((obj.show.statusRange?w2utils.formatNumber(this.offset+t1)+"-"+w2utils.formatNumber(this.offset+t2)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(url&&obj.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(buffered)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),url||this.fixedBody&&!(-1!=this.total&&this.total<=this.vs_start)){var start=Math.floor(records[0].scrollTop/this.recordHeight)-this.last.show_extra,end=start+Math.floor(records.height()/this.recordHeight)+2*this.last.show_extra+1;start<1&&(start=1),end>this.total&&-1!=this.total&&(end=this.total);var tr1=records.find("#grid_"+this.name+"_rec_top"),tr2=records.find("#grid_"+this.name+"_rec_bottom"),tr1f=frecords.find("#grid_"+this.name+"_frec_top"),tr2f=frecords.find("#grid_"+this.name+"_frec_bottom");-1!=String(tr1.next().prop("id")).indexOf("_expanded_row")&&(tr1.next().remove(),tr1f.next().remove()),this.total>end&&-1!=String(tr2.prev().prop("id")).indexOf("_expanded_row")&&(tr2.prev().remove(),tr2f.prev().remove());var first=parseInt(tr1.next().attr("line")),last=parseInt(tr2.prev().attr("line"));if(first<start||1==first||this.last.pull_refresh){if(end<=last+this.last.show_extra-2&&end!=this.total)return;for(this.last.pull_refresh=!1;;){var tmp1=frecords.find("#grid_"+this.name+"_frec_top").next(),tmp2;if("bottom"==(tmp2=records.find("#grid_"+this.name+"_rec_top").next()).attr("line"))break;if(!(parseInt(tmp2.attr("line"))<start))break;tmp1.remove(),tmp2.remove()}var tmp,rec_start;"top"==(rec_start=(tmp=records.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line"))&&(rec_start=start);for(var i=parseInt(rec_start)+1;i<=end;i++)if(this.records[i-1]){var tmp2;(tmp2=this.records[i-1].w2ui)&&!Array.isArray(tmp2.children)&&(tmp2.expanded=!1);var rec_html=this.getRecordHTML(i-1,i);tr2.before(rec_html[1]),tr2f.before(rec_html[0])}markSearch(),setTimeout(function(){obj.refreshRanges()},0)}else{if(start>=first-this.last.show_extra+2&&start>1)return;for(;;){var tmp1=frecords.find("#grid_"+this.name+"_frec_bottom").prev(),tmp2;if("top"==(tmp2=records.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line"))break;if(!(parseInt(tmp2.attr("line"))>end))break;tmp1.remove(),tmp2.remove()}var tmp,rec_start;"bottom"==(rec_start=(tmp=records.find("#grid_"+this.name+"_rec_top").next()).attr("line"))&&(rec_start=end);for(var i=parseInt(rec_start)-1;i>=start;i--)if(this.records[i-1]){var tmp2;(tmp2=this.records[i-1].w2ui)&&!Array.isArray(tmp2.children)&&(tmp2.expanded=!1);var rec_html=this.getRecordHTML(i-1,i);tr1.after(rec_html[1]),tr1f.after(rec_html[0])}markSearch(),setTimeout(function(){obj.refreshRanges()},0)}var h1=(start-1)*obj.recordHeight,h2=(buffered-end)*obj.recordHeight,s,e;if(h2<0&&(h2=0),tr1.css("height",h1+"px"),tr1f.css("height",h1+"px"),tr2.css("height",h2+"px"),tr2f.css("height",h2+"px"),obj.last.range_start=start,obj.last.range_end=end,Math.floor(records[0].scrollTop/this.recordHeight)+Math.floor(records.height()/this.recordHeight)+10>buffered&&!0!==this.last.pull_more&&(buffered<this.total-this.offset||-1==this.total&&this.last.xhr_hasMore))if(!0===this.autoLoad)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get");else{var more=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");"none"==more.css("display")&&more.show().on("click",function(){obj.last.pull_more=!0,obj.last.xhr_offset+=obj.limit,obj.request("get"),$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')}),(more.find("td .w2ui-spinner").length>0||-1==more.find("td").text().indexOf("Load"))&&more.find("td").html("<div>"+w2utils.lang("Load")+" "+obj.limit+" "+w2utils.lang("More")+"...</div>")}buffered>=this.total-this.offset&&-1!=this.total&&$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide()}}function markSearch(){obj.markSearch&&(clearTimeout(obj.last.marker_timer),obj.last.marker_timer=setTimeout(function(){for(var str=[],s=0;s<obj.searchData.length;s++){var sdata=obj.searchData[s],fld=obj.getSearch(sdata.field);fld&&!fld.hidden&&(-1==str.indexOf(sdata.value)&&str.push(sdata.value))}str.length>0&&$(obj.box).find(".w2ui-grid-data > div").w2marker(str)},50))}},getRecordHTML:function(ind,lineNum,summary){var tmph="",rec_html1="",rec_html2="",sel=this.last.selection,record;if(-1==ind){rec_html1+='<tr line="0">',rec_html2+='<tr line="0">',this.show.lineNumbers&&(rec_html1+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(rec_html1+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(rec_html1+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),rec_html2+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';for(var i=0;i<this.columns.length;i++){var col;if(tmph='<td class="w2ui-grid-data" col="'+i+'" style="height: 0px;"></td>',(col=this.columns[i]).frozen&&!col.hidden)rec_html1+=tmph;else{if(col.hidden||i<this.last.colStart||i>this.last.colEnd)continue;rec_html2+=tmph}}return rec_html1+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',rec_html2+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',[rec_html1+="</tr>",rec_html2+="</tr>"]}var url="object"!=typeof this.url?this.url:this.url.get;if(!0!==summary)if(this.searchData.length>0&&!url){if(ind>=this.last.searchIds.length)return"";ind=this.last.searchIds[ind],record=this.records[ind]}else{if(ind>=this.records.length)return"";record=this.records[ind]}else{if(ind>=this.summary.length)return"";record=this.summary[ind]}if(!record)return"";null==record.recid&&null!=this.recid&&null!=record[this.recid]&&(record.recid=record[this.recid]);var id=w2utils.escapeId(record.recid),isRowSelected=!1;-1!=sel.indexes.indexOf(ind)&&(isRowSelected=!0);var rec_style=record.w2ui?record.w2ui.style:"";null!=rec_style&&"string"==typeof rec_style||(rec_style="");var rec_class=record.w2ui?record.w2ui.class:"";if(null!=rec_class&&"string"==typeof rec_class||(rec_class=""),rec_html1+='<tr id="grid_'+this.name+"_frec_"+record.recid+'" recid="'+record.recid+'" line="'+lineNum+'" index="'+ind+'"  class="'+(lineNum%2==0?"w2ui-even":"w2ui-odd")+" "+rec_class+(isRowSelected&&"row"==this.selectType?" w2ui-selected":"")+(record.w2ui&&!1===record.w2ui.editable?" w2ui-no-edit":"")+(record.w2ui&&!0===record.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==summary?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(isRowSelected||""==rec_style?rec_style.replace("background-color","none"):rec_style)+'" '+(""!=rec_style?'custom_style="'+rec_style+'"':"")+">",rec_html2+='<tr id="grid_'+this.name+"_rec_"+record.recid+'" recid="'+record.recid+'" line="'+lineNum+'" index="'+ind+'"  class="'+(lineNum%2==0?"w2ui-even":"w2ui-odd")+" "+rec_class+(isRowSelected&&"row"==this.selectType?" w2ui-selected":"")+(record.w2ui&&!1===record.w2ui.editable?" w2ui-no-edit":"")+(record.w2ui&&!0===record.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==summary?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(isRowSelected||""==rec_style?rec_style.replace("background-color","none"):rec_style)+'" '+(""!=rec_style?'custom_style="'+rec_style+'"':"")+">",this.show.lineNumbers&&(rec_html1+='<td id="grid_'+this.name+"_cell_"+ind+"_number"+(summary?"_s":"")+'"    class="w2ui-col-number '+(isRowSelected?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==summary?this.getLineHTML(lineNum,record):"")+"</td>"),this.show.selectColumn&&(rec_html1+='<td id="grid_'+this.name+"_cell_"+ind+"_select"+(summary?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0!==summary?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(isRowSelected?'checked="checked"':"")+' style="pointer-events: none"/>    </div>':"")+"</td>"),this.show.expandColumn){var tmp_img="";tmp_img=record.w2ui&&!0===record.w2ui.expanded?"-":"+",record.w2ui&&"none"==record.w2ui.expanded&&(tmp_img=""),record.w2ui&&"spinner"==record.w2ui.expanded&&(tmp_img='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),rec_html1+='<td id="grid_'+this.name+"_cell_"+ind+"_expand"+(summary?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==summary?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+tmp_img+" </div>":"")+"</td>"}rec_html2+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var col_ind=0,col_skip=0;;){var col_span=1,col;if(null==(col=this.columns[col_ind]))break;if(col.hidden)col_ind++,col_skip>0&&col_skip--;else if(col_skip>0){if(col_ind++,null==this.columns[col_ind])break;record.w2ui.colspan[this.columns[col_ind-1].field]=0,col_skip--}else{if(record.w2ui){var tmp1=record.w2ui.colspan,tmp2=this.columns[col_ind].field;tmp1&&0===tmp1[tmp2]&&delete tmp1[tmp2]}if(!(col_ind<this.last.colStart||col_ind>this.last.colEnd)||col.frozen){if(record.w2ui&&"object"==typeof record.w2ui.colspan){var span=parseInt(record.w2ui.colspan[col.field])||null;if(span>1){for(var hcnt=0,i=col_ind;i<col_ind+span&&!(i>=this.columns.length);i++)this.columns[i].hidden&&hcnt++;col_span=span-hcnt,col_skip=span-1}}var rec_cell=this.getCellHTML(ind,col_ind,summary,col_span);col.frozen?rec_html1+=rec_cell:rec_html2+=rec_cell,col_ind++}else col_ind++}}return rec_html1+='<td class="w2ui-grid-data-last"></td>',rec_html2+='<td class="w2ui-grid-data-last" col="end"></td>',[rec_html1+="</tr>",rec_html2+="</tr>"]},getLineHTML:function(lineNum){return"<div>"+lineNum+"</div>"},getCellHTML:function(ind,col_ind,summary,col_span){var col=this.columns[col_ind];if(null==col)return"";var record=!0!==summary?this.records[ind]:this.summary[ind],data=this.getCellValue(ind,col_ind,summary),edit=this.getCellEditable(ind,col_ind),style="max-height: "+parseInt(this.recordHeight)+"px;",isChanged=!summary&&record&&record.w2ui&&record.w2ui.changes&&null!=record.w2ui.changes[col.field],addStyle="",addClass="",sel=this.last.selection,isRowSelected=!1,infoBubble="";if(-1!=sel.indexes.indexOf(ind)&&(isRowSelected=!0),null==col_span&&(col_span=record&&record.w2ui&&record.w2ui.colspan&&record.w2ui.colspan[col.field]?record.w2ui.colspan[col.field]:1),0===col_ind&&record&&record.w2ui&&Array.isArray(record.w2ui.children)){for(var level=0,subrec=this.get(record.w2ui.parent_recid,!0);null!=subrec;){var tmp;if(level++,null==(tmp=this.records[subrec].w2ui)||null==tmp.parent_recid)break;subrec=this.get(tmp.parent_recid,!0)}if(record.w2ui.parent_recid)for(var i=0;i<level;i++)infoBubble+='<span class="w2ui-show-children w2ui-icon-empty"></span>';infoBubble+='<span class="w2ui-show-children '+(record.w2ui.children.length>0?record.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(!0===col.info&&(col.info={}),null!=col.info&&(col.info.icon||(col.info.icon="w2ui-icon-info"),infoBubble+='<span class="w2ui-info '+col.info.icon+'" style="'+(col.info.style||"")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+ind+", "+col_ind+')"></span>'),null!=col.render){if("function"==typeof col.render&&((data=$.trim(col.render.call(this,record,ind,col_ind,data))).length<4||"<div"!=data.substr(0,4).toLowerCase())&&(data='<div style="'+style+'">'+infoBubble+String(data)+"</div>"),"object"==typeof col.render&&(data='<div style="'+style+'">'+infoBubble+(col.render[data]||"")+"</div>"),"string"==typeof col.render){var t=col.render.toLowerCase().indexOf(":"),tmp=[];-1==t?(tmp[0]=col.render.toLowerCase(),tmp[1]=""):(tmp[0]=col.render.toLowerCase().substr(0,t),tmp[1]=col.render.toLowerCase().substr(t+1));var func=w2utils.formatters[tmp[0]];data='<div style="'+style+'">'+infoBubble+("function"==typeof func?func(data,tmp[1]):"")+"</div>"}}else{if(edit&&-1!=["checkbox","check"].indexOf(edit.type)){var changeInd=summary?-(ind+1):ind;style+="text-align: center;",data='<input tabindex="-1" type="checkbox" '+(data?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+changeInd+", "+col_ind+', event); "/>',infoBubble=""}if(this.show.recordTitles){var title=w2utils.stripTags(String(data).replace(/"/g,"''"));null!=col.title&&("function"==typeof col.title&&(title=col.title.call(this,record,ind,col_ind)),"string"==typeof col.title&&(title=col.title))}data='<div style="'+style+'" title="'+(title||"")+'">'+infoBubble+String(data)+"</div>"}if(null==data&&(data=""),"string"==typeof col.render){var tmp=col.render.toLowerCase().split(":");-1!=["number","int","float","money","currency","percent","size"].indexOf(tmp[0])&&(addStyle+="text-align: right;")}record&&record.w2ui&&("object"==typeof record.w2ui.style&&("string"==typeof record.w2ui.style[col_ind]&&(addStyle+=record.w2ui.style[col_ind]+";"),"string"==typeof record.w2ui.style[col.field]&&(addStyle+=record.w2ui.style[col.field]+";")),"object"==typeof record.w2ui.class&&("string"==typeof record.w2ui.class[col_ind]&&(addClass+=record.w2ui.class[col_ind]+" "),"string"==typeof record.w2ui.class[col.field]&&(addClass+=record.w2ui.class[col.field]+" ")));var isCellSelected=!1;return isRowSelected&&-1!=$.inArray(col_ind,sel.columns[ind])&&(isCellSelected=!0),data='<td class="w2ui-grid-data'+(isCellSelected?" w2ui-selected":"")+" "+addClass+(isChanged?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+ind+"_"+col_ind+'" col="'+col_ind+'"    style="'+addStyle+(null!=col.style?col.style:"")+'" '+(null!=col.attr?col.attr:"")+(col_span>1?'colspan="'+col_span+'"':"")+">"+data+"</td>"},showBubble:function(ind,col_ind){var html="",info=this.columns[col_ind].info,rec=this.records[ind],el=$(this.box).find("#grid_"+this.name+"_data_"+ind+"_"+col_ind+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=el,null==info.fields){info.fields=[];for(var i=0;i<this.columns.length;i++){var col=this.columns[i];info.fields.push(col.field+("string"==typeof col.render?":"+col.render:""))}}var fields=info.fields;if("function"==typeof fields&&(fields=fields(rec,ind,col_ind)),"function"==typeof info.render)html=info.render(rec,ind,col_ind);else if($.isArray(fields)){html='<table cellpadding="0" cellspacing="0">';for(var i=0;i<fields.length;i++){var tmp;if(""!=(tmp=String(fields[i]).split(":"))[0]&&"-"!=tmp[0]&&"--"!=tmp[0]&&"---"!=tmp[0]){var col;null==(col=this.getColumn(tmp[0]))&&(col={field:tmp[0],caption:tmp[0]});var val=col?this.parseField(rec,col.field):"";tmp.length>1&&(w2utils.formatters[tmp[1]]?val=w2utils.formatters[tmp[1]](val,tmp[2]||null):console.log('ERROR: w2utils.formatters["'+tmp[1]+'"] does not exists.')),(!0===info.showEmpty||null!=val&&""!=val)&&(null!=info.maxLength&&"string"==typeof val&&val.length>info.maxLength&&(val=val.substr(0,info.maxLength)+"..."),html+="<tr><td>"+col.caption+"</td><td>"+((0===val?"0":val)||"")+"</td></tr>")}else html+='<tr><td colspan=2><div style="border-top: '+(""==tmp[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}html+="</table>"}else if($.isPlainObject(fields)){for(var caption in html='<table cellpadding="0" cellspacing="0">',fields){var fld=fields[caption];if(""!=fld&&"-"!=fld&&"--"!=fld&&"---"!=fld){var tmp=String(fld).split(":"),col;null==(col=this.getColumn(tmp[0]))&&(col={field:tmp[0],caption:tmp[0]});var val=col?this.parseField(rec,col.field):"";tmp.length>1&&(w2utils.formatters[tmp[1]]?val=w2utils.formatters[tmp[1]](val,tmp[2]||null):console.log('ERROR: w2utils.formatters["'+tmp[1]+'"] does not exists.')),"function"==typeof fld&&(val=fld(rec,ind,col_ind)),(!0===info.showEmpty||null!=val&&""!=val)&&(null!=info.maxLength&&"string"==typeof val&&val.length>info.maxLength&&(val=val.substr(0,info.maxLength)+"..."),html+="<tr><td>"+caption+"</td><td>"+(val||"")+"</td></tr>")}else html+='<tr><td colspan=2><div style="border-top: '+(""==fld?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}html+="</table>"}$(el).w2tag($.extend({html:html,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},info.options||{}))},getCellEditable:function(ind,col_ind){var col=this.columns[col_ind],rec=this.records[ind];if(!rec||!col)return null;var edit=rec.w2ui?rec.w2ui.editable:null;if(!1===edit)return null;if((null==edit||!0===edit)&&"function"==typeof(edit=col?col.editable:null)){var data=this.getCellValue(ind,col_ind,!1);edit=edit.call(this,rec,ind,col_ind,data)}return edit},getCellValue:function(ind,col_ind,summary){var col=this.columns[col_ind],record=!0!==summary?this.records[ind]:this.summary[ind],data=this.parseField(record,col.field);return record&&record.w2ui&&record.w2ui.changes&&null!=record.w2ui.changes[col.field]&&(data=record.w2ui.changes[col.field]),$.isPlainObject(data)&&col.editable&&(null!=data.text&&(data=data.text),null!=data.id&&(data=data.id)),null==data&&(data=""),data},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(msg){if(null!=msg)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(msg);else{var msgLeft="",sel=this.getSelection();if(sel.length>0&&(this.show.statusSelection&&sel.length>1&&(msgLeft=String(sel.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==sel.length)){var tmp=sel[0];"object"==typeof tmp&&(tmp=tmp.recid+", "+w2utils.lang("Column")+": "+tmp.column),msgLeft=w2utils.lang("Record ID")+": "+tmp+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(msgLeft),1==sel.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),sel.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(msg,showSpinner){var obj=this,args=Array.prototype.slice.call(arguments,0);args.unshift(this.box),setTimeout(function(){$(obj.box).find("#grid_"+obj.name+"_empty_msg").remove(),w2utils.lock.apply(window,args)},10)},unlock:function(speed){var box=this.box;setTimeout(function(){$(box).find(".w2ui-message").not(".w2ui-closing").length>0||w2utils.unlock(box,speed)},25)},stateSave:function(returnOnly){var obj=this;if(!w2utils.hasLocalStorage)return null;for(var state={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},i=0;i<this.columns.length;i++){var col=this.columns[i];state.columns.push({field:col.field,hidden:!!col.hidden,frozen:!!col.frozen,size:col.size?col.size:null,sizeCalculated:col.sizeCalculated?col.sizeCalculated:null,sizeOriginal:col.sizeOriginal?col.sizeOriginal:null,sizeType:col.sizeType?col.sizeType:null})}for(var i=0;i<this.sortData.length;i++)state.sortData.push($.extend({},this.sortData[i]));for(var i=0;i<this.searchData.length;i++)state.searchData.push($.extend({},this.searchData[i]));if(!0!==returnOnly){var edata=this.trigger({phase:"before",type:"stateSave",target:this.name,state:state});if(!0===edata.isCancelled)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var savedState=$.parseJSON(localStorage.w2ui||"{}");savedState||(savedState={}),savedState.states||(savedState.states={}),savedState.states[this.stateId||this.name]=state,localStorage.w2ui=JSON.stringify(savedState)}catch(e){return delete localStorage.w2ui,null}this.trigger($.extend(edata,{phase:"after"}))}return state},stateRestore:function(newState){var obj=this,url="object"!=typeof this.url?this.url:this.url.get;if(!newState)try{if(!w2utils.hasLocalStorage)return!1;var tmp;(tmp=$.parseJSON(localStorage.w2ui||"{}"))||(tmp={}),tmp.states||(tmp.states={}),newState=tmp.states[this.stateId||this.name]}catch(e){return delete localStorage.w2ui,null}var edata=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:newState});if(!0!==edata.isCancelled){if($.isPlainObject(newState)){$.extend(this.show,newState.show),$.extend(this.last,newState.last);for(var sTop=this.last.scrollTop,sLeft=this.last.scrollLeft,c=0;c<newState.columns.length;c++){var tmp=newState.columns[c],col_index=this.getColumn(tmp.field,!0);null!==col_index&&($.extend(this.columns[col_index],tmp),c!==col_index&&this.columns.splice(c,0,this.columns.splice(col_index,1)[0]))}this.sortData.splice(0,this.sortData.length);for(var c=0;c<newState.sortData.length;c++)this.sortData.push(newState.sortData[c]);this.searchData.splice(0,this.searchData.length);for(var c=0;c<newState.searchData.length;c++)this.searchData.push(newState.searchData[c]);setTimeout(function(){url||(obj.sortData.length>0&&obj.localSort(),obj.searchData.length>0&&obj.localSearch()),obj.last.scrollTop=sTop,obj.last.scrollLeft=sLeft,obj.refresh()},1)}return this.trigger($.extend(edata,{phase:"after"})),!0}"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},stateReset:function(){var obj=this;if(this.stateRestore(this.last.state),w2utils.hasLocalStorage)try{var tmp=$.parseJSON(localStorage.w2ui||"{}");tmp.states&&tmp.states[this.stateId||this.name]&&delete tmp.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(tmp)}catch(e){return delete localStorage.w2ui,null}},parseField:function(obj,field){var val="";try{val=obj;for(var tmp=String(field).split("."),i=0;i<tmp.length;i++)val=val[tmp[i]]}catch(event){val=""}return val},prepareData:function(){for(var obj=this,r=0;r<this.records.length;r++){var rec;prepareRecord(this.records[r])}function prepareRecord(rec){for(var c=0;c<obj.columns.length;c++){var column=obj.columns[c];if(null!=rec[column.field]&&"string"==typeof column.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(column.render.split(":")[0])&&"number"!=typeof rec[column.field]&&(rec[column.field]=parseFloat(rec[column.field])),-1!=["date","age"].indexOf(column.render.split(":")[0])&&!rec[column.field+"_"]){var dt=rec[column.field];w2utils.isInt(dt)&&(dt=parseInt(dt)),rec[column.field+"_"]=new Date(dt)}if(-1!=["time"].indexOf(column.render))if(w2utils.isTime(rec[column.field])){var tmp=w2utils.isTime(rec[column.field],!0),dt;(dt=new Date).setHours(tmp.hours,tmp.minutes,tmp.seconds?tmp.seconds:0,0),rec[column.field+"_"]||(rec[column.field+"_"]=dt)}else{var tmp=rec[column.field];w2utils.isInt(tmp)&&(tmp=parseInt(tmp));var tmp=null!=tmp?new Date(tmp):new Date,dt;(dt=new Date).setHours(tmp.getHours(),tmp.getMinutes(),tmp.getSeconds(),0),rec[column.field+"_"]||(rec[column.field+"_"]=dt)}}}if(rec.w2ui&&rec.w2ui.children&&!0!==rec.w2ui.expanded)for(var r=0;r<rec.w2ui.children.length;r++){var subRec;prepareRecord(rec.w2ui.children[r])}}},nextCell:function(index,col_ind,editable){var check=col_ind+1;if(check>=this.columns.length)return null;var tmp=this.records[index].w2ui,ccol=this.columns[col_ind],col=this.columns[check],span=tmp&&tmp.colspan&&!isNaN(tmp.colspan[col.field])?parseInt(tmp.colspan[col.field]):1;if(null==col)return null;if(col&&col.hidden||0===span)return this.nextCell(index,check,editable);if(editable){var edit=this.getCellEditable(index,col_ind);if(null==edit||-1!=["checkbox","check"].indexOf(edit.type))return this.nextCell(index,check,editable)}return check},prevCell:function(index,col_ind,editable){var check=col_ind-1;if(check<0)return null;var tmp=this.records[index].w2ui,col=this.columns[check],span=tmp&&tmp.colspan&&!isNaN(tmp.colspan[col.field])?parseInt(tmp.colspan[col.field]):1;if(null==col)return null;if(col&&col.hidden||0===span)return this.prevCell(index,check,editable);if(editable){var edit=this.getCellEditable(index,col_ind);if(null==edit||-1!=["checkbox","check"].indexOf(edit.type))return this.prevCell(index,check,editable)}return check},nextRow:function(ind,col_ind){var sids=this.last.searchIds,ret=null;if(ind+1<this.records.length&&0===sids.length||sids.length>0&&ind<sids[sids.length-1]){if(ind++,sids.length>0)for(;!(-1!=$.inArray(ind,sids)||ind>this.records.length);)ind++;var tmp=this.records[ind].w2ui,col=this.columns[col_ind],span;ret=0===(tmp&&tmp.colspan&&null!=col&&!isNaN(tmp.colspan[col.field])?parseInt(tmp.colspan[col.field]):1)?this.nextRow(ind,col_ind):ind}return ret},prevRow:function(ind,col_ind){var sids=this.last.searchIds,ret=null;if(ind>0&&0===sids.length||sids.length>0&&ind>sids[0]){if(ind--,sids.length>0)for(;!(-1!=$.inArray(ind,sids)||ind<0);)ind--;var tmp=this.records[ind].w2ui,col=this.columns[col_ind],span;ret=0===(tmp&&tmp.colspan&&null!=col&&!isNaN(tmp.colspan[col.field])?parseInt(tmp.colspan[col.field]):1)?this.prevRow(ind,col_ind):ind}return ret},selectionSave:function(){return this.last._selection=this.getSelection(),this.last._selection},selectionRestore:function(noRefresh){var time=(new Date).getTime();this.last.selection={indexes:[],columns:{}};for(var sel=this.last.selection,lst=this.last._selection,i=0;i<lst.length;i++){var tmp,tmp;if($.isPlainObject(lst[i]))null!=(tmp=this.get(lst[i].recid,!0))&&(-1==sel.indexes.indexOf(tmp)&&sel.indexes.push(tmp),sel.columns[tmp]||(sel.columns[tmp]=[]),sel.columns[tmp].push(lst[i].column));else null!=(tmp=this.get(lst[i],!0))&&sel.indexes.push(tmp)}return delete this.last._selection,!0!==noRefresh&&this.refresh(),(new Date).getTime()-time},message:function(options,callBack){"string"==typeof options&&(options={width:options.length<300?350:550,height:options.length<300?170:250,body:'<div class="w2ui-centered">'+options+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(event){setTimeout(function(){$(this.box).find(".w2ui-btn").focus()},25)},onClose:function(even){"function"==typeof callBack&&callBack()}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},options)}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery),function($){var w2layout=function(options){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",$.extend(!0,this,w2obj.layout,options)},w2panels=["top","left","main","preview","right","bottom"];$.fn.w2layout=function(method){if($.isPlainObject(method)){if(!w2utils.checkName(method,"w2layout"))return;var panels=method.panels||[],object=new w2layout(method);$.extend(object,{handlers:[],panels:[]});for(var p=0,len=panels.length;p<len;p++)object.panels[p]=$.extend(!0,{},w2layout.prototype.panel,panels[p]),($.isPlainObject(object.panels[p].tabs)||$.isArray(object.panels[p].tabs))&&initTabs(object,panels[p].type),($.isPlainObject(object.panels[p].toolbar)||$.isArray(object.panels[p].toolbar))&&initToolbar(object,panels[p].type);for(var p1=0;p1<w2panels.length;p1++)null==object.get(w2panels[p1])&&object.panels.push($.extend(!0,{},w2layout.prototype.panel,{type:w2panels[p1],hidden:"main"!==w2panels[p1],size:50}));return $(this).length>0&&object.render($(this)[0]),w2ui[object.name]=object,object}var obj=w2ui[$(this).attr("name")];return obj?arguments.length>0?(obj[method]&&obj[method].apply(obj,Array.prototype.slice.call(arguments,1)),this):obj:null;function initTabs(object,panel,tabs){var pan=object.get(panel);return null!=pan&&null==tabs&&(tabs=pan.tabs),null!=pan&&null!=tabs&&($.isArray(tabs)&&(tabs={tabs:tabs}),$().w2destroy(object.name+"_"+panel+"_tabs"),pan.tabs=$().w2tabs($.extend({},tabs,{owner:object,name:object.name+"_"+panel+"_tabs"})),pan.show.tabs=!0,!0)}function initToolbar(object,panel,toolbar){var pan=object.get(panel);return null!=pan&&null==toolbar&&(toolbar=pan.toolbar),null!=pan&&null!=toolbar&&($.isArray(toolbar)&&(toolbar={items:toolbar}),$().w2destroy(object.name+"_"+panel+"_toolbar"),pan.toolbar=$().w2toolbar($.extend({},toolbar,{owner:object,name:object.name+"_"+panel+"_toolbar"})),pan.show.toolbar=!0,!0)}},w2layout.prototype={onShow:null,onHide:null,onResizing:null,onResizerClick:null,onRender:null,onRefresh:null,onContent:null,onResize:null,onDestroy:null,panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(panel,data,transition){return this.content(panel,data,transition)},content:function(panel,data,transition){var obj=this,p=this.get(panel);if("css"==panel)return $("#layout_"+obj.name+"_panel_css").html("<style>"+data+"</style>"),!0;if(null==p)return!1;if(null==data)return p.content;var edata=this.trigger({phase:"before",type:"content",target:panel,object:p,content:data,transition:transition});if(!0!==edata.isCancelled){if(data instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1;var pname="#layout_"+this.name+"_panel_"+p.type,current=$(pname+"> .w2ui-panel-content"),panelTop=0;if(current.length>0&&($(pname).scrollTop(0),panelTop=$(current).position().top),""===p.content)p.content=data,this.refresh(panel);else{if(p.content=data,!p.hidden&&null!=transition&&""!==transition){var div1=$(pname+"> .w2ui-panel-content");div1.after('<div class="w2ui-panel-content new-panel" style="'+div1[0].style.cssText+'"></div>');var div2=$(pname+"> .w2ui-panel-content.new-panel");div1.css("top",panelTop),div2.css("top",panelTop),"object"==typeof data?(data.box=div2[0],data.render()):div2.html(data),w2utils.transition(div1[0],div2[0],transition,function(){div1.remove(),div2.removeClass("new-panel"),div2.css("overflow",p.overflow),obj.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){obj.resize()},100)})}this.refresh(panel)}return obj.trigger($.extend(edata,{phase:"after"})),obj.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){obj.resize()},100),!0}},message:function(panel,options){var obj=this;"string"==typeof options&&(options={width:options.length<300?350:550,height:options.length<300?170:250,body:'<div class="w2ui-centered">'+options+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message('"+panel+"')\">Ok</button>",onOpen:function(event){setTimeout(function(){$(this.box).find(".w2ui-btn").focus()},25)}});var p=this.get(panel),$el,oldOverflow=$("#layout_"+this.name+"_panel_"+p.type).css("overflow"),oldOnClose;options&&(options.onClose&&(oldOnClose=options.onClose),options.onClose=function(event){"function"==typeof oldOnClose&&oldOnClose(event),event.done(function(){$("#layout_"+obj.name+"_panel_"+p.type).css("overflow",oldOverflow)})}),$("#layout_"+this.name+"_panel_"+p.type).css("overflow","hidden"),w2utils.message.call(this,{box:$("#layout_"+this.name+"_panel_"+p.type),param:panel,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},options)},load:function(panel,url,transition,onLoad){var obj=this;return"css"==panel?($.get(url,function(data,status,xhr){obj.content(panel,xhr.responseText),onLoad&&onLoad()}),!0):null!=this.get(panel)&&($.get(url,function(data,status,xhr){obj.content(panel,xhr.responseText,transition),onLoad&&onLoad(),obj.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){obj.resize()},100)}),!0)},sizeTo:function(panel,size,instant){var obj=this,pan;return null!=obj.get(panel)&&($(obj.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",!0!==instant?".2s":"0s")),setTimeout(function(){obj.set(panel,{size:size})},1),setTimeout(function(){$(obj.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),obj.resize()},500),!0)},show:function(panel,immediate){var obj=this,edata=this.trigger({phase:"before",type:"show",target:panel,object:this.get(panel),immediate:immediate});if(!0!==edata.isCancelled){var p=obj.get(panel);return null!=p&&(p.hidden=!1,!0===immediate?($("#layout_"+obj.name+"_panel_"+panel).css({opacity:"1"}),obj.trigger($.extend(edata,{phase:"after"})),obj.resize()):($("#layout_"+obj.name+"_panel_"+panel).css({opacity:"0"}),$(obj.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout(function(){obj.resize()},1),setTimeout(function(){$("#layout_"+obj.name+"_panel_"+panel).css({opacity:"1"})},250),setTimeout(function(){$(obj.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),obj.trigger($.extend(edata,{phase:"after"})),obj.resize()},500)),!0)}},hide:function(panel,immediate){var obj=this,edata=this.trigger({phase:"before",type:"hide",target:panel,object:this.get(panel),immediate:immediate});if(!0!==edata.isCancelled){var p=obj.get(panel);return null!=p&&(p.hidden=!0,!0===immediate?($("#layout_"+obj.name+"_panel_"+panel).css({opacity:"0"}),obj.trigger($.extend(edata,{phase:"after"})),obj.resize()):($(obj.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),$("#layout_"+obj.name+"_panel_"+panel).css({opacity:"0"}),setTimeout(function(){obj.resize()},1),setTimeout(function(){$(obj.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),obj.trigger($.extend(edata,{phase:"after"})),obj.resize()},500)),!0)}},toggle:function(panel,immediate){var p=this.get(panel);return null!=p&&(p.hidden?this.show(panel,immediate):this.hide(panel,immediate))},set:function(panel,options){var ind=this.get(panel,!0);return null!=ind&&($.extend(this.panels[ind],options),null==options.content&&null==options.resizable||this.refresh(panel),this.resize(),!0)},get:function(panel,returnIndex){for(var p=0;p<this.panels.length;p++)if(this.panels[p].type==panel)return!0===returnIndex?p:this.panels[p];return null},el:function(panel){var el=$("#layout_"+this.name+"_panel_"+panel+"> .w2ui-panel-content");return 1!=el.length?null:el[0]},hideToolbar:function(panel){var pan=this.get(panel);pan&&(pan.show.toolbar=!1,$("#layout_"+this.name+"_panel_"+panel+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(panel){var pan=this.get(panel);pan&&(pan.show.toolbar=!0,$("#layout_"+this.name+"_panel_"+panel+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(panel){var pan=this.get(panel);pan&&(pan.show.toolbar?this.hideToolbar(panel):this.showToolbar(panel))},assignToolbar:function(panel,toolbar){"string"==typeof toolbar&&null!=w2ui[toolbar]&&(toolbar=w2ui[toolbar]);var pan=this.get(panel);pan.toolbar=toolbar;var tmp=$(this.box).find(panel+"> .w2ui-panel-toolbar");null!=pan.toolbar?(0===tmp.find("[name="+pan.toolbar.name+"]").length?tmp.w2render(pan.toolbar):null!=pan.toolbar&&pan.toolbar.refresh(),this.showToolbar(panel),this.refresh("main")):(tmp.html(""),this.hideToolbar(panel))},hideTabs:function(panel){var pan=this.get(panel);pan&&(pan.show.tabs=!1,$("#layout_"+this.name+"_panel_"+panel+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(panel){var pan=this.get(panel);pan&&(pan.show.tabs=!0,$("#layout_"+this.name+"_panel_"+panel+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(panel){var pan=this.get(panel);pan&&(pan.show.tabs?this.hideTabs(panel):this.showTabs(panel))},render:function(box){var obj=this,time=(new Date).getTime(),edata=obj.trigger({phase:"before",type:"render",target:obj.name,box:box});if(!0!==edata.isCancelled){if(null!=box&&($(obj.box).find("#layout_"+obj.name+"_panel_main").length>0&&$(obj.box).removeAttr("name").removeClass("w2ui-layout").html(""),obj.box=box),!obj.box)return!1;$(obj.box).attr("name",obj.name).addClass("w2ui-layout").html("<div></div>"),$(obj.box).length>0&&($(obj.box)[0].style.cssText+=obj.style);for(var p1=0;p1<w2panels.length;p1++){var pan=obj.get(w2panels[p1]),html='<div id="layout_'+obj.name+"_panel_"+w2panels[p1]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+obj.name+"_resizer_"+w2panels[p1]+'" class="w2ui-resizer"></div>';$(obj.box).find(" > div").append(html)}return $(obj.box).find(" > div").append('<div id="layout_'+obj.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),obj.refresh(),obj.trigger($.extend(edata,{phase:"after"})),setTimeout(function(){initEvents(),obj.resize()},0),(new Date).getTime()-time}function initEvents(){obj.tmp.events={resize:function(event){w2ui[obj.name].resize()},resizeStart:resizeStart,mouseMove:resizeMove,mouseUp:resizeStop},$(window).on("resize",obj.tmp.events.resize)}function resizeStart(type,evnt){if(obj.box){evnt||(evnt=window.event),$(document).off("mousemove",obj.tmp.events.mouseMove).on("mousemove",obj.tmp.events.mouseMove),$(document).off("mouseup",obj.tmp.events.mouseUp).on("mouseup",obj.tmp.events.mouseUp),obj.tmp.resize={type:type,x:evnt.screenX,y:evnt.screenY,diff_x:0,diff_y:0,value:0};for(var p1=0;p1<w2panels.length;p1++){var $tmp=$(obj.el(w2panels[p1])).parent().find(".w2ui-lock");$tmp.length>0?$tmp.attr("locked","previous"):obj.lock(w2panels[p1],{opacity:0})}"left"!=type&&"right"!=type||(obj.tmp.resize.value=parseInt($("#layout_"+obj.name+"_resizer_"+type)[0].style.left)),"top"!=type&&"preview"!=type&&"bottom"!=type||(obj.tmp.resize.value=parseInt($("#layout_"+obj.name+"_resizer_"+type)[0].style.top))}}function resizeStop(evnt){if(obj.box&&(evnt||(evnt=window.event),$(document).off("mousemove",obj.tmp.events.mouseMove),$(document).off("mouseup",obj.tmp.events.mouseUp),null!=obj.tmp.resize)){for(var p1=0;p1<w2panels.length;p1++){var $tmp=$(obj.el(w2panels[p1])).parent().find(".w2ui-lock");"previous"==$tmp.attr("locked")?$tmp.removeAttr("locked"):obj.unlock(w2panels[p1])}if(0!==obj.tmp.diff_x||0!==obj.tmp.resize.diff_y){var ptop=obj.get("top"),pbottom=obj.get("bottom"),panel=obj.get(obj.tmp.resize.type),height=parseInt($(obj.box).height()),width=parseInt($(obj.box).width()),str=String(panel.size),ns,nd;switch(obj.tmp.resize.type){case"top":ns=parseInt(panel.sizeCalculated)+obj.tmp.resize.diff_y,nd=0;break;case"bottom":ns=parseInt(panel.sizeCalculated)-obj.tmp.resize.diff_y,nd=0;break;case"preview":ns=parseInt(panel.sizeCalculated)-obj.tmp.resize.diff_y,nd=(ptop&&!ptop.hidden?ptop.sizeCalculated:0)+(pbottom&&!pbottom.hidden?pbottom.sizeCalculated:0);break;case"left":ns=parseInt(panel.sizeCalculated)+obj.tmp.resize.diff_x,nd=0;break;case"right":ns=parseInt(panel.sizeCalculated)-obj.tmp.resize.diff_x,nd=0}"%"==str.substr(str.length-1)?panel.size=Math.floor(100*ns/("left"==panel.type||"right"==panel.type?width:height-nd)*100)/100+"%":"-"==String(panel.size).substr(0,1)?panel.size=parseInt(panel.size)-panel.sizeCalculated+ns:panel.size=ns,obj.resize()}$("#layout_"+obj.name+"_resizer_"+obj.tmp.resize.type).removeClass("active"),delete obj.tmp.resize}}function resizeMove(evnt){if(obj.box&&(evnt||(evnt=window.event),null!=obj.tmp.resize)){var panel=obj.get(obj.tmp.resize.type),tmp=obj.tmp.resize,edata=obj.trigger({phase:"before",type:"resizing",target:obj.name,object:panel,originalEvent:evnt,panel:tmp?tmp.type:"all",diff_x:tmp?tmp.diff_x:0,diff_y:tmp?tmp.diff_y:0});if(!0!==edata.isCancelled){var p=$("#layout_"+obj.name+"_resizer_"+tmp.type),resize_x=evnt.screenX-tmp.x,resize_y=evnt.screenY-tmp.y,mainPanel=obj.get("main");switch(p.hasClass("active")||p.addClass("active"),tmp.type){case"left":panel.minSize-resize_x>panel.width&&(resize_x=panel.minSize-panel.width),panel.maxSize&&panel.width+resize_x>panel.maxSize&&(resize_x=panel.maxSize-panel.width),mainPanel.minSize+resize_x>mainPanel.width&&(resize_x=mainPanel.width-mainPanel.minSize);break;case"right":panel.minSize+resize_x>panel.width&&(resize_x=panel.width-panel.minSize),panel.maxSize&&panel.width-resize_x>panel.maxSize&&(resize_x=panel.width-panel.maxSize),mainPanel.minSize-resize_x>mainPanel.width&&(resize_x=mainPanel.minSize-mainPanel.width);break;case"top":panel.minSize-resize_y>panel.height&&(resize_y=panel.minSize-panel.height),panel.maxSize&&panel.height+resize_y>panel.maxSize&&(resize_y=panel.maxSize-panel.height),mainPanel.minSize+resize_y>mainPanel.height&&(resize_y=mainPanel.height-mainPanel.minSize);break;case"preview":case"bottom":panel.minSize+resize_y>panel.height&&(resize_y=panel.height-panel.minSize),panel.maxSize&&panel.height-resize_y>panel.maxSize&&(resize_y=panel.height-panel.maxSize),mainPanel.minSize-resize_y>mainPanel.height&&(resize_y=mainPanel.minSize-mainPanel.height)}switch(tmp.diff_x=resize_x,tmp.diff_y=resize_y,tmp.type){case"top":case"preview":case"bottom":tmp.diff_x=0,p.length>0&&(p[0].style.top=tmp.value+tmp.diff_y+"px");break;case"left":case"right":tmp.diff_y=0,p.length>0&&(p[0].style.left=tmp.value+tmp.diff_x+"px")}obj.trigger($.extend(edata,{phase:"after"}))}}}},refresh:function(panel){var obj=this;null==panel&&(panel=null);var time=(new Date).getTime(),edata=obj.trigger({phase:"before",type:"refresh",target:null!=panel?panel:obj.name,object:obj.get(panel)});if(!0!==edata.isCancelled){if("string"==typeof panel){var p=obj.get(panel);if(null==p)return;var pname="#layout_"+obj.name+"_panel_"+p.type,rname="#layout_"+obj.name+"_resizer_"+p.type;$(pname).css({display:p.hidden?"none":"block"}),p.resizable?$(rname).show():$(rname).hide(),"object"==typeof p.content&&"function"==typeof p.content.render?(p.content.box=$(pname+"> .w2ui-panel-content")[0],setTimeout(function(){$(pname+"> .w2ui-panel-content").length>0&&($(pname+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",p.overflow)[0].style.cssText+=";"+p.style),p.content&&"function"==typeof p.content.render&&p.content.render()},1)):$(pname+"> .w2ui-panel-content").length>0&&($(pname+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(p.content).css("overflow",p.overflow)[0].style.cssText+=";"+p.style);var tmp=$(obj.box).find(pname+"> .w2ui-panel-tabs");p.show.tabs?0===tmp.find("[name="+p.tabs.name+"]").length&&null!=p.tabs?tmp.w2render(p.tabs):p.tabs.refresh():tmp.html("").removeClass("w2ui-tabs").hide(),tmp=$(obj.box).find(pname+"> .w2ui-panel-toolbar"),p.show.toolbar?0===tmp.find("[name="+p.toolbar.name+"]").length&&null!=p.toolbar?tmp.w2render(p.toolbar):p.toolbar.refresh():tmp.html("").removeClass("w2ui-toolbar").hide(),tmp=$(obj.box).find(pname+"> .w2ui-panel-title"),p.title?tmp.html(p.title).show():tmp.html("").hide()}else{if(0===$("#layout_"+obj.name+"_panel_main").length)return void obj.render();obj.resize();for(var p1=0;p1<this.panels.length;p1++)obj.refresh(this.panels[p1].type)}return obj.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},resize:function(){if(!this.box)return!1;var time=(new Date).getTime(),tmp=this.tmp.resize,edata=this.trigger({phase:"before",type:"resize",target:this.name,panel:tmp?tmp.type:"all",diff_x:tmp?tmp.diff_x:0,diff_y:tmp?tmp.diff_y:0});if(!0!==edata.isCancelled){this.padding<0&&(this.padding=0);var width=parseInt($(this.box).width()),height=parseInt($(this.box).height());$(this.box).find(" > div").css({width:width+"px",height:height+"px"});for(var obj=this,pmain=this.get("main"),pprev=this.get("preview"),pleft=this.get("left"),pright=this.get("right"),ptop=this.get("top"),pbottom=this.get("bottom"),smain=!0,sprev=null!=pprev&&!0!==pprev.hidden,sleft=null!=pleft&&!0!==pleft.hidden,sright=null!=pright&&!0!==pright.hidden,stop=null!=ptop&&!0!==ptop.hidden,sbottom=null!=pbottom&&!0!==pbottom.hidden,l,t,w,h,e,p=0;p<w2panels.length;p++)if("main"!==w2panels[p]&&(tmp=this.get(w2panels[p]))){var str=String(tmp.size||0);if("%"==str.substr(str.length-1)){var tmph=height;"preview"==tmp.type&&(tmph=tmph-(ptop&&!ptop.hidden?ptop.sizeCalculated:0)-(pbottom&&!pbottom.hidden?pbottom.sizeCalculated:0)),tmp.sizeCalculated=parseInt(("left"==tmp.type||"right"==tmp.type?width:tmph)*parseFloat(tmp.size)/100)}else tmp.sizeCalculated=parseInt(tmp.size);tmp.sizeCalculated=Math.max(tmp.sizeCalculated,parseInt(tmp.minSize))}"-"==String(pright.size).substr(0,1)&&(sleft&&"-"==pleft.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):pright.sizeCalculated=width-(sleft?pleft.sizeCalculated:0)+parseInt(pright.size)),"-"==String(pleft.size).substr(0,1)&&(sright&&"-"==pright.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):pleft.sizeCalculated=width-(sright?pright.sizeCalculated:0)+parseInt(pleft.size)),null!=ptop&&!0!==ptop.hidden?(l=0,t=0,w=width,h=ptop.sizeCalculated,$("#layout_"+this.name+"_panel_top").css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px"}).show(),ptop.width=w,ptop.height=h,ptop.resizable&&(t=ptop.sizeCalculated-(0===this.padding?this.resizer:0),h=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(event){var edata=obj.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:event});if(!0!==edata.isCancelled)return w2ui[obj.name].tmp.events.resizeStart("top",event),obj.trigger($.extend(edata,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_top").hide(),$("#layout_"+this.name+"_resizer_top").hide()),null!=pleft&&!0!==pleft.hidden?(l=0,t=0+(stop?ptop.sizeCalculated+this.padding:0),w=pleft.sizeCalculated,h=height-(stop?ptop.sizeCalculated+this.padding:0)-(sbottom?pbottom.sizeCalculated+this.padding:0),e=$("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&e.length>0&&e[0].clientHeight<e[0].scrollHeight&&(w+=17),e.css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px"}).show(),pleft.width=w,pleft.height=h,pleft.resizable&&(l=pleft.sizeCalculated-(0===this.padding?this.resizer:0),w=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(event){var edata=obj.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:event});if(!0!==edata.isCancelled)return w2ui[obj.name].tmp.events.resizeStart("left",event),obj.trigger($.extend(edata,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_left").hide(),$("#layout_"+this.name+"_resizer_left").hide()),null!=pright&&!0!==pright.hidden?(l=width-pright.sizeCalculated,t=0+(stop?ptop.sizeCalculated+this.padding:0),w=pright.sizeCalculated,h=height-(stop?ptop.sizeCalculated+this.padding:0)-(sbottom?pbottom.sizeCalculated+this.padding:0),$("#layout_"+this.name+"_panel_right").css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px"}).show(),pright.width=w,pright.height=h,pright.resizable&&(l-=this.padding,w=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(event){var edata=obj.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:event});if(!0!==edata.isCancelled)return w2ui[obj.name].tmp.events.resizeStart("right",event),obj.trigger($.extend(edata,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_right").hide(),$("#layout_"+this.name+"_resizer_right").hide()),null!=pbottom&&!0!==pbottom.hidden?(l=0,t=height-pbottom.sizeCalculated,w=width,h=pbottom.sizeCalculated,$("#layout_"+this.name+"_panel_bottom").css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px"}).show(),pbottom.width=w,pbottom.height=h,pbottom.resizable&&(t-=0===this.padding?0:this.padding,h=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(event){var edata=obj.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:event});if(!0!==edata.isCancelled)return w2ui[obj.name].tmp.events.resizeStart("bottom",event),obj.trigger($.extend(edata,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_bottom").hide(),$("#layout_"+this.name+"_resizer_bottom").hide()),l=0+(sleft?pleft.sizeCalculated+this.padding:0),t=0+(stop?ptop.sizeCalculated+this.padding:0),w=width-(sleft?pleft.sizeCalculated+this.padding:0)-(sright?pright.sizeCalculated+this.padding:0),h=height-(stop?ptop.sizeCalculated+this.padding:0)-(sbottom?pbottom.sizeCalculated+this.padding:0)-(sprev?pprev.sizeCalculated+this.padding:0),e=$("#layout_"+this.name+"_panel_main"),-1!=window.navigator.userAgent.indexOf("MSIE")&&e.length>0&&e[0].clientHeight<e[0].scrollHeight&&(w+=17),e.css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px"}),pmain.width=w,pmain.height=h,null!=pprev&&!0!==pprev.hidden?(l=0+(sleft?pleft.sizeCalculated+this.padding:0),t=height-(sbottom?pbottom.sizeCalculated+this.padding:0)-pprev.sizeCalculated,w=width-(sleft?pleft.sizeCalculated+this.padding:0)-(sright?pright.sizeCalculated+this.padding:0),h=pprev.sizeCalculated,e=$("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&e.length>0&&e[0].clientHeight<e[0].scrollHeight&&(w+=17),e.css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px"}).show(),pprev.width=w,pprev.height=h,pprev.resizable&&(t-=0===this.padding?0:this.padding,h=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:l+"px",top:t+"px",width:w+"px",height:h+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(event){var edata=obj.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:event});if(!0!==edata.isCancelled)return w2ui[obj.name].tmp.events.resizeStart("preview",event),obj.trigger($.extend(edata,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_preview").hide(),$("#layout_"+this.name+"_resizer_preview").hide());for(var p1=0;p1<w2panels.length;p1++){var pan=this.get(w2panels[p1]),tmp2="#layout_"+this.name+"_panel_"+w2panels[p1]+" > .w2ui-panel-",tabHeight=0;pan&&(pan.title&&(tabHeight+=w2utils.getSize($(tmp2+"title").css({top:tabHeight+"px",display:"block"}),"height")),pan.show.tabs&&(null!=pan.tabs&&w2ui[this.name+"_"+w2panels[p1]+"_tabs"]&&w2ui[this.name+"_"+w2panels[p1]+"_tabs"].resize(),tabHeight+=w2utils.getSize($(tmp2+"tabs").css({top:tabHeight+"px",display:"block"}),"height")),pan.show.toolbar&&(null!=pan.toolbar&&w2ui[this.name+"_"+w2panels[p1]+"_toolbar"]&&w2ui[this.name+"_"+w2panels[p1]+"_toolbar"].resize(),tabHeight+=w2utils.getSize($(tmp2+"toolbar").css({top:tabHeight+"px",display:"block"}),"height"))),$(tmp2+"content").css({display:"block"}).css({top:tabHeight+"px"})}return clearTimeout(this._resize_timer),this._resize_timer=setTimeout(function(){for(var e in w2ui)if("function"==typeof w2ui[e].resize){null==w2ui[e].panels&&w2ui[e].resize();var parent=$(w2ui[e].box).parents(".w2ui-layout");parent.length>0&&parent.attr("name")==obj.name&&w2ui[e].resize()}},100),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},destroy:function(){var edata=this.trigger({phase:"before",type:"destroy",target:this.name});if(!0!==edata.isCancelled)return null!=w2ui[this.name]&&($(this.box).find("#layout_"+this.name+"_panel_main").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger($.extend(edata,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&$(window).off("resize",this.tmp.events.resize),!0)},lock:function(panel,msg,showSpinner){if(-1!=w2panels.indexOf(panel)){var args=Array.prototype.slice.call(arguments,0);args[0]="#layout_"+this.name+"_panel_"+panel,w2utils.lock.apply(window,args)}else console.log("ERROR: First parameter needs to be the a valid panel name.")},unlock:function(panel,speed){if(-1!=w2panels.indexOf(panel)){var nm="#layout_"+this.name+"_panel_"+panel;w2utils.unlock(nm,speed)}else console.log("ERROR: First parameter needs to be the a valid panel name.")}},$.extend(w2layout.prototype,w2utils.event),w2obj.layout=w2layout}(jQuery);var w2popup={};!function($){$.fn.w2popup=function(method,options){null==method&&(options={},method="open"),$.isPlainObject(method)&&(options=method,method="open"),"load"===(method=method.toLowerCase())&&"string"==typeof options&&(options=$.extend({url:options},arguments.length>2?arguments[2]:{})),"open"===method&&null!=options.url&&(method="load"),options=options||{};var dlgOptions={};if($(this).length>0&&"open"==method){if($(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){if($("#w2ui-popup").length>0){var tmp=$("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:tmp.title,body:tmp.body,buttons:tmp.buttons}}w2popup._template=this,$(this).find("div[rel=title]").length>0&&(dlgOptions.title=$(this).find("div[rel=title]")),$(this).find("div[rel=body]").length>0&&(dlgOptions.body=$(this).find("div[rel=body]"),dlgOptions.style=$(this).find("div[rel=body]")[0].style.cssText),$(this).find("div[rel=buttons]").length>0&&(dlgOptions.buttons=$(this).find("div[rel=buttons]"))}else dlgOptions.title="&#160;",dlgOptions.body=$(this).html();0!==parseInt($(this).css("width"))&&(dlgOptions.width=parseInt($(this).css("width"))),0!==parseInt($(this).css("height"))&&(dlgOptions.height=parseInt($(this).css("height")))}return w2popup[method]($.extend({},dlgOptions,options))},w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(options){var obj=this;if("closing"!=w2popup.status){var old_options=$("#w2ui-popup").data("options"),options=$.extend({},this.defaults,old_options,{title:"",body:"",buttons:""},options,{maximized:!1}),maxW,maxH;setTimeout(function(){$("#w2ui-popup").data("options",options)},100),0===$("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),options.onOpen&&(w2popup.onOpen=options.onOpen),options.onClose&&(w2popup.onClose=options.onClose),options.onMax&&(w2popup.onMax=options.onMax),options.onMin&&(w2popup.onMin=options.onMin),options.onToggle&&(w2popup.onToggle=options.onToggle),options.onKeydown&&(w2popup.onKeydown=options.onKeydown),options.width=parseInt(options.width),options.height=parseInt(options.height),null==window.innerHeight?(maxW=parseInt(document.documentElement.offsetWidth),maxH=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(maxW+=21,maxH+=4)):(maxW=parseInt(window.innerWidth),maxH=parseInt(window.innerHeight)),maxW-10<options.width&&(options.width=maxW-10),maxH-10<options.height&&(options.height=maxH-10);var top=(maxH-options.height)/2*.6,left=(maxW-options.width)/2;if(0===$("#w2ui-popup").length){var edata;if(!0===(edata=this.trigger({phase:"before",type:"open",target:"popup",options:options,present:!1})).isCancelled)return;w2popup.status="opening",w2popup.lockScreen(options);var btn="";options.showClose&&(btn+='<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>'),options.showMax&&(btn+='<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');var msg='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+left+"px; top: "+top+"px;     width: "+parseInt(options.width)+"px; height: "+parseInt(options.height)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+'"></div>';$("body").append(msg);var parts=$("#w2ui-popup"),tmp,tmp,tmp;if(parts.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0)(tmp=parts.find("div[rel=title]")).length>0&&(options.title=tmp.html(),tmp.remove()),(tmp=parts.find("div[rel=buttons]")).length>0&&(options.buttons=tmp.html(),tmp.remove()),(tmp=parts.find("div[rel=body]")).length>0?options.body=tmp.html():options.body=parts.html();var msg='<div class="w2ui-popup-title" style="'+(options.title?"":"display: none")+'">'+btn+'</div><div class="w2ui-box" style="'+(options.title?"":"top: 0px !important;")+(options.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body'+(""!==!options.title?" w2ui-popup-no-title":"")+(options.buttons?"":" w2ui-popup-no-buttons")+'" style="'+options.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(options.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>';$("#w2ui-popup").html(msg),options.title&&$("#w2ui-popup .w2ui-popup-title").append(options.title),options.buttons&&$("#w2ui-popup .w2ui-popup-buttons").append(options.buttons),options.body&&$("#w2ui-popup .w2ui-popup-body").append(options.body),setTimeout(function(){$("#w2ui-popup").css("opacity","1").css(w2utils.cssPrefix({transition:options.speed+"s opacity, "+options.speed+"s -webkit-transform",transform:"scale(1)"})),obj.focus()},1),setTimeout(function(){$("#w2ui-popup").css(w2utils.cssPrefix("transform","")),w2popup.status="open",setTimeout(function(){obj.trigger($.extend(edata,{phase:"after"}))},100)},1e3*options.speed)}else{var edata;if(null==w2popup._prev&&null!=w2popup._template&&obj.restoreTemplate(),!0===(edata=this.trigger({phase:"before",type:"open",target:"popup",options:options,present:!0})).isCancelled)return;w2popup.status="opening",null!=old_options&&(old_options.maximized||old_options.width==options.width&&old_options.height==options.height||w2popup.resize(options.width,options.height),options.prevSize=options.width+"px:"+options.height+"px",options.maximized=old_options.maximized);var cloned=$("#w2ui-popup .w2ui-box").clone(),tmp,tmp,tmp;if(cloned.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(options.body),"string"==typeof options.body&&cloned.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0)(tmp=cloned.find("div[rel=title]")).length>0&&(options.title=tmp.html(),tmp.remove()),(tmp=cloned.find("div[rel=buttons]")).length>0&&(options.buttons=tmp.html(),tmp.remove()),(tmp=cloned.find("div[rel=body]")).length>0?options.body=tmp.html():options.body=cloned.html(),cloned.html(options.body);$("#w2ui-popup .w2ui-box").after(cloned),options.buttons?($("#w2ui-popup .w2ui-popup-buttons").show().html("").append(options.buttons),$("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):($("#w2ui-popup .w2ui-popup-buttons").hide().html(""),$("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),options.title?($("#w2ui-popup .w2ui-popup-title").show().html((options.showClose?'<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(options.showMax?'<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':"")).append(options.title),$("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):($("#w2ui-popup .w2ui-popup-title").hide().html(""),$("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),$("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));var div_old=$("#w2ui-popup .w2ui-box")[0],div_new=$("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(div_old,div_new,options.transition,function(){obj.restoreTemplate(),$(div_old).remove(),$(div_new).removeClass("w2ui-box-temp").addClass("w2ui-box");var $body=$(div_new).find(".w2ui-popup-body");1==$body.length&&($body[0].style.cssText=options.style),$("#w2ui-popup").data("prev-size",null),obj.focus(),w2popup.status="open",obj.trigger($.extend(edata,{phase:"after"}))})}options._last_focus=$(":focus"),options.keyboard&&$(document).on("keydown",this.keydown);var tmp={resizing:!1,mvMove:mvMove,mvStop:mvStop};return $("#w2ui-popup .w2ui-popup-title").on("mousedown",function(event){w2popup.get().maximized||mvStart(event)}),this}function mvStart(evnt){if(evnt||(evnt=window.event),w2popup.status="moving",tmp.resizing=!0,tmp.isLocked=1==$("#w2ui-popup > .w2ui-lock").length,tmp.x=evnt.screenX,tmp.y=evnt.screenY,tmp.pos_x=$("#w2ui-popup").position().left,tmp.pos_y=$("#w2ui-popup").position().top,tmp.isLocked||w2popup.lock({opacity:0}),$(document).on("mousemove",tmp.mvMove),$(document).on("mouseup",tmp.mvStop),evnt.stopPropagation?evnt.stopPropagation():evnt.cancelBubble=!0,!evnt.preventDefault)return!1;evnt.preventDefault()}function mvMove(evnt){1==tmp.resizing&&(evnt||(evnt=window.event),tmp.div_x=evnt.screenX-tmp.x,tmp.div_y=evnt.screenY-tmp.y,$("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+tmp.div_x+"px, "+tmp.div_y+"px, 0px)"})))}function mvStop(evnt){1==tmp.resizing&&(evnt||(evnt=window.event),w2popup.status="open",tmp.div_x=evnt.screenX-tmp.x,tmp.div_y=evnt.screenY-tmp.y,$("#w2ui-popup").css({left:tmp.pos_x+tmp.div_x+"px",top:tmp.pos_y+tmp.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),tmp.resizing=!1,$(document).off("mousemove",tmp.mvMove),$(document).off("mouseup",tmp.mvStop),tmp.isLocked||w2popup.unlock())}setTimeout(function(){obj.open.call(obj,options)},100)},keydown:function(event){var options=$("#w2ui-popup").data("options");if(!options||options.keyboard){var edata=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:options,originalEvent:event});if(!0!==edata.isCancelled){switch(event.keyCode){case 27:event.preventDefault(),$("#w2ui-popup .w2ui-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger($.extend(edata,{phase:"after"}))}}},close:function(options){var obj=this,options=$.extend({},$("#w2ui-popup").data("options"),options);if(0!==$("#w2ui-popup").length&&"closed"!=this.status)if("opening"!=this.status){var edata=this.trigger({phase:"before",type:"close",target:"popup",options:options});!0!==edata.isCancelled&&(w2popup.status="closing",$("#w2ui-popup").css("opacity","0").css(w2utils.cssPrefix({transition:options.speed+"s opacity, "+options.speed+"s -webkit-transform",transform:"scale(0.9)"})),w2popup.unlockScreen(options),setTimeout(function(){obj.restoreTemplate(),$("#w2ui-popup").remove(),w2popup.status="closed",options._last_focus.length>0&&options._last_focus.focus(),obj.trigger($.extend(edata,{phase:"after"}))},1e3*options.speed),options.keyboard&&$(document).off("keydown",this.keydown))}else setTimeout(function(){w2popup.close()},100)},toggle:function(){var obj=this,options=$("#w2ui-popup").data("options"),edata=this.trigger({phase:"before",type:"toggle",target:"popup",options:options});!0!==edata.isCancelled&&(!0===options.maximized?w2popup.min():w2popup.max(),setTimeout(function(){obj.trigger($.extend(edata,{phase:"after"}))},1e3*options.speed+50))},max:function(){var obj=this,options=$("#w2ui-popup").data("options");if(!0!==options.maximized){var edata=this.trigger({phase:"before",type:"max",target:"popup",options:options});!0!==edata.isCancelled&&(w2popup.status="resizing",options.prevSize=$("#w2ui-popup").css("width")+":"+$("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,function(){w2popup.status="open",options.maximized=!0,obj.trigger($.extend(edata,{phase:"after"})),$("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var name=$(this).attr("name");w2ui[name]&&w2ui[name].resize&&w2ui[name].resize()})}))}},min:function(){var obj=this,options=$("#w2ui-popup").data("options");if(!0===options.maximized){var size=options.prevSize.split(":"),edata=this.trigger({phase:"before",type:"min",target:"popup",options:options});!0!==edata.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(size[0]),parseInt(size[1]),function(){w2popup.status="open",options.maximized=!1,options.prevSize=null,obj.trigger($.extend(edata,{phase:"after"})),$("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var name=$(this).attr("name");w2ui[name]&&w2ui[name].resize&&w2ui[name].resize()})}))}},get:function(){return $("#w2ui-popup").data("options")},set:function(options){w2popup.open(options)},clear:function(){$("#w2ui-popup .w2ui-popup-title").html(""),$("#w2ui-popup .w2ui-popup-body").html(""),$("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(options){if(w2popup.status="loading",null!=options.url){var tmp=String(options.url).split("#"),url=tmp[0],selector=tmp[1];null==options&&(options={});var html=$("#w2ui-popup").data(url);null!=html?popup(html,selector):$.get(url,function(data,status,obj){popup(obj.responseText,selector),$("#w2ui-popup").data(url,obj.responseText)})}else console.log("ERROR: The url parameter is empty.");function popup(html,selector){if(delete options.url,$("body").append('<div id="w2ui-tmp" style="display: none">'+html+"</div>"),null!=selector&&$("#w2ui-tmp #"+selector).length>0?$("#w2ui-tmp #"+selector).w2popup(options):$("#w2ui-tmp > div").w2popup(options),$("#w2ui-tmp > style").length>0){var style=$("<div>").append($("#w2ui-tmp > style").clone()).html();0===$("#w2ui-popup #div-style").length&&$("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),$("#w2ui-popup #div-style").html(style)}$("#w2ui-tmp").remove()}},message:function(options){var obj=this;$().w2tag(),options||(options={width:200,height:100});var pWidth=parseInt($("#w2ui-popup").width()),pHeight=parseInt($("#w2ui-popup").height());options.originalWidth=options.width,options.originalHeight=options.height,parseInt(options.width)<10&&(options.width=10),parseInt(options.height)<10&&(options.height=10),null==options.hideOnClick&&(options.hideOnClick=!1);var poptions=$("#w2ui-popup").data("options")||{},titleHeight=parseInt($("#w2ui-popup > .w2ui-popup-title").css("height"));(null==options.width||options.width>poptions.width-10)&&(options.width=poptions.width-10),(null==options.height||options.height>poptions.height-titleHeight-5)&&(options.height=poptions.height-titleHeight-5),options.originalHeight<0&&(options.height=pHeight+options.originalHeight-titleHeight),options.originalWidth<0&&(options.width=pWidth+2*options.originalWidth);var head=$("#w2ui-popup .w2ui-popup-title"),msgCount=$("#w2ui-popup .w2ui-message").length;if(""===$.trim(options.html)&&""===$.trim(options.body)&&""===$.trim(options.buttons)){var $msg=$("#w2ui-popup #w2ui-message"+(msgCount-1)),options=$msg.data("options")||{};$msg.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+options.height+"px)"})),1==msgCount?w2popup.unlock(150):$("#w2ui-popup #w2ui-message"+(msgCount-2)).css("z-index",1500),setTimeout(function(){var $focus=$msg.data("prev_focus");$msg.remove(),$focus&&$focus.length>0?$focus.focus():obj.focus(),"function"==typeof options.onClose&&options.onClose()},150)}else{""===$.trim(options.body)&&""===$.trim(options.buttons)||(options.html='<div class="w2ui-message-body">'+options.body+'</div><div class="w2ui-message-buttons">'+options.buttons+"</div>"),$("#w2ui-popup .w2ui-message").css("z-index",1390),head.css("z-index",1501),$("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+msgCount+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===head.length?"top: 0px;":"top: "+w2utils.getSize(head,"height")+"px;")+(null!=options.width?"width: "+options.width+"px; left: "+(pWidth-options.width)/2+"px;":"left: 10px; right: 10px;")+(null!=options.height?"height: "+options.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===options.hideOnClick?'onclick="w2popup.message();"':"")+"></div>"),$("#w2ui-popup #w2ui-message"+msgCount).data("options",options).data("prev_focus",$(":focus"));var display=$("#w2ui-popup #w2ui-message"+msgCount).css("display");$("#w2ui-popup #w2ui-message"+msgCount).css(w2utils.cssPrefix({transform:"none"==display?"translateY(-"+options.height+"px)":"translateY(0px)"})),"none"==display&&($("#w2ui-popup #w2ui-message"+msgCount).show().html(options.html),setTimeout(function(){$("#w2ui-popup #w2ui-message"+msgCount).css(w2utils.cssPrefix({transform:"none"==display?"translateY(0px)":"translateY(-"+options.height+"px)"}))},1),0===msgCount&&w2popup.lock(),setTimeout(function(){obj.focus(),$("#w2ui-popup #w2ui-message"+msgCount).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof options.onOpen&&options.onOpen()},350))}},focus:function(){var tmp=null,pop=$("#w2ui-popup"),sel="input:visible, button:visible, select:visible, textarea:visible";$(pop).find(sel).off(".keep-focus");var cnt=$("#w2ui-popup .w2ui-message").length-1,msg=$("#w2ui-popup #w2ui-message"+cnt),btn;if(msg.length>0)(btn=$(msg[msg.length-1]).find("button")).length>0&&btn[0].focus(),tmp=msg;else if(pop.length>0){var btn;(btn=pop.find(".w2ui-popup-buttons button")).length>0&&btn[0].focus(),tmp=pop}$(tmp).find(sel).on("blur.keep-focus",function(event){setTimeout(function(){var focus=$(":focus");if(focus.length>0&&!$(tmp).find(sel).is(focus)||focus.hasClass("w2ui-popup-hidden")){var el=$(tmp).find(sel);el.length>0&&el[0].focus()}},1)})},lock:function(msg,showSpinner){var args=Array.prototype.slice.call(arguments,0);args.unshift($("#w2ui-popup")),w2utils.lock.apply(window,args)},unlock:function(speed){w2utils.unlock($("#w2ui-popup"),speed)},lockScreen:function(options){return!($("#w2ui-lock").length>0)&&(null==options&&(options=$("#w2ui-popup").data("options")),null==options&&(options={}),options=$.extend({},w2popup.defaults,options),$("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+options.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){$("#w2ui-lock").css("opacity",options.opacity).css(w2utils.cssPrefix("transition",options.speed+"s opacity"))},1),1==options.modal?($("#w2ui-lock").on("mousedown",function(){$("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),$("#w2ui-lock").on("mouseup",function(){setTimeout(function(){$("#w2ui-lock").css("opacity",options.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)})):$("#w2ui-lock").on("mousedown",function(){w2popup.close()}),!0)},unlockScreen:function(options){return 0!==$("#w2ui-lock").length&&(null==options&&(options=$("#w2ui-popup").data("options")),null==options&&(options={}),options=$.extend({},w2popup.defaults,options),$("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",options.speed+"s opacity")),setTimeout(function(){$("#w2ui-lock").remove()},1e3*options.speed),!0)},resizeMessages:function(){var obj=this,options=$("#w2ui-popup").data("options");$("#w2ui-popup .w2ui-message").each(function(){var moptions=$(this).data("options"),$popup=$("#w2ui-popup");parseInt(moptions.width)<10&&(moptions.width=10),parseInt(moptions.height)<10&&(moptions.height=10);var titleHeight=parseInt($popup.find("> .w2ui-popup-title").css("height")),pWidth=parseInt($popup.width()),pHeight=parseInt($popup.height());moptions.width=moptions.originalWidth,moptions.width>pWidth-10&&(moptions.width=pWidth-10),moptions.height=moptions.originalHeight,moptions.height>pHeight-titleHeight-5&&(moptions.height=pHeight-titleHeight-5),moptions.originalHeight<0&&(moptions.height=pHeight+moptions.originalHeight-titleHeight),moptions.originalWidth<0&&(moptions.width=pWidth+2*moptions.originalWidth),$(this).css({left:(pWidth-moptions.width)/2+"px",width:moptions.width+"px",height:moptions.height+"px"})})},resize:function(width,height,callBack){var obj=this,options=$("#w2ui-popup").data("options"),maxW,maxH;width=parseInt(width),height=parseInt(height),null==window.innerHeight?(maxW=parseInt(document.documentElement.offsetWidth),maxH=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(maxW+=21,maxH+=4)):(maxW=parseInt(window.innerWidth),maxH=parseInt(window.innerHeight)),maxW-10<width&&(width=maxW-10),maxH-10<height&&(height=maxH-10);var top=(maxH-height)/2*.6,left=(maxW-width)/2;$("#w2ui-popup").css(w2utils.cssPrefix({transition:options.speed+"s width, "+options.speed+"s height, "+options.speed+"s left, "+options.speed+"s top"})).css({top:top,left:left,width:width,height:height});var tmp_int=setInterval(function(){obj.resizeMessages()},10);setTimeout(function(){clearInterval(tmp_int),options.width=width,options.height=height,obj.resizeMessages(),"function"==typeof callBack&&callBack()},1e3*options.speed+50)},restoreTemplate:function(){var options=$("#w2ui-popup").data("options");if(null!=options){var template=w2popup._template,title=options.title,body=options.body,buttons=options.buttons;if(w2popup._prev?(template=w2popup._prev.template,title=w2popup._prev.title,body=w2popup._prev.body,buttons=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=template){var $tmp=$(template);if(0===$tmp.length)return;"body"==$(body).attr("rel")?(title&&$tmp.append(title),body&&$tmp.append(body),buttons&&$tmp.append(buttons)):$tmp.append(body)}}}},$.extend(w2popup,w2utils.event)}(jQuery);var w2alert=function(msg,title,callBack){var $=jQuery;return null==title&&(title=w2utils.lang("Notification")),$("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+msg+"</div>",buttons:'<button onclick="w2popup.message();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(){$("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof callBack&&callBack()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:title,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+msg+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(event){setTimeout(function(){$("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown:function(event){$("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof callBack&&callBack()}}),{ok:function(fun){return callBack=fun,this},done:function(fun){return callBack=fun,this}}},w2confirm=function(msg,title,callBack){var $=jQuery,options={},defaults={msg:"",title:w2utils.lang("Confirmation"),width:$("#w2ui-popup").length>0?400:450,height:$("#w2ui-popup").length>0?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};return 1==arguments.length&&"object"==typeof msg?$.extend(options,defaults,msg):"function"==typeof title?$.extend(options,defaults,{msg:msg,callBack:title}):$.extend(options,defaults,{msg:msg,title:title,callBack:callBack}),"object"==typeof options.btn_yes&&(options.yes_text=options.btn_yes.text||options.yes_text,options.yes_class=options.btn_yes.class||options.yes_class,options.yes_style=options.btn_yes.style||options.yes_style,options.yes_callBack=options.btn_yes.callBack||options.yes_callBack),"object"==typeof options.btn_no&&(options.no_text=options.btn_no.text||options.no_text,options.no_class=options.btn_no.class||options.no_class,options.no_style=options.btn_no.style||options.no_style,options.no_callBack=options.btn_no.callBack||options.no_callBack),$("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(options.width>w2popup.get().width&&(options.width=w2popup.get().width),options.height>w2popup.get().height-50&&(options.height=w2popup.get().height-50),w2popup.message({width:options.width,height:options.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+options.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+options.yes_class+'" style="'+options.yes_style+'">'+w2utils.lang(options.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+options.no_class+'" style="'+options.no_style+'">'+w2utils.lang(options.no_text)+"</button>",onOpen:function(){$("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(event){w2popup._confirm_btn=event.target.id,w2popup.message()})},onClose:function(){$("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout(function(){"function"==typeof options.callBack&&options.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof options.yes_callBack&&options.yes_callBack(),"No"==w2popup._confirm_btn&&"function"==typeof options.no_callBack&&options.no_callBack()},300)}})):(w2utils.isInt(options.height)||(options.height=options.height+50),w2popup.open({width:options.width,height:options.height,title:options.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+options.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+options.yes_class+'" style="'+options.yes_style+'">'+w2utils.lang(options.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+options.no_class+'" style="'+options.no_style+'">'+w2utils.lang(options.no_text)+"</button>",onOpen:function(event){setTimeout(function(){$("#w2ui-popup .w2ui-popup-btn").on("click",function(event){w2popup.close(),"function"==typeof options.callBack&&options.callBack(event.target.id),"Yes"==event.target.id&&"function"==typeof options.yes_callBack&&options.yes_callBack(),"No"==event.target.id&&"function"==typeof options.no_callBack&&options.no_callBack()}),$("#w2ui-popup .w2ui-popup-btn#Yes").focus()},1)},onKeydown:function(event){if(0===$("#w2ui-popup .w2ui-message").length)switch(event.originalEvent.keyCode){case 13:$("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:$("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}})),{yes:function(fun){return options.yes_callBack=fun,this},no:function(fun){return options.no_callBack=fun,this}}},w2prompt=function(label,title,callBack){var $=jQuery,options={},defaults={label:"",value:"",attrs:"",title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),cancel_text:w2utils.lang("Cancel"),width:$("#w2ui-popup").length>0?400:450,height:$("#w2ui-popup").length>0?170:220,callBack:null};return 1==arguments.length&&"object"==typeof label?$.extend(options,defaults,label):"function"==typeof title?$.extend(options,defaults,{label:label,callBack:title}):$.extend(options,defaults,{label:label,title:title,callBack:callBack}),$("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(options.width>w2popup.get().width&&(options.width=w2popup.get().width),options.height>w2popup.get().height-50&&(options.height=w2popup.get().height-50),w2popup.message({width:options.width,height:options.height,body:'<div class="w2ui-centered" style="font-size: 13px;">   <label style="margin-right: 10px;">'+options.label+':</label>   <input id="w2prompt" '+options.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+options.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+options.cancel_text+"</button>",onOpen:function(){$("#w2prompt").val(options.value),$("#w2ui-popup .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(event){w2popup._prompt_value=$("#w2prompt").val(),w2popup.message()}),$("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(event){w2popup._prompt_value=null,w2popup.message()}),setTimeout(function(){$("#w2prompt").focus()},100)},onClose:function(){$("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout(function(){"function"==typeof options.callBack&&null!=w2popup._prompt_value&&options.callBack(w2popup._prompt_value)},300)}})):(w2utils.isInt(options.height)||(options.height=options.height+50),w2popup.open({width:options.width,height:options.height,title:options.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered" style="font-size: 13px;"><label style="margin-right: 10px;">'+options.label+':</label><input id="w2prompt"></div>',buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+options.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+options.cancel_text+"</button>",onOpen:function(event){setTimeout(function(){$("#w2prompt").val(options.value),$("#w2prompt").w2field("text"),$("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(event){w2popup._prompt_value=$("#w2prompt").val(),w2popup.close(),"function"==typeof options.callBack&&options.callBack(w2popup._prompt_value)}),$("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(event){w2popup._prompt_value=null,w2popup.close()}),$("#w2ui-popup .w2ui-popup-btn#Ok"),setTimeout(function(){$("#w2prompt").focus()},100)},1)},onKeydown:function(event){if(0===$("#w2ui-popup .w2ui-message").length)switch(event.originalEvent.keyCode){case 13:$("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked"),w2popup.close();break;case 27:w2popup.close()}}})),{change:function(fun){return $("#w2prompt").on("keyup",fun).keyup(),this},ok:function(fun){return options.callBack=fun,this}}};!function($){var w2tabs=function(options){this.box=null,this.name=null,this.active=null,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.right="",this.style="",$.extend(this,{handlers:[]}),$.extend(!0,this,w2obj.tabs,options)};$.fn.w2tabs=function(method){if($.isPlainObject(method)){if(!w2utils.checkName(method,"w2tabs"))return;for(var tabs=method.tabs||[],object=new w2tabs(method),i=0;i<tabs.length;i++)object.tabs[i]=$.extend({},w2tabs.prototype.tab,tabs[i]);return 0!==$(this).length&&object.render($(this)[0]),w2ui[object.name]=object,object}var obj=w2ui[$(this).attr("name")];return obj?arguments.length>0?(obj[method]&&obj[method].apply(obj,Array.prototype.slice.call(arguments,1)),this):obj:null},w2tabs.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(tab){return this.insert(null,tab)},insert:function(id,tab){$.isArray(tab)||(tab=[tab]);for(var i=0;i<tab.length;i++){if(null==tab[i].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(tab[i].id,this.tabs,"tabs",this.name))return;var newTab=$.extend({},w2tabs.prototype.tab,tab[i]);if(null==id)this.tabs.push(newTab);else{var middle=this.get(id,!0);this.tabs=this.tabs.slice(0,middle).concat([newTab],this.tabs.slice(middle))}this.refresh(tab[i].id),this.resize()}},remove:function(){for(var removed=0,a=0;a<arguments.length;a++){var tab=this.get(arguments[a]);if(!tab)return!1;removed++,this.tabs.splice(this.get(tab.id,!0),1),$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(tab.id)).remove()}return this.resize(),removed},select:function(id){return this.active!=id&&null!=this.get(id)&&(this.active=id,this.refresh(),!0)},set:function(id,tab){var index=this.get(id,!0);return null!=index&&($.extend(this.tabs[index],tab),this.refresh(id),!0)},get:function(id,returnIndex){if(0===arguments.length){for(var all=[],i1=0;i1<this.tabs.length;i1++)null!=this.tabs[i1].id&&all.push(this.tabs[i1].id);return all}for(var i2=0;i2<this.tabs.length;i2++)if(this.tabs[i2].id==id)return!0===returnIndex?i2:this.tabs[i2];return null},show:function(){for(var obj=this,shown=0,tmp=[],a=0;a<arguments.length;a++){var tab=this.get(arguments[a]);tab&&!1!==tab.hidden&&(shown++,tab.hidden=!1,tmp.push(tab.id))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t]);obj.resize()},15),shown},hide:function(){for(var obj=this,hidden=0,tmp=[],a=0;a<arguments.length;a++){var tab=this.get(arguments[a]);tab&&!0!==tab.hidden&&(hidden++,tab.hidden=!0,tmp.push(tab.id))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t]);obj.resize()},15),hidden},enable:function(){for(var obj=this,enabled=0,tmp=[],a=0;a<arguments.length;a++){var tab=this.get(arguments[a]);tab&&!1!==tab.disabled&&(enabled++,tab.disabled=!1,tmp.push(tab.id))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t])},15),enabled},disable:function(){for(var obj=this,disabled=0,tmp=[],a=0;a<arguments.length;a++){var tab=this.get(arguments[a]);tab&&!0!==tab.disabled&&(disabled++,tab.disabled=!0,tmp.push(tab.id))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t])},15),disabled},tooltipShow:function(id,event,forceRefresh){if(null!=this.tooltip){var $el=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(id)),item=this.get(id),pos=this.tooltip,txt=item.tooltip;"function"==typeof txt&&(txt=txt.call(this,item)),$el.prop("_mouse_over",!0),setTimeout(function(){!0===$el.prop("_mouse_over")&&!0!==$el.prop("_mouse_tooltip")&&($el.prop("_mouse_tooltip",!0),$el.w2tag(w2utils.lang(txt),{position:pos})),1==forceRefresh&&$el.w2tag(w2utils.lang(txt),{position:pos})},1)}},tooltipHide:function(id){if(null!=this.tooltip){var $el=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(id)),item=this.get(id);$el.removeProp("_mouse_over"),setTimeout(function(){!0!==$el.prop("_mouse_over")&&!0===$el.prop("_mouse_tooltip")&&($el.removeProp("_mouse_tooltip"),$el.w2tag())},1)}},refresh:function(id){var time=(new Date).getTime();"up"==this.flow?$(this.box).addClass("w2ui-tabs-up"):$(this.box).removeClass("w2ui-tabs-up");var edata=this.trigger({phase:"before",type:"refresh",target:null!=id?id:this.name,object:this.get(id)});if(!0!==edata.isCancelled){if(null==id)for(var i=0;i<this.tabs.length;i++)this.refresh(this.tabs[i].id);else{var tab=this.get(id);if(null==tab)return!1;null==tab.text&&null!=tab.caption&&(tab.text=tab.caption),null==tab.tooltip&&null!=tab.hint&&(tab.tooltip=tab.hint);var text=tab.text;"function"==typeof text&&(text=text.call(this,tab)),null==text&&(text="");var jq_el=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(tab.id)),closable="";tab.closable&&!tab.disabled&&(closable='<div class="w2ui-tab-close"     onmouseover = "w2ui[\''+this.name+"'].tooltipShow('"+tab.id+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+tab.id+"', event);\"    onclick=\"w2ui['"+this.name+"'].animateClose('"+tab.id+"', event);\"></div>");var tabHTML=closable+'    <div class="w2ui-tab'+(this.active===tab.id?" active":"")+(tab.closable?" closable":"")+(tab.class?" "+tab.class:"")+'" style="'+tab.style+'"         onmouseover = "'+(tab.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+tab.id+"', event);")+'"        onmouseout  = "'+(tab.disabled?"":"w2ui['"+this.name+"'].tooltipHide('"+tab.id+"', event);")+'"        onclick="w2ui[\''+this.name+"'].click('"+tab.id+"', event);\">"+w2utils.lang(text)+"</div>";if(0===jq_el.length){var addStyle="";tab.hidden&&(addStyle+="display: none;"),tab.disabled&&(addStyle+="opacity: 0.2;");var html='<td id="tabs_'+this.name+"_tab_"+tab.id+'" style="'+addStyle+'" valign="middle">'+tabHTML+"</td>";this.get(id,!0)!==this.tabs.length-1&&$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(id,!0))+1].id)).length>0?$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(id,!0))+1].id)).before(html):$(this.box).find("#tabs_"+this.name+"_right").before(html)}else jq_el.html(tabHTML),tab.hidden?jq_el.css("display","none"):jq_el.css("display",""),tab.disabled?jq_el.css({opacity:"0.2"}):jq_el.css({opacity:"1"})}return $("#tabs_"+this.name+"_right").html(this.right),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},render:function(box){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"render",target:this.name,box:box});if(!0!==edata.isCancelled){if(null!=box&&($(this.box).find("> table #tabs_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=box),!this.box)return!1;var html='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="1" width="100%"><tbody>    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+'</td></tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>";return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(html),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.trigger($.extend(edata,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-time}},scroll:function(direction){var box=$(this.box),obj=this,scrollBox=box.find(".w2ui-scroll-wrapper"),scrollLeft=scrollBox.scrollLeft(),width1,width2,scroll;switch(direction){case"left":width1=scrollBox.outerWidth(),width2=scrollBox.find(":first").outerWidth(),(scroll=scrollLeft-width1+50)<=0&&(scroll=0),scrollBox.animate({scrollLeft:scroll},300);break;case"right":(scroll=scrollLeft+(width1=scrollBox.outerWidth())-50)>=(width2=scrollBox.find(":first").outerWidth())-width1&&(scroll=width2-width1),scrollBox.animate({scrollLeft:scroll},300)}setTimeout(function(){obj.resize()},350)},resize:function(){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==edata.isCancelled){var box=$(this.box);box.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var scrollBox=box.find(".w2ui-scroll-wrapper");return scrollBox.find(":first").outerWidth()>scrollBox.outerWidth()&&(scrollBox.scrollLeft()>0&&box.find(".w2ui-scroll-left").show(),scrollBox.scrollLeft()<scrollBox.find(":first").outerWidth()-scrollBox.outerWidth()&&box.find(".w2ui-scroll-right").show()),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},destroy:function(){var edata=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==edata.isCancelled&&($(this.box).find("> table #tabs_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger($.extend(edata,{phase:"after"})))},click:function(id,event){var tab=this.get(id);if(null==tab||tab.disabled)return!1;var edata=this.trigger({phase:"before",type:"click",target:id,tab:tab,object:tab,originalEvent:event});if(!0!==edata.isCancelled){if($(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=tab.id,"string"==typeof tab.route){var route=""!==tab.route?String("/"+tab.route).replace(/\/{2,}/g,"/"):"",info=w2utils.parseRoute(route);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=this.routeData[info.keys[k].name]&&(route=route.replace(new RegExp(":"+info.keys[k].name,"g"),this.routeData[info.keys[k].name]));setTimeout(function(){window.location.hash=route},1)}this.trigger($.extend(edata,{phase:"after"})),this.refresh(id)}},animateClose:function(id,event){var tab=this.get(id);if(null==tab||tab.disabled)return!1;var edata=this.trigger({phase:"before",type:"close",target:id,object:this.get(id),originalEvent:event});if(!0!==edata.isCancelled){var obj=this;$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(tab.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0"),setTimeout(function(){var width=$(obj.box).find("#tabs_"+obj.name+"_tab_"+w2utils.escapeId(tab.id)).width();$(obj.box).find("#tabs_"+obj.name+"_tab_"+w2utils.escapeId(tab.id)).html('<div style="width: '+width+"px; "+w2utils.cssPrefix("transition",".2s",!0)+'"></div>'),setTimeout(function(){$(obj.box).find("#tabs_"+obj.name+"_tab_"+w2utils.escapeId(tab.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){obj.remove(id)},450),this.trigger($.extend(edata,{phase:"after"})),this.refresh()}},animateInsert:function(id,tab){var jq_el;if(null!=this.get(id)&&($.isPlainObject(tab)&&w2utils.checkUniqueId(tab.id,this.tabs,"tabs",this.name)&&0===$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(tab.id)).length)){null==tab.text&&null!=tab.caption&&(tab.text=tab.caption);var tmp='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tbody><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(tab.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===tab.id?"active":"")+'">'+tab.text+"</div></td></tr></tbody></table></div>";$("body").append(tmp);var tabHTML='<div style="width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'">&#160;</div>',addStyle="";tab.hidden&&(addStyle+="display: none;"),tab.disabled&&(addStyle+="opacity: 0.2;");var html='<td id="tabs_'+this.name+"_tab_"+tab.id+'" style="'+addStyle+'" valign="middle">'+tabHTML+"</td>";this.get(id,!0)!==this.tabs.length&&$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(id,!0))].id)).length>0?$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(id,!0))].id)).before(html):$(this.box).find("#tabs_"+this.name+"_right").before(html);var obj=this;setTimeout(function(){var width=$("#_tmp_simple_tab").width();$("#_tmp_tabs").remove(),$("#tabs_"+obj.name+"_tab_"+w2utils.escapeId(tab.id)+" > div").css("width",width+"px")},1),setTimeout(function(){obj.insert(id,tab)},200)}}},$.extend(w2tabs.prototype,w2utils.event),w2obj.tabs=w2tabs}(jQuery),function($){var w2toolbar=function(options){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",$.extend(!0,this,w2obj.toolbar,options)};$.fn.w2toolbar=function(method){if($.isPlainObject(method)){if(!w2utils.checkName(method,"w2toolbar"))return;var items=method.items||[],object=new w2toolbar(method);$.extend(object,{items:[],handlers:[]});for(var i=0;i<items.length;i++)if(object.items[i]=$.extend({},w2toolbar.prototype.item,items[i]),"menu-check"==object.items[i].type){var item=object.items[i];if(Array.isArray(item.selected)||(item.selected=[]),Array.isArray(item.items))for(var j=0;j<item.items.length;j++){var it;(it=item.items[j]).checked&&-1==item.selected.indexOf(it.id)&&item.selected.push(it.id),it.checked||-1==item.selected.indexOf(it.id)||(it.checked=!0),null==it.checked&&(it.checked=!1)}}else if("menu-radio"==object.items[i].type){var item=object.items[i];if(Array.isArray(item.items))for(var j=0;j<item.items.length;j++){var it;(it=item.items[j]).checked&&null==item.selected?item.selected=it.id:it.checked=!1,it.checked||item.selected!=it.id||(it.checked=!0),null==it.checked&&(it.checked=!1)}}return 0!==$(this).length&&object.render($(this)[0]),w2ui[object.name]=object,object}var obj=w2ui[$(this).attr("name")];return obj?arguments.length>0?(obj[method]&&obj[method].apply(obj,Array.prototype.slice.call(arguments,1)),this):obj:null},w2toolbar.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,color:null,transparent:null,group:null,items:null,selected:null,overlay:{},onClick:null,onRefresh:null},add:function(items){this.insert(null,items)},insert:function(id,items){$.isArray(items)||(items=[items]);for(var o=0;o<items.length;o++){if(null==items[o].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(-1==$.inArray(String(items[o].type),["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","break","html","spacer"]))return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if(null==items[o].id&&"break"!=items[o].type&&"spacer"!=items[o].type)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(items[o].id,this.items,"toolbar items",this.name))return;var it=$.extend({},w2toolbar.prototype.item,items[o]);if(null==id)this.items.push(it);else{var middle=this.get(id,!0);this.items=this.items.slice(0,middle).concat([it],this.items.slice(middle))}this.refresh(it.id),this.resize()}},remove:function(){for(var removed=0,a=0;a<arguments.length;a++){var it=this.get(arguments[a]);if(it&&-1==String(arguments[a]).indexOf(":")){removed++,$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(it.id)).remove();var ind=this.get(it.id,!0);null!=ind&&this.items.splice(ind,1)}}return this.resize(),removed},set:function(id,newOptions){var item=this.get(id);return null!=item&&($.extend(item,newOptions),this.refresh(String(id).split(":")[0]),!0)},get:function(id,returnIndex){if(0===arguments.length){for(var all=[],i1=0;i1<this.items.length;i1++)null!=this.items[i1].id&&all.push(this.items[i1].id);return all}for(var tmp=String(id).split(":"),i2=0;i2<this.items.length;i2++){var it=this.items[i2];if(-1!=["menu","menu-radio","menu-check"].indexOf(it.type)&&2==tmp.length&&it.id==tmp[0])for(var i=0;i<it.items.length;i++){var item=it.items[i];if(item.id==tmp[1]||null==item.id&&item.text==tmp[1])return 1==returnIndex?i:item}else if(it.id==tmp[0])return 1==returnIndex?i2:it}return null},show:function(){for(var obj=this,items=0,tmp=[],a=0;a<arguments.length;a++){var it=this.get(arguments[a]);it&&(items++,it.hidden=!1,tmp.push(String(arguments[a]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t]);obj.resize()},15),items},hide:function(){for(var obj=this,items=0,tmp=[],a=0;a<arguments.length;a++){var it=this.get(arguments[a]);it&&(items++,it.hidden=!0,tmp.push(String(arguments[a]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t]),obj.tooltipHide(tmp[t]);obj.resize()},15),items},enable:function(){for(var obj=this,items=0,tmp=[],a=0;a<arguments.length;a++){var it=this.get(arguments[a]);it&&(items++,it.disabled=!1,tmp.push(String(arguments[a]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t])},15),items},disable:function(){for(var obj=this,items=0,tmp=[],a=0;a<arguments.length;a++){var it=this.get(arguments[a]);it&&(items++,it.disabled=!0,tmp.push(String(arguments[a]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t]),obj.tooltipHide(tmp[t])},15),items},check:function(){for(var obj=this,items=0,tmp=[],a=0;a<arguments.length;a++){var it=this.get(arguments[a]);it&&-1==String(arguments[a]).indexOf(":")&&(items++,it.checked=!0,tmp.push(String(arguments[a]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t])},15),items},uncheck:function(){for(var obj=this,items=0,tmp=[],a=0;a<arguments.length;a++){var it=this.get(arguments[a]);it&&-1==String(arguments[a]).indexOf(":")&&(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(it.type)&&it.checked&&setTimeout(function(){var el;$("#tb_"+obj.name+"_item_"+w2utils.escapeId(it.id)).w2overlay({name:obj.name})},1),items++,it.checked=!1,tmp.push(String(arguments[a]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<tmp.length;t++)obj.refresh(tmp[t])},15),items},click:function(id,event){var obj=this,tmp=String(id).split(":"),it=this.get(tmp[0]);if(tmp.length>1){var subItem=this.get(id);subItem&&!subItem.disabled&&obj.menuClick({name:obj.name,item:it,subItem:subItem,originalEvent:event})}else if(it&&!it.disabled){var edata=this.trigger({phase:"before",type:"click",target:null!=id?id:this.name,item:it,object:it,originalEvent:event});if(!0===edata.isCancelled)return;var btn="#tb_"+this.name+"_item_"+w2utils.escapeId(it.id)+" table.w2ui-button";if($(btn).removeClass("down"),"radio"==it.type){for(var i=0;i<this.items.length;i++){var itt=this.items[i];null!=itt&&itt.id!=it.id&&"radio"===itt.type&&(itt.group==it.group&&itt.checked&&(itt.checked=!1,this.refresh(itt.id)))}it.checked=!0,$(btn).addClass("checked")}if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(it.type)&&(obj.tooltipHide(id),it.checked?setTimeout(function(){var el;$("#tb_"+obj.name+"_item_"+w2utils.escapeId(it.id)).w2overlay({name:obj.name}),it.checked=!1,obj.refresh(it.id)},1):setTimeout(function(){var el=$("#tb_"+obj.name+"_item_"+w2utils.escapeId(it.id));$.isPlainObject(it.overlay)||(it.overlay={});var left=(el.width()-50)/2;if(left>19&&(left=19),"drop"==it.type&&el.w2overlay(it.html,$.extend({name:obj.name,left:left,top:3},it.overlay,{onHide:function(event){hideDrop()}})),-1!=["menu","menu-radio","menu-check"].indexOf(it.type)){var menuType="normal";"menu-radio"==it.type&&(menuType="radio",it.items.forEach(function(item){it.selected==item.id?item.checked=!0:item.checked=!1})),"menu-check"==it.type&&(menuType="check",it.items.forEach(function(item){$.isArray(it.selected)&&-1!=it.selected.indexOf(item.id)?item.checked=!0:item.checked=!1})),el.w2menu($.extend({name:obj.name,items:it.items,left:left,top:3},it.overlay,{type:menuType,select:function(event){obj.menuClick({name:obj.name,item:it,subItem:event.item,originalEvent:event.originalEvent,keepOpen:event.keepOpen})},onHide:function(event){hideDrop()}}))}function hideDrop(event){it.checked=!1,$(btn).removeClass("checked")}-1!=["color","text-color"].indexOf(it.type)&&(null==it.transparent&&(it.transparent=!0),$(el).w2color({color:it.color,transparent:it.transparent},function(color,index){null!=color&&obj.colorClick({name:obj.name,item:it,color:color,originalEvent:event.originalEvent}),hideDrop()}))},1)),-1!=["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(it.type)&&(it.checked=!it.checked,it.checked?$(btn).addClass("checked"):$(btn).removeClass("checked")),it.route){var route=String("/"+it.route).replace(/\/{2,}/g,"/"),info=w2utils.parseRoute(route);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)route=route.replace(new RegExp(":"+info.keys[k].name,"g"),this.routeData[info.keys[k].name]);setTimeout(function(){window.location.hash=route},1)}event&&-1!=["button","check","radio"].indexOf(it.type)&&this.tooltipShow(id,event,!0),this.trigger($.extend(edata,{phase:"after"}))}},scroll:function(direction){var box=$(this.box),obj=this,scrollBox=box.find(".w2ui-scroll-wrapper"),scrollLeft=scrollBox.scrollLeft(),width1,width2,scroll;switch(direction){case"left":width1=scrollBox.outerWidth(),width2=scrollBox.find(":first").outerWidth(),(scroll=scrollLeft-width1+50)<=0&&(scroll=0),scrollBox.animate({scrollLeft:scroll},300);break;case"right":(scroll=scrollLeft+(width1=scrollBox.outerWidth())-50)>=(width2=scrollBox.find(":first").outerWidth())-width1&&(scroll=width2-width1),scrollBox.animate({scrollLeft:scroll},300)}setTimeout(function(){obj.resize()},350)},render:function(box){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"render",target:this.name,box:box});if(!0!==edata.isCancelled&&(null!=box&&($(this.box).find("> table #tb_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=box),this.box)){for(var html='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>',i=0;i<this.items.length;i++){var it=this.items[i];null!=it&&(null==it.id&&(it.id="item_"+i),"spacer"==it.type?html+='<td width="100%" id="tb_'+this.name+"_item_"+it.id+'" align="right"></td>':html+='<td id="tb_'+this.name+"_item_"+it.id+'" style="'+(it.hidden?"display: none":"")+'"     class="'+(it.disabled?"disabled":"")+'" valign="middle"></td>')}return html+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",html+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>",$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(html),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.refresh(),this.resize(),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},refresh:function(id){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"refresh",target:null!=id?id:this.name,item:this.get(id)});if(!0!==edata.isCancelled){if(null!=id){var it=this.get(id);if(null==it)return!1;if("function"==typeof it.onRefresh){var edata2=this.trigger({phase:"before",type:"refresh",target:id,item:it,object:it});if(!0===edata2.isCancelled)return}var el=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(it.id)),html=this.getItemHTML(it);return 0===el.length?(html="spacer"==it.type?'<td width="100%" id="tb_'+this.name+"_item_"+it.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+it.id+'" style="'+(it.hidden?"display: none":"")+'"     class="'+(it.disabled?"disabled":"")+'" valign="middle">'+html+"</td>",this.get(id,!0)==this.items.length-1?$(this.box).find("#tb_"+this.name+"_right").before(html):$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(id,!0))+1].id)).before(html)):(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(it.type)&&0==it.checked&&$("#w2ui-overlay-"+this.name).length>0&&$("#w2ui-overlay-"+this.name)[0].hide(),el.html(html),it.hidden?el.css("display","none"):el.css("display",""),it.disabled?el.addClass("disabled"):el.removeClass("disabled")),"function"==typeof it.onRefresh&&this.trigger($.extend(edata2,{phase:"after"})),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}for(var i=0;i<this.items.length;i++){var it1=this.items[i];null==it1.id&&(it1.id="item_"+i),this.refresh(it1.id)}}},resize:function(){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==edata.isCancelled){var box=$(this.box);box.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var scrollBox=box.find(".w2ui-scroll-wrapper");return scrollBox.find(":first").outerWidth()>scrollBox.outerWidth()&&(scrollBox.scrollLeft()>0&&box.find(".w2ui-scroll-left").show(),scrollBox.scrollLeft()<scrollBox.find(":first").outerWidth()-scrollBox.outerWidth()&&box.find(".w2ui-scroll-right").show()),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}},destroy:function(){var edata=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==edata.isCancelled&&($(this.box).find("> table #tb_"+this.name+"_right").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),$(this.box).html(""),delete w2ui[this.name],this.trigger($.extend(edata,{phase:"after"})))},getItemHTML:function(item){var html="";null!=item.caption&&null==item.text&&(item.text=item.caption),null==item.text&&(item.text=""),null==item.tooltip&&null!=item.hint&&(item.tooltip=item.hint),null==item.tooltip&&(item.tooltip="");var img="<td>&#160;</td>",text=item.text;if("function"==typeof text&&(text=text.call(this,item)),item.img&&(img='<td><div class="w2ui-tb-image w2ui-icon '+item.img+'"></div></td>'),item.icon&&(img='<td><div class="w2ui-tb-image"><span class="'+item.icon+'"></span></div></td>'),""===html)switch(item.type){case"color":case"text-color":"string"==typeof item.color&&"#"==item.color.substr(0,1)&&(item.color=item.color.substr(1)),"color"==item.type&&(text='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: #'+(null!=item.color?item.color:"fff")+'; float: left;"></div>'+(item.text?'<div style="margin-left: 17px;">'+w2utils.lang(item.text)+"</div>":"")),"text-color"==item.type&&(text='<div style="color: #'+(null!=item.color?item.color:"444")+';">'+(item.text?w2utils.lang(item.text):"<b>Aa</b>")+"</div>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":html+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(item.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+item.id+'\', event);"        onmouseover = "'+(item.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+item.id+"', event);")+'"       onmouseout  = "'+(item.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+item.id+"', event);")+'"       onmousedown = "'+(item.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(item.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+img+(""!==text?'<td class="w2ui-tb-caption" nowrap="nowrap" style="'+(item.style?item.style:"")+'">'+w2utils.lang(text)+"</td>":"")+(null!=item.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+item.count+"</span></td>":"")+(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(item.type)&&!1!==item.arrow?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case"break":html+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';break;case"html":html+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof item.html?item.html.call(this,item):item.html)+"</td></tr></tbody></table>"}return"<div>"+html+"</div>"},tooltipShow:function(id,event,forceRefresh){if(null!=this.tooltip){var $el=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(id)),item=this.get(id),pos=this.tooltip,txt=item.tooltip;"function"==typeof txt&&(txt=txt.call(this,item)),$el.prop("_mouse_over",!0),setTimeout(function(){if(!0===$el.prop("_mouse_over")&&!0!==$el.prop("_mouse_tooltip")){if($el.prop("_mouse_tooltip",!0),-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(item.type)&&1==item.checked)return;$el.w2tag(w2utils.lang(txt),{position:pos})}1==forceRefresh&&$el.w2tag(w2utils.lang(txt),{position:pos})},1)}},tooltipHide:function(id,event){if(null!=this.tooltip){var $el=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(id)),item=this.get(id);$el.removeProp("_mouse_over"),setTimeout(function(){!0!==$el.prop("_mouse_over")&&!0===$el.prop("_mouse_tooltip")&&($el.removeProp("_mouse_tooltip"),$el.w2tag())},1)}},menuClick:function(event){var obj=this;if(event.item&&!event.item.disabled){var edata=this.trigger({phase:"before",type:"click",target:event.item.id+":"+event.subItem.id,item:event.item,subItem:event.subItem,originalEvent:event.originalEvent});if(!0===edata.isCancelled)return;var it=event.subItem,item=this.get(event.item.id);if("menu-radio"==item.type&&(item.selected=it.id,event.item.items.forEach(function(item){item.checked=!1}),it.checked=!0),"menu-check"==item.type){$.isArray(item.selected)||(item.selected=[]);var ind=item.selected.indexOf(it.id);-1==ind?(item.selected.push(it.id),it.checked=!0):(item.selected.splice(ind,1),it.checked=!1)}if("string"==typeof it.route){var route=""!==it.route?String("/"+it.route).replace(/\/{2,}/g,"/"):"",info=w2utils.parseRoute(route);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(route=route.replace(new RegExp(":"+info.keys[k].name,"g"),this.routeData[info.keys[k].name]));setTimeout(function(){window.location.hash=route},1)}this.refresh(event.item.id),this.trigger($.extend(edata,{phase:"after"}))}},colorClick:function(event){var obj=this;if(event.item&&!event.item.disabled){var edata=this.trigger({phase:"before",type:"click",target:event.item.id,item:event.item,color:event.color,originalEvent:event.originalEvent});if(!0===edata.isCancelled)return;event.item.color=event.color,obj.refresh(event.item.id),this.trigger($.extend(edata,{phase:"after"}))}}},$.extend(w2toolbar.prototype,w2utils.event),w2obj.toolbar=w2toolbar}(jQuery),function($){var w2sidebar=function(options){this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,$.extend(!0,this,w2obj.sidebar,options)};$.fn.w2sidebar=function(method){if($.isPlainObject(method)){if(!w2utils.checkName(method,"w2sidebar"))return;var nodes=method.nodes,object=new w2sidebar(method);return $.extend(object,{handlers:[],nodes:[]}),null!=nodes&&object.add(object,nodes),0!==$(this).length&&object.render($(this)[0]),object.sidebar=object,w2ui[object.name]=object,object}var obj=w2ui[$(this).attr("name")];return obj?arguments.length>0?(obj[method]&&obj[method].apply(obj,Array.prototype.slice.call(arguments,1)),this):obj:null},w2sidebar.prototype={onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!0,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(parent,nodes){return 1==arguments.length&&(nodes=arguments[0],parent=this),"string"==typeof parent&&(parent=this.get(parent)),this.insert(parent,null,nodes)},insert:function(parent,before,nodes){var txt,ind,tmp,node,nd;if(2==arguments.length)if(nodes=arguments[1],null!=(before=arguments[0])){if(null==(ind=this.get(before)))return $.isArray(nodes)||(nodes=[nodes]),txt=null!=nodes[0].caption?nodes[0].caption:nodes[0].text,console.log('ERROR: Cannot insert node "'+txt+'" because cannot find node "'+before+'" to insert before.'),null;parent=this.get(before).parent}else parent=this;"string"==typeof parent&&(parent=this.get(parent)),$.isArray(nodes)||(nodes=[nodes]);for(var o=0;o<nodes.length;o++)if(null!=typeof(node=nodes[o]).id)if(null==this.get(this,node.id)){if((tmp=$.extend({},w2sidebar.prototype.node,node)).sidebar=this,tmp.parent=parent,nd=tmp.nodes||[],tmp.nodes=[],null==before)parent.nodes.push(tmp);else{if(null==(ind=this.get(parent,before,!0)))return txt=null!=node.caption?node.caption:node.text,console.log('ERROR: Cannot insert node "'+txt+'" because cannot find node "'+before+'" to insert before.'),null;parent.nodes.splice(ind,0,tmp)}nd.length>0&&this.insert(tmp,null,nd)}else txt=null!=node.caption?node.caption:node.text,console.log("ERROR: Cannot insert node with id="+node.id+" (text: "+txt+") because another node with the same id already exists.");else txt=null!=node.caption?node.caption:node.text,console.log('ERROR: Cannot insert node "'+txt+'" because it has no id.');return this.refresh(parent.id),tmp},remove:function(){for(var deleted=0,tmp,a=0;a<arguments.length;a++)if(null!=(tmp=this.get(arguments[a]))){null!=this.selected&&this.selected===tmp.id&&(this.selected=null);var ind=this.get(tmp.parent,arguments[a],!0);null!=ind&&(tmp.parent.nodes[ind].selected&&tmp.sidebar.unselect(tmp.id),tmp.parent.nodes.splice(ind,1),deleted++)}return deleted>0&&1==arguments.length?this.refresh(tmp.parent.id):this.refresh(),deleted},set:function(parent,id,node){if(2==arguments.length&&(node=id,id=parent,parent=this),"string"==typeof parent&&(parent=this.get(parent)),null==parent.nodes)return null;for(var i=0;i<parent.nodes.length;i++){if(parent.nodes[i].id===id){var nodes=node.nodes;return $.extend(parent.nodes[i],node,{nodes:[]}),null!=nodes&&this.add(parent.nodes[i],nodes),this.refresh(id),!0}var rv;if(this.set(parent.nodes[i],id,node))return!0}return!1},get:function(parent,id,returnIndex){if(0===arguments.length){for(var all=[],tmp=this.find({}),t=0;t<tmp.length;t++)null!=tmp[t].id&&all.push(tmp[t].id);return all}if((1==arguments.length||2==arguments.length&&!0===id)&&(returnIndex=id,id=parent,parent=this),"string"==typeof parent&&(parent=this.get(parent)),null==parent.nodes)return null;for(var i=0;i<parent.nodes.length;i++){if(parent.nodes[i].id==id)return!0===returnIndex?i:parent.nodes[i];var rv=this.get(parent.nodes[i],id,returnIndex);if(rv||0===rv)return rv}return null},find:function(parent,params,results){if(1==arguments.length&&(params=parent,parent=this),results||(results=[]),"string"==typeof parent&&(parent=this.get(parent)),null==parent.nodes)return results;for(var i=0;i<parent.nodes.length;i++){var match=!0;for(var prop in params)parent.nodes[i][prop]!=params[prop]&&(match=!1);match&&results.push(parent.nodes[i]),parent.nodes[i].nodes.length>0&&(results=this.find(parent.nodes[i],params,results))}return results},hide:function(){for(var hidden=0,a=0;a<arguments.length;a++){var tmp=this.get(arguments[a]);null!=tmp&&(tmp.hidden=!0,hidden++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),hidden},show:function(){for(var shown=0,a=0;a<arguments.length;a++){var tmp=this.get(arguments[a]);null!=tmp&&(tmp.hidden=!1,shown++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),shown},disable:function(){for(var disabled=0,a=0;a<arguments.length;a++){var tmp=this.get(arguments[a]);null!=tmp&&(tmp.disabled=!0,tmp.selected&&this.unselect(tmp.id),disabled++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),disabled},enable:function(){for(var enabled=0,a=0;a<arguments.length;a++){var tmp=this.get(arguments[a]);null!=tmp&&(tmp.disabled=!1,enabled++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),enabled},select:function(id){var new_node=this.get(id);return!!new_node&&((this.selected!=id||!new_node.selected)&&(this.unselect(this.selected),$(this.box).find("#node_"+w2utils.escapeId(id)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),new_node.selected=!0,this.selected=id,!0))},unselect:function(id){0===arguments.length&&(id=this.selected);var current=this.get(id);return!!current&&(current.selected=!1,$(this.box).find("#node_"+w2utils.escapeId(id)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==id&&(this.selected=null),!0)},toggle:function(id){var nd=this.get(id);return null!=nd&&(nd.plus?(this.set(id,{plus:!1}),this.expand(id),void this.refresh(id)):0!==nd.nodes.length&&(!!nd.collapsible&&(this.get(id).expanded?this.collapse(id):this.expand(id))))},collapse:function(id){var obj=this,nd=this.get(id),edata=this.trigger({phase:"before",type:"collapse",target:id,object:nd});if(!0!==edata.isCancelled)return $(this.box).find("#node_"+w2utils.escapeId(id)+"_sub").slideUp(200),$(this.box).find("#node_"+w2utils.escapeId(id)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),nd.expanded=!1,this.trigger($.extend(edata,{phase:"after"})),setTimeout(function(){obj.refresh(id)},200),!0},collapseAll:function(parent){if(null==parent&&(parent=this),"string"==typeof parent&&(parent=this.get(parent)),null==parent.nodes)return!1;for(var i=0;i<parent.nodes.length;i++)!0===parent.nodes[i].expanded&&(parent.nodes[i].expanded=!1),parent.nodes[i].nodes&&parent.nodes[i].nodes.length>0&&this.collapseAll(parent.nodes[i]);return this.refresh(parent.id),!0},expand:function(id){var obj=this,nd=this.get(id),edata=this.trigger({phase:"before",type:"expand",target:id,object:nd});if(!0!==edata.isCancelled)return $(this.box).find("#node_"+w2utils.escapeId(id)+"_sub").slideDown(200),$(this.box).find("#node_"+w2utils.escapeId(id)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),nd.expanded=!0,this.trigger($.extend(edata,{phase:"after"})),setTimeout(function(){obj.refresh(id)},200),!0},expandAll:function(parent){if(null==parent&&(parent=this),"string"==typeof parent&&(parent=this.get(parent)),null==parent.nodes)return!1;for(var i=0;i<parent.nodes.length;i++)!1===parent.nodes[i].expanded&&(parent.nodes[i].expanded=!0),parent.nodes[i].nodes&&parent.nodes[i].nodes.length>0&&this.expandAll(parent.nodes[i]);this.refresh(parent.id)},expandParents:function(id){var node=this.get(id);return null!=node&&(node.parent&&(node.parent.expanded||(node.parent.expanded=!0,this.refresh(node.parent.id)),this.expandParents(node.parent.id)),!0)},click:function(id,event){var obj=this,nd=this.get(id);if(null!=nd&&!nd.disabled&&!nd.group){$(obj.box).find(".w2ui-node.w2ui-selected").each(function(index,el){var oldID=$(el).attr("id").replace("node_",""),oldNode=obj.get(oldID);null!=oldNode&&(oldNode.selected=!1),$(el).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var newNode=$(obj.box).find("#node_"+w2utils.escapeId(id)),oldNode=$(obj.box).find("#node_"+w2utils.escapeId(obj.selected));newNode.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(function(){var edata=obj.trigger({phase:"before",type:"click",target:id,originalEvent:event,node:nd,object:nd});if(!0===edata.isCancelled)return newNode.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void oldNode.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!=oldNode&&(oldNode.selected=!1),obj.get(id).selected=!0,obj.selected=id,"string"==typeof nd.route){var route=""!==nd.route?String("/"+nd.route).replace(/\/{2,}/g,"/"):"",info=w2utils.parseRoute(route);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(route=route.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]));setTimeout(function(){window.location.hash=route},1)}obj.trigger($.extend(edata,{phase:"after"}))},1)}},focus:function(event){var obj=this,edata=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:event});if(!0===edata.isCancelled)return!1;this.hasFocus=!0,$(this.box).find(".w2ui-selected").removeClass("w2ui-inactive"),setTimeout(function(){var $input=$(obj.box).find("#sidebar_"+obj.name+"_focus");$input.is(":focus")||$input.focus()},10),this.trigger($.extend(edata,{phase:"after"}))},blur:function(event){var edata=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:event});if(!0===edata.isCancelled)return!1;this.hasFocus=!1,$(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),this.trigger($.extend(edata,{phase:"after"}))},keydown:function(event){var obj=this,nd=obj.get(obj.selected);if(!0===obj.keyboard){nd||(nd=obj.nodes[0]);var edata=obj.trigger({phase:"before",type:"keydown",target:obj.name,originalEvent:event});!0!==edata.isCancelled&&(13!=event.keyCode&&32!=event.keyCode||nd.nodes.length>0&&obj.toggle(obj.selected),37==event.keyCode&&(nd.nodes.length>0&&nd.expanded?obj.collapse(obj.selected):(selectNode(nd.parent),nd.parent.group||obj.collapse(nd.parent.id))),39==event.keyCode&&(nd.nodes.length>0||nd.plus)&&!nd.expanded&&obj.expand(obj.selected),38==event.keyCode&&selectNode(neighbor(nd,prev)),40==event.keyCode&&selectNode(neighbor(nd,next)),-1!=$.inArray(event.keyCode,[13,32,37,38,39,40])&&(event.preventDefault&&event.preventDefault(),event.stopPropagation&&event.stopPropagation()),obj.trigger($.extend(edata,{phase:"after"})))}function selectNode(node,event){null==node||node.hidden||node.disabled||node.group||(obj.click(node.id,event),setTimeout(function(){obj.scrollIntoView()},50))}function neighbor(node,neighborFunc){for(node=neighborFunc(node);null!=node&&(node.hidden||node.disabled)&&!node.group;)node=neighborFunc(node);return node}function next(node,noSubs){if(null==node)return null;var parent=node.parent,ind=obj.get(node.id,!0),nextNode=null;if(node.expanded&&node.nodes.length>0&&!0!==noSubs){var t=node.nodes[0];nextNode=t.hidden||t.disabled||t.group?next(t):t}else nextNode=parent&&ind+1<parent.nodes.length?parent.nodes[ind+1]:next(parent,!0);return null!=nextNode&&(nextNode.hidden||nextNode.disabled||nextNode.group)&&(nextNode=next(nextNode)),nextNode}function prev(node){if(null==node)return null;var parent=node.parent,ind=obj.get(node.id,!0),prevNode=ind>0?lastChild(parent.nodes[ind-1]):parent;return null!=prevNode&&(prevNode.hidden||prevNode.disabled||prevNode.group)&&(prevNode=prev(prevNode)),prevNode}function lastChild(node){if(node.expanded&&node.nodes.length>0){var t=node.nodes[node.nodes.length-1];return t.hidden||t.disabled||t.group?prev(t):lastChild(t)}return node}},scrollIntoView:function(id){var nd;if(null==id&&(id=this.selected),null!=this.get(id)){var body=$(this.box).find(".w2ui-sidebar-div"),item=$(this.box).find("#node_"+w2utils.escapeId(id)),offset=item.offset().top-body.offset().top;(offset+item.height()>body.height()||offset<=0)&&body.animate({scrollTop:body.scrollTop()+offset-body.height()/2+item.height()},250,"linear")}},dblClick:function(id,event){var nd=this.get(id),edata=this.trigger({phase:"before",type:"dblClick",target:id,originalEvent:event,object:nd});!0!==edata.isCancelled&&(this.toggle(id),this.trigger($.extend(edata,{phase:"after"})))},contextMenu:function(id,event){var obj=this,nd=obj.get(id);id!=obj.selected&&obj.click(id);var edata=obj.trigger({phase:"before",type:"contextMenu",target:id,originalEvent:event,object:nd,allowOnDisabled:!1});!0!==edata.isCancelled&&(nd.disabled&&!edata.allowOnDisabled||(obj.menu.length>0&&$(obj.box).find("#node_"+w2utils.escapeId(id)).w2menu({items:obj.menu,contextMenu:!0,originalEvent:event,onSelect:function(event){obj.menuClick(id,parseInt(event.index),event.originalEvent)}}),event.preventDefault&&event.preventDefault(),obj.trigger($.extend(edata,{phase:"after"}))))},menuClick:function(itemId,index,event){var obj=this,edata=obj.trigger({phase:"before",type:"menuClick",target:itemId,originalEvent:event,menuIndex:index,menuItem:obj.menu[index]});!0!==edata.isCancelled&&obj.trigger($.extend(edata,{phase:"after"}))},goFlat:function(){var edata=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==edata.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger($.extend(edata,{phase:"after"})))},render:function(box){var time=(new Date).getTime(),obj=this,edata=this.trigger({phase:"before",type:"render",target:this.name,box:box});if(!0!==edata.isCancelled&&(null!=box&&($(this.box).find("> div > div.w2ui-sidebar-div").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=box),this.box)){$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0"/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style);var flatHTML="",kbd_timer;return 1==this.flatButton&&(flatHTML='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===flatHTML||($(this.box).find(".w2ui-sidebar-top").html(this.topHTML+flatHTML),$(this.box).find(".w2ui-sidebar-div").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-div").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+"px")),$(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(event){clearTimeout(kbd_timer),obj.hasFocus||obj.focus(event)}).on("blur",function(event){kbd_timer=setTimeout(function(){obj.hasFocus&&obj.blur(event)},100)}).on("keydown",function(event){9!=event.keyCode&&w2ui[obj.name].keydown.call(w2ui[obj.name],event)}),$(this.box).off("mousedown").on("mousedown",function(event){setTimeout(function(){if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(event.target.tagName.toUpperCase())){var $input=$(obj.box).find("#sidebar_"+obj.name+"_focus");if(!$input.is(":focus")){if($(event.target).hasClass("w2ui-node")){var top=$(event.target).position().top+$(obj.box).find(".w2ui-sidebar-top").height()+event.offsetY;$input.css({top:top+"px",left:"0px"})}$input.focus()}}},1)}),this.trigger($.extend(edata,{phase:"after"})),this.refresh(),(new Date).getTime()-time}},refresh:function(id){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"refresh",target:null!=id?id:this.name,fullRefresh:null==id});if(!0!==edata.isCancelled){var flatHTML="";1==this.flatButton&&(flatHTML='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===flatHTML||($(this.box).find(".w2ui-sidebar-top").html(this.topHTML+flatHTML),$(this.box).find(".w2ui-sidebar-div").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-div").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+"px")),$(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"});var obj=this,node,nd,nm,nodeHTML;if(null==id)node=this,nm=".w2ui-sidebar-div";else{if(null==(node=this.get(id)))return;nm="#node_"+w2utils.escapeId(node.id)+"_sub"}if(node!==this){var tmp="#node_"+w2utils.escapeId(node.id);nodeHTML=getNodeHTML(node),$(this.box).find(tmp).before('<div id="sidebar_'+this.name+'_tmp"></div>'),$(this.box).find(tmp).remove(),$(this.box).find(nm).remove(),$("#sidebar_"+this.name+"_tmp").before(nodeHTML),$("#sidebar_"+this.name+"_tmp").remove()}$(this.box).find(nm).html("");for(var i=0;i<node.nodes.length;i++)if(nodeHTML=getNodeHTML(nd=node.nodes[i]),$(this.box).find(nm).append(nodeHTML),0!==nd.nodes.length)this.refresh(nd.id);else{var edata2=this.trigger({phase:"before",type:"refresh",target:nd.id});if(!0===edata2.isCancelled)return;this.trigger($.extend(edata2,{phase:"after"}))}return this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time}function getNodeHTML(nd){var html="",img=nd.img;null==img&&(img=this.img);var icon=nd.icon;null==icon&&(icon=this.icon);for(var tmp=nd.parent,level=0;tmp&&null!=tmp.parent;)tmp.group&&level--,tmp=tmp.parent,level++;if(null!=nd.caption&&(nd.text=nd.caption),nd.group)html='<div class="w2ui-node-group w2ui-level-'+level+'" id="node_'+nd.id+'"   onclick="w2ui[\''+obj.name+"'].toggle('"+nd.id+"')\"   oncontextmenu=\"w2ui['"+obj.name+"'].contextMenu('"+nd.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(nd.groupShowHide&&nd.collapsible?"<span>"+(!nd.hidden&&nd.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+("function"==typeof nd.text?nd.text.call(obj,nd):"<span>"+nd.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+nd.id+'_sub" style="'+nd.style+";"+(!nd.hidden&&nd.expanded?"":"display: none;")+'"></div>',obj.flat&&(html='<div class="w2ui-node-group" id="node_'+nd.id+'"><span>&#160;</span></div><div id="node_'+nd.id+'_sub" style="'+nd.style+";"+(!nd.hidden&&nd.expanded?"":"display: none;")+'"></div>');else{nd.selected&&!nd.disabled&&(obj.selected=nd.id),tmp="",img&&(tmp='<div class="w2ui-node-image w2ui-icon '+img+(nd.selected&&!nd.disabled?" w2ui-icon-selected":"")+'"></div>'),icon&&(tmp='<div class="w2ui-node-image"><span class="'+icon+'"></span></div>');var text=nd.text;"function"==typeof nd.text&&(text=nd.text.call(obj,nd)),html='<div class="w2ui-node w2ui-level-'+level+" "+(nd.selected?"w2ui-selected":"")+" "+(nd.disabled?"w2ui-disabled":"")+'" id="node_'+nd.id+'" style="'+(nd.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+obj.name+"'].dblClick('"+nd.id+"', event);\"    oncontextmenu=\"w2ui['"+obj.name+"'].contextMenu('"+nd.id+"', event);\"    onClick=\"w2ui['"+obj.name+"'].click('"+nd.id+'\', event); "><table cellpadding="0" cellspacing="0" style="margin-left:'+18*level+"px; padding-right:"+18*level+'px"><tbody><tr><td class="w2ui-node-dots" nowrap="nowrap" onclick="w2ui[\''+obj.name+"'].toggle('"+nd.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div class="w2ui-expand">'+(nd.nodes.length>0?nd.expanded?"-":"+":nd.plus?"+":"")+'</div></td><td class="w2ui-node-data" nowrap="nowrap">'+tmp+(nd.count||0===nd.count?'<div class="w2ui-node-count">'+nd.count+"</div>":"")+'<div class="w2ui-node-caption">'+text+'</div></td></tr></tbody></table></div><div class="w2ui-node-sub" id="node_'+nd.id+'_sub" style="'+nd.style+";"+(!nd.hidden&&nd.expanded?"":"display: none;")+'"></div>',obj.flat&&(html='<div class="w2ui-node w2ui-level-'+level+" "+(nd.selected?"w2ui-selected":"")+" "+(nd.disabled?"w2ui-disabled":"")+'" id="node_'+nd.id+'" style="'+(nd.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(text+(nd.count||0===nd.count?' - <span class="w2ui-node-count">'+nd.count+"</span>":""))+"'),                { id: '"+nd.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+nd.id+"' })\"    ondblclick=\"w2ui['"+obj.name+"'].dblClick('"+nd.id+"', event);\"    oncontextmenu=\"w2ui['"+obj.name+"'].contextMenu('"+nd.id+"', event);\"    onClick=\"w2ui['"+obj.name+"'].click('"+nd.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+tmp+'</div></div><div class="w2ui-node-sub" id="node_'+nd.id+'_sub" style="'+nd.style+";"+(!nd.hidden&&nd.expanded?"":"display: none;")+'"></div>')}return html}},resize:function(){var time=(new Date).getTime(),edata=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==edata.isCancelled)return $(this.box).css("overflow","hidden"),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),this.trigger($.extend(edata,{phase:"after"})),(new Date).getTime()-time},destroy:function(){var edata=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==edata.isCancelled&&($(this.box).find("> div > div.w2ui-sidebar-div").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger($.extend(edata,{phase:"after"})))},lock:function(msg,showSpinner){var args=Array.prototype.slice.call(arguments,0);args.unshift(this.box),w2utils.lock.apply(window,args)},unlock:function(speed){w2utils.unlock(this.box,speed)}},$.extend(w2sidebar.prototype,w2utils.event),w2obj.sidebar=w2sidebar}(jQuery),function($){var w2field=function(options){this.el=null,this.helpers={},this.type=options.type||"text",this.options=$.extend(!0,{},options),this.onSearch=options.onSearch||null,this.onRequest=options.onRequest||null,this.onLoad=options.onLoad||null,this.onError=options.onError||null,this.onClick=options.onClick||null,this.onAdd=options.onAdd||null,this.onNew=options.onNew||null,this.onRemove=options.onRemove||null,this.onMouseOver=options.onMouseOver||null,this.onMouseOut=options.onMouseOut||null,this.onIconClick=options.onIconClick||null,this.onScroll=options.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll,$.extend(!0,this,w2obj.field)};$.fn.w2field=function(method,options){var obj;if(0!==this.length)return 0===arguments.length?$(this).data("w2field"):("string"==typeof method&&"object"==typeof options&&(method=$.extend(!0,{},options,{type:method})),"string"==typeof method&&null==options&&(method={type:method}),method.type=String(method.type).toLowerCase(),this.each(function(index,el){var obj;if(null==(obj=$(el).data("w2field"))){var obj=new w2field(method);return $.extend(obj,{handlers:[]}),el&&(obj.el=$(el)[0]),obj.init(),$(el).data("w2field",obj),obj}if(obj.clear(),"clear"!=method.type){var obj=new w2field(method);return $.extend(obj,{handlers:[]}),el&&(obj.el=$(el)[0]),obj.init(),$(el).data("w2field",obj),obj}}));var pr=w2field.prototype;return pr[method]?pr[method].apply(pr,Array.prototype.slice.call(arguments,1)):void 0},w2field.prototype={custom:{},addType:function(type,handler){return type=String(type).toLowerCase(),this.custom[type]=handler,!0},removeType:function(type){return type=String(type).toLowerCase(),!!this.custom[type]&&(delete this.custom[type],!0)},init:function(){var obj=this,options=this.options,defaults;if("function"!=typeof this.custom[this.type])if(-1!=["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":defaults={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=$.extend(!0,{},defaults,options),(options=this.options).numberRE=new RegExp("["+options.groupSymbol+"]","g"),options.moneyRE=new RegExp("["+options.currencyPrefix+options.currencySuffix+options.groupSymbol+"]","g"),options.percentRE=new RegExp("["+options.groupSymbol+"%]","g"),-1!=["text","alphanumeric","hex","bin"].indexOf(this.type)&&(options.arrows=!1,options.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":defaults={prefix:"#",suffix:'<div style="width: '+(parseInt($(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,transparent:!0},$.extend(options,defaults),this.addPrefix(),this.addSuffix(),$(this.el).attr("maxlength",6),""!==$(this.el).val()&&setTimeout(function(){obj.change()},1);break;case"date":defaults={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=$.extend(!0,{},defaults,options),options=this.options,null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",options.format);break;case"time":defaults={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=$.extend(!0,{},defaults,options),options=this.options,null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",options.format);break;case"datetime":defaults={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=$.extend(!0,{},defaults,options),options=this.options,null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",options.placeholder||options.format);break;case"list":case"combo":if(defaults={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},options.items=this.normMenu(options.items),"list"==this.type){if(defaults.openOnFocus=!0,$(this.el).addClass("w2ui-select"),!$.isPlainObject(options.selected)&&options.items)for(var i=0;i<options.items.length;i++){var item=options.items[i];if(item&&item.id==options.selected){options.selected=$.extend(!0,{},item);break}}this.watchSize()}options=$.extend({},defaults,options,{align:"both",altRows:!0}),this.options=options,$.isPlainObject(options.selected)||(options.selected={}),$(this.el).data("selected",options.selected),options.url&&(options.items=[],this.request(0)),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){obj.refresh()},10),$(this.el).attr("autocomplete","off"),null!=options.selected.text&&$(this.el).val(options.selected.text);break;case"enum":defaults={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},(options=$.extend({},defaults,options,{align:"both",suffix:"",altRows:!0})).items=this.normMenu(options.items),options.selected=this.normMenu(options.selected),this.options=options,$.isArray(options.selected)||(options.selected=[]),$(this.el).data("selected",options.selected),options.url&&(options.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":defaults={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},options=$.extend({},defaults,options,{align:"both",altRows:!0}),this.options=options,$.isArray(options.selected)||(options.selected=[]),$(this.el).data("selected",options.selected),null==$(this.el).attr("placeholder")&&$(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(event){obj.change.call(obj,event)},onClick:function(event){obj.click.call(obj,event)},onFocus:function(event){obj.focus.call(obj,event)},onBlur:function(event){obj.blur.call(obj,event)},onKeydown:function(event){obj.keyDown.call(obj,event)},onKeyup:function(event){obj.keyUp.call(obj,event)},onKeypress:function(event){obj.keyPress.call(obj,event)}},$(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change($.Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else this.custom[this.type].call(this,options)},watchSize:function(){var obj=this,tmp=$(obj.el).data("tmp")||{};tmp.sizeTimer=setInterval(function(){$(obj.el).parents("body").length>0?obj.resize():clearInterval(tmp.sizeTimer)},200),$(obj.el).data("tmp",tmp)},get:function(){var ret;return ret=-1!=["list","enum","file"].indexOf(this.type)?$(this.el).data("selected"):$(this.el).val()},set:function(val,append){if(-1!=["list","enum","file"].indexOf(this.type)){if("list"!=this.type&&append)null==$(this.el).data("selected")&&$(this.el).data("selected",[]),$(this.el).data("selected").push(val),$(this.el).change();else{var it="enum"==this.type?[val]:val;$(this.el).data("selected",it).change()}this.refresh()}else $(this.el).val(val)},setIndex:function(ind,append){if(-1!=["list","enum"].indexOf(this.type)){var items=this.options.items;if(items&&items[ind]){if("list"!=this.type&&append)null==$(this.el).data("selected")&&$(this.el).data("selected",[]),$(this.el).data("selected").push(items[ind]),$(this.el).change();else{var it="enum"==this.type?[items[ind]]:items[ind];$(this.el).data("selected",it).change()}return this.refresh(),!0}}return!1},clear:function(){var obj=this,options=this.options;-1!=["money","currency"].indexOf(this.type)&&$(this.el).val($(this.el).val().replace(options.moneyRE,"")),"percent"==this.type&&$(this.el).val($(this.el).val().replace(/%/g,"")),"color"==this.type&&$(this.el).removeAttr("maxlength"),"list"==this.type&&$(this.el).removeClass("w2ui-select"),this.type="clear";var tmp=$(this.el).data("tmp");if(this.tmp){for(var h in null!=tmp&&($(this.el).height("auto"),tmp&&tmp["old-padding-left"]&&$(this.el).css("padding-left",tmp["old-padding-left"]),tmp&&tmp["old-padding-right"]&&$(this.el).css("padding-right",tmp["old-padding-right"]),tmp&&tmp["old-background-color"]&&$(this.el).css("background-color",tmp["old-background-color"]),tmp&&tmp["old-border-color"]&&$(this.el).css("border-color",tmp["old-border-color"]),clearInterval(tmp.sizeTimer)),$(this.el).val(this.clean($(this.el).val())).removeClass("w2field").removeData().off(".w2field"),this.helpers)$(this.helpers[h]).remove();this.helpers={}}},refresh:function(){var obj=this,options=this.options,selected=$(this.el).data("selected"),time=(new Date).getTime();if(-1!=["list"].indexOf(this.type)&&($(obj.el).parent().css("white-space","nowrap"),obj.helpers.prefix&&obj.helpers.prefix.hide(),setTimeout(function(){if(obj.helpers.focus){!$.isEmptyObject(selected)&&options.icon?(options.prefix='<span class="w2ui-icon '+options.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+options.iconStyle+'"></span>',obj.addPrefix()):(options.prefix="",obj.addPrefix());var focus=obj.helpers.focus.find("input");""===$(focus).val()?($(focus).css("text-indent","-9999em").prev().css("opacity",0),$(obj.el).val(selected&&null!=selected.text?w2utils.lang(selected.text):"")):($(focus).css("text-indent",0).prev().css("opacity",1),$(obj.el).val(""),setTimeout(function(){obj.helpers.prefix&&obj.helpers.prefix.hide();var tmp="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";options.icon?($(focus).css("margin-left","17px"),$(obj.helpers.focus).find(".icon-search").attr("style",tmp+"width: 11px !important; opacity: 1; display: block")):($(focus).css("margin-left","0px"),$(obj.helpers.focus).find(".icon-search").attr("style",tmp+"width: 0px !important; opacity: 0; display: none"))},1)),$(obj.el).prop("readonly")||$(obj.el).prop("disabled")?setTimeout(function(){$(obj.helpers.prefix).css("opacity","0.6"),$(obj.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){$(obj.helpers.prefix).css("opacity","1"),$(obj.helpers.suffix).css("opacity","1")},1)}},1)),-1!=["enum","file"].indexOf(this.type)){var html="";if(selected)for(var s=0;s<selected.length;s++){var it=selected[s],ren="";ren="function"==typeof options.renderItem?options.renderItem(it,s,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+s+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+s+'">&#160;&#160;</div>'+("enum"==obj.type?it.text:it.name+'<span class="file-size"> - '+w2utils.formatSize(it.size)+"</span>"),html+='<li index="'+s+'" style="max-width: '+parseInt(options.maxWidth)+"px; "+(it.style?it.style:"")+'">'+ren+"</li>"}var div=obj.helpers.multi,ul=div.find("ul");if(div.attr("style",div.attr("style")+";"+options.style),$(obj.el).css("z-index","-1"),$(obj.el).prop("readonly")||$(obj.el).prop("disabled")?setTimeout(function(){div[0].scrollTop=0,div.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){div.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1),div.find(".w2ui-enum-placeholder").remove(),ul.find("li").not("li.nomouse").remove(),""!==html)ul.prepend(html);else if(null!=$(obj.el).attr("placeholder")&&""===div.find("input").val()){var style="padding-top: "+$(this.el).css("padding-top")+";padding-left: "+$(this.el).css("padding-left")+"; box-sizing: "+$(this.el).css("box-sizing")+"; line-height: "+$(this.el).css("line-height")+"; font-size: "+$(this.el).css("font-size")+"; font-family: "+$(this.el).css("font-family")+"; ";div.prepend('<div class="w2ui-enum-placeholder" style="'+style+'">'+$(obj.el).attr("placeholder")+"</div>")}div.off("scroll.w2field").on("scroll.w2field",function(event){var edata=obj.trigger({phase:"before",type:"scroll",target:obj.el,originalEvent:event});!0!==edata.isCancelled&&obj.trigger($.extend(edata,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(event){var target="LI"==event.target.tagName.toUpperCase()?event.target:$(event.target).parents("LI"),item=selected[$(target).attr("index")];if(!$(target).hasClass("nomouse"))if(event.stopPropagation(),$(event.target).hasClass("w2ui-list-remove")){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var edata;if(!0===(edata=obj.trigger({phase:"before",type:"remove",target:obj.el,originalEvent:event.originalEvent,item:item})).isCancelled)return;$().w2overlay(),selected.splice($(event.target).attr("index"),1),$(obj.el).trigger("change"),$(event.target).parent().fadeOut("fast"),setTimeout(function(){obj.refresh(),obj.trigger($.extend(edata,{phase:"after"}))},300)}else{var edata;if(!0===(edata=obj.trigger({phase:"before",type:"click",target:obj.el,originalEvent:event.originalEvent,item:item})).isCancelled)return;if("file"==obj.type){var preview="";/image/i.test(item.type)&&(preview='<div style="padding: 3px;">    <img src="'+(item.content?"data:"+item.type+";base64,"+item.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var td1='style="padding: 3px; text-align: right; color: #777;"',td2='style="padding: 3px"';preview+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+td1+">"+w2utils.lang("Name")+":</td><td "+td2+">"+item.name+"</td></tr>    <tr><td "+td1+">"+w2utils.lang("Size")+":</td><td "+td2+">"+w2utils.formatSize(item.size)+"</td></tr>    <tr><td "+td1+">"+w2utils.lang("Type")+":</td><td "+td2+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+item.type+"</span>    </td></tr>    <tr><td "+td1+">"+w2utils.lang("Modified")+":</td><td "+td2+">"+w2utils.date(item.modified)+"</td></tr>    </tbody></table></div>",$("#w2ui-overlay").remove(),$(target).w2overlay(preview)}obj.trigger($.extend(edata,{phase:"after"}))}}).on("mouseover",function(event){var target="LI"==event.target.tagName.toUpperCase()?event.target:$(event.target).parents("LI");if(!$(target).hasClass("nomouse")){if("out"==$(target).data("mouse")){var item=selected[$(event.target).attr("index")],edata=obj.trigger({phase:"before",type:"mouseOver",target:obj.el,originalEvent:event.originalEvent,item:item});if(!0===edata.isCancelled)return;obj.trigger($.extend(edata,{phase:"after"}))}$(target).data("mouse","over")}}).on("mouseout",function(event){var target="LI"==event.target.tagName.toUpperCase()?event.target:$(event.target).parents("LI");$(target).hasClass("nomouse")||($(target).data("mouse","leaving"),setTimeout(function(){if("leaving"==$(target).data("mouse")){$(target).data("mouse","out");var item=selected[$(event.target).attr("index")],edata=obj.trigger({phase:"before",type:"mouseOut",target:obj.el,originalEvent:event.originalEvent,item:item});if(!0===edata.isCancelled)return;obj.trigger($.extend(edata,{phase:"after"}))}},0))}),$(this.el).height("auto");var cntHeight=$(div).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(div,"+height");cntHeight<26&&(cntHeight=26),cntHeight>options.maxHeight&&(cntHeight=options.maxHeight),div.length>0&&(div[0].scrollTop=1e3);var inpHeight=w2utils.getSize($(this.el),"height")-2;if(inpHeight>cntHeight&&(cntHeight=inpHeight),$(div).css({height:cntHeight+"px",overflow:cntHeight==options.maxHeight?"auto":"hidden"}),cntHeight<options.maxHeight&&$(div).prop("scrollTop",0),$(this.el).css({height:cntHeight+2+"px"}),"enum"==obj.type){var tmp=obj.helpers.multi.find("input");tmp.width(8*(tmp.val().length+2)+"px")}}return(new Date).getTime()-time},reset:function(){var type=this.type;this.clear(),this.type=type,this.init()},resize:function(){var obj=this,new_width=$(obj.el).width(),new_height=$(obj.el).height();if(!(obj.tmp.current_width==new_width&&new_height>0)){var focus=this.helpers.focus,multi=this.helpers.multi,suffix=this.helpers.suffix,prefix=this.helpers.prefix;if(focus&&focus.width($(obj.el).width()),multi){var width=w2utils.getSize(obj.el,"width")-parseInt($(obj.el).css("margin-left"),10)-parseInt($(obj.el).css("margin-right"),10);$(multi).width(width)}suffix&&(obj.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt($(obj.el).height())-6)/2+'px;"></div>',obj.addSuffix()),prefix&&obj.addPrefix(),obj.tmp.current_width=new_width}},clean:function(val){if("number"==typeof val)return val;var options=this.options;return val=String(val).trim(),-1!=["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof val&&(options.autoFormat&&-1!=["money","currency"].indexOf(this.type)&&(val=String(val).replace(options.moneyRE,"")),options.autoFormat&&"percent"==this.type&&(val=String(val).replace(options.percentRE,"")),options.autoFormat&&-1!=["int","float"].indexOf(this.type)&&(val=String(val).replace(options.numberRE,"")),val=val.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(val)==val&&(null!=options.min&&val<options.min&&(val=options.min,$(this.el).val(options.min)),null!=options.max&&val>options.max&&(val=options.max,$(this.el).val(options.max))),val=""!==val&&w2utils.isFloat(val)?Number(val):""),val},format:function(val){var options=this.options;if(options.autoFormat&&""!==val)switch(this.type){case"money":case"currency":""!==(val=w2utils.formatNumber(val,options.currencyPrecision,options.groupSymbol))&&(val=options.currencyPrefix+val+options.currencySuffix);break;case"percent":""!==(val=w2utils.formatNumber(val,options.precision,options.groupSymbol))&&(val+="%");break;case"float":val=w2utils.formatNumber(val,options.precision,options.groupSymbol);break;case"int":val=w2utils.formatNumber(val,0,options.groupSymbol)}return val},change:function(event){var obj=this,options=obj.options;if(-1!=["int","float","money","currency","percent"].indexOf(this.type)){var val=$(this.el).val(),new_val=this.format(this.clean($(this.el).val()));if(""!==val&&val!=new_val)return $(this.el).val(new_val).change(),event.stopPropagation(),event.preventDefault(),!1}if("color"==this.type){var color="#"+$(this.el).val();6!=$(this.el).val().length&&3!=$(this.el).val().length&&(color=""),$(this.el).next().find("div").css("background-color",color),$(obj.el).is(":focus")&&this.updateOverlay()}if(-1!=["list","enum","file"].indexOf(this.type)&&(obj.refresh(),setTimeout(function(){obj.refresh()},5)),-1!=["date","time","datetime"].indexOf(this.type)){var tmp=parseInt(obj.el.value);w2utils.isInt(obj.el.value)&&tmp>3e3&&("time"==this.type&&$(obj.el).val(w2utils.formatTime(new Date(tmp),options.format)).change(),"date"==this.type&&$(obj.el).val(w2utils.formatDate(new Date(tmp),options.format)).change(),"datetime"==this.type&&$(obj.el).val(w2utils.formatDateTime(new Date(tmp),options.format)).change())}},click:function(event){event.stopPropagation(),-1!=["list","combo","enum"].indexOf(this.type)&&($(this.el).is(":focus")||this.focus(event)),-1!=["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()},focus:function(event){var obj=this,options=this.options;if(-1!==["color","date","time","datetime"].indexOf(obj.type)){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),setTimeout(function(){obj.updateOverlay()},150)}if(-1!=["list","combo","enum"].indexOf(obj.type)){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),obj.resize(),setTimeout(function(){"list"==obj.type&&$(obj.el).is(":focus")?$(obj.helpers.focus).find("input").focus():(obj.search(),setTimeout(function(){obj.updateOverlay()},1))},1)}"file"==obj.type&&$(obj.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(event){var obj=this,options=obj.options,val=$(obj.el).val().trim();-1!=["color","date","time","list","combo","enum","datetime"].indexOf(obj.type)&&$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),-1!=["int","float","money","currency","percent"].indexOf(obj.type)&&(""===val||obj.checkType(val)||($(obj.el).val("").change(),!1===options.silent&&($(obj.el).w2tag("Not a valid number"),setTimeout(function(){$(obj.el).w2tag("")},3e3)))),-1!=["date","time","datetime"].indexOf(obj.type)&&(""===val||obj.inRange(obj.el.value)?"date"!=obj.type||""===val||w2utils.isDate(obj.el.value,options.format)?"time"!=obj.type||""===val||w2utils.isTime(obj.el.value)?"datetime"!=obj.type||""===val||w2utils.isDateTime(obj.el.value,options.format)||($(obj.el).val("").removeData("selected").change(),!1===options.silent&&($(obj.el).w2tag("Not a valid date"),setTimeout(function(){$(obj.el).w2tag("")},3e3))):($(obj.el).val("").removeData("selected").change(),!1===options.silent&&($(obj.el).w2tag("Not a valid time"),setTimeout(function(){$(obj.el).w2tag("")},3e3))):($(obj.el).val("").removeData("selected").change(),!1===options.silent&&($(obj.el).w2tag("Not a valid date"),setTimeout(function(){$(obj.el).w2tag("")},3e3))):($(obj.el).val("").removeData("selected").change(),!1===options.silent&&($(obj.el).w2tag("Not in range"),setTimeout(function(){$(obj.el).w2tag("")},3e3)))),"enum"==obj.type&&$(obj.helpers.multi).find("input").val("").width(20),"file"==obj.type&&$(obj.helpers.multi).css({outline:"none"})},keyPress:function(event){var obj=this,options=obj.options;if(-1!=["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(obj.type)){if(event.metaKey||event.ctrlKey||event.altKey||event.charCode!=event.keyCode&&event.keyCode>0)return;var ch=String.fromCharCode(event.charCode);if(!obj.checkType(ch,!0)&&13!=event.keyCode)return event.preventDefault(),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0,!1}-1!=["date","time","datetime"].indexOf(obj.type)&&9!==event.keyCode&&setTimeout(function(){obj.updateOverlay()},1)},keyDown:function(event,extra){var obj=this,options=obj.options,key=event.keyCode||extra&&extra.keyCode;if(-1!=["int","float","money","currency","percent"].indexOf(obj.type)){if(!options.keyboard||$(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var cancel=!1,val=parseFloat($(obj.el).val().replace(options.moneyRE,""))||0,inc=options.step;switch((event.ctrlKey||event.metaKey)&&(inc=10),key){case 38:if(event.shiftKey)break;$(obj.el).val(val+inc<=options.max||null==options.max?Number((val+inc).toFixed(12)):options.max).change(),cancel=!0;break;case 40:if(event.shiftKey)break;$(obj.el).val(val-inc>=options.min||null==options.min?Number((val-inc).toFixed(12)):options.min).change(),cancel=!0}cancel&&(event.preventDefault(),setTimeout(function(){obj.el.setSelectionRange(obj.el.value.length,obj.el.value.length)},0))}if("date"==obj.type){if(!options.keyboard||$(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var cancel=!1,daymil=864e5,inc=1,dt;switch((event.ctrlKey||event.metaKey)&&(inc=10),(dt=w2utils.isDate($(obj.el).val(),options.format,!0))||(dt=new Date,daymil=0),key){case 38:if(event.shiftKey)break;var newDT=w2utils.formatDate(dt.getTime()+daymil,options.format);10==inc&&(newDT=w2utils.formatDate(new Date(dt.getFullYear(),dt.getMonth()+1,dt.getDate()),options.format)),$(obj.el).val(newDT).change(),cancel=!0;break;case 40:if(event.shiftKey)break;var newDT=w2utils.formatDate(dt.getTime()-daymil,options.format);10==inc&&(newDT=w2utils.formatDate(new Date(dt.getFullYear(),dt.getMonth()-1,dt.getDate()),options.format)),$(obj.el).val(newDT).change(),cancel=!0}cancel&&(event.preventDefault(),setTimeout(function(){obj.el.setSelectionRange(obj.el.value.length,obj.el.value.length),obj.updateOverlay()},0))}if("time"==obj.type){if(!options.keyboard||$(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var cancel=!1,inc=event.ctrlKey||event.metaKey?60:1,val=$(obj.el).val(),time=obj.toMin(val)||obj.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(key){case 38:if(event.shiftKey)break;time+=inc,cancel=!0;break;case 40:if(event.shiftKey)break;time-=inc,cancel=!0}cancel&&($(obj.el).val(obj.fromMin(time)).change(),event.preventDefault(),setTimeout(function(){obj.el.setSelectionRange(obj.el.value.length,obj.el.value.length)},0))}if("datetime"==obj.type){if(!options.keyboard||$(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var cancel=!1,daymil=864e5,inc=1;(event.ctrlKey||event.metaKey)&&(inc=10);var str=$(obj.el).val(),dt;switch((dt=w2utils.isDateTime(str,this.options.format,!0))||(dt=new Date,daymil=0),key){case 38:if(event.shiftKey)break;var newDT=w2utils.formatDateTime(dt.getTime()+daymil,options.format);10==inc&&(newDT=w2utils.formatDateTime(new Date(dt.getFullYear(),dt.getMonth()+1,dt.getDate()),options.format)),$(obj.el).val(newDT).change(),cancel=!0;break;case 40:if(event.shiftKey)break;var newDT=w2utils.formatDateTime(dt.getTime()-daymil,options.format);10==inc&&(newDT=w2utils.formatDateTime(new Date(dt.getFullYear(),dt.getMonth()-1,dt.getDate()),options.format)),$(obj.el).val(newDT).change(),cancel=!0}cancel&&(event.preventDefault(),setTimeout(function(){obj.el.setSelectionRange(obj.el.value.length,obj.el.value.length),obj.updateOverlay()},0))}if("color"==obj.type){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;if(86==event.keyCode&&(event.ctrlKey||event.metaKey)&&($(obj.el).prop("maxlength",7),setTimeout(function(){var val=$(obj).val();"#"==val.substr(0,1)&&(val=val.substr(1)),w2utils.isHex(val)||(val=""),$(obj).val(val).prop("maxlength",6).change()},20)),(event.ctrlKey||event.metaKey)&&!event.shiftKey){var dir=null,newColor=null;switch(key){case 38:dir="up";break;case 40:dir="down";break;case 39:dir="right";break;case 37:dir="left"}obj.el.nav&&null!=dir&&(newColor=obj.el.nav(dir),$(obj.el).val(newColor).change(),event.preventDefault())}}if(-1!=["list","combo","enum"].indexOf(obj.type)){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var selected=$(obj.el).data("selected"),focus=$(obj.el),indexOnly=!1;switch(-1!=["list","enum"].indexOf(obj.type)&&("list"==obj.type&&(focus=$(obj.helpers.focus).find("input")),"enum"==obj.type&&(focus=$(obj.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(key)&&setTimeout(function(){obj.refresh()},1),86==event.keyCode&&(event.ctrlKey||event.metaKey)&&setTimeout(function(){obj.refresh(),obj.search(),obj.request()},50)),key){case 27:"list"==obj.type&&(""!==focus.val()&&focus.val(""),event.stopPropagation());break;case 37:case 39:break;case 13:if(0===$("#w2ui-overlay").length)break;var item=options.items[options.index];if("enum"==obj.type)if(null!=item){var edata;if(!0===(edata=obj.trigger({phase:"before",type:"add",target:obj.el,originalEvent:event.originalEvent,item:item})).isCancelled)return;item=edata.item,selected.length>=options.max&&options.max>0&&selected.pop(),delete item.hidden,delete obj.tmp.force_open,selected.push(item),$(obj.el).change(),focus.val("").width(20),obj.refresh(),obj.trigger($.extend(edata,{phase:"after"}))}else{var edata;if(item={id:focus.val(),text:focus.val()},!0===(edata=obj.trigger({phase:"before",type:"new",target:obj.el,originalEvent:event.originalEvent,item:item})).isCancelled)return;item=edata.item,"function"==typeof obj.onNew&&(selected.length>=options.max&&options.max>0&&selected.pop(),delete obj.tmp.force_open,selected.push(item),$(obj.el).change(),focus.val("").width(20),obj.refresh()),obj.trigger($.extend(edata,{phase:"after"}))}else item&&$(obj.el).data("selected",item).val(item.text).change(),""===$(obj.el).val()&&$(obj.el).data("selected")&&$(obj.el).removeData("selected").val("").change(),"list"==obj.type&&(focus.val(""),obj.refresh()),obj.tmp.force_hide=!0;break;case 8:case 46:if("enum"==obj.type&&8==key&&""===focus.val()&&selected.length>0){var item=selected[selected.length-1],edata;if(!0===(edata=obj.trigger({phase:"before",type:"remove",target:obj.el,originalEvent:event.originalEvent,item:item})).isCancelled)return;selected.pop(),$(obj.el).trigger("change"),obj.refresh(),obj.trigger($.extend(edata,{phase:"after"}))}"list"==obj.type&&""===focus.val()&&($(obj.el).data("selected",{}).change(),obj.refresh());break;case 38:for(options.index=w2utils.isInt(options.index)?parseInt(options.index):0,options.index--;options.index>0&&options.items[options.index].hidden;)options.index--;if(0===options.index&&options.items[options.index].hidden)for(;options.items[options.index]&&options.items[options.index].hidden;)options.index++;indexOnly=!0;break;case 40:for(options.index=w2utils.isInt(options.index)?parseInt(options.index):-1,options.index++;options.index<options.items.length-1&&options.items[options.index].hidden;)options.index++;if(options.index==options.items.length-1&&options.items[options.index].hidden)for(;options.items[options.index]&&options.items[options.index].hidden;)options.index--;""===focus.val()&&0===$("#w2ui-overlay").length?obj.tmp.force_open=!0:indexOnly=!0}if(indexOnly)return options.index<0&&(options.index=0),options.index>=options.items.length&&(options.index=options.items.length-1),obj.updateOverlay(indexOnly),event.preventDefault(),void setTimeout(function(){var tmp;if("enum"==obj.type)(tmp=focus.get(0)).setSelectionRange(tmp.value.length,tmp.value.length);else if("list"==obj.type){var tmp;(tmp=focus.get(0)).setSelectionRange(tmp.value.length,tmp.value.length)}else obj.el.setSelectionRange(obj.el.value.length,obj.el.value.length)},0);"enum"==obj.type&&focus.width(8*(focus.val().length+2)+"px")}},keyUp:function(event){var obj=this;if("color"==this.type&&86==event.keyCode&&(event.ctrlKey||event.metaKey)&&$(this).prop("maxlength",6),-1!=["list","combo","enum"].indexOf(this.type)){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;if(-1==[16,17,18,20,37,39,91].indexOf(event.keyCode)){var input=$(this.helpers.focus).find("input");0===input.length&&(input=$(this.el));var edata=this.trigger({phase:"before",type:"search",originalEvent:event,target:input,search:input.val()});if(!0===edata.isCancelled)return;this.tmp.force_hide||this.request(),1==input.val().length&&this.refresh(),0!==$("#w2ui-overlay").length&&-1!=[38,40].indexOf(event.keyCode)||this.search(),this.trigger($.extend(edata,{phase:"after"}))}}},clearCache:function(){var options;this.options.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1},request:function(interval){var obj=this,options=this.options,search=$(obj.el).val()||"";if(options.url){if("enum"==obj.type){var tmp=$(obj.helpers.multi).find("input");search=0===tmp.length?"":tmp.val()}if("list"==obj.type){var tmp=$(obj.helpers.focus).find("input");search=0===tmp.length?"":tmp.val()}if(0!==options.minLength&&search.length<options.minLength)return options.items=[],void this.updateOverlay();null==interval&&(interval=options.interval),null==obj.tmp.xhr_search&&(obj.tmp.xhr_search=""),null==obj.tmp.xhr_total&&(obj.tmp.xhr_total=-1),options.url&&!0!==$(obj.el).prop("readonly")&&!0!==$(obj.el).prop("disabled")&&(0===options.items.length&&0!==obj.tmp.xhr_total||obj.tmp.xhr_total==options.cacheMax&&search.length>obj.tmp.xhr_search.length||search.length>=obj.tmp.xhr_search.length&&search.substr(0,obj.tmp.xhr_search.length)!=obj.tmp.xhr_search||search.length<obj.tmp.xhr_search.length)&&(obj.tmp.xhr&&obj.tmp.xhr.abort(),obj.tmp.xhr_loading=!0,obj.search(),clearTimeout(obj.tmp.timeout),obj.tmp.timeout=setTimeout(function(){var url=options.url,postData={search:search,max:options.cacheMax};$.extend(postData,options.postData);var edata=obj.trigger({phase:"before",type:"request",search:search,target:obj.el,url:url,postData:postData});if(!0!==edata.isCancelled){var ajaxOptions={type:"GET",url:url=edata.url,data:postData=edata.postData,dataType:"JSON"};options.method&&(ajaxOptions.type=options.method),"JSON"==w2utils.settings.dataType&&(ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)}),null!=options.method&&(ajaxOptions.type=options.method),obj.tmp.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){var edata2=obj.trigger({phase:"before",type:"load",target:obj.el,search:postData.search,data:data,xhr:xhr});!0!==edata2.isCancelled&&("string"==typeof(data=edata2.data)&&(data=JSON.parse(data)),null==data.records&&null!=data.items&&(data.records=data.items,delete data.items),"success"==data.status&&Array.isArray(data.records)?(data.records.length>options.cacheMax&&data.records.splice(options.cacheMax,1e5),null==options.recId&&null!=options.recid&&(options.recId=options.recid),(options.recId||options.recText)&&data.records.forEach(function(item){"string"==typeof options.recId&&(item.id=item[options.recId]),"function"==typeof options.recId&&(item.id=options.recId(item)),"string"==typeof options.recText&&(item.text=item[options.recText]),"function"==typeof options.recText&&(item.text=options.recText(item))}),obj.tmp.xhr_loading=!1,obj.tmp.xhr_search=search,obj.tmp.xhr_total=data.records.length,options.items=obj.normMenu(data.records),""===search&&0===data.records.length?obj.tmp.emptySet=!0:obj.tmp.emptySet=!1,obj.search(),obj.trigger($.extend(edata2,{phase:"after"}))):console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]}))}).fail(function(xhr,status,error){var errorObj={status:status,error:error,rawResponseText:xhr.responseText},edata2=obj.trigger({phase:"before",type:"error",target:obj.el,search:search,error:errorObj,xhr:xhr});if(!0!==edata2.isCancelled){if("abort"!=status){var data;try{data=$.parseJSON(xhr.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof data?data:xhr.responseText)}obj.clearCache(),obj.search(),obj.trigger($.extend(edata2,{phase:"after"}))}}),obj.trigger($.extend(edata,{phase:"after"}))}},interval))}},search:function(){var obj=this,options=this.options,search=$(obj.el).val(),target=obj.el,ids=[],selected=$(obj.el).data("selected");if("enum"==obj.type)for(var s in target=$(obj.helpers.multi).find("input"),search=target.val(),selected)selected[s]&&ids.push(selected[s].id);else if("list"==obj.type)for(var s in target=$(obj.helpers.focus).find("input"),search=target.val(),selected)selected[s]&&ids.push(selected[s].id);if(!0!==obj.tmp.xhr_loading){for(var shown=0,i=0;i<options.items.length;i++){var item=options.items[i];if(null!=options.compare)"function"==typeof options.compare&&(item.hidden=!1===options.compare.call(this,item,search));else{var prefix="",suffix="";-1!=["is","begins"].indexOf(options.match)&&(prefix="^"),-1!=["is","ends"].indexOf(options.match)&&(suffix="$");try{var re;new RegExp(prefix+search+suffix,"i").test(item.text)||"..."==item.text?item.hidden=!1:item.hidden=!0}catch(e){}}!1===options.filter&&(item.hidden=!1),"enum"==obj.type&&-1!=$.inArray(item.id,ids)&&(item.hidden=!0),!0!==item.hidden&&(shown++,delete item.hidden)}for(options.index=-1;options.items[options.index]&&options.items[options.index].hidden;)options.index++;shown<=0&&(options.index=-1),options.spinner=!1,obj.updateOverlay(),setTimeout(function(){var html=$("#w2ui-overlay").html()||"";options.markSearch&&-1!=html.indexOf("$.fn.w2menuHandler")&&$("#w2ui-overlay").w2marker(search)},1)}else options.items.splice(0,options.cacheMax),options.spinner=!0,obj.updateOverlay()},updateOverlay:function(indexOnly){var obj=this,options=this.options;if("color"==this.type){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;$(this.el).w2color({color:$(this.el).val(),transparent:options.transparent},function(color){null!=color&&$(obj.el).val(color).change()})}if("date"==this.type){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var month,year,dt;0===$("#w2ui-overlay").length&&$(obj.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}}),(dt=w2utils.isDate($(obj.el).val(),obj.options.format,!0))&&(month=dt.getMonth()+1,year=dt.getFullYear()),function refreshCalendar(month,year){$("#w2ui-overlay > div > div").html(obj.getMonthHTML(month,year,$(obj.el).val())),$("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){var selYear,selMonth;$(this).next().hasClass("w2ui-calendar-jump")?$(this).next().remove():($(this).after('<div class="w2ui-calendar-jump" style=""></div>'),$(this).next().hide().html(obj.getYearHTML()).fadeIn(200),setTimeout(function(){$("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){$(this).hasClass("w2ui-jump-month")&&($(this).parent().find(".w2ui-jump-month").removeClass("selected"),$(this).addClass("selected"),selMonth=$(this).attr("name")),$(this).hasClass("w2ui-jump-year")&&($(this).parent().find(".w2ui-jump-year").removeClass("selected"),$(this).addClass("selected"),selYear=$(this).attr("name")),null!=selYear&&null!=selMonth&&($("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){refreshCalendar(parseInt(selMonth)+1,selYear)},100))}),$("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1))}),$("#w2ui-overlay .w2ui-date").on("mousedown",function(){var day=$(this).attr("date");$(obj.el).val(day).change(),$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),$("#w2ui-overlay .previous").on("mousedown",function(){var tmp=obj.options.current.split("/");tmp[0]=parseInt(tmp[0])-1,refreshCalendar(tmp[0],tmp[1])}),$("#w2ui-overlay .next").on("mousedown",function(){var tmp=obj.options.current.split("/");tmp[0]=parseInt(tmp[0])+1,refreshCalendar(tmp[0],tmp[1])})}(month,year)}if("time"==this.type){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;0===$("#w2ui-overlay").length&&$(obj.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var h24="h24"==this.options.format;$("#w2ui-overlay > div").html(obj.getHourHTML()),$("#w2ui-overlay .w2ui-time").on("mousedown",function(event){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var hour=$(this).attr("hour");$(obj.el).val((hour>12&&!h24?hour-12:hour)+":00"+(h24?"":hour<12?" am":" pm")).change()}),null==this.options.noMinutes||!1===this.options.noMinutes?$("#w2ui-overlay .w2ui-time").on("mouseup",function(){var hour=$(this).attr("hour");$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),$(obj.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),$("#w2ui-overlay > div").html(obj.getMinHTML(hour)),$("#w2ui-overlay .w2ui-time").on("mousedown",function(){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var min=$(this).attr("min");$(obj.el).val((hour>12&&!h24?hour-12:hour)+":"+(min<10?0:"")+min+(h24?"":hour<12?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):$("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"==this.type){if($(obj.el).prop("readonly")||$(obj.el).prop("disabled"))return;var month,year,dt;$("#w2ui-overlay .w2ui-time").length>0&&$("#w2ui-overlay")[0].hide(),0===$("#w2ui-overlay").length&&$(obj.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}}),(dt=w2utils.isDateTime($(obj.el).val(),obj.options.format,!0))&&(month=dt.getMonth()+1,year=dt.getFullYear());var selDate=null;!function refreshCalendar(month,year){$("#w2ui-overlay > div > div").html(obj.getMonthHTML(month,year,$(obj.el).val())+(options.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),$("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){var selYear,selMonth;$(this).next().hasClass("w2ui-calendar-jump")?$(this).next().remove():($(this).after('<div class="w2ui-calendar-jump" style=""></div>'),$(this).next().hide().html(obj.getYearHTML()).fadeIn(200),setTimeout(function(){$("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){$(this).hasClass("w2ui-jump-month")&&($(this).parent().find(".w2ui-jump-month").removeClass("selected"),$(this).addClass("selected"),selMonth=$(this).attr("name")),$(this).hasClass("w2ui-jump-year")&&($(this).parent().find(".w2ui-jump-year").removeClass("selected"),$(this).addClass("selected"),selYear=$(this).attr("name")),null!=selYear&&null!=selMonth&&($("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){refreshCalendar(parseInt(selMonth)+1,selYear)},100))}),$("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1))}),$("#w2ui-overlay .w2ui-date").on("mousedown",function(){var day=$(this).attr("date");$(obj.el).val(day).change(),$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),selDate=new Date($(this).attr("data-date"))}).on("mouseup",function(){var selHour,selMin;$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),$(obj.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});var h24="h24"==obj.options.format;$("#w2ui-overlay > div").html(obj.getHourHTML()),$("#w2ui-overlay .w2ui-time").on("mousedown",function(event){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),selHour=$(this).attr("hour"),selDate.setHours(selHour);var txt=w2utils.formatDateTime(selDate,obj.options.format);$(obj.el).val(txt).change()}),null==obj.options.noMinutes||!1===obj.options.noMinutes?$("#w2ui-overlay .w2ui-time").on("mouseup",function(){var hour=$(this).attr("hour");$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),$(obj.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),$("#w2ui-overlay > div").html(obj.getMinHTML(hour)),$("#w2ui-overlay .w2ui-time").on("mousedown",function(){$(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),selMin=$(this).attr("min"),selDate.setHours(selHour,selMin);var txt=w2utils.formatDateTime(selDate,obj.options.format);$(obj.el).val(txt).change()}).on("mouseup",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):$("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}),$("#w2ui-overlay .previous").on("mousedown",function(){var tmp=obj.options.current.split("/");tmp[0]=parseInt(tmp[0])-1,refreshCalendar(tmp[0],tmp[1])}),$("#w2ui-overlay .next").on("mousedown",function(){var tmp=obj.options.current.split("/");tmp[0]=parseInt(tmp[0])+1,refreshCalendar(tmp[0],tmp[1])}),$("#w2ui-overlay .now").on("mousedown",function(){var tmp=w2utils.formatDateTime(new Date,obj.options.format);return $(obj.el).val(tmp).change(),!1}).on("mouseup",function(){setTimeout(function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}(month,year)}if(-1!=["list","combo","enum"].indexOf(this.type)){var el=this.el,input=this.el;if("enum"==this.type&&(el=$(this.helpers.multi),input=$(el).find("input")),"list"==this.type){var sel=$(input).data("selected");$.isPlainObject(sel)&&!$.isEmptyObject(sel)&&-1==options.index&&options.items.forEach(function(item,ind){item.id==sel.id&&(options.index=ind)}),input=$(this.helpers.focus).find("input")}if($(input).is(":focus")){if(!1===options.openOnFocus&&""===$(input).val()&&!0!==obj.tmp.force_open)return void $().w2overlay();if(obj.tmp.force_hide)return $().w2overlay(),void setTimeout(function(){delete obj.tmp.force_hide},1);""!==$(input).val()&&delete obj.tmp.force_open;var msgNoItems=w2utils.lang("No matches");null!=options.url&&$(input).val().length<options.minLength&&!0!==obj.tmp.emptySet&&(msgNoItems=options.minLength+" "+w2utils.lang("letters or more...")),null!=options.url&&""===$(input).val()&&!0!==obj.tmp.emptySet&&(msgNoItems=w2utils.lang("Type to search...")),null==options.url&&0===options.items.length&&(msgNoItems=w2utils.lang("Empty list")),null!=options.msgNoItems&&(msgNoItems=options.msgNoItems),"function"==msgNoItems&&(msgNoItems=msgNoItems(options)),$(el).w2menu(indexOnly?"refresh-index":"refresh",$.extend(!0,{},options,{search:!1,render:options.renderDrop,maxHeight:options.maxDropHeight,maxWidth:options.maxDropWidth,msgNoItems:msgNoItems,onSelect:function(event){if("enum"==obj.type){var selected=$(obj.el).data("selected");if(event.item){var edata=obj.trigger({phase:"before",type:"add",target:obj.el,originalEvent:event.originalEvent,item:event.item});if(!0===edata.isCancelled)return;selected.length>=options.max&&options.max>0&&selected.pop(),delete event.item.hidden,selected.push(event.item),$(obj.el).data("selected",selected).change(),$(obj.helpers.multi).find("input").val("").width(20),obj.refresh(),$("#w2ui-overlay").length>0&&$("#w2ui-overlay")[0].hide(),obj.trigger($.extend(edata,{phase:"after"}))}}else $(obj.el).data("selected",event.item).val(event.item.text).change(),obj.helpers.focus&&obj.helpers.focus.find("input").val("")}}))}}},inRange:function(str,onlyDate){var inRange=!1,dt;if("date"==this.type){if(dt=w2utils.isDate(str,this.options.format,!0)){if(this.options.start||this.options.end){var st="string"==typeof this.options.start?this.options.start:$(this.options.start).val(),en="string"==typeof this.options.end?this.options.end:$(this.options.end).val(),start=w2utils.isDate(st,this.options.format,!0),end=w2utils.isDate(en,this.options.format,!0),current=new Date(dt);start||(start=current),end||(end=current),current>=start&&current<=end&&(inRange=!0)}else inRange=!0;if(this.options.blocked&&-1!=$.inArray(str,this.options.blocked)&&(inRange=!1),null!=this.options.blockWeekDays&&null!=this.options.blockWeekDays&&null!=this.options.blockWeekDays.length)for(var l=this.options.blockWeekDays.length,i=0;i<l;i++)dt.getDay()==this.options.blockWeekDays[i]&&(inRange=!1)}}else if("time"==this.type)if(this.options.start||this.options.end){var tm=this.toMin(str),tm1=this.toMin(this.options.start),tm2=this.toMin(this.options.end);tm1||(tm1=tm),tm2||(tm2=tm),tm>=tm1&&tm<=tm2&&(inRange=!0)}else inRange=!0;else if("datetime"==this.type){var dt;if(dt=w2utils.isDateTime(str,this.options.format,!0)){if(this.options.start||this.options.end){var start,end,st,en;if("object"==typeof this.options.start&&this.options.start instanceof Date)start=this.options.start;else start=""!==(st="string"==typeof this.options.start?this.options.start:$(this.options.start).val()).trim()?w2utils.isDateTime(st,this.options.format,!0):"";if("object"==typeof this.options.end&&this.options.end instanceof Date)end=this.options.end;else end=""!==(en="string"==typeof this.options.end?this.options.end:$(this.options.end).val()).trim()?w2utils.isDateTime(en,this.options.format,!0):"";var current=dt;start||(start=current),end||(end=current),onlyDate&&start instanceof Date&&(start.setHours(0),start.setMinutes(0),start.setSeconds(0)),current>=start&&current<=end&&(inRange=!0)}else inRange=!0;if(inRange&&this.options.blocked)for(var i=0;i<this.options.blocked.length;i++){var blocked=this.options.blocked[i];if("string"==typeof blocked&&(blocked=w2utils.isDateTime(blocked,this.options.format,!0)),"object"==typeof blocked&&blocked instanceof Date&&blocked.getFullYear()==dt.getFullYear()&&blocked.getMonth()==dt.getMonth()&&blocked.getDate()==dt.getDate()){inRange=!1;break}}}}return inRange},checkType:function(ch,loose){var obj=this;switch(obj.type){case"int":return!(!loose||-1==["-",obj.options.groupSymbol].indexOf(ch))||w2utils.isInt(ch.replace(obj.options.numberRE,""));case"percent":ch=ch.replace(/%/g,"");case"float":return!(!loose||-1==["-",w2utils.settings.decimalSymbol,obj.options.groupSymbol].indexOf(ch))||w2utils.isFloat(ch.replace(obj.options.numberRE,""));case"money":case"currency":return!(!loose||-1==["-",obj.options.decimalSymbol,obj.options.groupSymbol,obj.options.currencyPrefix,obj.options.currencySuffix].indexOf(ch))||w2utils.isFloat(ch.replace(obj.options.moneyRE,""));case"bin":return w2utils.isBin(ch);case"hex":case"color":return w2utils.isHex(ch);case"alphanumeric":return w2utils.isAlphaNumeric(ch)}return!0},addPrefix:function(){var obj=this;setTimeout(function(){if("clear"!==obj.type){var helper,tmp=$(obj.el).data("tmp")||{};tmp["old-padding-left"]&&$(obj.el).css("padding-left",tmp["old-padding-left"]),tmp["old-padding-left"]=$(obj.el).css("padding-left"),$(obj.el).data("tmp",tmp),obj.helpers.prefix&&$(obj.helpers.prefix).remove(),""!==obj.options.prefix&&($(obj.el).before('<div class="w2ui-field-helper">'+obj.options.prefix+"</div>"),(helper=$(obj.el).prev()).css({color:$(obj.el).css("color"),"font-family":$(obj.el).css("font-family"),"font-size":$(obj.el).css("font-size"),"padding-top":$(obj.el).css("padding-top"),"padding-bottom":$(obj.el).css("padding-bottom"),"padding-left":$(obj.el).css("padding-left"),"padding-right":0,"margin-top":parseInt($(obj.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt($(obj.el).css("margin-bottom"),10)+1+"px","margin-left":$(obj.el).css("margin-left"),"margin-right":0}).on("click",function(event){if(obj.options.icon&&"function"==typeof obj.onIconClick){var edata=obj.trigger({phase:"before",type:"iconClick",target:obj.el,el:$(this).find("span.w2ui-icon")[0]});if(!0===edata.isCancelled)return;obj.trigger($.extend(edata,{phase:"after"}))}else"list"==obj.type?$(obj.helpers.focus).find("input").focus():$(obj.el).focus()}),$(obj.el).css("padding-left",helper.width()+parseInt($(obj.el).css("padding-left"),10)+"px"),obj.helpers.prefix=helper)}},1)},addSuffix:function(){var obj=this,helper,pr;setTimeout(function(){if("clear"!==obj.type){var tmp=$(obj.el).data("tmp")||{};if(tmp["old-padding-right"]&&$(obj.el).css("padding-right",tmp["old-padding-right"]),tmp["old-padding-right"]=$(obj.el).css("padding-right"),$(obj.el).data("tmp",tmp),pr=parseInt($(obj.el).css("padding-right"),10),obj.options.arrows){obj.helpers.arrows&&$(obj.helpers.arrows).remove(),$(obj.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>');var height=w2utils.getSize(obj.el,"height");(helper=$(obj.el).next()).css({color:$(obj.el).css("color"),"font-family":$(obj.el).css("font-family"),"font-size":$(obj.el).css("font-size"),height:$(obj.el).height()+parseInt($(obj.el).css("padding-top"),10)+parseInt($(obj.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt($(obj.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(helper.width()+parseInt($(obj.el).css("margin-right"),10)+12)+"px").on("mousedown",function(event){var body=$("body");function tmp(){clearTimeout(body.data("_field_update_timer")),body.off("mouseup",tmp)}function update(notimer){$(obj.el).focus(),obj.keyDown($.Event("keydown"),{keyCode:"up"==$(event.target).attr("type")?38:40}),!1!==notimer&&$("body").data("_field_update_timer",setTimeout(update,60))}body.on("mouseup",tmp),body.data("_field_update_timer",setTimeout(update,700)),update(!1)}),pr+=helper.width()+12,$(obj.el).css("padding-right",pr+"px"),obj.helpers.arrows=helper}""!==obj.options.suffix&&(obj.helpers.suffix&&$(obj.helpers.suffix).remove(),$(obj.el).after('<div class="w2ui-field-helper">'+obj.options.suffix+"</div>"),(helper=$(obj.el).next()).css({color:$(obj.el).css("color"),"font-family":$(obj.el).css("font-family"),"font-size":$(obj.el).css("font-size"),"padding-top":$(obj.el).css("padding-top"),"padding-bottom":$(obj.el).css("padding-bottom"),"padding-left":"3px","padding-right":$(obj.el).css("padding-right"),"margin-top":parseInt($(obj.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt($(obj.el).css("margin-bottom"),10)+1+"px"}).on("click",function(event){"list"==obj.type?$(obj.helpers.focus).find("input").focus():$(obj.el).focus()}),helper.css("margin-left","-"+(w2utils.getSize(helper,"width")+parseInt($(obj.el).css("margin-right"),10)+2)+"px"),pr+=helper.width()+3,$(obj.el).css("padding-right",pr+"px"),obj.helpers.suffix=helper)}},1)},addFocus:function(){var obj=this,options=this.options,width=0,pholder;$(obj.helpers.focus).remove();var tabIndex=$(obj.el).attr("tabIndex");tabIndex&&-1!=tabIndex&&(obj.el._tabIndex=tabIndex),obj.el._tabIndex&&(tabIndex=obj.el._tabIndex),null==tabIndex&&(tabIndex=-1);var html='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input type="text" autocomplete="off" tabIndex="'+tabIndex+'"/></div>';$(obj.el).attr("tabindex",-1).before(html);var helper=$(obj.el).prev();obj.helpers.focus=helper,helper.css({width:$(obj.el).width(),"margin-top":$(obj.el).css("margin-top"),"margin-left":parseInt($(obj.el).css("margin-left"))+parseInt($(obj.el).css("padding-left"))+"px","margin-bottom":$(obj.el).css("margin-bottom"),"margin-right":$(obj.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:$(obj.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"}),helper.find("input").on("click",function(event){0===$("#w2ui-overlay").length&&obj.focus(event),event.stopPropagation()}).on("focus",function(event){pholder=$(obj.el).attr("placeholder"),$(obj.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),$(this).val(""),$(obj.el).triggerHandler("focus"),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0}).on("blur",function(event){$(obj.el).css("outline","none"),$(this).val(""),obj.refresh(),$(obj.el).triggerHandler("blur"),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0,null!=pholder&&$(obj.el).attr("placeholder",pholder)}).on("keydown",function(event){var el=this;obj.keyDown(event),setTimeout(function(){""===el.value?$(obj.el).attr("placeholder",pholder):$(obj.el).attr("placeholder","")},10)}).on("keyup",function(event){obj.keyUp(event)}).on("keypress",function(event){obj.keyPress(event)}),helper.on("click",function(event){$(this).find("input").focus()}),obj.refresh()},addMulti:function(){var obj=this,options=this.options;$(obj.helpers.multi).remove();var html="",margin="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+$(obj.el).css("margin-left")+"; margin-right   : "+$(obj.el).css("margin-right")+"; width          : "+(w2utils.getSize(obj.el,"width")-parseInt($(obj.el).css("margin-left"),10)-parseInt($(obj.el).css("margin-right"),10))+"px;";if("enum"==obj.type){var tabIndex=$(obj.el).attr("tabIndex");tabIndex&&-1!=tabIndex&&(obj.el._tabIndex=tabIndex),obj.el._tabIndex&&(tabIndex=obj.el._tabIndex),null==tabIndex&&(tabIndex=-1),html='<div class="w2ui-field-helper w2ui-list" style="'+margin+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocomplete="off"'+($(obj.el).prop("readonly")?' readonly="readonly"':"")+($(obj.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+tabIndex+'"/>        </li>    </ul>    </div></div>'}"file"==obj.type&&(html='<div class="w2ui-field-helper w2ui-list" style="'+margin+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" name="attachment" multiple tabindex="-1"'+($(obj.el).prop("readonly")?' readonly="readonly"':"")+($(obj.el).prop("disabled")?' disabled="disabled"':"")+($(obj.el).attr("accept")?' accept="'+$(obj.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');var tmp=$(obj.el).data("tmp")||{};tmp["old-background-color"]=$(obj.el).css("background-color"),tmp["old-border-color"]=$(obj.el).css("border-color"),$(obj.el).data("tmp",tmp),$(obj.el).before(html).css({"background-color":"transparent","border-color":"transparent"});var div=$(obj.el).prev();obj.helpers.multi=div,"enum"==obj.type&&($(obj.el).attr("tabindex",-1),div.find("input").on("click",function(event){0===$("#w2ui-overlay").length&&obj.focus(event),$(obj.el).triggerHandler("click")}).on("focus",function(event){$(div).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),$(obj.el).triggerHandler("focus"),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0}).on("blur",function(event){$(div).css("outline","none"),$(obj.el).triggerHandler("blur"),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0}).on("keyup",function(event){obj.keyUp(event)}).on("keydown",function(event){obj.keyDown(event)}).on("keypress",function(event){obj.keyPress(event)}),div.on("click",function(event){$(this).find("input").focus()})),"file"==obj.type&&($(obj.el).css("outline","none"),div.on("click",function(event){$(obj.el).focus(),$(obj.el).prop("readonly")||$(obj.el).prop("disabled")||(obj.blur(event),obj.resize(),setTimeout(function(){div.find("input").click()},10))}).on("dragenter",function(event){$(obj.el).prop("readonly")||$(obj.el).prop("disabled")||$(div).addClass("w2ui-file-dragover")}).on("dragleave",function(event){var tmp;$(obj.el).prop("readonly")||$(obj.el).prop("disabled")||0===$(event.target).parents(".w2ui-field-helper").length&&$(div).removeClass("w2ui-file-dragover")}).on("drop",function(event){if(!$(obj.el).prop("readonly")&&!$(obj.el).prop("disabled")){$(div).removeClass("w2ui-file-dragover");for(var files=event.originalEvent.dataTransfer.files,i=0,l=files.length;i<l;i++)obj.addFile.call(obj,files[i]);event.preventDefault(),event.stopPropagation()}}).on("dragover",function(event){event.preventDefault(),event.stopPropagation()}),div.find("input").on("click",function(event){event.stopPropagation()}).on("change",function(){if(void 0!==this.files)for(var i=0,l=this.files.length;i<l;i++)obj.addFile.call(obj,this.files[i])})),obj.refresh()},addFile:function(file){var obj=this,options=this.options,selected=$(obj.el).data("selected"),newItem={name:file.name,type:file.type,modified:file.lastModifiedDate,size:file.size,content:null,file:file},size=0,cnt=0,err;if(selected)for(var s=0;s<selected.length;s++){if(selected[s].name==file.name&&selected[s].size==file.size)return;size+=selected[s].size,cnt++}var edata=obj.trigger({phase:"before",type:"add",target:obj.el,file:newItem,total:cnt,totalSize:size});if(!0!==edata.isCancelled){if(0!==options.maxFileSize&&newItem.size>options.maxFileSize)return err="Maximum file size is "+w2utils.formatSize(options.maxFileSize),!1===options.silent&&$(obj.el).w2tag(err),void console.log("ERROR: "+err);if(0!==options.maxSize&&size+newItem.size>options.maxSize)return err="Maximum total size is "+w2utils.formatSize(options.maxSize),!1===options.silent&&$(obj.el).w2tag(err),void console.log("ERROR: "+err);if(0!==options.max&&cnt>=options.max)return err="Maximum number of files is "+options.max,!1===options.silent&&$(obj.el).w2tag(err),void console.log("ERROR: "+err);if(selected.push(newItem),"undefined"!=typeof FileReader&&!0===options.readContent){var reader=new FileReader;reader.onload=function(event){var fl=event.target.result,ind=fl.indexOf(",");newItem.content=fl.substr(ind+1),obj.refresh(),$(obj.el).trigger("change"),obj.trigger($.extend(edata,{phase:"after"}))},reader.readAsDataURL(file)}else obj.refresh(),$(obj.el).trigger("change")}},normMenu:function(menu){if($.isArray(menu)){for(var m=0;m<menu.length;m++)"string"==typeof menu[m]?menu[m]={id:menu[m],text:menu[m]}:(null!=menu[m].text&&null==menu[m].id&&(menu[m].id=menu[m].text),null==menu[m].text&&null!=menu[m].id&&(menu[m].text=menu[m].id),null!=menu[m].caption&&(menu[m].caption=menu[m].caption),null!=menu[m].checked&&(menu[m].checked=menu[m].checked));return menu}if("function"==typeof menu)return this.normMenu(menu());if("object"==typeof menu){var tmp=[];for(var m in menu)tmp.push({id:m,text:menu[m]});return tmp}},getMonthHTML:function(month,year,selected){var td=new Date,months=w2utils.settings.fullmonths,daysCount=["31","28","31","30","31","30","31","31","30","31","30","31"],today=td.getFullYear()+"/"+(Number(td.getMonth())+1)+"/"+td.getDate(),days=w2utils.settings.fulldays.slice(),sdays=w2utils.settings.shortdays.slice();"M"!=w2utils.settings.weekStarts&&(days.unshift(days.pop()),sdays.unshift(sdays.pop()));var options=this.options;null==options&&(options={}),year=w2utils.isInt(year)?parseInt(year):td.getFullYear(),(month=w2utils.isInt(month)?parseInt(month):td.getMonth()+1)>12&&(month-=12,year++),(month<1||0===month)&&(month+=12,year--),year/4==Math.floor(year/4)?daysCount[1]="29":daysCount[1]="28",options.current=month+"/"+year;for(var weekDay=(td=new Date(year,month-1,1)).getDay(),dayTitle="",i=0;i<sdays.length;i++)dayTitle+='<td title="'+days[i]+'">'+sdays[i]+"</td>";var html='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+months[month-1]+", "+year+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+dayTitle+"</tr>    <tr>",day=1;if("M"!=w2utils.settings.weekStarts&&weekDay++,"datetime"===this.type){var dt_sel=w2utils.isDateTime(selected,options.format,!0);selected=w2utils.formatDate(dt_sel,w2utils.settings.dateFormat)}for(var ci=1;ci<43;ci++){if(0===weekDay&&1==ci){for(var ti=0;ti<6;ti++)html+='<td class="w2ui-day-empty">&#160;</td>';ci+=6}else if(ci<weekDay||day>daysCount[month-1]){html+='<td class="w2ui-day-empty">&#160;</td>',ci%7==0&&(html+="</tr><tr>");continue}var dt=year+"/"+month+"/"+day,DT=new Date(dt),className="";6===DT.getDay()&&(className=" w2ui-saturday"),0===DT.getDay()&&(className=" w2ui-sunday"),dt==today&&(className+=" w2ui-today");var dspDay=day,col="",bgcol="",tmp_dt,tmp_dt_fmt;if("datetime"===this.type?(tmp_dt=w2utils.formatDateTime(dt,options.format),tmp_dt_fmt=w2utils.formatDate(dt,w2utils.settings.dateFormat)):tmp_dt_fmt=tmp_dt=w2utils.formatDate(dt,options.format),options.colored&&void 0!==options.colored[tmp_dt_fmt]){var tmp=options.colored[tmp_dt_fmt].split(":");bgcol="background-color: "+tmp[0]+";",col="color: "+tmp[1]+";"}html+='<td class="'+(this.inRange(tmp_dt,!0)?"w2ui-date "+(tmp_dt_fmt==selected?"w2ui-date-selected":""):"w2ui-blocked")+className+'"    style="'+col+bgcol+'" date="'+tmp_dt+'" data-date="'+DT+'">'+dspDay+"</td>",(ci%7==0||0===weekDay&&1==ci)&&(html+="</tr><tr>"),day++}return html+="</tr></tbody></table>"},getYearHTML:function(){for(var months=w2utils.settings.shortmonths,start_year=w2utils.settings.dateStartYear,end_year=w2utils.settings.dateEndYear,mhtml="",yhtml="",m=0;m<months.length;m++)mhtml+='<div class="w2ui-jump-month" name="'+m+'">'+months[m]+"</div>";for(var y=start_year;y<=end_year;y++)yhtml+='<div class="w2ui-jump-year" name="'+y+'">'+y+"</div>";return"<div>"+mhtml+"</div><div>"+yhtml+"</div>"},getHourHTML:function(){var tmp=[],options=this.options,html;null==options&&(options={format:w2utils.settings.timeFormat});for(var h24=options.format.indexOf("h24")>-1,a=0;a<24;a++){var time=(a>=12&&!h24?a-12:a)+":00"+(h24?"":a<12?" am":" pm");12!=a||h24||(time="12:00 pm"),tmp[Math.floor(a/8)]||(tmp[Math.floor(a/8)]="");var tm1=this.fromMin(this.toMin(time)),tm2=this.fromMin(this.toMin(time)+59);if("datetime"===this.type){var dt=w2utils.isDateTime(this.el.value,options.format,!0),fm=options.format.split("|")[0].trim();tm1=w2utils.formatDate(dt,fm)+" "+tm1,tm2=w2utils.formatDate(dt,fm)+" "+tm2}tmp[Math.floor(a/8)]+='<div class="'+(this.inRange(tm1)||this.inRange(tm2)?"w2ui-time ":"w2ui-blocked")+'" hour="'+a+'">'+time+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+tmp[0]+"</td>       <td>"+tmp[1]+"</td>       <td>"+tmp[2]+"</td>   </tr></tbody></table></div></div>"},getMinHTML:function(hour){null==hour&&(hour=0);var options=this.options,html;null==options&&(options={format:w2utils.settings.timeFormat});for(var h24=options.format.indexOf("h24")>-1,tmp=[],a=0;a<60;a+=1){var time=(hour>12&&!h24?hour-12:hour)+":"+(a<10?0:"")+a+" "+(h24?"":hour<12?"am":"pm"),tm=time,ind=0;if(a<10?ind=0:a<20?ind=1:a<30?ind=2:a<40?ind=3:a<50?ind=4:a<60&&(ind=5),tmp[ind]||(tmp[ind]=""),"datetime"===this.type){var dt=w2utils.isDateTime(this.el.value,options.format,!0),fm=options.format.split("|")[0].trim();tm=w2utils.formatDate(dt,fm)+" "+tm}tmp[ind]+='<div class="'+(this.inRange(tm)?"w2ui-time ":"w2ui-blocked")+'" min="'+a+'">'+time+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+tmp[0]+"</td>       <td>"+tmp[1]+"</td>       <td>"+tmp[2]+"</td>       <td>"+tmp[3]+"</td>       <td>"+tmp[4]+"</td>       <td>"+tmp[5]+"</td>   </tr></tbody></table></div></div>"},toMin:function(str){if("string"!=typeof str)return null;var tmp=str.split(":");return 2!==tmp.length?null:(tmp[0]=parseInt(tmp[0]),tmp[1]=parseInt(tmp[1]),-1!=str.indexOf("pm")&&12!=tmp[0]&&(tmp[0]+=12),60*tmp[0]+tmp[1])},fromMin:function(time){var ret="";time>=1440&&(time%=1440),time<0&&(time=1440+time);var hour=Math.floor(time/60),min=(time%60<10?"0":"")+time%60,options=this.options;return null==options&&(options={format:w2utils.settings.timeFormat}),ret=-1!=options.format.indexOf("h24")?hour+":"+min:(hour<=12?hour:hour-12)+":"+min+" "+(hour>=12?"pm":"am")}},$.extend(w2field.prototype,w2utils.event),w2obj.field=w2field}(jQuery),function($){var w2form=function(options){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,options)};$.fn.w2form=function(method){if($.isPlainObject(method)){var obj=this;if(!w2utils.checkName(method,"w2form"))return;var record=method.record,original=method.original,fields=method.fields,toolbar=method.toolbar,tabs=method.tabs,object=new w2form(method);if($.extend(object,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(tabs)){$.extend(!0,object.tabs,{tabs:[]});for(var t=0;t<tabs.length;t++){var tmp=tabs[t];"object"==typeof tmp?(object.tabs.tabs.push(tmp),!0===tmp.active&&(object.tabs.active=tmp.id)):object.tabs.tabs.push({id:tmp,caption:tmp})}}else $.extend(!0,object.tabs,tabs);if($.extend(!0,object.toolbar,toolbar),fields)for(var p=0;p<fields.length;p++){var field=$.extend(!0,{},fields[p]);null==field.name&&null!=field.field&&(field.name=field.field),null==field.field&&null!=field.name&&(field.field=field.name),object.fields[p]=field}for(var p in record)$.isPlainObject(record[p])?object.record[p]=$.extend(!0,{},record[p]):object.record[p]=record[p];for(var p in original)$.isPlainObject(original[p])?object.original[p]=$.extend(!0,{},original[p]):object.original[p]=original[p];return obj.length>0&&(object.box=obj[0]),""!==object.formURL?$.get(object.formURL,function(data){object.formHTML=data,object.isGenerated=!0,0===$(object.box).length&&0===data.length||($(object.box).html(data),object.render(object.box))}):""!==object.formHTML||(0!==$(this).length&&""!==$.trim($(this).html())?object.formHTML=$(this).html():object.formHTML=object.generateHTML()),w2ui[object.name]=object,""===object.formURL&&(-1==String(object.formHTML).indexOf("w2ui-page")&&(object.formHTML='<div class="w2ui-page page-0">'+object.formHTML+"</div>"),$(object.box).html(object.formHTML),object.isGenerated=!0,object.render(object.box)),object}var obj;return(obj=w2ui[$(this).attr("name")])?arguments.length>0?(obj[method]&&obj[method].apply(obj,Array.prototype.slice.call(arguments,1)),this):obj:null},w2form.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgSaving:"Saving...",get:function(field,returnIndex){if(0===arguments.length){for(var all=[],f1=0;f1<this.fields.length;f1++)null!=this.fields[f1].name&&all.push(this.fields[f1].name);return all}for(var f2=0;f2<this.fields.length;f2++)if(this.fields[f2].name==field)return!0===returnIndex?f2:this.fields[f2];return null},set:function(field,obj){for(var f=0;f<this.fields.length;f++)if(this.fields[f].name==field)return $.extend(this.fields[f],obj),this.refresh(),!0;return!1},show:function(){for(var affected=0,a=0;a<arguments.length;a++){var fld=this.get(arguments[a]);fld&&fld.hidden&&(fld.hidden=!1,affected++)}return affected>0&&this.refresh(),affected},hide:function(){for(var affected=0,a=0;a<arguments.length;a++){var fld=this.get(arguments[a]);fld&&!fld.hidden&&(fld.hidden=!0,affected++)}return affected>0&&this.refresh(),affected},enable:function(){for(var affected=0,a=0;a<arguments.length;a++){var fld=this.get(arguments[a]);fld&&fld.disabled&&(fld.disabled=!1,affected++)}return affected>0&&this.refresh(),affected},disable:function(){for(var affected=0,a=0;a<arguments.length;a++){var fld=this.get(arguments[a]);fld&&!fld.disabled&&(fld.disabled=!0,affected++)}return affected>0&&this.refresh(),affected},reload:function(callBack){var url;("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request(callBack):"function"==typeof callBack&&callBack()},clear:function(){this.recid=0,this.record={},$().w2tag(),this.refresh()},error:function(msg){var obj=this,edata=this.trigger({target:this.name,type:"error",message:msg,xhr:this.last.xhr});!0!==edata.isCancelled?(setTimeout(function(){obj.message(msg)},1),this.trigger($.extend(edata,{phase:"after"}))):"function"==typeof callBack&&callBack()},message:function(options){"string"==typeof options&&(options={width:options.length<300?350:550,height:options.length<300?170:250,body:'<div class="w2ui-centered">'+options+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(event){setTimeout(function(){$(event.box).find(".w2ui-btn").focus()},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},options)},validate:function(showErrors){null==showErrors&&(showErrors=!0),$().w2tag();for(var errors=[],f=0;f<this.fields.length;f++){var field=this.fields[f];switch(null==this.record[field.name]&&(this.record[field.name]=""),field.type){case"int":this.record[field.name]&&!w2utils.isInt(this.record[field.name])&&errors.push({field:field,error:w2utils.lang("Not an integer")});break;case"float":this.record[field.name]&&!w2utils.isFloat(this.record[field.name])&&errors.push({field:field,error:w2utils.lang("Not a float")});break;case"money":this.record[field.name]&&!w2utils.isMoney(this.record[field.name])&&errors.push({field:field,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.record[field.name]&&!w2utils.isHex(this.record[field.name])&&errors.push({field:field,error:w2utils.lang("Not a hex number")});break;case"email":this.record[field.name]&&!w2utils.isEmail(this.record[field.name])&&errors.push({field:field,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.record[field.name]?this.record[field.name]=1:this.record[field.name]=0;break;case"date":field.options.format||(field.options.format=w2utils.settings.dateFormat),this.record[field.name]&&!w2utils.isDate(this.record[field.name],field.options.format)&&errors.push({field:field,error:w2utils.lang("Not a valid date")+": "+field.options.format})}var val=this.record[field.name];field.required&&(""===val||$.isArray(val)&&0===val.length||$.isPlainObject(val)&&$.isEmptyObject(val))&&errors.push({field:field,error:w2utils.lang("Required field")}),field.equalto&&this.record[field.name]!=this.record[field.equalto]&&errors.push({field:field,error:w2utils.lang("Field should be equal to ")+field.equalto})}var edata=this.trigger({phase:"before",target:this.name,type:"validate",errors:errors});if(!0!==edata.isCancelled){if(showErrors)for(var e=0;e<edata.errors.length;e++){var err=edata.errors[e];null!=err.field&&("radio"==err.field.type?$($(err.field.el).parents("div")[0]).w2tag(err.error,{class:"w2ui-error"}):-1!=["enum","file"].indexOf(err.field.type)?function(err){setTimeout(function(){var fld=$(err.field.el).data("w2field").helpers.multi;$(err.field.el).w2tag(err.error),$(fld).addClass("w2ui-error")},1)}(err):$(err.field.el).w2tag(err.error,{class:"w2ui-error"}),this.goto(errors[0].field.page))}return this.trigger($.extend(edata,{phase:"after"})),errors}},getChanges:function(){var differ=function(record,original,result){for(var i in record)"object"==typeof record[i]?(result[i]=differ(record[i],original[i]||{},{}),result[i]&&!$.isEmptyObject(result[i])||delete result[i]):record[i]!=original[i]&&(result[i]=record[i]);return result};return differ(this.record,this.original,{})},request:function(postData,callBack){var obj=this;if("function"==typeof postData&&(callBack=postData,postData=null),null==postData&&(postData={}),this.url&&("object"!=typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var params={cmd:"get"};params.recid=this.recid,params.name=this.name,$.extend(params,this.postData),$.extend(params,postData);var edata=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params,httpHeaders:this.httpHeaders});if(!0!==edata.isCancelled){this.record={},this.original={},this.lock(w2utils.lang(this.msgRefresh));var url=edata.url;if("object"==typeof edata.url&&edata.url.get&&(url=edata.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text"};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":ajaxOptions.type="GET",ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":ajaxOptions.type="GET",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr});if(!0!==edata.isCancelled){var data,responseText=obj.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"function"==typeof callBack&&callBack(data)}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})}).fail(function(xhr,status,error){var errorObj={status:status,error:error,rawResponseText:xhr.responseText},edata2=obj.trigger({phase:"before",type:"error",error:errorObj,xhr:xhr});if(!0!==edata2.isCancelled){if("abort"!=status){var data;try{data=$.parseJSON(xhr.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof data?data:xhr.responseText)}obj.trigger($.extend(edata2,{phase:"after"}))}}),this.trigger($.extend(edata,{phase:"after"}))}else"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})}},submit:function(postData,callBack){return this.save(postData,callBack)},save:function(postData,callBack){var obj=this;$(this.box).find(":focus").change(),"function"==typeof postData&&(callBack=postData,postData=null);var errors=obj.validate(!0);0===errors.length&&(null==postData&&(postData={}),obj.url&&("object"!=typeof obj.url||obj.url.save)?(obj.lock(w2utils.lang(obj.msgSaving)+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){var params={cmd:"save"};params.recid=obj.recid,params.name=obj.name,$.extend(params,obj.postData),$.extend(params,postData),obj.fields.forEach(function(item){"file"==item.type&&Array.isArray(obj.record[item.field])&&obj.record[item.field].forEach(function(fitem){delete fitem.file})}),params.record=$.extend(!0,{},obj.record);var edata=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params,httpHeaders:obj.httpHeaders});if(!0!==edata.isCancelled){var url=edata.url;if("object"==typeof edata.url&&edata.url.save&&(url=edata.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text",xhr:function(){var xhr=new window.XMLHttpRequest;return xhr.upload.addEventListener("progress",function(evt){if(evt.lengthComputable){var edata3=obj.trigger({phase:"before",type:"progress",total:evt.total,loaded:evt.loaded,originalEvent:evt});if(!0===edata3.isCancelled)return;var percent=Math.round(evt.loaded/evt.total*100);$("#"+obj.name+"_progress").text(percent+"%"),obj.trigger($.extend(edata3,{phase:"after"}))}},!1),xhr}};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),obj.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status});if(!0!==edata.isCancelled){var data,responseText=xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"success"==data.status&&"function"==typeof callBack&&callBack(data)}}).fail(function(xhr,status,error){var errorObj={status:status,error:error,rawResponseText:xhr.responseText},edata2=obj.trigger({phase:"before",type:"error",error:errorObj,xhr:xhr});!0!==edata2.isCancelled&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",errorObj),obj.trigger($.extend(edata2,{phase:"after"})))}),obj.trigger($.extend(edata,{phase:"after"}))}},50)):console.log("ERROR: Form cannot be saved because no url is defined."))},lock:function(msg,showSpinner){var args=Array.prototype.slice.call(arguments,0);args.unshift(this.box),setTimeout(function(){w2utils.lock.apply(window,args)},10)},unlock:function(speed){var box=this.box;setTimeout(function(){w2utils.unlock(box,speed)},25)},goto:function(page){this.page!==page&&(null!=page&&(this.page=page),!0===$(this.box).data("auto-size")&&$(this.box).height(0),this.refresh())},generateHTML:function(){for(var pages=[],group="",page,column,html,f=0;f<this.fields.length;f++){html="";var field=this.fields[f];null==field.html&&(field.html={}),null==field.options&&(field.options={}),field.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",style:"",page:0,column:0},field.html),null==page&&(page=field.html.page),null==column&&(column=field.html.column),""===field.html.caption&&(field.html.caption=field.name);var input='<input name="'+field.name+'" class="w2ui-input" type="text" '+field.html.attr+' tabindex="'+(f+1)+'" value="'+field.value+'" />';switch(field.type){case"pass":case"password":input='<input name="'+field.name+'" class="w2ui-input" type = "password" '+field.html.attr+' tabindex="'+(f+1)+'"/>';break;case"checkbox":input="Yes"==field.value?'<input name="'+field.name+'" class="w2ui-input" type="checkbox" '+field.html.attr+' tabindex="'+(f+1)+'" checked/>':'<input name="'+field.name+'" class="w2ui-input" type="checkbox" '+field.html.attr+' tabindex="'+(f+1)+'"/>';break;case"radio":input="";var items=field.options.items?field.options.items:field.html.items;$.isArray(items)||(items=[]),items.length>0&&(items=w2obj.field.prototype.normMenu(items));for(var i=0;i<items.length;i++)input+='<label><input name="'+field.name+'" class="w2ui-input" type = "radio" '+field.html.attr+' value="'+items[i].id+'"  checked="'+items[i].checked+'" />&#160;'+items[i].text+"</label><br/>";break;case"select":input='<select name="'+field.name+'" class="w2ui-input" '+field.html.attr+' tabindex="'+(f+1)+'">';var items=field.options.items?field.options.items:field.html.items;$.isArray(items)||(items=[]),items.length>0&&(items=w2obj.field.prototype.normMenu(items));for(var i=0;i<items.length;i++)input+='<option value="'+items[i].id+'">'+items[i].text+"</option>";input+="</select>";break;case"textarea":input='<textarea name="'+field.name+'" class="w2ui-input" '+field.html.attr+' tabindex="'+(f+1)+'"></textarea>';break;case"toggle":input='<input name="'+field.name+'" type="checkbox" '+field.html.attr+' class="w2ui-input w2ui-toggle" tabindex="'+(f+1)+'"/><div><div></div></div>';break;case"html":case"custom":case"empty":input=""}""!==group&&(page!=field.html.page||column!=field.html.column||field.html.group&&group!=field.html.group)&&(pages[page][column]+="\n   </div>",group=""),field.html.group&&group!=field.html.group&&(html+='\n   <div class="w2ui-group-title">'+field.html.group+'</div>\n   <div class="w2ui-group">',group=field.html.group),html+='\n      <div class="w2ui-field '+(null!=field.html.span?"w2ui-span"+field.html.span:"")+'" style="'+field.html.style+'">\n         <label>'+w2utils.lang(field.html.caption)+"</label>\n         <div>"+input+w2utils.lang(field.html.text)+"</div>\n      </div>",null==pages[field.html.page]&&(pages[field.html.page]=[]),null==pages[field.html.page][field.html.column]&&(pages[field.html.page][field.html.column]=""),pages[field.html.page][field.html.column]+=html,page=field.html.page,column=field.html.column}if(""!==group&&(pages[page][column]+="\n   </div>"),this.tabs.tabs)for(var i=0;i<this.tabs.tabs.length;i++)null==pages[i]&&(pages[i]=[]);var buttons="";if(!$.isEmptyObject(this.actions)){var addClass="";for(var a in buttons+='\n<div class="w2ui-buttons">',this.actions){var act=this.actions[a],info={caption:"",style:"",class:""};$.isPlainObject(act)?(act.caption&&(info.caption=act.caption),act.style&&(info.style=act.style),act.class&&(info.class=act.class)):(info.caption=a,-1!=["save","update","create"].indexOf(a.toLowerCase())?info.class="w2ui-btn-blue":info.class=""),buttons+='\n    <button name="'+a+'" class="w2ui-btn '+info.class+'" style="'+info.style+'">'+w2utils.lang(info.caption)+"</button>"}buttons+="\n</div>"}html="";for(var p=0;p<pages.length;p++){html+='<div class="w2ui-page page-'+p+'" '+(0===p?"":'style="display: none;"')+'><div class="w2ui-column-container" style="display: flex;">';for(var c=0;c<pages[p].length;c++)html+='<div class="w2ui-column col-'+c+'">'+(pages[p][c]||"")+"\n</div>";html+="\n</div></div>"}return html+=buttons},action:function(action,event){var act=this.actions[action],click=act;$.isPlainObject(act)&&act.onClick&&(click=act.onClick);var edata=this.trigger({phase:"before",target:action,type:"action",click:click,originalEvent:event});!0!==edata.isCancelled&&("function"==typeof click&&click.call(this,event),this.trigger($.extend(edata,{phase:"after"})))},resize:function(){var obj=this,edata=this.trigger({phase:"before",target:this.name,type:"resize"});if(!0!==edata.isCancelled){var main=$(this.box).find("> div.w2ui-form-box"),header=$(this.box).find("> div .w2ui-form-header"),toolbar=$(this.box).find("> div .w2ui-form-toolbar"),tabs=$(this.box).find("> div .w2ui-form-tabs"),page=$(this.box).find("> div .w2ui-page"),cpage=$(this.box).find("> div .w2ui-page.page-"+this.page),dpage=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),buttons=$(this.box).find("> div .w2ui-buttons");resizeElements(),0!==parseInt($(this.box).height())&&!0!==$(this.box).data("auto-size")||($(this.box).height((header.length>0?w2utils.getSize(header,"height"):0)+("object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?w2utils.getSize(tabs,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?w2utils.getSize(toolbar,"height"):0)+(page.length>0?w2utils.getSize(dpage,"height")+w2utils.getSize(cpage,"+height")+12:0)+(buttons.length>0?w2utils.getSize(buttons,"height"):0)),$(this.box).data("auto-size",!0)),resizeElements(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.tabs&&this.tabs.resize&&this.tabs.resize(),obj.trigger($.extend(edata,{phase:"after"}))}function resizeElements(){main.width($(obj.box).width()).height($(obj.box).height()),toolbar.css("top",""!==obj.header?w2utils.getSize(header,"height"):0),tabs.css("top",(""!==obj.header?w2utils.getSize(header,"height"):0)+("object"==typeof obj.toolbar&&$.isArray(obj.toolbar.items)&&obj.toolbar.items.length>0?w2utils.getSize(toolbar,"height"):0)),page.css("top",(""!==obj.header?w2utils.getSize(header,"height"):0)+("object"==typeof obj.toolbar&&$.isArray(obj.toolbar.items)&&obj.toolbar.items.length>0?w2utils.getSize(toolbar,"height")+5:0)+("object"==typeof obj.tabs&&$.isArray(obj.tabs.tabs)&&obj.tabs.tabs.length>0?w2utils.getSize(tabs,"height")+5:0)),page.css("bottom",buttons.length>0?w2utils.getSize(buttons,"height"):0)}},refresh:function(field){var time=(new Date).getTime(),obj=this;if(this.box&&this.isGenerated&&null!=$(this.box).html()){var edata=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:field});if(!0!==edata.isCancelled){if(null!=field)var from_field,to_field=(from_field=obj.get(field,!0))+1;else{$(this.box).find("input, textarea, select").each(function(index,el){var name=null!=$(el).attr("name")?$(el).attr("name"):$(el).attr("id"),field=obj.get(name);if(field){var div=$(el).parents(".w2ui-page");if(div.length>0)for(var i=0;i<100;i++)if(div.hasClass("page-"+i)){field.page=i;break}}}),$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();var from_field=0,to_field=this.fields.length}for(var f=from_field;f<to_field;f++){var field,tmp;null==(field=this.fields[f]).name&&null!=field.field&&(field.name=field.field),null==field.field&&null!=field.name&&(field.field=field.name),field.$el=$(this.box).find('[name="'+String(field.name).replace(/\\/g,"\\\\")+'"]'),field.el=field.$el[0],null==field.el&&console.log('ERROR: Cannot associate field "'+field.name+'" with html control. Make sure html control exists with the same name.'),field.el&&(field.el.id=field.name),(tmp=$(field).data("w2field"))&&tmp.clear(),$(field.$el).off("change").on("change",function(){var value_new=this.value,value_previous=null!=obj.record[this.name]?obj.record[this.name]:"",field=obj.get(this.name);if(-1!=["list","enum","file"].indexOf(field.type)&&$(this).data("selected")){var nv=$(this).data("selected"),cv=obj.record[this.name];if($.isArray(nv)){value_new=[];for(var i=0;i<nv.length;i++)value_new[i]=$.extend(!0,{},nv[i])}if($.isPlainObject(nv)&&(value_new=$.extend(!0,{},nv)),$.isArray(cv)){value_previous=[];for(var i=0;i<cv.length;i++)value_previous[i]=$.extend(!0,{},cv[i])}$.isPlainObject(cv)&&(value_previous=$.extend(!0,{},cv))}if(-1!=["toggle","checkbox"].indexOf(field.type)&&(value_new=!!$(this).prop("checked")&&("on"==$(this).prop("value")||$(this).prop("value"))),-1!=["int","float","percent","money","currency"].indexOf(field.type)&&(value_new=$(this).data("w2field").clean(value_new)),value_new!==value_previous){var edata2=obj.trigger({phase:"before",target:this.name,type:"change",value_new:value_new,value_previous:value_previous});if(!0!==edata2.isCancelled){var val=this.value;if("select"==this.type&&(val=this.value),"checkbox"==this.type&&(val=!!this.checked),"radio"==this.type&&field.$el.each(function(index,el){el.checked&&(val=el.value)}),-1!=["int","float","percent","money","currency","list","combo","enum","file","toggle"].indexOf(field.type)&&(val=value_new),-1!=["enum","file"].indexOf(field.type)&&val.length>0){var fld=$(field.el).data("w2field").helpers.multi;$(fld).removeClass("w2ui-error")}(""===val||null==val||$.isArray(val)&&0===val.length||$.isPlainObject(val)&&$.isEmptyObject(val))&&(val=null),obj.record[this.name]=val,obj.trigger($.extend(edata2,{phase:"after"}))}else $(this).val(obj.record[this.name])}}),field.required?$(field.el).parent().parent().addClass("w2ui-required"):$(field.el).parent().parent().removeClass("w2ui-required"),null!=field.disabled&&(field.disabled?$(field.el).prop("readonly",!0):$(field.el).prop("readonly",!1)),field.hidden?$(field.el).parent().parent().hide():$(field.el).parent().parent().show()}$(this.box).find("button, input[type=button]").each(function(index,el){$(el).off("click").on("click",function(event){var action=this.value;this.id&&(action=this.id),this.name&&(action=this.name),obj.action(action,event)})});for(var f=from_field;f<to_field;f++){var field=this.fields[f],value=null!=this.record[field.name]?this.record[field.name]:"";if(field.el)switch($(field.el).hasClass("w2ui-input")||$(field.el).addClass("w2ui-input"),field.type=String(field.type).toLowerCase(),field.options||(field.options={}),field.type){case"text":case"textarea":case"email":case"pass":case"password":field.el.value=value;break;case"int":case"float":case"money":case"currency":case"percent":field.el.value=value,$(field.el).w2field($.extend({},field.options,{type:field.type}));break;case"hex":case"alphanumeric":case"color":case"date":case"time":field.el.value=value,$(field.el).w2field($.extend({},field.options,{type:field.type}));break;case"toggle":w2utils.isFloat(value)&&(value=parseFloat(value)),$(field.el).prop("checked",!!value),this.record[field.name]=value||!1;break;case"list":case"combo":if("list"==field.type){var tmp_value=$.isPlainObject(value)?value.id:$.isPlainObject(field.options.selected)?field.options.selected.id:value;field.options.items||(field.options.items=[]);var items=field.options.items;$.isArray(items)&&items.length>0&&!$.isPlainObject(items[0])&&(field.options.items=w2obj.field.prototype.normMenu(items));for(var i=0;i<field.options.items.length;i++){var item=field.options.items[i];if(item.id==tmp_value){value=$.extend(!0,{},item),obj.record[field.name]=value;break}}}else"combo"!=field.type||$.isPlainObject(value)?$.isPlainObject(value)&&null!=value.text?field.el.value=value.text:field.el.value="":field.el.value=value;$.isPlainObject(value)||(value={}),$(field.el).w2field($.extend({},field.options,{type:field.type,selected:value}));break;case"enum":case"file":$.isArray(value)||(value=[]),$(field.el).w2field($.extend({},field.options,{type:field.type,selected:value}));break;case"select":var items;if(null!=(items=field.options.items)&&items.length>0){items=w2obj.field.prototype.normMenu(items),$(field.el).html("");for(var it=0;it<items.length;it++)$(field.el).append('<option value="'+items[it].id+'">'+items[it].text+"</option")}$(field.el).val(value);break;case"radio":$(field.$el).prop("checked",!1).each(function(index,el){$(el).val()==value&&$(el).prop("checked",!0)});break;case"checkbox":$(field.el).prop("checked",!!value);break;case"html":case"custom":case"empty":break;default:$(field.el).val(value),$(field.el).w2field($.extend({},field.options,{type:field.type}))}}for(var tmp=$(this.box).find(".w2ui-page"),i=0;i<tmp.length;i++)$(tmp[i]).find("> *").length>1&&$(tmp[i]).wrapInner("<div></div>");return this.trigger($.extend(edata,{phase:"after"})),this.resize(),(new Date).getTime()-time}}},render:function(box){var time=(new Date).getTime(),obj=this;if("object"==typeof box&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=box),this.isGenerated&&this.box){var edata=this.trigger({phase:"before",target:this.name,type:"render",box:null!=box?box:this.box});if(!0!==edata.isCancelled){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var html='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>",url;return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(html),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(event){var edata=obj.trigger({phase:"before",type:"toolbar",target:event.target,originalEvent:event});!0!==edata.isCancelled&&obj.trigger($.extend(edata,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(event){obj.goto(this.get(event.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger($.extend(edata,{phase:"after"})),this.resize(),("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===$(".w2ui-layout").length&&(this.tmp_resize=function(event){w2ui[obj.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize)),this.focus>=0&&setTimeout(function(){0===$(obj.box).find("input, select, textarea").length?setTimeout(focusEl,500):focusEl()},10),(new Date).getTime()-time}}function focusEl(){var inputs=$(obj.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");inputs.length>obj.focus&&inputs[obj.focus].focus()}},destroy:function(){var edata=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==edata.isCancelled&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(edata,{phase:"after"})),$(window).off("resize","body"))}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}(jQuery);